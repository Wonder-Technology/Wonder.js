!function(t,e){"undefined"!=typeof module&&module.exports?module.exports.browser=e():"function"==typeof define&&define.amd?define(e):this[t]=e()}("bowser",function(){function t(t){function r(e){var r=t.match(e);return r&&r.length>1&&r[1]||""}var n,o=r(/(ipod|iphone|ipad)/i).toLowerCase(),i=/like android/i.test(t),a=!i&&/android/i.test(t),s=r(/version\/(\d+(\.\d+)?)/i),c=/tablet/i.test(t),u=!c&&/[^-]mobi/i.test(t);/opera|opr/i.test(t)?n={name:"Opera",opera:e,version:s||r(/(?:opera|opr)[\s\/](\d+(\.\d+)?)/i)}:/windows phone/i.test(t)?n={name:"Windows Phone",windowsphone:e,msie:e,version:r(/iemobile\/(\d+(\.\d+)?)/i)}:/msie|trident/i.test(t)?n={name:"Internet Explorer",msie:e,version:r(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:/chrome|crios|crmo/i.test(t)?n={name:"Chrome",chrome:e,version:r(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:o?(n={name:"iphone"==o?"iPhone":"ipad"==o?"iPad":"iPod"},s&&(n.version=s)):/sailfish/i.test(t)?n={name:"Sailfish",sailfish:e,version:r(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(t)?n={name:"SeaMonkey",seamonkey:e,version:r(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel/i.test(t)?(n={name:"Firefox",firefox:e,version:r(/(?:firefox|iceweasel)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(t)&&(n.firefoxos=e)):/silk/i.test(t)?n={name:"Amazon Silk",silk:e,version:r(/silk\/(\d+(\.\d+)?)/i)}:a?n={name:"Android",version:s}:/phantom/i.test(t)?n={name:"PhantomJS",phantom:e,version:r(/phantomjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(t)||/rim\stablet/i.test(t)?n={name:"BlackBerry",blackberry:e,version:s||r(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:/(web|hpw)os/i.test(t)?(n={name:"WebOS",webos:e,version:s||r(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(t)&&(n.touchpad=e)):n=/bada/i.test(t)?{name:"Bada",bada:e,version:r(/dolfin\/(\d+(\.\d+)?)/i)}:/tizen/i.test(t)?{name:"Tizen",tizen:e,version:r(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||s}:/safari/i.test(t)?{name:"Safari",safari:e,version:s}:{},/(apple)?webkit/i.test(t)?(n.name=n.name||"Webkit",n.webkit=e,!n.version&&s&&(n.version=s)):!n.opera&&/gecko\//i.test(t)&&(n.name=n.name||"Gecko",n.gecko=e,n.version=n.version||r(/gecko\/(\d+(\.\d+)?)/i)),a||n.silk?n.android=e:o&&(n[o]=e,n.ios=e);var h="";o?(h=r(/os (\d+([_\s]\d+)*) like mac os x/i),h=h.replace(/[_\s]/g,".")):a?h=r(/android[ \/-](\d+(\.\d+)*)/i):n.windowsphone?h=r(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):n.webos?h=r(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):n.blackberry?h=r(/rim\stablet\sos\s(\d+(\.\d+)*)/i):n.bada?h=r(/bada\/(\d+(\.\d+)*)/i):n.tizen&&(h=r(/tizen[\/\s](\d+(\.\d+)*)/i)),h&&(n.osversion=h);var l=h.split(".")[0];return c||"ipad"==o||a&&(3==l||4==l&&!u)||n.silk?n.tablet=e:(u||"iphone"==o||"ipod"==o||a||n.blackberry||n.webos||n.bada)&&(n.mobile=e),n.msie&&n.version>=10||n.chrome&&n.version>=20||n.firefox&&n.version>=20||n.safari&&n.version>=6||n.opera&&n.version>=10||n.ios&&n.osversion&&n.osversion.split(".")[0]>=6||n.blackberry&&n.version>=10.1?n.a=e:n.msie&&n.version<10||n.chrome&&n.version<20||n.firefox&&n.version<20||n.safari&&n.version<6||n.opera&&n.version<10||n.ios&&n.osversion&&n.osversion.split(".")[0]<6?n.c=e:n.x=e,n}var e=!0,r=t("undefined"!=typeof navigator?navigator.userAgent:"");return r._detect=t,r}),function(){"use strict";function t(t){return"function"==typeof t||"object"==typeof t&&null!==t}function e(t){return"function"==typeof t}function r(t){return"object"==typeof t&&null!==t}function n(){}function o(t,e){for(var r=0,n=t.length;n>r;r++)if(t[r]===e)return r;return-1}function i(t){var e=t._promiseCallbacks;return e||(e=t._promiseCallbacks={}),e}function a(t,e){return"onerror"===t?void wt.on("error",e):2!==arguments.length?wt[t]:void(wt[t]=e)}function s(){setTimeout(function(){for(var t,e=0;e<Ct.length;e++){t=Ct[e];var r=t.payload;r.guid=r.key+r.id,r.childGuid=r.key+r.childId,r.error&&(r.stack=r.error.stack),wt.trigger(t.name,t.payload)}Ct.length=0},50)}function c(t,e,r){1===Ct.push({name:t,payload:{key:e._guidKey,id:e._id,eventName:t,detail:e._result,childId:r&&r._id,label:e._label,timeStamp:gt(),error:wt["instrument-with-stack"]?new Error(e._label):null}})&&s()}function u(){return new TypeError("A promises callback cannot return that same promise.")}function h(){}function l(t){try{return t.then}catch(e){return xt.error=e,xt}}function p(t,e,r,n){try{t.call(e,r,n)}catch(o){return o}}function f(t,e,r){wt.async(function(t){var n=!1,o=p(r,e,function(r){n||(n=!0,e!==r?y(t,r):g(t,r))},function(e){n||(n=!0,v(t,e))},"Settle: "+(t._label||" unknown promise"));!n&&o&&(n=!0,v(t,o))},t)}function d(t,e){e._state===Dt?g(t,e._result):e._state===Ot?(e._onError=null,v(t,e._result)):b(e,void 0,function(r){e!==r?y(t,r):g(t,r)},function(e){v(t,e)})}function _(t,r){if(r.constructor===t.constructor)d(t,r);else{var n=l(r);n===xt?v(t,xt.error):void 0===n?g(t,r):e(n)?f(t,r,n):g(t,r)}}function y(e,r){e===r?g(e,r):t(r)?_(e,r):g(e,r)}function m(t){t._onError&&t._onError(t._result),w(t)}function g(t,e){t._state===St&&(t._result=e,t._state=Dt,0===t._subscribers.length?wt.instrument&&Tt("fulfilled",t):wt.async(w,t))}function v(t,e){t._state===St&&(t._state=Ot,t._result=e,wt.async(m,t))}function b(t,e,r,n){var o=t._subscribers,i=o.length;t._onError=null,o[i]=e,o[i+Dt]=r,o[i+Ot]=n,0===i&&t._state&&wt.async(w,t)}function w(t){var e=t._subscribers,r=t._state;if(wt.instrument&&Tt(r===Dt?"fulfilled":"rejected",t),0!==e.length){for(var n,o,i=t._result,a=0;a<e.length;a+=3)n=e[a],o=e[a+r],n?S(r,n,o,i):o(i);t._subscribers.length=0}}function C(){this.error=null}function T(t,e){try{return t(e)}catch(r){return Et.error=r,Et}}function S(t,r,n,o){var i,a,s,c,h=e(n);if(h){if(i=T(n,o),i===Et?(c=!0,a=i.error,i=null):s=!0,r===i)return void v(r,u())}else i=o,s=!0;r._state!==St||(h&&s?y(r,i):c?v(r,a):t===Dt?g(r,i):t===Ot&&v(r,i))}function D(t,e){var r=!1;try{e(function(e){r||(r=!0,y(t,e))},function(e){r||(r=!0,v(t,e))})}catch(n){v(t,n)}}function O(t,e,r){return t===Dt?{state:"fulfilled",value:r}:{state:"rejected",reason:r}}function x(t,e,r,n){this._instanceConstructor=t,this.promise=new t(h,n),this._abortOnReject=r,this._validateInput(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._init(),0===this.length?g(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&g(this.promise,this._result))):v(this.promise,this._validationError())}function E(t,e){return new Mt(this,t,!0,e).promise}function M(t,e){function r(t){y(i,t)}function n(t){v(i,t)}var o=this,i=new o(h,e);if(!mt(t))return v(i,new TypeError("You must pass an array to race.")),i;for(var a=t.length,s=0;i._state===St&&a>s;s++)b(o.resolve(t[s]),void 0,r,n);return i}function L(t,e){var r=this;if(t&&"object"==typeof t&&t.constructor===r)return t;var n=new r(h,e);return y(n,t),n}function A(t,e){var r=this,n=new r(h,e);return v(n,t),n}function P(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function R(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function F(t,r){this._id=Nt++,this._label=r,this._state=void 0,this._result=void 0,this._subscribers=[],wt.instrument&&Tt("created",this),h!==t&&(e(t)||P(),this instanceof F||R(),D(this,t))}function N(t,e,r){this._superConstructor(t,e,!1,r)}function U(t,e){return new N(Ut,t,e).promise}function B(t,e){return Ut.all(t,e)}function I(t,e){Kt[Gt]=t,Kt[Gt+1]=e,Gt+=2,2===Gt&&It()}function j(){var t=process.nextTick,e=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(e)&&"0"===e[1]&&"10"===e[2]&&(t=setImmediate),function(){t(W)}}function V(){return function(){Bt(W)}}function G(){var t=0,e=new zt(W),r=document.createTextNode("");return e.observe(r,{characterData:!0}),function(){r.data=t=++t%2}}function k(){var t=new MessageChannel;return t.port1.onmessage=W,function(){t.port2.postMessage(0)}}function H(){return function(){setTimeout(W,1)}}function W(){for(var t=0;Gt>t;t+=2){var e=Kt[t],r=Kt[t+1];e(r),Kt[t]=void 0,Kt[t+1]=void 0}Gt=0}function z(){try{var t=require,e=t("vertx");return Bt=e.runOnLoop||e.runOnContext,V()}catch(r){return H()}}function q(t){var e={};return e.promise=new Ut(function(t,r){e.resolve=t,e.reject=r},t),e}function X(t,r,n){return Ut.all(t,n).then(function(t){if(!e(r))throw new TypeError("You must pass a function as filter's second argument.");for(var o=t.length,i=new Array(o),a=0;o>a;a++)i[a]=r(t[a]);return Ut.all(i,n).then(function(e){for(var r=new Array(o),n=0,i=0;o>i;i++)e[i]&&(r[n]=t[i],n++);return r.length=n,r})})}function K(t,e,r){this._superConstructor(t,e,!0,r)}function J(t,e,r){this._superConstructor(t,e,!1,r)}function Y(t,e){return new J(Ut,t,e).promise}function Q(t,e){return new Qt(Ut,t,e).promise}function $(t,r,n){return Ut.all(t,n).then(function(t){if(!e(r))throw new TypeError("You must pass a function as map's second argument.");for(var o=t.length,i=new Array(o),a=0;o>a;a++)i[a]=r(t[a]);return Ut.all(i,n)})}function Z(){this.value=void 0}function tt(t){try{return t.then}catch(e){return ee.value=e,ee}}function et(t,e,r){try{t.apply(e,r)}catch(n){return ee.value=n,ee}}function rt(t,e){for(var r,n,o={},i=t.length,a=new Array(i),s=0;i>s;s++)a[s]=t[s];for(n=0;n<e.length;n++)r=e[n],o[r]=a[n+1];return o}function nt(t){for(var e=t.length,r=new Array(e-1),n=1;e>n;n++)r[n-1]=t[n];return r}function ot(t,e){return{then:function(r,n){return t.call(e,r,n)}}}function it(t,e){var r=function(){for(var r,n=this,o=arguments.length,i=new Array(o+1),a=!1,s=0;o>s;++s){if(r=arguments[s],!a){if(a=ct(r),a===re){var c=new Ut(h);return v(c,re.value),c}a&&a!==!0&&(r=ot(a,r))}i[s]=r}var u=new Ut(h);return i[o]=function(t,r){t?v(u,t):void 0===e?y(u,r):e===!0?y(u,nt(arguments)):mt(e)?y(u,rt(arguments,e)):y(u,r)},a?st(u,i,t,n):at(u,i,t,n)};return r.__proto__=t,r}function at(t,e,r,n){var o=et(r,n,e);return o===ee&&v(t,o.value),t}function st(t,e,r,n){return Ut.all(e).then(function(e){var o=et(r,n,e);return o===ee&&v(t,o.value),t})}function ct(t){return t&&"object"==typeof t?t.constructor===Ut?!0:tt(t):!1}function ut(t,e){return Ut.race(t,e)}function ht(t,e){return Ut.reject(t,e)}function lt(t,e){return Ut.resolve(t,e)}function pt(t){throw setTimeout(function(){throw t}),t}function ft(t,e){wt.async(t,e)}function dt(){wt.on.apply(wt,arguments)}function _t(){wt.off.apply(wt,arguments)}var yt;yt=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var mt=yt,gt=Date.now||function(){return(new Date).getTime()},vt=Object.create||function(t){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof t)throw new TypeError("Argument must be an object");return n.prototype=t,new n},bt={mixin:function(t){return t.on=this.on,t.off=this.off,t.trigger=this.trigger,t._promiseCallbacks=void 0,t},on:function(t,e){var r,n=i(this);r=n[t],r||(r=n[t]=[]),-1===o(r,e)&&r.push(e)},off:function(t,e){var r,n,a=i(this);return e?(r=a[t],n=o(r,e),void(-1!==n&&r.splice(n,1))):void(a[t]=[])},trigger:function(t,e){var r,n,o=i(this);if(r=o[t])for(var a=0;a<r.length;a++)(n=r[a])(e)}},wt={instrument:!1};bt.mixin(wt);var Ct=[],Tt=c,St=void 0,Dt=1,Ot=2,xt=new C,Et=new C,Mt=x;x.prototype._validateInput=function(t){return mt(t)},x.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},x.prototype._init=function(){this._result=new Array(this.length)},x.prototype._enumerate=function(){for(var t=this.length,e=this.promise,r=this._input,n=0;e._state===St&&t>n;n++)this._eachEntry(r[n],n)},x.prototype._eachEntry=function(t,e){var n=this._instanceConstructor;r(t)?t.constructor===n&&t._state!==St?(t._onError=null,this._settledAt(t._state,e,t._result)):this._willSettleAt(n.resolve(t),e):(this._remaining--,this._result[e]=this._makeResult(Dt,e,t))},x.prototype._settledAt=function(t,e,r){var n=this.promise;n._state===St&&(this._remaining--,this._abortOnReject&&t===Ot?v(n,r):this._result[e]=this._makeResult(t,e,r)),0===this._remaining&&g(n,this._result)},x.prototype._makeResult=function(t,e,r){return r},x.prototype._willSettleAt=function(t,e){var r=this;b(t,void 0,function(t){r._settledAt(Dt,e,t)},function(t){r._settledAt(Ot,e,t)})};var Lt=E,At=M,Pt=L,Rt=A,Ft="rsvp_"+gt()+"-",Nt=0,Ut=F;F.cast=Pt,F.all=Lt,F.race=At,F.resolve=Pt,F.reject=Rt,F.prototype={constructor:F,_guidKey:Ft,_onError:function(t){wt.async(function(e){setTimeout(function(){e._onError&&wt.trigger("error",t)},0)},this)},then:function(t,e,r){var n=this,o=n._state;if(o===Dt&&!t||o===Ot&&!e)return wt.instrument&&Tt("chained",this,this),this;n._onError=null;var i=new this.constructor(h,r),a=n._result;if(wt.instrument&&Tt("chained",n,i),o){var s=arguments[o-1];wt.async(function(){S(o,i,s,a)})}else b(n,i,t,e);return i},"catch":function(t,e){return this.then(null,t,e)},"finally":function(t,e){var r=this.constructor;return this.then(function(e){return r.resolve(t()).then(function(){return e})},function(e){return r.resolve(t()).then(function(){throw e})},e)}},N.prototype=vt(Mt.prototype),N.prototype._superConstructor=Mt,N.prototype._makeResult=O,N.prototype._validationError=function(){return new Error("allSettled must be called with an array")};var Bt,It,jt=U,Vt=B,Gt=0,kt=({}.toString,I),Ht="undefined"!=typeof window?window:void 0,Wt=Ht||{},zt=Wt.MutationObserver||Wt.WebKitMutationObserver,qt="undefined"!=typeof process&&"[object process]"==={}.toString.call(process),Xt="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Kt=new Array(1e3);It=qt?j():zt?G():Xt?k():void 0===Ht&&"function"==typeof require?z():H();var Jt=q,Yt=X,Qt=K;K.prototype=vt(Mt.prototype),K.prototype._superConstructor=Mt,K.prototype._init=function(){this._result={}},K.prototype._validateInput=function(t){return t&&"object"==typeof t},K.prototype._validationError=function(){return new Error("Promise.hash must be called with an object")},K.prototype._enumerate=function(){var t=this.promise,e=this._input,r=[];for(var n in e)t._state===St&&Object.prototype.hasOwnProperty.call(e,n)&&r.push({position:n,entry:e[n]});var o=r.length;this._remaining=o;for(var i,a=0;t._state===St&&o>a;a++)i=r[a],this._eachEntry(i.entry,i.position)},J.prototype=vt(Qt.prototype),J.prototype._superConstructor=Mt,J.prototype._makeResult=O,J.prototype._validationError=function(){return new Error("hashSettled must be called with an object")};var $t=Y,Zt=Q,te=$,ee=new Z,re=new Z,ne=it,oe=ut,ie=ht,ae=lt,se=pt;wt.async=kt;if("undefined"!=typeof window&&"object"==typeof window.__PROMISE_INSTRUMENTATION__){var ce=window.__PROMISE_INSTRUMENTATION__;a("instrument",!0);for(var ue in ce)ce.hasOwnProperty(ue)&&dt(ue,ce[ue])}var he={race:oe,Promise:Ut,allSettled:jt,hash:Zt,hashSettled:$t,denodeify:ne,on:dt,off:_t,map:te,filter:Yt,resolve:ae,reject:ie,all:Vt,rethrow:se,defer:Jt,EventTarget:bt,configure:a,async:ft};"function"==typeof define&&define.amd?define(function(){return he}):"undefined"!=typeof module&&module.exports?module.exports=he:"undefined"!=typeof this&&(this.RSVP=he)}.call(this);var wdCb;!function(t){var e=function(){function t(){}return t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"===Object.prototype.toString.call(t)},t.isNumber=function(t){return"[object Number]"===Object.prototype.toString.call(t)},t.isString=function(t){return"[object String]"===Object.prototype.toString.call(t)},t.isBoolean=function(t){return"[object Boolean]"===Object.prototype.toString.call(t)},t.isDom=function(t){return t instanceof HTMLElement},t.isDirectObject=function(t){return"[object Object]"===Object.prototype.toString.call(t)?!0:!1},t.isHostMethod=function(t,e){var r=typeof t[e];return"function"===r||"object"===r&&!!t[e]||"unknown"===r},t.isNodeJs=function(){return("undefined"!=typeof global&&global.module||"undefined"!=typeof module)&&"undefined"!=typeof module.exports},t}();t.JudgeUtils=e}(wdCb||(wdCb={}));var wdCb;!function(t){Object.defineProperty(t,"root",{get:function(){return t.JudgeUtils.isNodeJs()?global:window}})}(wdCb||(wdCb={}));var wdCb;!function(t){if("performance"in t.root==!1&&(t.root.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in t.root.performance==!1){var e=t.root.performance.timing&&t.root.performance.timing.navigationStart?performance.timing.navigationStart:Date.now();t.root.performance.now=function(){return Date.now()-e}}}(wdCb||(wdCb={}));var wdCb;!function(t){t.$BREAK={"break":!0},t.$REMOVE=void 0}(wdCb||(wdCb={}));var wdCb;!function(t){var e=function(){function e(){}return e.log=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];this._exec("log",e)||t.root.alert(e.join(",")),this._exec("trace",e)},e.assert=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];t&&(this._exec("assert",arguments,1)||this.log.apply(this,Array.prototype.slice.call(arguments,1)))},e.error=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t)throw new Error(Array.prototype.slice.call(arguments,1).join("\n"))},e.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var r=this._exec("warn",arguments);r?this._exec("trace",["warn trace"]):this.log.apply(this,arguments)},e._exec=function(e,r,n){return void 0===n&&(n=0),t.root.console&&t.root.console[e]?(t.root.console[e].apply(t.root.console,Array.prototype.slice.call(r,n)),!0):!1},e.info={INVALID_PARAM:"invalid parameter",ABSTRACT_ATTRIBUTE:"abstract attribute need override",ABSTRACT_METHOD:"abstract method need override",helperFunc:function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var r="";return t.forEach(function(t){r+=String(t)+" "}),r.slice(0,-1)},assertion:function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];if(2===t.length)return this.helperFunc(t[0],t[1]);if(3===t.length)return this.helperFunc(t[1],t[0],t[2]);throw new Error("args.length must <= 3")},FUNC_INVALID:function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return t.unshift("invalid"),this.assertion.apply(this,t)},FUNC_MUST:function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return t.unshift("must"),this.assertion.apply(this,t)},FUNC_MUST_BE:function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return t.unshift("must be"),this.assertion.apply(this,t)},FUNC_MUST_NOT_BE:function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return t.unshift("must not be"),this.assertion.apply(this,t)},FUNC_SHOULD:function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return t.unshift("should"),this.assertion.apply(this,t)},FUNC_SHOULD_NOT:function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return t.unshift("should not"),this.assertion.apply(this,t)},FUNC_SUPPORT:function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return t.unshift("support"),this.assertion.apply(this,t)},FUNC_NOT_SUPPORT:function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return t.unshift("not support"),this.assertion.apply(this,t)},FUNC_MUST_DEFINE:function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return t.unshift("must define"),this.assertion.apply(this,t)},FUNC_MUST_NOT_DEFINE:function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return t.unshift("must not define"),this.assertion.apply(this,t)},FUNC_UNKNOW:function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return t.unshift("unknow"),this.assertion.apply(this,t)},FUNC_EXPECT:function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return t.unshift("expect"),this.assertion.apply(this,t)},FUNC_UNEXPECT:function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return t.unshift("unexpect"),this.assertion.apply(this,t)},FUNC_NOT_EXIST:function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return t.unshift("not exist"),this.assertion.apply(this,t)}},e}();t.Log=e}(wdCb||(wdCb={}));var wdCb;!function(t){var e=function(){function e(){this.children=null}return e.prototype.getCount=function(){return this.children.length},e.prototype.hasChild=function(e){if(t.JudgeUtils.isFunction(arguments[0])){var r=arguments[0];return this._contain(this.children,function(t,e){return r(t,e)})}var n=arguments[0];return this._contain(this.children,function(t,e){return t===n||t.uid&&n.uid&&t.uid===n.uid?!0:!1})},e.prototype.getChildren=function(){return this.children},e.prototype.getChild=function(t){return this.children[t]},e.prototype.addChild=function(t){return this.children.push(t),this},e.prototype.addChildren=function(r){if(t.JudgeUtils.isArray(r)){var n=r;this.children=this.children.concat(n)}else if(r instanceof e){var n=r;this.children=this.children.concat(n.getChildren())}else{var o=r;this.addChild(o)}return this},e.prototype.unShiftChild=function(t){this.children.unshift(t)},e.prototype.removeAllChildren=function(){return this.children=[],this},e.prototype.forEach=function(t,e){return this._forEach(this.children,t,e),this},e.prototype.toArray=function(){return this.children},e.prototype.copyChildren=function(){return this.children.slice(0)},e.prototype.removeChildHelper=function(e){var r=null;if(t.JudgeUtils.isFunction(e)){var n=e;r=this._removeChild(this.children,n)}else r=e.uid?this._removeChild(this.children,function(t){return t.uid?t.uid===e.uid:!1}):this._removeChild(this.children,function(t){return t===e});return r},e.prototype._indexOf=function(e,r){var n=-1;if(t.JudgeUtils.isFunction(r)){var o=r;this._forEach(e,function(e,r){return o.call(null,e,r)?(n=r,t.$BREAK):void 0})}else{var i=r;this._forEach(e,function(e,r){return i===e||e.contain&&e.contain(i)||e.indexOf&&e.indexOf(i)>-1?(n=r,t.$BREAK):void 0})}return n},e.prototype._contain=function(t,e){return this._indexOf(t,e)>-1},e.prototype._forEach=function(e,r,n){var o=n||t.root,i=0,a=e.length;for(i=0;a>i&&r.call(o,e[i],i)!==t.$BREAK;i++);},e.prototype._removeChild=function(t,e){var r=this,n=[],o=[];return this._forEach(t,function(t,i){e.call(r,t)?n.push(t):o.push(t)}),this.children=o,n},e}();t.List=e}(wdCb||(wdCb={}));var wdCb;!function(t){var e=function(){function e(t){void 0===t&&(t={}),this._children=null,this._children=t}return e.create=function(t){void 0===t&&(t={});var e=new this(t);return e},e.prototype.getChildren=function(){return this._children},e.prototype.getCount=function(){var t=0,e=this._children,r=null;for(r in e)e.hasOwnProperty(r)&&t++;return t},e.prototype.getKeys=function(){var e=t.Collection.create(),r=this._children,n=null;for(n in r)r.hasOwnProperty(n)&&e.addChild(n);return e},e.prototype.getValues=function(){var e=t.Collection.create(),r=this._children,n=null;for(n in r)r.hasOwnProperty(n)&&e.addChild(r[n]);return e},e.prototype.getChild=function(t){return this._children[t]},e.prototype.setValue=function(t,e){return this._children[t]=e,this},e.prototype.addChild=function(t,e){return this._children[t]=e,this},e.prototype.addChildren=function(t){var r=null,n=null;n=t instanceof e?t.getChildren():t;for(r in n)n.hasOwnProperty(r)&&this.addChild(r,n[r])},e.prototype.appendChild=function(e,r){if(this._children[e]instanceof t.Collection){var n=this._children[e];n.addChild(r)}else this._children[e]=t.Collection.create().addChild(r);return this},e.prototype.removeChild=function(e){var r=[];if(t.JudgeUtils.isString(e)){var n=e;r.push(this._children[n]),this._children[n]=void 0,delete this._children[n]}else if(t.JudgeUtils.isFunction(e)){var o=e,i=this;this.forEach(function(t,e){o(t,e)&&(r.push(i._children[e]),i._children[e]=void 0,delete i._children[e])})}return t.Collection.create(r)},e.prototype.removeAllChildren=function(){this._children={}},e.prototype.hasChild=function(e){if(t.JudgeUtils.isFunction(arguments[0])){var r=arguments[0],n=!1;return this.forEach(function(e,o){return r(e,o)?(n=!0,t.$BREAK):void 0}),n}var o=arguments[0];return!!this._children[o]},e.prototype.forEach=function(e,r){var n=null,o=this._children;for(n in o)if(o.hasOwnProperty(n)&&e.call(r,o[n],n)===t.$BREAK)break;return this},e.prototype.filter=function(t){var r={},n=this._children;return this.forEach(function(e,o){t.call(n,e,o)&&(r[o]=e)}),e.create(r)},e.prototype.findOne=function(e){var r=[],n=this,o=this._children;return this.forEach(function(i,a){return e.call(o,i,a)?(r=[a,n.getChild(a)],t.$BREAK):void 0}),r},e.prototype.map=function(r){var n={};return this.forEach(function(e,o){var i=r(e,o);i!==t.$REMOVE&&(t.Log.error(!t.JudgeUtils.isArray(i)||2!==i.length,t.Log.info.FUNC_MUST_BE("iterator","[key, value]")),n[i[0]]=i[1])}),e.create(n)},e.prototype.toCollection=function(){var r=t.Collection.create();return this.forEach(function(n,o){n instanceof t.Collection?r.addChildren(n):n instanceof e?t.Log.error(!0,t.Log.info.FUNC_NOT_SUPPORT("toCollection","value is Hash")):r.addChild(n)}),r},e}();t.Hash=e}(wdCb||(wdCb={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdCb;!function(t){var e=function(t){function e(e){void 0===e&&(e=[]),t.call(this),this.children=e}return __extends(e,t),e.create=function(t){void 0===t&&(t=[]);var e=new this(t);return e},e.prototype.push=function(t){this.children.unshift(t)},e.prototype.pop=function(){return this.children.pop()},e.prototype.clear=function(){this.removeAllChildren()},e}(t.List);t.Queue=e}(wdCb||(wdCb={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdCb;!function(t){var e=function(t){function e(e){void 0===e&&(e=[]),t.call(this),this.children=e}return __extends(e,t),e.create=function(t){void 0===t&&(t=[]);var e=new this(t);return e},e.prototype.push=function(t){this.children.push(t)},e.prototype.pop=function(){return this.children.pop()},e.prototype.clear=function(){this.removeAllChildren()},e}(t.List);t.Stack=e}(wdCb||(wdCb={}));var wdCb;!function(wdCb){var AjaxUtils=function(){function AjaxUtils(){}return AjaxUtils.ajax=function(conf){var type=conf.type,url=conf.url,data=conf.data,dataType=conf.dataType,success=conf.success,error=conf.error,xhr=null,self=this;if(null===type&&(type="get"),null===dataType&&(dataType="text"),xhr=this._createAjax(error))try{xhr.open(type,url,!0),this._isSoundFile(dataType)&&(xhr.responseType="arraybuffer"),"GET"===type||"get"===type?xhr.send(null):("POST"===type||"post"===type)&&(xhr.setRequestHeader("content-type","application/x-www-form-urlencoded"),xhr.send(data)),xhr.onreadystatechange=function(){4!==xhr.readyState||200!==xhr.status&&!self._isLocalFile(xhr.status)||("text"===dataType||"TEXT"===dataType?null!==success&&success(xhr.responseText):"xml"===dataType||"XML"===dataType?null!==success&&success(xhr.responseXML):"json"===dataType||"JSON"===dataType?null!==success&&success(eval("("+xhr.responseText+")")):self._isSoundFile(dataType)&&null!==success&&success(xhr.response))}}catch(e){error(xhr,e)}},AjaxUtils._createAjax=function(t){var e=null;try{e=new ActiveXObject("microsoft.xmlhttp")}catch(r){try{e=new XMLHttpRequest}catch(n){return t(e,{message:"您的浏览器不支持ajax，请更换！"}),null}}return e},AjaxUtils._isLocalFile=function(t){return document.URL.contain("file://")&&0===t},AjaxUtils._isSoundFile=function(t){return"arraybuffer"===t},AjaxUtils}();wdCb.AjaxUtils=AjaxUtils}(wdCb||(wdCb={}));var wdCb;!function(t){var e=function(){function e(){}return e.removeRepeatItems=function(t,e){void 0===e&&(e=function(t,e){return t===e});var r=[],n=this;return t.forEach(function(t){n.contain(r,function(r){return e(r,t)})||r.push(t)}),r},e.contain=function(e,r){if(t.JudgeUtils.isFunction(r))for(var n=r,o=0,i=e.length;i>o;o++){var a=e[o];if(n.call(null,a,o))return!0}else for(var o=0,i=e.length;i>o;o++){var a=e[o];if(r===a||a.contain&&a.contain(r))return!0}return!1},e}();t.ArrayUtils=e}(wdCb||(wdCb={}));var wdCb;!function(t){var e=function(){function e(){}return e.toString=function(e){return t.JudgeUtils.isNumber(e)?String(e):t.JudgeUtils.isFunction(e)?this._convertCodeToString(e):t.JudgeUtils.isDirectObject(e)||t.JudgeUtils.isArray(e)?JSON.stringify(e):String(e)},e._convertCodeToString=function(t){return t.toString().split("\n").slice(1,-1).join("\n")+"\n"},e}();t.ConvertUtils=e}(wdCb||(wdCb={}));var wdCb;!function(t){var e=function(){function e(){}return e.bindEvent=function(t,e){return function(r){return e.call(t,r)}},e.addEvent=function(e,r,n){t.JudgeUtils.isHostMethod(e,"addEventListener")?e.addEventListener(r,n,!1):t.JudgeUtils.isHostMethod(e,"attachEvent")?e.attachEvent("on"+r,n):e["on"+r]=n},e.removeEvent=function(e,r,n){t.JudgeUtils.isHostMethod(e,"removeEventListener")?e.removeEventListener(r,n,!1):t.JudgeUtils.isHostMethod(e,"detachEvent")?e.detachEvent("on"+r,n):e["on"+r]=null},e}();t.EventUtils=e}(wdCb||(wdCb={}));var wdCb;!function(t){var e=function(){function e(){}return e.extendDeep=function(t,e,r){void 0===r&&(r=function(t,e){return!0});var n=null,o=0,i=Object.prototype.toString,a="[object Array]",s="[object Object]",c="",u=null;if(i.call(t)===a)for(u=e||[],n=0,o=t.length;o>n;n++)r(t[n],n)&&(c=i.call(t[n]),c===a||c===s?(u[n]=c===a?[]:{},arguments.callee(t[n],u[n])):u[n]=t[n]);else if(i.call(t)===s){u=e||{};for(n in t)r(t[n],n)&&(c=i.call(t[n]),c===a||c===s?(u[n]=c===a?[]:{},arguments.callee(t[n],u[n])):u[n]=t[n])}else u=t;return u},e.extend=function(t,e){var r="";for(r in e)t[r]=e[r];return t},e.copyPublicAttri=function(e){var r={};return this.extendDeep(e,r,function(e,r){return"_"!==r.slice(0,1)&&!t.JudgeUtils.isFunction(e)}),r},e}();t.ExtendUtils=e}(wdCb||(wdCb={}));var wdCb;!function(t){var e=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,r=function(){function t(){}return t.basename=function(t,e){var r=this._splitPath(t)[2];return e&&r.substr(-1*e.length)===e&&(r=r.substr(0,r.length-e.length)),r},t.extname=function(t){return this._splitPath(t)[3]},t.dirname=function(t){var e=this._splitPath(t),r=e[0],n=e[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},t._splitPath=function(t){return e.exec(t).slice(1)},t}();t.PathUtils=r}(wdCb||(wdCb={}));var wdCb;!function(t){var e=function(){function e(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];return this._doms=null,t.JudgeUtils.isDom(e[0])?this._doms=[e[0]]:this._isDomEleStr(e[0])?this._doms=[this._buildDom(e[0])]:this._doms=document.querySelectorAll(e[0]),this}return e.create=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var r=new this(t[0]);return r},e.prototype.get=function(t){return this._doms[t]},e.prototype.prepend=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var r=null;r=this._buildDom(t[0]);for(var n=0,o=this._doms;n<o.length;n++){var i=o[n];1===i.nodeType&&i.insertBefore(r,i.firstChild)}return this},e.prototype.prependTo=function(t){var r=null;r=e.create(t);for(var n=0,o=this._doms;n<o.length;n++){var i=o[n];1===i.nodeType&&r.prepend(i)}return this},e.prototype.remove=function(){for(var t=0,e=this._doms;t<e.length;t++){var r=e[t];r&&r.parentNode&&"BODY"!=r.tagName&&r.parentNode.removeChild(r)}return this},e.prototype.css=function(t,e){for(var r=0,n=this._doms;r<n.length;r++){var o=n[r];o.style[t]=e}},e.prototype._isDomEleStr=function(t){return null!==t.match(/<(\w+)><\/\1>/)},e.prototype._buildDom=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];if(t.JudgeUtils.isString(e[0])){var n=this._createElement("div"),o=e[0];return n.innerHTML=o,n.firstChild}return e[0]},e.prototype._createElement=function(t){return document.createElement(t)},e}();t.DomQuery=e}(wdCb||(wdCb={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdCb;!function(t){var e=function(e){function r(t){void 0===t&&(t=[]),e.call(this),this.children=t;
}return __extends(r,e),r.create=function(t){void 0===t&&(t=[]);var e=new this(t);return e},r.prototype.copy=function(e){return void 0===e&&(e=!1),e?r.create(t.ExtendUtils.extendDeep(this.children)):r.create(t.ExtendUtils.extend([],this.children))},r.prototype.filter=function(t){var e=this.children,n=[];return this.forEach(function(r,o){t.call(e,r,o)&&n.push(r)}),r.create(n)},r.prototype.findOne=function(e){var r=this.children,n=null;return this.forEach(function(o,i){return e.call(r,o,i)?(n=o,t.$BREAK):void 0}),n},r.prototype.reverse=function(){return r.create(this.copyChildren().reverse())},r.prototype.removeChild=function(t){return r.create(this.removeChildHelper(t))},r.prototype.sort=function(t){return r.create(this.copyChildren().sort(t))},r.prototype.map=function(e){var n=[];return this.forEach(function(r,o){var i=e(r,o);i!==t.$REMOVE&&n.push(i)}),r.create(n)},r.prototype.removeRepeatItems=function(){var t=r.create();return this.forEach(function(e){t.hasChild(e)||t.addChild(e)}),t},r}(t.List);t.Collection=e}(wdCb||(wdCb={}));var wdCb;!function(t){var e=function(){function t(){}return t.bind=function(t,e){return function(){return e.apply(t,arguments)}},t}();t.FunctionUtils=e}(wdCb||(wdCb={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.isPromise=function(e){return!!e&&!t.isFunction.call(this,e.subscribe)&&t.isFunction.call(this,e.then)},e.isEqual=function(t,e){return t.uid===e.uid},e}(wdCb.JudgeUtils);t.JudgeUtils=e}(wdFrp||(wdFrp={}));var wdFrp;!function(t){var e=function(){function t(e){this._uid=null,this._uid=e+String(t.UID++)}return Object.defineProperty(t.prototype,"uid",{get:function(){return this._uid},set:function(t){this._uid=t},enumerable:!0,configurable:!0}),t.UID=1,t}();t.Entity=e}(wdFrp||(wdFrp={}));var wdFrp;!function(t){var e=function(){function t(t){this._disposeHandler=null,this._disposeHandler=t}return t.create=function(t){void 0===t&&(t=function(){});var e=new this(t);return e},t.prototype.setDisposeHandler=function(t){this._disposeHandler=t},t.prototype.dispose=function(){this._disposeHandler()},t}();t.SingleDisposable=e}(wdFrp||(wdFrp={}));var wdFrp;!function(t){var e=function(){function t(t){this._group=wdCb.Collection.create(),t&&this._group.addChild(t)}return t.create=function(t){var e=new this(t);return e},t.prototype.add=function(t){return this._group.addChild(t),this},t.prototype.dispose=function(){this._group.forEach(function(t){t.dispose()})},t}();t.GroupDisposable=e}(wdFrp||(wdFrp={}));var wdFrp;!function(t){var e=function(){function t(t,e){this._subject=null,this._observer=null,this._subject=t,this._observer=e}return t.create=function(t,e){var r=new this(t,e);return r},t.prototype.dispose=function(){this._subject.remove(this._observer),this._observer.dispose()},t}();t.InnerSubscription=e}(wdFrp||(wdFrp={}));var wdFrp;!function(t){var e=function(){function t(){this._container=wdCb.Collection.create()}return t.create=function(){var t=new this;return t},t.prototype.addChild=function(t){this._container.addChild(t)},t.prototype.dispose=function(){this._container.forEach(function(t){t.dispose()})},t}();t.InnerSubscriptionGroup=e}(wdFrp||(wdFrp={}));var wdFrp;!function(t){Object.defineProperty(t,"root",{get:function(){return t.JudgeUtils.isNodeJs()?global:window}})}(wdFrp||(wdFrp={}));var wdFrp;!function(t){t.ABSTRACT_ATTRIBUTE=null}(wdFrp||(wdFrp={}));var wdFrp;!function(t){t.root.RSVP&&(t.root.RSVP.onerror=function(t){throw t},t.root.RSVP.on("error",t.root.RSVP.onerror))}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(e){function r(r){e.call(this,"Stream"),this.scheduler=t.ABSTRACT_ATTRIBUTE,this.subscribeFunc=null,this.subscribeFunc=r||function(){}}return __extends(r,e),r.prototype.buildStream=function(e){return t.SingleDisposable.create(this.subscribeFunc(e)||function(){})},r.prototype["do"]=function(e,r,n){return t.DoStream.create(this,e,r,n)},r.prototype.map=function(e){return t.MapStream.create(this,e)},r.prototype.flatMap=function(t){return this.map(t).mergeAll()},r.prototype.mergeAll=function(){return t.MergeAllStream.create(this)},r.prototype.takeUntil=function(e){return t.TakeUntilStream.create(this,e)},r.prototype.concat=function(){var e=null;return e=t.JudgeUtils.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments,0),e.unshift(this),t.ConcatStream.create(e)},r.prototype.merge=function(){var e=null,r=null;return e=t.JudgeUtils.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments,0),e.unshift(this),r=t.fromArray(e).mergeAll()},r.prototype.repeat=function(e){return void 0===e&&(e=-1),t.RepeatStream.create(this,e)},r.prototype.ignoreElements=function(){return t.IgnoreElementsStream.create(this)},r.prototype.handleSubject=function(t){return this._isSubject(t)?(this._setSubject(t),!0):!1},r.prototype._isSubject=function(e){return e instanceof t.Subject},r.prototype._setSubject=function(t){t.source=this},r}(t.Entity);t.Stream=e}(wdFrp||(wdFrp={}));var wdFrp;!function(t){t.root.requestNextAnimationFrame=function(){var e=void 0,r=void 0,n=null,o=t.root.navigator&&t.root.navigator.userAgent,i=0,a=this;return r=function(e){e=t.root.performance.now(),a.callback(e)},t.root.requestAnimationFrame?requestAnimationFrame:(t.root.webkitRequestAnimationFrame&&(e=t.root.webkitRequestAnimationFrame,t.root.webkitRequestAnimationFrame=function(t,n){return a.callback=t,e(r,n)}),t.root.msRequestAnimationFrame&&(e=t.root.msRequestAnimationFrame,t.root.msRequestAnimationFrame=function(t){return a.callback=t,e(r)}),t.root.mozRequestAnimationFrame&&(i=o.indexOf("rv:"),-1!=o.indexOf("Gecko")&&(n=o.substr(i+3,3),"2.0"===n&&(t.root.mozRequestAnimationFrame=void 0))),t.root.webkitRequestAnimationFrame||t.root.mozRequestAnimationFrame||t.root.oRequestAnimationFrame||t.root.msRequestAnimationFrame||function(e,r){var n,o;t.root.setTimeout(function(){n=t.root.performance.now(),e(n),o=t.root.performance.now(),a.timeout=1e3/60-(o-n)},a.timeout)})}(),t.root.cancelNextRequestAnimationFrame=t.root.cancelRequestAnimationFrame||t.root.webkitCancelAnimationFrame||t.root.webkitCancelRequestAnimationFrame||t.root.mozCancelRequestAnimationFrame||t.root.oCancelRequestAnimationFrame||t.root.msCancelRequestAnimationFrame||clearTimeout;var e=function(){function e(){this._requestLoopId=null}return e.create=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var r=new this;return r},Object.defineProperty(e.prototype,"requestLoopId",{get:function(){return this._requestLoopId},set:function(t){this._requestLoopId=t},enumerable:!0,configurable:!0}),e.prototype.publishRecursive=function(t,e,r){r(e)},e.prototype.publishInterval=function(e,r,n,o){return t.root.setInterval(function(){r=o(r)},n)},e.prototype.publishIntervalRequest=function(e,r){var n=this,o=function(e){var i=r(e);i||(n._requestLoopId=t.root.requestNextAnimationFrame(o))};this._requestLoopId=t.root.requestNextAnimationFrame(o)},e}();t.Scheduler=e}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(t){function e(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];if(t.call(this,"Observer"),this._isDisposed=null,this.onUserNext=null,this.onUserError=null,this.onUserCompleted=null,this._isStop=!1,this._disposable=null,1===e.length){var n=e[0];this.onUserNext=function(t){n.next(t)},this.onUserError=function(t){n.error(t)},this.onUserCompleted=function(){n.completed()}}else{var o=e[0],i=e[1],a=e[2];this.onUserNext=o||function(t){},this.onUserError=i||function(t){throw t},this.onUserCompleted=a||function(){}}}return __extends(e,t),Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this._isDisposed},set:function(t){this._isDisposed=t},enumerable:!0,configurable:!0}),e.prototype.next=function(t){return this._isStop?void 0:this.onNext(t)},e.prototype.error=function(t){this._isStop||(this._isStop=!0,this.onError(t))},e.prototype.completed=function(){this._isStop||(this._isStop=!0,this.onCompleted())},e.prototype.dispose=function(){this._isStop=!0,this._isDisposed=!0,this._disposable&&this._disposable.dispose()},e.prototype.setDisposable=function(t){this._disposable=t},e}(t.Entity);t.Observer=e}(wdFrp||(wdFrp={}));var wdFrp;!function(t){var e=function(){function e(){this._source=null,this._observer=new t.SubjectObserver}return e.create=function(){var t=new this;return t},Object.defineProperty(e.prototype,"source",{get:function(){return this._source},set:function(t){this._source=t},enumerable:!0,configurable:!0}),e.prototype.subscribe=function(e,r,n){var o=e instanceof t.Observer?e:t.AutoDetachObserver.create(e,r,n);return this._observer.addChild(o),t.InnerSubscription.create(this,o)},e.prototype.next=function(t){this._observer.next(t)},e.prototype.error=function(t){this._observer.error(t)},e.prototype.completed=function(){this._observer.completed()},e.prototype.start=function(){this._source&&this._observer.setDisposable(this._source.buildStream(this))},e.prototype.remove=function(t){this._observer.removeChild(t)},e.prototype.dispose=function(){this._observer.dispose()},e}();t.Subject=e}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(e){function r(){e.call(this,"GeneratorSubject"),this._isStart=!1,this.observer=new t.SubjectObserver}return __extends(r,e),r.create=function(){var t=new this;return t},Object.defineProperty(r.prototype,"isStart",{get:function(){return this._isStart},set:function(t){this._isStart=t},enumerable:!0,configurable:!0}),r.prototype.onBeforeNext=function(t){},r.prototype.onAfterNext=function(t){},r.prototype.onIsCompleted=function(t){return!1},r.prototype.onBeforeError=function(t){},r.prototype.onAfterError=function(t){},r.prototype.onBeforeCompleted=function(){},r.prototype.onAfterCompleted=function(){},r.prototype.subscribe=function(e,r,n){var o=e instanceof t.Observer?e:t.AutoDetachObserver.create(e,r,n);return this.observer.addChild(o),t.InnerSubscription.create(this,o)},r.prototype.next=function(t){if(this._isStart&&!this.observer.isEmpty())try{this.onBeforeNext(t),this.observer.next(t),this.onAfterNext(t),this.onIsCompleted(t)&&this.completed()}catch(e){this.error(e)}},r.prototype.error=function(t){this._isStart&&!this.observer.isEmpty()&&(this.onBeforeError(t),this.observer.error(t),this.onAfterError(t))},r.prototype.completed=function(){this._isStart&&!this.observer.isEmpty()&&(this.onBeforeCompleted(),this.observer.completed(),this.onAfterCompleted())},r.prototype.toStream=function(){var e=this,r=null;return r=t.AnonymousStream.create(function(t){e.subscribe(t)})},r.prototype.start=function(){var e=this;this._isStart=!0,this.observer.setDisposable(t.SingleDisposable.create(function(){e.dispose()}))},r.prototype.stop=function(){this._isStart=!1},r.prototype.remove=function(t){this.observer.removeChild(t)},r.prototype.dispose=function(){this.observer.dispose()},r}(t.Entity);t.GeneratorSubject=e}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.create=function(t,e,r){return new this(t,e,r)},e.prototype.onNext=function(t){this.onUserNext(t)},e.prototype.onError=function(t){this.onUserError(t)},e.prototype.onCompleted=function(){this.onUserCompleted()},e}(t.Observer);t.AnonymousObserver=e}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.create=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return 1===t.length?new this(t[0]):new this(t[0],t[1],t[2])},e.prototype.dispose=function(){return this.isDisposed?void wdCb.Log.log("only can dispose once"):void t.prototype.dispose.call(this)},e.prototype.onNext=function(t){try{this.onUserNext(t)}catch(e){this.onError(e)}},e.prototype.onError=function(t){try{this.onUserError(t)}catch(e){throw e}finally{this.dispose()}},e.prototype.onCompleted=function(){try{this.onUserCompleted(),this.dispose()}catch(t){throw t}},e}(t.Observer);t.AutoDetachObserver=e}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(t){function e(e,r){t.call(this,null,null,null),this._currentObserver=null,this._selector=null,this._currentObserver=e,this._selector=r}return __extends(e,t),e.create=function(t,e){return new this(t,e)},e.prototype.onNext=function(t){var e=null;try{e=this._selector(t)}catch(r){this._currentObserver.error(r)}finally{this._currentObserver.next(e)}},e.prototype.onError=function(t){this._currentObserver.error(t)},e.prototype.onCompleted=function(){this._currentObserver.completed()},e}(t.Observer);t.MapObserver=e}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(t){function e(e,r){t.call(this,null,null,null),this._currentObserver=null,this._prevObserver=null,this._currentObserver=e,this._prevObserver=r}return __extends(e,t),e.create=function(t,e){return new this(t,e)},e.prototype.onNext=function(t){try{this._prevObserver.next(t)}catch(e){this._prevObserver.error(e),this._currentObserver.error(e)}finally{this._currentObserver.next(t)}},e.prototype.onError=function(t){try{this._prevObserver.error(t)}catch(e){}finally{this._currentObserver.error(t)}},e.prototype.onCompleted=function(){try{this._prevObserver.completed()}catch(t){this._prevObserver.error(t),this._currentObserver.error(t)}finally{this._currentObserver.completed()}},e}(t.Observer);t.DoObserver=e}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(e){function n(t,r,n){e.call(this,null,null,null),this._currentObserver=null,this._done=!1,this._streamGroup=null,this._groupDisposable=null,this._currentObserver=t,this._streamGroup=r,this._groupDisposable=n}return __extends(n,e),n.create=function(t,e,r){return new this(t,e,r)},Object.defineProperty(n.prototype,"currentObserver",{get:function(){return this._currentObserver},set:function(t){this._currentObserver=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"done",{get:function(){return this._done},set:function(t){this._done=t},enumerable:!0,configurable:!0}),n.prototype.onNext=function(e){wdCb.Log.error(!(e instanceof t.Stream||t.JudgeUtils.isPromise(e)),wdCb.Log.info.FUNC_MUST_BE("innerSource","Stream or Promise")),t.JudgeUtils.isPromise(e)&&(e=t.fromPromise(e)),this._streamGroup.addChild(e),this._groupDisposable.add(e.buildStream(r.create(this,this._streamGroup,e)))},n.prototype.onError=function(t){this._currentObserver.error(t)},n.prototype.onCompleted=function(){this.done=!0,0===this._streamGroup.getCount()&&this._currentObserver.completed()},n}(t.Observer);t.MergeAllObserver=e;var r=function(e){function r(t,r,n){e.call(this,null,null,null),this._parent=null,this._streamGroup=null,this._currentStream=null,this._parent=t,this._streamGroup=r,this._currentStream=n}return __extends(r,e),r.create=function(t,e,r){var n=new this(t,e,r);return n},r.prototype.onNext=function(t){this._parent.currentObserver.next(t)},r.prototype.onError=function(t){this._parent.currentObserver.error(t)},r.prototype.onCompleted=function(){var e=this._currentStream,r=this._parent;this._streamGroup.removeChild(function(r){return t.JudgeUtils.isEqual(r,e)}),this._isAsync()&&0===this._streamGroup.getCount()&&r.currentObserver.completed()},r.prototype._isAsync=function(){return this._parent.done},r}(t.Observer)}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(t){function e(e){t.call(this,null,null,null),this._prevObserver=null,this._prevObserver=e}return __extends(e,t),e.create=function(t){return new this(t)},e.prototype.onNext=function(t){this._prevObserver.completed()},e.prototype.onError=function(t){this._prevObserver.error(t)},e.prototype.onCompleted=function(){},e}(t.Observer);t.TakeUntilObserver=e}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(t){function e(e,r){t.call(this,null,null,null),this.currentObserver=null,this._startNextStream=null,this.currentObserver=e,this._startNextStream=r}return __extends(e,t),e.create=function(t,e){return new this(t,e)},e.prototype.onNext=function(t){this.currentObserver.next(t)},e.prototype.onError=function(t){this.currentObserver.error(t)},e.prototype.onCompleted=function(){this._startNextStream()},e}(t.Observer);t.ConcatObserver=e}(wdFrp||(wdFrp={}));var wdFrp;!function(t){var e=function(){function e(){this.observers=wdCb.Collection.create(),this._disposable=null}return e.prototype.isEmpty=function(){return 0===this.observers.getCount()},e.prototype.next=function(t){this.observers.forEach(function(e){e.next(t)})},e.prototype.error=function(t){this.observers.forEach(function(e){e.error(t)})},e.prototype.completed=function(){this.observers.forEach(function(t){t.completed()})},e.prototype.addChild=function(t){this.observers.addChild(t),t.setDisposable(this._disposable)},e.prototype.removeChild=function(e){this.observers.removeChild(function(r){return t.JudgeUtils.isEqual(r,e)})},e.prototype.dispose=function(){this.observers.forEach(function(t){t.dispose()}),this.observers.removeAllChildren()},e.prototype.setDisposable=function(t){this.observers.forEach(function(e){e.setDisposable(t)}),this._disposable=t},e}();t.SubjectObserver=e}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(t){function e(e){t.call(this,null,null,null),this._currentObserver=null,this._currentObserver=e}return __extends(e,t),e.create=function(t){return new this(t)},e.prototype.onNext=function(t){},e.prototype.onError=function(t){this._currentObserver.error(t)},e.prototype.onCompleted=function(){this._currentObserver.completed()},e}(t.Observer);t.IgnoreElementsObserver=e}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.prototype.subscribe=function(e,r,n){var o=null;if(!this.handleSubject(e))return o=e instanceof t.Observer?t.AutoDetachObserver.create(e):t.AutoDetachObserver.create(e,r,n),o.setDisposable(this.buildStream(o)),o},r.prototype.buildStream=function(t){return e.prototype.buildStream.call(this,t),this.subscribeCore(t)},r}(t.Stream);t.BaseStream=e}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(e){function r(r,n,o,i){e.call(this,null),this._source=null,this._observer=null,this._source=r,this._observer=t.AnonymousObserver.create(n,o,i),this.scheduler=this._source.scheduler}return __extends(r,e),r.create=function(t,e,r,n){var o=new this(t,e,r,n);return o},r.prototype.subscribeCore=function(e){return this._source.buildStream(t.DoObserver.create(e,this._observer))},r}(t.BaseStream);t.DoStream=e}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(e){function r(t,r){e.call(this,null),this._source=null,this._selector=null,this._source=t,this.scheduler=this._source.scheduler,this._selector=r}return __extends(r,e),r.create=function(t,e){var r=new this(t,e);return r},r.prototype.subscribeCore=function(e){return this._source.buildStream(t.MapObserver.create(e,this._selector))},r}(t.BaseStream);t.MapStream=e}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(e){function r(t,r){e.call(this,null),this._array=null,this._array=t,this.scheduler=r}return __extends(r,e),r.create=function(t,e){var r=new this(t,e);return r},r.prototype.subscribeCore=function(e){function r(t){o>t?(e.next(n[t]),arguments.callee(t+1)):e.completed()}var n=this._array,o=n.length;return this.scheduler.publishRecursive(e,0,r),t.SingleDisposable.create()},r}(t.BaseStream);t.FromArrayStream=e}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(e){function r(t,r){e.call(this,null),this._promise=null,this._promise=t,this.scheduler=r}return __extends(r,e),r.create=function(t,e){var r=new this(t,e);return r},r.prototype.subscribeCore=function(e){return this._promise.then(function(t){e.next(t),e.completed()},function(t){e.error(t)},e),t.SingleDisposable.create()},r}(t.BaseStream);t.FromPromiseStream=e}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(e){function r(t,r){e.call(this,null),this._addHandler=null,this._removeHandler=null,this._addHandler=t,this._removeHandler=r}return __extends(r,e),r.create=function(t,e){var r=new this(t,e);return r},r.prototype.subscribeCore=function(e){function r(t){e.next(t)}var n=this;return this._addHandler(r),t.SingleDisposable.create(function(){n._removeHandler(r)})},r}(t.BaseStream);t.FromEventPatternStream=e}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(e){function r(r){e.call(this,r),this.scheduler=t.Scheduler.create()}return __extends(r,e),r.create=function(t){var e=new this(t);return e},r.prototype.subscribe=function(e,r,n){var o=null;if(!this.handleSubject(arguments[0]))return o=t.AutoDetachObserver.create(e,r,n),o.setDisposable(this.buildStream(o)),o},r}(t.Stream);t.AnonymousStream=e}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(e){function r(t,r){e.call(this,null),this._interval=null,this._interval=t,this.scheduler=r}return __extends(r,e),r.create=function(t,e){var r=new this(t,e);return r.initWhenCreate(),r},r.prototype.initWhenCreate=function(){this._interval=this._interval<=0?1:this._interval},r.prototype.subscribeCore=function(e){var r=null;return r=this.scheduler.publishInterval(e,0,this._interval,function(t){return e.next(t),t+1}),t.SingleDisposable.create(function(){t.root.clearInterval(r)})},r}(t.BaseStream);t.IntervalStream=e}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(e){function r(t){e.call(this,null),this._isEnd=!1,this.scheduler=t}return __extends(r,e),r.create=function(t){var e=new this(t);return e},r.prototype.subscribeCore=function(e){var r=this;return this.scheduler.publishIntervalRequest(e,function(t){return e.next(t),r._isEnd}),t.SingleDisposable.create(function(){t.root.cancelNextRequestAnimationFrame(r.scheduler.requestLoopId),r._isEnd=!0})},r}(t.BaseStream);t.IntervalRequestStream=e}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(e){function r(t){e.call(this,null),this._source=null,this._observer=null,this._source=t,this.scheduler=this._source.scheduler}return __extends(r,e),r.create=function(t){var e=new this(t);return e},r.prototype.subscribeCore=function(e){var r=wdCb.Collection.create(),n=t.GroupDisposable.create();return this._source.buildStream(t.MergeAllObserver.create(e,r,n)),n},r}(t.BaseStream);t.MergeAllStream=e}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(e){function r(r,n){e.call(this,null),this._source=null,this._otherStream=null,this._source=r,this._otherStream=t.JudgeUtils.isPromise(n)?t.fromPromise(n):n,this.scheduler=this._source.scheduler}return __extends(r,e),r.create=function(t,e){var r=new this(t,e);return r},r.prototype.subscribeCore=function(e){var r=t.GroupDisposable.create(),n=t.AutoDetachObserver.create(e),o=null;return o=this._source.buildStream(e),r.add(o),n.setDisposable(o),r.add(this._otherStream.buildStream(t.TakeUntilObserver.create(n))),r},r}(t.BaseStream);t.TakeUntilStream=e}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(e){function r(r){e.call(this,null),this._sources=wdCb.Collection.create();var n=this;this.scheduler=r[0].scheduler,r.forEach(function(e){t.JudgeUtils.isPromise(e)?n._sources.addChild(t.fromPromise(e)):n._sources.addChild(e)})}return __extends(r,e),r.create=function(t){var e=new this(t);return e},r.prototype.subscribeCore=function(e){function r(a){return a===o?void e.completed():void i.add(n._sources.getChild(a).buildStream(t.ConcatObserver.create(e,function(){r(a+1)})))}var n=this,o=this._sources.getCount(),i=t.GroupDisposable.create();return this.scheduler.publishRecursive(e,0,r),t.GroupDisposable.create(i)},r}(t.BaseStream);t.ConcatStream=e}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(e){function r(t,r){e.call(this,null),this._source=null,this._count=null,this._source=t,this._count=r,this.scheduler=this._source.scheduler}return __extends(r,e),r.create=function(t,e){var r=new this(t,e);return r},r.prototype.subscribeCore=function(e){function r(i){return 0===i?void e.completed():void o.add(n._source.buildStream(t.ConcatObserver.create(e,function(){r(i-1)})))}var n=this,o=t.GroupDisposable.create();return this.scheduler.publishRecursive(e,this._count,r),t.GroupDisposable.create(o)},r}(t.BaseStream);t.RepeatStream=e}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(e){function r(t){e.call(this,null),this._source=null,this._source=t,this.scheduler=this._source.scheduler}return __extends(r,e),r.create=function(t){var e=new this(t);return e},r.prototype.subscribeCore=function(e){return this._source.buildStream(t.IgnoreElementsObserver.create(e))},r}(t.BaseStream);t.IgnoreElementsStream=e}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(e){function r(t){e.call(this,null),this._buildStreamFunc=null,this._buildStreamFunc=t}return __extends(r,e),r.create=function(t){var e=new this(t);return e},r.prototype.subscribeCore=function(e){var r=t.GroupDisposable.create();return r.add(this._buildStreamFunc().buildStream(e)),r},r}(t.BaseStream);t.DeferStream=e}(wdFrp||(wdFrp={}));var wdFrp;!function(t){t.createStream=function(e){return t.AnonymousStream.create(e)},t.fromArray=function(e,r){return void 0===r&&(r=t.Scheduler.create()),t.FromArrayStream.create(e,r)},t.fromPromise=function(e,r){return void 0===r&&(r=t.Scheduler.create()),t.FromPromiseStream.create(e,r)},t.fromEventPattern=function(e,r){return t.FromEventPatternStream.create(e,r)},t.interval=function(e,r){return void 0===r&&(r=t.Scheduler.create()),t.IntervalStream.create(e,r)},t.intervalRequest=function(e){return void 0===e&&(e=t.Scheduler.create()),t.IntervalRequestStream.create(e)},t.empty=function(){return t.createStream(function(t){t.completed()})},t.callFunc=function(e,r){return void 0===r&&(r=t.root),t.createStream(function(t){try{t.next(e.call(r,null))}catch(n){t.error(n)}t.completed()})},t.judge=function(t,e,r){return t()?e():r()},t.defer=function(e){return t.DeferStream.create(e)},t.just=function(e){return t.createStream(function(t){t.next(e),t.completed()})}}(wdFrp||(wdFrp={}));var wdFrp;!function(t){var e=function(t,e){return t===e},r=function(){function t(t,r,n,o){this._time=null,this._value=null,this._actionType=null,this._comparer=null,this._time=t,this._value=r,this._actionType=n,this._comparer=o||e}return t.create=function(t,e,r,n){var o=new this(t,e,r,n);return o},Object.defineProperty(t.prototype,"time",{get:function(){return this._time},set:function(t){this._time=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(t){this._value=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"actionType",{get:function(){return this._actionType},set:function(t){this._actionType=t},enumerable:!0,configurable:!0}),t.prototype.equals=function(t){return this._time===t.time&&this._comparer(this._value,t.value)},t}();t.Record=r}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,
new r)},wdFrp;!function(t){var e=function(e){function r(t){e.call(this,null,null,null),this._messages=[],this._scheduler=null,this._scheduler=t}return __extends(r,e),r.create=function(t){var e=new this(t);return e},Object.defineProperty(r.prototype,"messages",{get:function(){return this._messages},set:function(t){this._messages=t},enumerable:!0,configurable:!0}),r.prototype.onNext=function(e){this._messages.push(t.Record.create(this._scheduler.clock,e))},r.prototype.onError=function(e){this._messages.push(t.Record.create(this._scheduler.clock,e))},r.prototype.onCompleted=function(){this._messages.push(t.Record.create(this._scheduler.clock,null))},r.prototype.dispose=function(){e.prototype.dispose.call(this),this._scheduler.remove(this)},r.prototype.copy=function(){var t=r.create(this._scheduler);return t.messages=this._messages,t},r}(t.Observer);t.MockObserver=e}(wdFrp||(wdFrp={}));var wdFrp;!function(t){var e=function(){function t(t,e){this._messages=[],this._scheduler=null,this._scheduler=t,this._messages=e}return t.create=function(t,e){var r=new this(t,e);return r},t.prototype.then=function(t,e,r){this._scheduler.setStreamMap(r,this._messages)},t}();t.MockPromise=e}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=200,r=1e3,n=function(n){function o(t){n.call(this),this._clock=null,this._isReset=!1,this._isDisposed=!1,this._timerMap=wdCb.Hash.create(),this._streamMap=wdCb.Hash.create(),this._subscribedTime=null,this._disposedTime=null,this._observer=null,this._isReset=t}return __extends(o,n),o.next=function(e,r){return t.Record.create(e,r,t.ActionType.NEXT)},o.error=function(e,r){return t.Record.create(e,r,t.ActionType.ERROR)},o.completed=function(e){return t.Record.create(e,null,t.ActionType.COMPLETED)},o.create=function(t){void 0===t&&(t=!1);var e=new this(t);return e},Object.defineProperty(o.prototype,"clock",{get:function(){return this._clock},set:function(t){this._clock=t},enumerable:!0,configurable:!0}),o.prototype.setStreamMap=function(e,r){var n=this;r.forEach(function(r){var o=null;switch(r.actionType){case t.ActionType.NEXT:o=function(){e.next(r.value)};break;case t.ActionType.ERROR:o=function(){e.error(r.value)};break;case t.ActionType.COMPLETED:o=function(){e.completed()};break;default:wdCb.Log.error(!0,wdCb.Log.info.FUNC_UNKNOW("actionType"))}n._streamMap.addChild(String(r.time),o)})},o.prototype.remove=function(t){this._isDisposed=!0},o.prototype.publishRecursive=function(t,e,r){var n=this,o=null,i=null;this._setClock(),o=t.next,i=t.completed,t.next=function(e){o.call(t,e),n._tick(1)},t.completed=function(){i.call(t),n._tick(1)},r(e)},o.prototype.publishInterval=function(t,e,r,n){var i=10,a=[];for(this._setClock();i>0&&!this._isDisposed;)this._tick(r),a.push(o.next(this._clock,e)),e++,i--;return this.setStreamMap(t,a),NaN},o.prototype.publishIntervalRequest=function(t,e){var r=10,n=[],i=100,a=0;for(this._setClock();r>0&&!this._isDisposed;)this._tick(i),n.push(o.next(this._clock,a)),a++,r--;return this.setStreamMap(t,n),NaN},o.prototype._setClock=function(){this._isReset&&(this._clock=this._subscribedTime)},o.prototype.startWithTime=function(t,e,r){var n,o,i=this.createObserver(),a=this;return this._subscribedTime=e,this._disposedTime=r,this._clock=e,this._runAt(e,function(){n=t(),o=n.subscribe(i)}),this._runAt(r,function(){o.dispose(),a._isDisposed=!0}),this._observer=i,this.start(),i},o.prototype.startWithSubscribe=function(t,n){return void 0===n&&(n=e),this.startWithTime(t,n,r)},o.prototype.startWithDispose=function(t,n){return void 0===n&&(n=r),this.startWithTime(t,e,n)},o.prototype.publicAbsolute=function(t,e){this._runAt(t,function(){e()})},o.prototype.start=function(){for(var t=this._getMinAndMaxTime(),e=t[0],r=t[1],n=e;r>=n;)this._clock=n,this._exec(n,this._timerMap),this._clock=n,this._runStream(n),n++,r=this._getMinAndMaxTime()[1]},o.prototype.createStream=function(e){return t.TestStream.create(Array.prototype.slice.call(arguments,0),this)},o.prototype.createObserver=function(){return t.MockObserver.create(this)},o.prototype.createResolvedPromise=function(e,r){return t.MockPromise.create(this,[o.next(e,r),o.completed(e+1)])},o.prototype.createRejectPromise=function(e,r){return t.MockPromise.create(this,[o.error(e,r)])},o.prototype._getMinAndMaxTime=function(){var t=this._timerMap.getKeys().addChildren(this._streamMap.getKeys());return t=t.map(function(t){return Number(t)}).toArray(),[Math.min.apply(Math,t),Math.max.apply(Math,t)]},o.prototype._exec=function(t,e){var r=e.getChild(String(t));r&&r()},o.prototype._runStream=function(t){var e=this._streamMap.getChild(String(t));e&&e()},o.prototype._runAt=function(t,e){this._timerMap.addChild(String(t),e)},o.prototype._tick=function(t){this._clock+=t},o}(t.Scheduler);t.TestScheduler=n}(wdFrp||(wdFrp={}));var wdFrp;!function(t){!function(t){t[t.NEXT=0]="NEXT",t[t.ERROR=1]="ERROR",t[t.COMPLETED=2]="COMPLETED"}(t.ActionType||(t.ActionType={}));t.ActionType}(wdFrp||(wdFrp={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wdFrp;!function(t){var e=function(e){function r(t,r){e.call(this,null),this.scheduler=null,this._messages=null,this._messages=t,this.scheduler=r}return __extends(r,e),r.create=function(t,e){var r=new this(t,e);return r},r.prototype.subscribeCore=function(e){return this.scheduler.setStreamMap(e,this._messages),t.SingleDisposable.create()},r}(t.BaseStream);t.TestStream=e}(wdFrp||(wdFrp={}));var wdFrp;!function(t){t.fromNodeCallback=function(e,r){return function(){for(var n=[],o=0;o<arguments.length;o++)n[o-0]=arguments[o];return t.createStream(function(t){var o=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return e?void t.error(e):(r.length<=1?t.next.apply(t,r):t.next(r),void t.completed())};n.push(o),e.apply(r,n)})}},t.fromStream=function(e,r){return void 0===r&&(r="end"),e.pause(),t.createStream(function(t){var n=function(e){t.next(e)},o=function(e){t.error(e)},i=function(){t.completed()};return e.addListener("data",n),e.addListener("error",o),e.addListener(r,i),e.resume(),function(){e.removeListener("data",n),e.removeListener("error",o),e.removeListener(r,i)}})},t.fromReadableStream=function(e){return t.fromStream(e,"end")},t.fromWritableStream=function(e){return t.fromStream(e,"finish")},t.fromTransformStream=function(e){return t.fromStream(e,"finish")}}(wdFrp||(wdFrp={}));var wd;!function(t){t.DebugConfig={isTest:!1,debugCollision:!1}}(wd||(wd={}));var wdFrp;!function(t){t.fromCollection=function(e,r){void 0===r&&(r=t.Scheduler.create());var n=e.toArray();return 0===n.length?t.empty():t.fromArray(n,r)}}(wdFrp||(wdFrp={}));var wd;!function(t){function e(e,r){void 0===r&&(r="contract error"),t.Log.error(!e,r)}function r(e){return function(r,n,o){var i=o.value;return o.value=function(){for(var r=[],n=0;n<arguments.length;n++)r[n-0]=arguments[n];return t.Main.isTest&&e.apply(this,r),i.apply(this,r)},o}}function n(e){return function(r,n,o){var i=o.value;return o.value=function(){for(var r=[],n=0;n<arguments.length;n++)r[n-0]=arguments[n];var o=i.apply(this,r),a=[o].concat(r);return t.Main.isTest&&e.apply(this,a),o},o}}function o(e){return function(r,n,o){var i=o.get;return o.get=function(){return t.Main.isTest&&e.call(this),i.call(this)},o}}function i(e){return function(r,n,o){var i=o.set;return o.set=function(r){t.Main.isTest&&e.call(this,r),i.call(this,r)},o}}function a(e){return function(r,n,o){var i=o.get;return o.get=function(){var r=i.call(this);return t.Main.isTest&&e.call(this,r),r},o}}function s(e){return function(r,n,o){var i=o.set;return o.set=function(r){var n=i.call(this,r),o=[n,r];t.Main.isTest&&e.apply(this,o)},o}}function c(e){return function(r){t.Main.isTest&&e(r)}}t.assert=e,t.require=r,t.ensure=n,t.requireGetter=o,t.requireSetter=i,t.ensureGetter=a,t.ensureSetter=s,t.invariant=c}(wd||(wd={}));var wd;!function(t){function e(t,e,r){return function(n,o,i){var a=i.get;return i.get=function(){var n=null;return t.call(this)?e.call(this):(n=a.call(this),r.call(this,n),n)},i}}function r(t,e,r){return function(n,o,i){var a=i.value;return i.value=function(){for(var n=[],o=0;o<arguments.length;o++)n[o-0]=arguments[o];var i=null;return t.apply(this,n)?e.apply(this,n):(i=a.apply(this,n),r.apply(this,[i].concat(n)),i)},i}}t.cacheGetter=e,t.cache=r}(wd||(wd={}));var wd;!function(t){function e(t,e,r){return r}t.virtual=e}(wd||(wd={}));var wd;!function(t){function e(t){return function(e,r,n){var i=n.get,a=n.set;return n.get=function(){if(this.isPhysicsEngineAdapterExist()){var e=this.getPhysicsEngineAdapter()["get"+t](this.gameObject);return null!==e?e:this["_"+o(t)]}return i.call(this)},n.set=function(e){a.call(this,e),this.isPhysicsEngineAdapterExist()&&this.getPhysicsEngineAdapter()["set"+t](this.gameObject,e)},n}}function r(e){return function(r,i,a){var s=a.get,c=a.set;return a.get=function(){var r=t.Director.getInstance().scene;if(n(r)){var i=r.physicsEngineAdapter["get"+e]();return null!==i?i:this["_"+o(e)]}return s.call(this)},a.set=function(r){var o=t.Director.getInstance().scene;c.call(this,r),n(o)&&o.physicsEngineAdapter["set"+e](r)},a}}function n(t){return t.physicsEngineAdapter&&t.physicsEngineAdapter.world}function o(t){var e=t.slice(0,1);return""+e.toLowerCase()+t.slice(1)}t.operateBodyDataGetterAndSetter=e,t.operateWorldDataGetterAndSetter=r}(wd||(wd={}));var wd;!function(t){t.ABSTRACT_ATTRIBUTE=null}(wd||(wd={}));var wd;!function(t){Object.defineProperty(t,"root",{get:function(){return t.JudgeUtils.isNodeJs()?global:window}})}(wd||(wd={}));var wd;!function(t){var e=function(){function t(){this.uid=null,this.uid=t._count,t._count+=1}return t._count=1,t}();t.Entity=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.gameObject=null}return __extends(r,e),r.prototype.init=function(){},r.prototype.dispose=function(){},Object.defineProperty(r.prototype,"transform",{get:function(){return this.gameObject?this.gameObject.transform:null},enumerable:!0,configurable:!0}),r.prototype.addToGameObject=function(t){this.gameObject&&this.gameObject.removeComponent(this),this.gameObject=t},r.prototype.removeFromGameObject=function(t){this.gameObject=null},__decorate([t.virtual],r.prototype,"init",null),__decorate([t.virtual],r.prototype,"dispose",null),r}(t.Entity);t.Component=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(r){e.call(this),this._localToParentMatrix=t.Matrix4.create(),this._localToWorldMatrix=null,this._parent=null,this._position=t.Vector3.create(),this._rotation=t.Quaternion.create(0,0,0,1),this._scale=t.Vector3.create(1,1,1),this._eulerAngles=null,this._localPosition=t.Vector3.create(0,0,0),this._localRotation=t.Quaternion.create(0,0,0,1),this._localEulerAngles=null,this._localScale=t.Vector3.create(1,1,1),this._isTranslate=!1,this._isRotate=!1,this._isScale=!1,this.dirtyWorld=null,this.dirtyLocal=!0,this._children=wdCb.Collection.create(),this._gameObject=null,this._gameObject=r}return __extends(r,e),r.create=function(t){var e=new this(t);return e},Object.defineProperty(r.prototype,"localToParentMatrix",{get:function(){return this.dirtyLocal&&(this._localToParentMatrix.setTRS(this._localPosition,this._localRotation,this._localScale),this.dirtyLocal=!1,this.dirtyWorld=!0),this._localToParentMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"localToWorldMatrix",{get:function(){var t=wdCb.Collection.create(),e=this._parent;for(t.addChild(this);null!==e;)t.addChild(e),e=e.parent;return t.reverse().forEach(function(t){t.sync()}),this._localToWorldMatrix},set:function(t){this._localToWorldMatrix=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"parent",{get:function(){return this._parent},set:function(t){return this._parent&&this._parent.removeChild(this),t?(this._parent=t,void this._parent.addChild(this)):void(this._parent=null)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"position",{get:function(){return this._position=this.localToWorldMatrix.getTranslation(),this._position},set:function(t){null===this._parent?this._localPosition=t.copy():this._localPosition=this._parent.localToWorldMatrix.copy().invert().multiplyVector3(t),this.isTranslate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rotation",{get:function(){return this._rotation.setFromMatrix(this.localToWorldMatrix),this._rotation},set:function(t){null===this._parent?this._localRotation=t.copy():this._localRotation=this._parent.rotation.copy().invert().multiply(t),this.isRotate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scale",{get:function(){return this._scale=this.localToWorldMatrix.getScale(),this._scale},set:function(t){null===this._parent?this._localScale=t.copy():this._localScale=this._parent.localToWorldMatrix.copy().invert().multiplyVector3(t),this.isScale=!0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"eulerAngles",{get:function(){return this._eulerAngles=this.localToWorldMatrix.getEulerAngles(),this._eulerAngles},set:function(t){this._localRotation.setFromEulerAngles(t),null!==this._parent&&(this._localRotation=this._parent.rotation.copy().invert().multiply(this._localRotation)),this.isRotate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"localPosition",{get:function(){return this._localPosition},set:function(t){this._localPosition=t.copy(),this.isTranslate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"localRotation",{get:function(){return this._localRotation},set:function(t){this._localRotation=t.copy(),this.isRotate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"localEulerAngles",{get:function(){return this._localEulerAngles=this._localRotation.getEulerAngles(),this._localEulerAngles},set:function(t){this._localRotation.setFromEulerAngles(t),this.isRotate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"localScale",{get:function(){return this._localScale},set:function(t){this._localScale=t.copy(),this.isScale=!0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"up",{get:function(){return this.localToWorldMatrix.getY().normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"right",{get:function(){return this.localToWorldMatrix.getX().normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"forward",{get:function(){return this.localToWorldMatrix.getZ().normalize().scale(-1)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isTranslate",{get:function(){return this._isTranslate},set:function(t){this._isTranslate=t,t&&(this.dirtyLocal=!0),this._children.forEach(function(e){e.isTranslate=t})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isRotate",{get:function(){return this._isRotate},set:function(t){this._isRotate=t,t&&(this.dirtyLocal=!0),this._children.forEach(function(e){e.isRotate=t})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isScale",{get:function(){return this._isScale},set:function(t){this._isScale=t,t&&(this.dirtyLocal=!0),this._children.forEach(function(e){e.isScale=t})},enumerable:!0,configurable:!0}),r.prototype.init=function(){var e=this;t.EventManager.on(t.EngineEvent.ENDLOOP,function(){e._resetTransformFlag()})},r.prototype.addChild=function(t){this._children.addChild(t)},r.prototype.removeChild=function(t){this._children.removeChild(t)},r.prototype.sync=function(){this.dirtyLocal&&(this._localToParentMatrix.setTRS(this._localPosition,this._localRotation,this._localScale),this.dirtyLocal=!1,this.dirtyWorld=!0),this.dirtyWorld&&(null===this._parent?this._localToWorldMatrix=this._localToParentMatrix.copy():this._localToWorldMatrix=this._parent.localToWorldMatrix.copy().multiply(this._localToParentMatrix),this.dirtyWorld=!1,this._children.forEach(function(t){t.dirtyWorld=!0}))},r.prototype.translateLocal=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=null;return n=3===e.length?t.Vector3.create(e[0],e[1],e[2]):e[0],this._localPosition=this._localPosition.add(this._localRotation.multiplyVector3(n)),this.isTranslate=!0,this},r.prototype.translate=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=null;return n=3===e.length?t.Vector3.create(e[0],e[1],e[2]):e[0],this.position=n.add(this.position),this},r.prototype.rotate=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=null,o=t.Quaternion.create();return n=3===e.length?t.Vector3.create(e[0],e[1],e[2]):e[0],o.setFromEulerAngles(n),null===this._parent?this._localRotation=o.multiply(this._localRotation):(o=this._parent.rotation.copy().invert().multiply(o),this._localRotation=o.multiply(this.rotation)),this.isRotate=!0,this},r.prototype.rotateLocal=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=null,o=t.Quaternion.create();return n=3===e.length?t.Vector3.create(e[0],e[1],e[2]):e[0],o.setFromEulerAngles(n),this._localRotation.multiply(o),this.isRotate=!0,this},r.prototype.rotateAround=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=null,o=null,i=null,a=null,s=null;return 3===e.length?(n=e[0],o=e[1],i=e[2]):(n=e[0],o=t.Vector3.create(e[1],e[2],e[3]),i=t.Vector3.create(e[4],e[5],e[6])),a=t.Quaternion.create().setFromAxisAngle(n,i),s=this.position.copy().sub(o),s=a.multiplyVector3(s),this.position=o.add(s),this.rotation=a.multiply(this.rotation),this},r.prototype.lookAt=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=null,o=null;return 1===e.length?(n=e[0],o=t.Vector3.up):2===e.length?(n=e[0],o=e[1]):3===e.length?(n=t.Vector3.create(e[0],e[1],e[2]),o=t.Vector3.up):(n=t.Vector3.create(e[0],e[1],e[2]),o=t.Vector3.create(e[3],e[4],e[5])),this.rotation=t.Quaternion.create().setFromMatrix(t.Matrix4.create().setLookAt(this.position,n,o)),this},r.prototype._resetTransformFlag=function(){this.isTranslate=!1,this.isScale=!1,this.isRotate=!1},r}(t.Entity);t.Transform=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this._scripts=wdCb.Hash.create(),this.parent=null,this.isRigidbodyChild=!1,this.bubbleParent=null,this.transform=t.Transform.create(this),this.name="gameObject"+String(this.uid),this.actionManager=t.ActionManager.create(),this.isCollided=!1,this._children=wdCb.Collection.create(),this._components=wdCb.Collection.create(),this._startLoopHandler=null,this._endLoopHandler=null}return __extends(r,e),r.create=function(){var t=new this;return t},Object.defineProperty(r.prototype,"script",{get:function(){return this._scripts},enumerable:!0,configurable:!0}),r.prototype.init=function(){var e=this;return this._startLoopHandler=wdCb.FunctionUtils.bind(this,function(){e.onStartLoop()}),this._endLoopHandler=wdCb.FunctionUtils.bind(this,function(){e.onEndLoop()}),t.EventManager.on(t.EngineEvent.STARTLOOP,this._startLoopHandler),t.EventManager.on(t.EngineEvent.ENDLOOP,this._endLoopHandler),this._components.forEach(function(t){t.init()}),this.transform.init(),this.execScript("init"),this.forEach(function(t){t.init()}),this},r.prototype.onStartLoop=function(){this.execScript("onStartLoop")},r.prototype.onEndLoop=function(){this.execScript("onEndLoop")},r.prototype.onEnter=function(){this.execScript("onEnter")},r.prototype.onExit=function(){this.execScript("onExit")},r.prototype.onDispose=function(){this.execScript("onDispose")},r.prototype.dispose=function(){this.onDispose(),this.parent&&(this.parent.removeChild(this),this.parent=null),t.EventManager.off(this),t.EventManager.off(t.EngineEvent.STARTLOOP,this._startLoopHandler),t.EventManager.off(t.EngineEvent.ENDLOOP,this._endLoopHandler),this._components.forEach(function(t){t.dispose()}),this.forEach(function(t){t.dispose()})},r.prototype.hasChild=function(t){return this._children.hasChild(t)},r.prototype.addChild=function(t){return t.parent&&t.parent.removeChild(t),t.parent=this,t.transform.parent=this.transform,this._children.addChild(t),t.onEnter(),this},r.prototype.addChildren=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return this._children.addChildren(t[0]),this},r.prototype.sort=function(){return this._children=this._children.sort(this._ascendZ),this},r.prototype.forEach=function(t){return this._children.forEach(t),this},r.prototype.filter=function(t){return this._children.filter(t)},r.prototype.getChildren=function(){return this._children},r.prototype.getChild=function(t){return this._children.getChild(t)},r.prototype.findChildByUid=function(t){return this._children.findOne(function(e){return e.uid===t})},r.prototype.findChildByName=function(t){return this._children.findOne(function(e){return e.name.search(t)>-1})},r.prototype.findChildrenByName=function(t){return this._children.filter(function(e){return e.name.search(t)>-1})},r.prototype.getComponent=function(t){return this._components.findOne(function(e){return e instanceof t})},r.prototype.findComponentByUid=function(t){return this._components.findOne(function(e){return e.uid===t})},r.prototype.getFirstComponent=function(){return this._components.getChild(0)},r.prototype.removeChild=function(t){return t.onExit(),this._children.removeChild(t),t.parent=null,this},r.prototype.getTopUnderPoint=function(t){var e=null;return this._children.copy().reverse().forEach(function(r){return e=r.getTopUnderPoint(t),e?wdCb.$BREAK:void 0}),e?e:this.isPick(t)?this:null},r.prototype.isPick=function(t){var e=this._getPick();return e?e.isPick(t.x,t.y):!1},r.prototype.hasComponent=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];if(e[0]instanceof t.Component){var n=e[0];return this._components.hasChild(n)}var o=e[0];return this._components.hasChild(function(t){return t instanceof o})},r.prototype.addComponent=function(e){return this.hasComponent(e)?(t.Log.assert(!1,"the component already exist"),this):(this._components.addChild(e),e.addToGameObject(this),this)},r.prototype.removeComponent=function(e){var r=null;return r=e instanceof t.Component?e:this.getComponent(e),this._components.removeChild(r),r.removeFromGameObject(this),this},r.prototype.render=function(t,e){var r=this._getGeometry(),n=this._getRendererComponent();n&&r&&n.render(t,r,e),this._children.forEach(function(r){r.render(t,e)})},r.prototype.update=function(t){var e=this._getCamera(),r=this._getAnimation(),n=this._getCollider();e&&e.update(t),r&&r.update(t),this.actionManager.update(t),this.execScript("update",t),n&&n.update(t),this._children.forEach(function(e){e.update(t)})},r.prototype.execScript=function(t,e){this._scripts.forEach(function(r){r[t]&&(e?r[t](e):r[t]())})},r.prototype._ascendZ=function(t,e){return t.transform.position.z-e.transform.position.z},r.prototype._getGeometry=function(){return this.getComponent(t.Geometry)},r.prototype._getPick=function(){return this.getComponent(t.Pick)},r.prototype._getCamera=function(){return this.getComponent(t.CameraController)},r.prototype._getAnimation=function(){return this.getComponent(t.Animation)},r.prototype._getRendererComponent=function(){return this.getComponent(t.RendererComponent)},r.prototype._getCollider=function(){return this.getComponent(t.Collider)},r.prototype._getComponentCount=function(t){return this._components.filter(function(e){return e instanceof t}).getCount()},__decorate([t.require(function(){t.assert(this._getComponentCount(t.Geometry)<=1,t.Log.info.FUNC_SHOULD_NOT("gameObject","contain more than 1 geometry component"))})],r.prototype,"_getGeometry",null),__decorate([t.require(function(){t.assert(this._getComponentCount(t.Pick)<=1,t.Log.info.FUNC_SHOULD_NOT("gameObject","contain more than 1 pick component"))})],r.prototype,"_getPick",null),__decorate([t.require(function(){t.assert(this._getComponentCount(t.CameraController)<=1,t.Log.info.FUNC_SHOULD_NOT("gameObject","contain more than 1 camera controller"))})],r.prototype,"_getCamera",null),__decorate([t.require(function(){t.assert(this._getComponentCount(t.Animation)<=1,t.Log.info.FUNC_SHOULD_NOT("gameObject","contain more than 1 animation component"))})],r.prototype,"_getAnimation",null),__decorate([t.require(function(){t.assert(this._getComponentCount(t.RendererComponent)<=1,t.Log.info.FUNC_SHOULD_NOT("gameObject","contain more than 1 rendererComponent"))})],r.prototype,"_getRendererComponent",null),__decorate([t.require(function(){t.assert(this._getComponentCount(t.Collider)<=1,t.Log.info.FUNC_SHOULD_NOT("gameObject","contain more than 1 collider component"))})],r.prototype,"_getCollider",null),r}(t.Entity);t.GameObject=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(){function t(){this._scheduleCount=0,this._schedules=wdCb.Hash.create()}return t.create=function(){var t=new this;return t},t.prototype.update=function(t){var e=this;this._schedules.forEach(function(r,n){r.isStop||r.isPause||(r.update(t),r.isFinish&&e.remove(n))})},t.prototype.scheduleLoop=function(t,e){return void 0===e&&(e=[]),this._schedule(i,Array.prototype.slice.call(arguments,0))},t.prototype.scheduleFrame=function(t,e,r){return void 0===e&&(e=1),this._schedule(a,Array.prototype.slice.call(arguments,0))},t.prototype.scheduleInterval=function(t,e,r){return void 0===e&&(e=0),this._schedule(o,Array.prototype.slice.call(arguments,0))},t.prototype.scheduleTime=function(t,e,r){return void 0===e&&(e=0),this._schedule(n,Array.prototype.slice.call(arguments,0))},t.prototype.pause=function(t){if(0===arguments.length){var e=this;this._schedules.forEach(function(t,r){e.pause(r)})}else if(1===arguments.length){var r=this._schedules.getChild(arguments[0]);r.pause()}},t.prototype.resume=function(t){if(0===arguments.length){var e=this;this._schedules.forEach(function(t,r){e.resume(r)})}else if(1===arguments.length){var r=this._schedules.getChild(arguments[0]);r.resume()}},t.prototype.start=function(t){if(0===arguments.length){var e=this;this._schedules.forEach(function(t,r){e.start(r)})}else if(1===arguments.length){var r=this._schedules.getChild(arguments[0]);r.start()}},t.prototype.stop=function(t){if(0===arguments.length){var e=this;this._schedules.forEach(function(t,r){e.stop(r)})}else if(1===arguments.length){var r=this._schedules.getChild(arguments[0]);r.stop()}},t.prototype.has=function(t){return!!this._schedules.hasChild(t)},t.prototype.remove=function(t){this._schedules.removeChild(t)},t.prototype.removeAll=function(){this._schedules.removeAllChildren()},t.prototype._schedule=function(t,e){var r=this._buildId();return this._schedules.setValue(r,t.create.apply(t,e)),r},t.prototype._buildId=function(){return"Schedule_"+this._scheduleCount++},t}();t.Scheduler=e;var r=function(){function e(e,r){this.isPause=!1,this.isStop=!1,this.pauseTime=null,this.pauseElapsed=null,this.startTime=null,this.isFinish=!1,this.task=null,this.args=null,this.timeController=t.CommonTimeController.create(),this.task=e,this.args=r}return e.prototype.pause=function(){this.isPause=!0,this.timeController.pause()},e.prototype.resume=function(){this.isPause=!1,this.timeController.resume()},e.prototype.start=function(){this.isStop=!1,this.timeController.start()},e.prototype.stop=function(){this.isStop=!0,this.timeController.stop()},e.prototype.finish=function(){this.isFinish=!0},e}(),n=function(t){function e(e,r,n){void 0===r&&(r=0),void 0===n&&(n=[]),t.call(this,e,n),this._time=null,this._time=r}return __extends(e,t),e.create=function(t,e,r){void 0===e&&(e=0),void 0===r&&(r=[]);var n=new this(t,e,r);return n},e.prototype.update=function(t){var e=this.timeController.computeElapseTime(t);e>=this._time&&(this.task.apply(this,this.args),this.finish())},e}(r),o=function(t){function e(e,r,n){void 0===r&&(r=0),void 0===n&&(n=[]),t.call(this,e,n),this._intervalTime=null,this._elapsed=0,this._intervalTime=r}return __extends(e,t),e.create=function(t,e,r){void 0===e&&(e=0),void 0===r&&(r=[]);var n=new this(t,e,r);return n},e.prototype.update=function(t){var e=this.timeController.computeElapseTime(t);e-this._elapsed>=this._intervalTime&&(this.task.apply(this,this.args),this._elapsed=e)},e.prototype.start=function(){t.prototype.start.call(this),this._elapsed=0},e}(r),i=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.create=function(t,e){void 0===e&&(e=[]);var r=new this(t,e);return r},e.prototype.update=function(t){this.task.apply(this,this.args)},e}(r),a=function(t){function e(e,r,n){void 0===r&&(r=1),void 0===n&&(n=[]),t.call(this,e,n),this._frame=null,this._frame=r}return __extends(e,t),e.create=function(t,e,r){void 0===e&&(e=1),void 0===r&&(r=[]);var n=new this(t,e,r);return n},e.prototype.update=function(t){this._frame--,this._frame<=0&&(this.task.apply(this,this.args),this.finish())},e}(r)}(wd||(wd={}));var wd;!function(t){var e;!function(t){t[t.NORMAL=0]="NORMAL",t[t.STOP=1]="STOP",t[t.PAUSE=2]="PAUSE"}(e||(e={}));var r=function(){function r(){this.scene=t.Scene.create(),this.scheduler=t.Scheduler.create(),this.renderer=null,this.scriptStreams=wdCb.Hash.create(),this._gameLoop=null,this._gameState=e.NORMAL,this._timeController=t.DirectorTimeController.create(),this._isFirstStart=!0}return r.getInstance=function(){return null===this._instance&&(this._instance=new this,this._instance.initWhenCreate()),this._instance},Object.defineProperty(r.prototype,"gameTime",{get:function(){return this._timeController.gameTime},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fps",{get:function(){return this._timeController.fps},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isNormal",{get:function(){return this._gameState===e.NORMAL},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isStop",{get:function(){return this._gameState===e.STOP},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isPause",{get:function(){return this._gameState===e.PAUSE},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isTimeChange",{get:function(){return this._timeController.isTimeChange},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"elapsed",{get:function(){return this._timeController.elapsed},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"view",{get:function(){return t.DeviceManager.getInstance().view},enumerable:!0,configurable:!0}),r.prototype.initWhenCreate=function(){
this.renderer=t.WebGLRenderer.create()},r.prototype.start=function(){this._gameState=e.NORMAL,this.startLoop()},r.prototype.stop=function(){this._gameLoop&&this._gameLoop.dispose(),this._gameState=e.STOP,this._timeController.stop(),this.scheduler.stop()},r.prototype.pause=function(){this._gameState!==e.PAUSE&&(this._gameState=e.PAUSE,this._timeController.pause(),this.scheduler.pause())},r.prototype.resume=function(){this._gameState=e.NORMAL,this._timeController.resume(),this.scheduler.resume()},r.prototype.getTopUnderPoint=function(t){var e=this.scene.getTopUnderPoint(t);return e?e:this.scene},r.prototype.getDeltaTime=function(){return this._timeController.deltaTime},r.prototype.startLoop=function(){var t=this;this._gameLoop=wdFrp.judge(function(){return t._isFirstStart},function(){return t._buildLoadScriptStream()},function(){return wdFrp.empty()}).concat(this._buildInitStream()).ignoreElements().concat(this._buildLoopStream()).subscribe(function(e){t._loopBody(e)})},r.prototype._buildLoadScriptStream=function(){return wdFrp.fromCollection(this.scriptStreams.getValues()).mergeAll()},r.prototype._buildInitStream=function(){var t=this;return wdFrp.callFunc(function(){t._init()},this)},r.prototype._init=function(){this._isFirstStart=!1,t.EventManager.trigger(t.CustomEvent.create(t.EngineEvent.BEFORE_INIT)),this.scene.onEnter(),this.scene.init(),this.renderer.init(),this._timeController.start(),this.scheduler.start(),t.EventManager.trigger(t.CustomEvent.create(t.EngineEvent.AFTER_INIT)),t.EventManager.trigger(t.CustomEvent.create(t.EngineEvent.AFTER_INIT_RIGIDBODY_ADD_CONSTRAINT))},r.prototype._buildLoopStream=function(){return wdFrp.intervalRequest()},r.prototype._loopBody=function(r){var n=null;return this._gameState===e.PAUSE||this._gameState===e.STOP?!1:(n=this._timeController.computeElapseTime(r),this._timeController.tick(n),t.EventManager.trigger(t.CustomEvent.create(t.EngineEvent.STARTLOOP)),this._run(n),t.EventManager.trigger(t.CustomEvent.create(t.EngineEvent.ENDLOOP)),!0)},r.prototype._run=function(t){this.scheduler.update(t),this.scene.update(t),this.scene.render(this.renderer),this.renderer.render()},r._instance=null,r}();t.Director=r}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){}return e.setConfig=function(e){var r=e.canvasId,n=e.isTest,o=void 0===n?t.DebugConfig.isTest:n,i=e.screenSize,a=void 0===i?t.ScreenSize.FULL:i;return this.isTest=o,this.screenSize=a,this._canvasId=r,this},e.init=function(){return t.DeviceManager.getInstance().createGL(this._canvasId),t.DeviceManager.getInstance().setScreen(),t.GPUDetector.getInstance().detect(),this},e.isTest=null,e.screenSize=null,e._canvasId=null,e}();t.Main=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function o(){e.apply(this,arguments),this.side=null,this.shadowMap={enable:!0,softType:n.NONE},this.shader=null,this.camera=null,this.isUseProgram=!1,this.physics=r.create(),this.physicsEngineAdapter=null,this._lightManager=t.LightManager.create(),this._renderTargetRenderers=wdCb.Collection.create(),this._collisionDetector=t.CollisionDetector.create()}return __extends(o,e),o.create=function(){var t=new this;return t},Object.defineProperty(o.prototype,"ambientLight",{get:function(){return this._lightManager.ambientLight},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"directionLights",{get:function(){return this._lightManager.directionLights},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"pointLights",{get:function(){return this._lightManager.pointLights},enumerable:!0,configurable:!0}),o.prototype.init=function(){return this.addComponent(t.Pick.create()),this.physics.enable&&(this.physicsEngineAdapter=t.PhysicsEngineFactory.create(this.physics.engine),this.physicsEngineAdapter.init()),e.prototype.init.call(this),this._renderTargetRenderers.forEach(function(t){return t.init()}),this},o.prototype.useProgram=function(t){this.isUseProgram=!0,this.shader=t},o.prototype.unUseProgram=function(){this.isUseProgram=!1},o.prototype.addChild=function(t){return this._isCamera(t)?this.camera=t:this._isLight(t)&&this._lightManager.addChild(t),e.prototype.addChild.call(this,t)},o.prototype.addRenderTargetRenderer=function(t){this._renderTargetRenderers.addChild(t)},o.prototype.removeRenderTargetRenderer=function(t){this._renderTargetRenderers.removeChild(t)},o.prototype.update=function(t){this.physics.enable&&this.physicsEngineAdapter.update(t),e.prototype.update.call(this,t),this._collisionDetector.detect(this)},o.prototype.render=function(t){var r=this;this._renderTargetRenderers.forEach(function(e){e.render(t,r.camera)}),e.prototype.render.call(this,t,this.camera)},o.prototype._isCamera=function(e){return e.hasComponent(t.CameraController)},o.prototype._isLight=function(e){return e.hasComponent(t.Light)},__decorate([t.require(function(e){t.assert(!!this.camera,t.Log.info.FUNC_MUST("scene","add camera"))})],o.prototype,"render",null),o}(t.GameObject);t.Scene=e;var r=function(){function e(){this._gravity=t.Vector3.create(0,-9.8,0),this.enable=!1,this.engine=t.PhysicsEngineType.CANNON,this.iterations=10}return e.create=function(){var t=new this;return t},Object.defineProperty(e.prototype,"gravity",{get:function(){return this._gravity},set:function(t){this._gravity=t},enumerable:!0,configurable:!0}),__decorate([t.operateWorldDataGetterAndSetter("Gravity")],e.prototype,"gravity",null),e}();t.PhysicsConfig=r,function(t){t[t.NONE=0]="NONE",t[t.PCF=1]="PCF"}(t.ShadowMapSoftType||(t.ShadowMapSoftType={}));var n=t.ShadowMapSoftType}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){this._lights=wdCb.Hash.create()}return e.create=function(){var t=new this;return t},Object.defineProperty(e.prototype,"ambientLight",{get:function(){return this._lights.getChild(t.AmbientLight.type)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"directionLights",{get:function(){return this._lights.getChild(t.DirectionLight.type)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointLights",{get:function(){return this._lights.getChild(t.PointLight.type)},enumerable:!0,configurable:!0}),e.prototype.addChild=function(e){e.hasComponent(t.AmbientLight)?this._lights.addChild(t.AmbientLight.type,e):e.hasComponent(t.DirectionLight)?this._lights.appendChild(t.DirectionLight.type,e):e.hasComponent(t.PointLight)?this._lights.appendChild(t.PointLight.type,e):t.Log.error(!0,t.Log.info.FUNC_INVALID("light"))},e}();t.LightManager=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.create=function(){var t=new this;return t.initWhenCreate(),t},r.prototype.initWhenCreate=function(){this.addComponent(t.SkyboxRenderer.create())},r}(t.GameObject);t.Skybox=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){this._lastCollideObjects=null}return e.create=function(){var t=new this;return t},e.prototype.detect=function(e){var r=e.filter(function(e){return e.hasComponent(t.Collider)}),n=this;r.forEach(function(e){var o=null;e.hasComponent(t.RigidBody)||(o=e.getComponent(t.Collider).getCollideObjects(r),o.getCount()>0?(n._isCollisionStart(e)?(e.execScript("onCollisionStart",o),e.execScript("onContact",o),n._triggerCollisionEventOfCollideObjectWhichHasRigidBody(o,e,["onCollisionStart","onContact"])):(e.execScript("onContact",o),n._triggerCollisionEventOfCollideObjectWhichHasRigidBody(o,e,["onContact"])),e.isCollided=!0,n._lastCollideObjects=o):(n._isCollisionEnd(e)&&(e.execScript("onCollisionEnd"),n._triggerCollisionEventOfCollideObjectWhichHasRigidBody(n._lastCollideObjects,e,["onCollisionEnd"])),e.isCollided=!1))})},e.prototype._isCollisionStart=function(t){return!t.isCollided},e.prototype._isCollisionEnd=function(t){return t.isCollided},e.prototype._triggerCollisionEventOfCollideObjectWhichHasRigidBody=function(e,r,n){e.filter(function(e){return e.hasComponent(t.RigidBody)}).forEach(function(t){for(var e=0;e<n.length;e++){var o=n[e];t.execScript(o,wdCb.Collection.create([r]))}})},e}();t.CollisionDetector=e}(wd||(wd={}));var wd;!function(t){t.DEG_TO_RAD=Math.PI/180,t.RAD_TO_DEG=180/Math.PI}(wd||(wd={}));var wd;!function(t){var e=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];this.values=new Float32Array(2),t.length>0&&(this.values[0]=t[0],this.values[1]=t[1])}return t.create=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var r=null;return r=0===t.length?new this:new this(t[0],t[1])},Object.defineProperty(t.prototype,"x",{get:function(){return this.values[0]},set:function(t){this.values[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.values[1]},set:function(t){this.values[1]=t},enumerable:!0,configurable:!0}),t.prototype.set=function(t,e){this.x=t,this.y=e},t}();t.Vector2=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];this.values=null,this.values=new Float32Array(3),t.length>0&&(this.values[0]=t[0],this.values[1]=t[1],this.values[2]=t[2])}return e.create=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var r=null;return r=0===t.length?new this:new this(t[0],t[1],t[2])},Object.defineProperty(e.prototype,"x",{get:function(){return this.values[0]},set:function(t){this.values[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.values[1]},set:function(t){this.values[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this.values[2]},set:function(t){this.values[2]=t},enumerable:!0,configurable:!0}),e.prototype.normalize=function(){var t=this.values,e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return 0===e?(t[0]=0,t[1]=0,t[2]=0,this):(t[0]=t[0]/e,t[1]=t[1]/e,t[2]=t[2]/e,t[0]===-0&&(t[0]=0),t[1]===-0&&(t[1]=0),t[2]===-0&&(t[2]=0),this)},e.prototype.isZero=function(){var t=this.values;return 0===t[0]&&0===t[1]&&0===t[2]},e.prototype.scale=function(t){var e=this.values;return e[0]*=t,e[1]*=t,e[2]*=t,this},e.prototype.set=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];if(3===t.length)this.x=t[0],this.y=t[1],this.z=t[2];else{var r=t[0];this.x=r.x,this.y=r.y,this.z=r.z}},e.prototype.sub=function(t){return this.values[0]=this.values[0]-t.values[0],this.values[1]=this.values[1]-t.values[1],this.values[2]=this.values[2]-t.values[2],this},e.prototype.sub2=function(t,e){return this.values[0]=t.values[0]-e.values[0],this.values[1]=t.values[1]-e.values[1],this.values[2]=t.values[2]-e.values[2],this},e.prototype.add=function(t){return this.values[0]=this.values[0]+t.values[0],this.values[1]=this.values[1]+t.values[1],this.values[2]=this.values[2]+t.values[2],this},e.prototype.add2=function(t,e){return this.values[0]=t.values[0]+e.values[0],this.values[1]=t.values[1]+e.values[1],this.values[2]=t.values[2]+e.values[2],this},e.prototype.mul=function(t){return this.values[0]=this.values[0]*t.values[0],this.values[1]=this.values[1]*t.values[1],this.values[2]=this.values[2]*t.values[2],this},e.prototype.reverse=function(){return this.values[0]=-this.values[0],this.values[1]=-this.values[1],this.values[2]=-this.values[2],this},e.prototype.copy=function(){var t=e.create(),r=0,n=this.values.length;for(r=0;n>r;r++)t.values[r]=this.values[r];return t},e.prototype.toVector4=function(){return t.Vector4.create(this.values[0],this.values[1],this.values[2],1)},e.prototype.length=function(){var t=this.values;return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])},e.prototype.cross=function(t,e){var r,n,o,i,a,s,c,u,h;return r=t.values,n=e.values,o=this.values,i=r[0],a=r[1],s=r[2],c=n[0],u=n[1],h=n[2],o[0]=a*h-u*s,o[1]=s*c-h*i,o[2]=i*u-c*a,this},e.prototype.lerp=function(t,e,r){var n=t.values,o=e.values,i=this.values;return i[0]=n[0]+r*(o[0]-n[0]),i[1]=n[1]+r*(o[1]-n[1]),i[2]=n[2]+r*(o[2]-n[2]),this},e.prototype.dot=function(t){var e=this.values,r=t.values;return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]},e.prototype.min=function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this.z>t.z&&(this.z=t.z),this},e.prototype.max=function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this.z<t.z&&(this.z=t.z),this},e.prototype.isEqual=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},e.prototype.toArray=function(){return[this.x,this.y,this.z]},e.prototype.applyMatrix4=function(t){var e=this.x,r=this.y,n=this.z,o=t.values;return this.x=o[0]*e+o[4]*r+o[8]*n+o[12],this.y=o[1]*e+o[5]*r+o[9]*n+o[13],this.z=o[2]*e+o[6]*r+o[10]*n+o[14],this},e.prototype.distanceTo=function(t){return Math.sqrt(this.distanceToSquared(t))},e.prototype.distanceToSquared=function(t){var e=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return Math.pow(e,2)+Math.pow(r,2)+Math.pow(n,2)},e.up=e.create(0,1,0),e.forward=e.create(0,0,1),e.right=e.create(1,0,0),e}();t.Vector3=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];this.values=new Float32Array(4),t.length>0&&(this.values[0]=t[0],this.values[1]=t[1],this.values[2]=t[2],this.values[3]=t[3])}return e.create=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var r=null;return r=0===t.length?new this:new this(t[0],t[1],t[2],t[3])},Object.defineProperty(e.prototype,"x",{get:function(){return this.values[0]},set:function(t){this.values[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.values[1]},set:function(t){this.values[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this.values[2]},set:function(t){this.values[2]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"w",{get:function(){return this.values[3]},set:function(t){this.values[3]=t},enumerable:!0,configurable:!0}),e.prototype.normalize=function(){var t=this.values,r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]);return 0===r?e.create(0,0,0,0):(t[0]=t[0]/r,t[1]=t[1]/r,t[2]=t[2]/r,t[3]=t[3]/r,this)},e.prototype.copy=function(){return this.copyHelper(e.create())},e.prototype.toVector3=function(){return t.Vector3.create(this.values[0],this.values[1],this.values[2])},e.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},e.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},e.prototype.set=function(t,e,r,n){this.x=t,this.y=e,this.z=r,this.w=n},e.prototype.copyHelper=function(t){var e=t,r=0,n=this.values.length;for(r=0;n>r;r++)e.values[r]=this.values[r];return e},e}();t.Vector4=e}(wd||(wd={}));var __decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(){function e(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];this.values=null,this._matrixArr=null,1===t.length?this.values=t[0]:this.values=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._matrixArr=[]}return e.create=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var r=null;return r=0===t.length?new this:new this(t[0])},e.prototype.push=function(){this._matrixArr.push(this.values)},e.prototype.pop=function(){this.values=this._matrixArr.pop()},e.prototype.setIdentity=function(){var t=this.values;return t[0]=1,t[4]=0,t[8]=0,t[12]=0,t[1]=0,t[5]=1,t[9]=0,t[13]=0,t[2]=0,t[6]=0,t[10]=1,t[14]=0,t[3]=0,t[7]=0,t[11]=0,t[15]=1,this},e.prototype.invert=function(){var t,e,r,n,o,i,a,s,c,u,h,l,p,f,d,_,y,m,g,v,b,w,C,T,S,D,O,x,E,M;return M=this.values,t=M[0],e=M[1],r=M[2],n=M[3],o=M[4],i=M[5],a=M[6],s=M[7],c=M[8],u=M[9],h=M[10],l=M[11],p=M[12],f=M[13],d=M[14],_=M[15],y=t*i-e*o,m=t*a-r*o,g=t*s-n*o,v=e*a-r*i,b=e*s-n*i,w=r*s-n*a,C=c*f-u*p,T=c*d-h*p,S=c*_-l*p,D=u*d-h*f,O=u*_-l*f,x=h*_-l*d,E=1/(y*x-m*O+g*D+v*S-b*T+w*C),M[0]=(i*x-a*O+s*D)*E,M[1]=(-e*x+r*O-n*D)*E,M[2]=(f*w-d*b+_*v)*E,M[3]=(-u*w+h*b-l*v)*E,M[4]=(-o*x+a*S-s*T)*E,M[5]=(t*x-r*S+n*T)*E,M[6]=(-p*w+d*g-_*m)*E,M[7]=(c*w-h*g+l*m)*E,M[8]=(o*O-i*S+s*C)*E,M[9]=(-t*O+e*S-n*C)*E,M[10]=(p*b-f*g+_*y)*E,M[11]=(-c*b+u*g-l*y)*E,M[12]=(-o*D+i*T-a*C)*E,M[13]=(t*D-e*T+r*C)*E,M[14]=(-p*v+f*m-d*y)*E,M[15]=(c*v-u*m+h*y)*E,this},e.prototype.invertTo3x3=function(){var e,r,n,o,i,a,s,c,u,h,l,p,f,d=t.Matrix3.create();return h=this.values,l=d.values,e=h[10]*h[5]-h[6]*h[9],r=-h[10]*h[1]+h[2]*h[9],n=h[6]*h[1]-h[2]*h[5],o=-h[10]*h[4]+h[6]*h[8],i=h[10]*h[0]-h[2]*h[8],a=-h[6]*h[0]+h[2]*h[4],s=h[9]*h[4]-h[5]*h[8],c=-h[9]*h[0]+h[1]*h[8],u=h[5]*h[0]-h[1]*h[4],p=h[0]*e+h[1]*o+h[2]*s,0===p?(t.Log.warn("can't invert matrix, determinant is 0"),d):(f=1/p,l[0]=f*e,l[1]=f*r,l[2]=f*n,l[3]=f*o,l[4]=f*i,l[5]=f*a,l[6]=f*s,l[7]=f*c,l[8]=f*u,d)},e.prototype.transpose=function(){var t,e=this.values;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},e.prototype.setTranslate=function(t,e,r){var n=this.values;return n[0]=1,n[4]=0,n[8]=0,n[12]=t,n[1]=0,n[5]=1,n[9]=0,n[13]=e,n[2]=0,n[6]=0,n[10]=1,n[14]=r,n[3]=0,n[7]=0,n[11]=0,n[15]=1,this},e.prototype.translate=function(t,r,n){return this.applyMatrix(e.create().setTranslate(t,r,n)),this},e.prototype.setRotate=function(t,e,r,n){var o,i,a,s,c,u,h,l,p,f,d,_,t=Math.PI*t/180;return o=this.values,i=Math.sin(t),a=Math.cos(t),0!==e&&0===r&&0===n?(0>e&&(i=-i),o[0]=1,o[4]=0,o[8]=0,o[12]=0,o[1]=0,o[5]=a,o[9]=-i,o[13]=0,o[2]=0,o[6]=i,o[10]=a,o[14]=0,o[3]=0,o[7]=0,o[11]=0,o[15]=1):0===e&&0!==r&&0===n?(0>r&&(i=-i),o[0]=a,o[4]=0,o[8]=i,o[12]=0,o[1]=0,o[5]=1,o[9]=0,o[13]=0,o[2]=-i,o[6]=0,o[10]=a,o[14]=0,o[3]=0,o[7]=0,o[11]=0,o[15]=1):0===e&&0===r&&0!==n?(0>n&&(i=-i),o[0]=a,o[4]=-i,o[8]=0,o[12]=0,o[1]=i,o[5]=a,o[9]=0,o[13]=0,o[2]=0,o[6]=0,o[10]=1,o[14]=0,o[3]=0,o[7]=0,o[11]=0,o[15]=1):(s=Math.sqrt(e*e+r*r+n*n),1!==s&&(c=1/s,e*=c,r*=c,n*=c),u=1-a,h=e*r,l=r*n,p=n*e,f=e*i,d=r*i,_=n*i,o[0]=e*e*u+a,o[1]=h*u+_,o[2]=p*u-d,o[3]=0,o[4]=h*u-_,o[5]=r*r*u+a,o[6]=l*u+f,o[7]=0,o[8]=p*u+d,o[9]=l*u-f,o[10]=n*n*u+a,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1),this},e.prototype.rotate=function(){for(var t=[],r=0;r<arguments.length;r++)t[r-0]=arguments[r];var n=t[0];if(2===t.length){var o=t[1];this.applyMatrix(e.create().setRotate(n,o.values[0],o.values[1],o.values[2]))}else if(4===t.length){var i=t[1],a=t[2],s=t[3];this.applyMatrix(e.create().setRotate(n,i,a,s))}return this},e.prototype.setScale=function(t,e,r){var n=this.values;return n[0]=t,n[4]=0,n[8]=0,n[12]=0,n[1]=0,n[5]=e,n[9]=0,n[13]=0,n[2]=0,n[6]=0,n[10]=r,n[14]=0,n[3]=0,n[7]=0,n[11]=0,n[15]=1,this},e.prototype.scale=function(t,r,n){return this.applyMatrix(e.create().setScale(t,r,n)),this},e.prototype.setLookAt=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n,o,i,a,s,c;3===e.length?(a=e[0],s=e[1],c=e[2]):9===e.length&&(a=t.Vector3.create(e[0],e[1],e[2]),s=t.Vector3.create(e[3],e[4],e[5]),c=t.Vector3.create(e[6],e[7],e[8])),n=t.Vector3.create(),i=a.copy().sub(s).normalize(),o=c.copy().normalize(),n.cross(o,i).normalize(),o.cross(i,n);var u=this.values;return u[0]=n.x,u[1]=n.y,u[2]=n.z,u[3]=0,u[4]=o.x,u[5]=o.y,u[6]=o.z,u[7]=0,u[8]=i.x,u[9]=i.y,u[10]=i.z,u[11]=0,u[12]=a.x,u[13]=a.y,u[14]=a.z,u[15]=1,this},e.prototype.lookAt=function(){for(var t=[],r=0;r<arguments.length;r++)t[r-0]=arguments[r];var n=e.create();return this.applyMatrix(n.setLookAt.apply(n,t)),this},e.prototype.setOrtho=function(t,e,r,n,o,i){var a,s,c,u=this.values;return a=1/(e-t),s=1/(n-r),c=1/(i-o),u[0]=2*a,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=2*s,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=-2*c,u[11]=0,u[12]=-(e+t)*a,u[13]=-(n+r)*s,u[14]=-(i+o)*c,u[15]=1,this},e.prototype.ortho=function(t,r,n,o,i,a){return this.applyMatrix(e.create().setOrtho(t,r,n,o,i,a)),this},e.prototype.setPerspective=function(e,r,n,o){var i=null,a=null,s=null,c=null,e=Math.PI*e/180/2;return s=Math.sin(e),t.Log.error(0===s,t.Log.info.FUNC_MUST_NOT_BE("frustum","null")),a=1/(o-n),c=Math.cos(e)/s,i=this.values,i[0]=c/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=c,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=-(o+n)*a,i[11]=-1,i[12]=0,i[13]=0,i[14]=-2*n*o*a,i[15]=0,this},e.prototype.perspective=function(t,r,n,o){return this.applyMatrix(e.create().setPerspective(t,r,n,o)),this},e.prototype.applyMatrix=function(t){var e=this,r=t.copy();return this.values=r.multiply(e).values,this},e.prototype.multiply=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var r=null,n=null,o=null;o=this.values,1===t.length?(r=this.values,n=t[0].values):2===t.length&&(r=t[0].values,n=t[1].values);var i=r[0],a=r[1],s=r[2],c=r[3],u=r[4],h=r[5],l=r[6],p=r[7],f=r[8],d=r[9],_=r[10],y=r[11],m=r[12],g=r[13],v=r[14],b=r[15],w=n[0],C=n[1],T=n[2],S=n[3],D=n[4],O=n[5],x=n[6],E=n[7],M=n[8],L=n[9],A=n[10],P=n[11],R=n[12],F=n[13],N=n[14],U=n[15];return o[0]=w*i+C*u+T*f+S*m,o[1]=w*a+C*h+T*d+S*g,o[2]=w*s+C*l+T*_+S*v,o[3]=w*c+C*p+T*y+S*b,o[4]=D*i+O*u+x*f+E*m,o[5]=D*a+O*h+x*d+E*g,o[6]=D*s+O*l+x*_+E*v,o[7]=D*c+O*p+x*y+E*b,o[8]=M*i+L*u+A*f+P*m,o[9]=M*a+L*h+A*d+P*g,o[10]=M*s+L*l+A*_+P*v,o[11]=M*c+L*p+A*y+P*b,o[12]=R*i+F*u+N*f+U*m,o[13]=R*a+F*h+N*d+U*g,o[14]=R*s+F*l+N*_+U*v,o[15]=R*c+F*p+N*y+U*b,this},e.prototype.multiplyVector4=function(e){var r=this.values,n=e.values,o=[];return o[0]=n[0]*r[0]+n[1]*r[4]+n[2]*r[8]+n[3]*r[12],o[1]=n[0]*r[1]+n[1]*r[5]+n[2]*r[9]+n[3]*r[13],o[2]=n[0]*r[2]+n[1]*r[6]+n[2]*r[10]+n[3]*r[14],o[3]=n[0]*r[3]+n[1]*r[7]+n[2]*r[11]+n[3]*r[15],t.Vector4.create(o[0],o[1],o[2],o[3])},e.prototype.multiplyVector3=function(e){var r=this.values,n=e.values,o=[];return o[0]=n[0]*r[0]+n[1]*r[4]+n[2]*r[8]+r[12],o[1]=n[0]*r[1]+n[1]*r[5]+n[2]*r[9]+r[13],o[2]=n[0]*r[2]+n[1]*r[6]+n[2]*r[10]+r[14],t.Vector3.create(o[0],o[1],o[2])},e.prototype.copy=function(){var t=e.create(),r=0,n=this.values.length;for(r=0;n>r;r++)t.values[r]=this.values[r];return t},e.prototype.getX=function(){return t.Vector3.create(this.values[0],this.values[1],this.values[2])},e.prototype.getY=function(){return t.Vector3.create(this.values[4],this.values[5],this.values[6])},e.prototype.getZ=function(){return t.Vector3.create(this.values[8],this.values[9],this.values[10])},e.prototype.getTranslation=function(){return t.Vector3.create(this.values[12],this.values[13],this.values[14])},e.prototype.getScale=function(){return t.Vector3.create(this.getX().length(),this.getY().length(),this.getZ().length())},e.prototype.getEulerAngles=function(){var e,r,n,o,i,a,s,c,u=this.getScale();return o=u.x,i=u.y,a=u.z,s=this.values,r=Math.asin(-s[2]/o),c=.5*Math.PI,c>r?r>-c?(e=Math.atan2(s[6]/i,s[10]/a),n=Math.atan2(s[1]/o,s[0]/o)):(n=0,e=-Math.atan2(s[4]/i,s[5]/i)):(n=0,e=Math.atan2(s[4]/i,s[5]/i)),t.Vector3.create(e,r,n).scale(t.RAD_TO_DEG)},e.prototype.setTRS=function(t,e,r){var n,o,i,a,s,c,u,h,l,p,f,d,_,y,m,g,v,b,w,C,T,S,D;return n=t.x,o=t.y,i=t.z,a=e.x,s=e.y,c=e.z,u=e.w,h=r.x,l=r.y,p=r.z,f=a+a,d=s+s,_=c+c,y=a*f,m=a*d,g=a*_,v=s*d,b=s*_,w=c*_,C=u*f,T=u*d,S=u*_,D=this.values,D[0]=(1-(v+w))*h,D[1]=(m+S)*h,D[2]=(g-T)*h,D[3]=0,D[4]=(m-S)*l,D[5]=(1-(y+w))*l,D[6]=(b+C)*l,D[7]=0,D[8]=(g+T)*p,D[9]=(b-C)*p,D[10]=(1-(y+v))*p,D[11]=0,D[12]=n,D[13]=o,D[14]=i,D[15]=1,this},__decorate([t.require(function(e,r,n,o,i,a){t.assert(e!==r&&n!==o&&i!==a,t.Log.info.FUNC_MUST_NOT_BE("frustum","null"))})],e.prototype,"setOrtho",null),__decorate([t.require(function(e,r,n,o){t.assert(n!==o&&0!==r,t.Log.info.FUNC_MUST_NOT_BE("frustum","null")),t.assert(n>0,t.Log.info.FUNC_MUST("near","> 0")),t.assert(o>0,t.Log.info.FUNC_MUST("far","> 0"))})],e.prototype,"setPerspective",null),e}();t.Matrix4=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];this.values=null,1===t.length?this.values=t[0]:this.values=new Float32Array([1,0,0,0,1,0,0,0,1])}return e.create=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var r=null;return r=0===t.length?new this:new this(t[0])},e.prototype.setIdentity=function(){var t=this.values;return t[0]=1,t[3]=0,t[6]=0,t[1]=0,t[4]=1,t[7]=0,t[2]=0,t[5]=0,t[8]=1,this},e.prototype.invert=function(){var e=this.values,r=new Float32Array(16),n=this.values;r[0]=e[10]*e[5]-e[6]*e[9],r[1]=-e[10]*e[1]+e[2]*e[9],r[2]=e[6]*e[1]-e[2]*e[5],r[3]=-e[10]*e[4]+e[6]*e[8],r[4]=e[10]*e[0]-e[2]*e[8],r[5]=-e[6]*e[0]+e[2]*e[4],r[6]=e[9]*e[4]-e[5]*e[8],r[7]=-e[9]*e[0]+e[1]*e[8],r[8]=e[5]*e[0]-e[1]*e[4];var o=e[0]*r[0]+e[1]*r[3]+e[2]*r[6];if(0===o)return t.Log.warn("can't invert matrix, determinant is 0"),this.setIdentity(),this;o=1/o;for(var i=0;9>i;i++)n[i]=r[i]*o},e.prototype.multiplyScalar=function(t){var e=this.values;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},e.prototype.multiplyVector3=function(e){var r=e.x,n=e.y,o=e.z,i=t.Vector3.create(),a=this.values;return i.x=a[0]*r+a[3]*n+a[6]*o,i.y=a[1]*r+a[4]*n+a[7]*o,i.z=a[2]*r+a[5]*n+a[8]*o,i},e.prototype.transpose=function(){var t,e=this.values;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},e.prototype.copy=function(){var t=this.values;return e.create().set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])},e.prototype.set=function(t,e,r,n,o,i,a,s,c){var u=this.values;return u[0]=t,u[3]=e,u[6]=r,u[1]=n,u[4]=o,u[7]=i,u[2]=a,u[5]=s,u[8]=c,this},e}();t.Matrix3=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(t,e,r,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===n&&(n=1),this.x=null,this.y=null,this.z=null,this.w=null,this.x=t,this.y=e,this.z=r,this.w=n}return e.create=function(t,e,r,n){var o=new this(t,e,r,n);return o},e.prototype.setFromEulerAngles=function(e){var r,n,o,i,a,s,c,u=e.x,h=e.y,l=e.z;return c=.5*t.DEG_TO_RAD,u*=c,h*=c,l*=c,r=Math.sin(u),n=Math.cos(u),o=Math.sin(h),i=Math.cos(h),a=Math.sin(l),s=Math.cos(l),this.x=r*i*s-n*o*a,this.y=n*o*s+r*i*a,this.z=n*i*a-r*o*s,this.w=n*i*s+r*o*a,this},e.prototype.multiply=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var r,n,o,i,a,s,c,u,h,l,p=this;return 1===t.length?(h=this,l=t[0]):2===t.length&&(h=t[0],l=t[1]),r=h.x,n=h.y,o=h.z,i=h.w,a=l.x,s=l.y,c=l.z,u=l.w,p.x=i*a+r*u+n*c-o*s,p.y=i*s+n*u+o*a-r*c,p.z=i*c+o*u+r*s-n*a,p.w=i*u-r*a-n*s-o*c,p},e.prototype.setFromMatrix=function(t){var e,r,n,o,i,a,s,c,u,h,l,p,f,d,_,y;return y=t.values,e=y[0],r=y[1],n=y[2],o=y[4],i=y[5],a=y[6],s=y[8],c=y[9],u=y[10],f=1/Math.sqrt(e*e+r*r+n*n),d=1/Math.sqrt(o*o+i*i+a*a),_=1/Math.sqrt(s*s+c*c+u*u),e*=f,r*=f,n*=f,o*=d,i*=d,a*=d,s*=_,c*=_,u*=_,h=e+i+u,h>=0?(l=Math.sqrt(h+1),this.w=.5*l,l=.5/l,this.x=(a-c)*l,this.y=(s-n)*l,this.z=(r-o)*l):e>i?e>u?(p=e-(i+u)+1,p=Math.sqrt(p),this.x=.5*p,p=.5/p,this.w=(a-c)*p,this.y=(r+o)*p,this.z=(n+s)*p):(p=u-(e+i)+1,p=Math.sqrt(p),this.z=.5*p,p=.5/p,this.w=(r-o)*p,this.x=(s+n)*p,this.y=(c+a)*p):i>u?(p=i-(u+e)+1,p=Math.sqrt(p),this.y=.5*p,p=.5/p,this.w=(s-n)*p,this.z=(a+c)*p,this.x=(o+r)*p):(p=u-(e+i)+1,p=Math.sqrt(p),this.z=.5*p,p=.5/p,this.w=(r-o)*p,this.x=(s+n)*p,this.y=(c+a)*p),this},e.prototype.setFromAxisAngle=function(e,r){var n,o;return r=r.normalize(),e*=.5*t.DEG_TO_RAD,n=Math.sin(e),o=Math.cos(e),this.x=n*r.x,this.y=n*r.y,this.z=n*r.z,this.w=o,this},e.prototype.invert=function(){return this.conjugate().normalize()},e.prototype.conjugate=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},e.prototype.clone=function(){return e.create(this.x,this.y,this.z,this.w)},e.prototype.copy=function(){return e.create(this.x,this.y,this.z,this.w)},e.prototype.normalize=function(){var t=this.length();return 0===t?(this.x=this.y=this.z=0,this.w=1):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this},e.prototype.length=function(){var t,e,r,n;return t=this.x,e=this.y,r=this.z,n=this.w,Math.sqrt(t*t+e*e+r*r+n*n)},e.prototype.multiplyVector3=function(e){var r=this,n=e.x,o=e.y,i=e.z,a=r.x,s=r.y,c=r.z,u=r.w,h=u*n+s*i-c*o,l=u*o+c*n-a*i,p=u*i+a*o-s*n,f=-a*n-s*o-c*i;return t.Vector3.create(h*u+f*-a+l*-c-p*-s,l*u+f*-s+p*-a-h*-c,p*u+f*-c+h*-s-l*-a)},e.prototype.set=function(t,e,r,n){this.x=t,this.y=e,this.z=r,this.w=n},e.prototype.sub=function(t){var e=t.copy().invert().multiply(this);return this.set(e.x,e.y,e.z,e.w),this},e.prototype.getEulerAngles=function(){var e,r,n,o,i,a,s,c;return o=this.x,i=this.y,a=this.z,s=this.w,c=2*(s*i-o*a),-.99999>=c?(e=2*Math.atan2(o,s),r=-Math.PI/2,n=0):c>=.99999?(e=2*Math.atan2(o,s),r=Math.PI/2,n=0):(e=Math.atan2(2*(s*o+i*a),1-2*(o*o+i*i)),r=Math.asin(c),n=Math.atan2(2*(s*a+o*i),1-2*(i*i+a*a))),t.Vector3.create(e,r,n).scale(t.RAD_TO_DEG)},e}();t.Quaternion=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(e,r,n,o){this.normal=t.Vector3.create(0,1,0),this.d=0,this.normal=t.Vector3.create(e,r,n),this.d=o}return e.create=function(t,e,r,n){var o=new this(t,e,r,n);return o},e.prototype.getReflectionMatrix=function(){this.normalize();var e=this.normal.x,r=this.normal.y,n=this.normal.z,o=-2*e,i=-2*r,a=-2*n,s=t.Matrix4.create();return s.values[0]=o*e+1,s.values[1]=i*e,s.values[2]=a*e,s.values[3]=0,s.values[4]=o*r,s.values[5]=i*r+1,s.values[6]=a*r,s.values[7]=0,s.values[8]=o*n,s.values[9]=i*n,s.values[10]=a*n+1,s.values[11]=0,s.values[12]=o*this.d,s.values[13]=i*this.d,s.values[14]=a*this.d,s.values[15]=1,s},e.prototype.normalize=function(){var t=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),e=0;return 0!==t&&(e=1/t),this.normal.x*=e,this.normal.y*=e,this.normal.z*=e,this.d*=e,this},e.prototype.copy=function(){return e.create(this.normal.x,this.normal.y,this.normal.z,this.d)},e}();t.Plane=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(t.Component);t.Animation=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function n(){e.apply(this,arguments),this.interpolation=0,this.currentFrame=0,this.nextFrame=1,this.duration=null,this.fps=null,this.currentAnimName=null,this.isFrameChange=!1,this._currentTime=0,this._oldTime=0,this._frameCount=null,this._state=r.DEFAULT,this._isResume=!1,this._isStartFromStop=!1,this._pauseTime=null,this._resumeTime=null}return __extends(n,e),n.create=function(){var t=new this;return t},Object.defineProperty(n.prototype,"isStart",{get:function(){return this._state===r.RUN},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isStop",{get:function(){return this._state===r.STOP},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isPause",{get:function(){
return this._state===r.PAUSE},enumerable:!0,configurable:!0}),n.prototype.init=function(){},n.prototype.dispose=function(){},n.prototype.play=function(e,r){var n=this.gameObject.getComponent(t.ModelGeometry);this.currentAnimName=e,this.fps=r,this.duration=1/r*1e3,this._frameCount=n.morphTargets.getChild(e).getCount(),this._start()},n.prototype.pause=function(){this._state=r.PAUSE,this._pauseTime=this._currentTime},n.prototype.resume=function(){this._state=r.RUN,this._isResume=!0,this._resumeTime=this._oldTime},n.prototype.stop=function(){this._state=r.STOP},n.prototype.update=function(t){if(this._state!==r.DEFAULT){if(this.isStop||this.isPause)return void(this._oldTime=t);this._isResume&&(this._isResume=!1,this._continueFromPausePoint(t)),this._currentTime=t,this._isStartFromStop&&(this._isStartFromStop=!1,this._resetAnim()),this._currentTime-this._oldTime>this.duration?(this.isFrameChange=!0,this._oldTime=this._floor(this._currentTime),this.currentFrame=this.nextFrame,this.nextFrame++,this.nextFrame>=this._frameCount&&(this.nextFrame=0)):this.isFrameChange=!1,this.interpolation=this.fps*(this._currentTime-this._oldTime)/1e3}},n.prototype._start=function(){this._currentTime=0,this._oldTime=0,this.currentFrame=0,this.nextFrame=this.currentFrame+1,this.isStop&&(this._isStartFromStop=!0),this._state=r.RUN},n.prototype._floor=function(t){return t-t%this.duration},n.prototype._resetAnim=function(){this._oldTime=this._currentTime},n.prototype._continueFromPausePoint=function(t){this._oldTime=t-(this._resumeTime-this._pauseTime)%this.duration},__decorate([t.require(function(e,r){var n=this.gameObject.getComponent(t.ModelGeometry);t.assert(n,t.Log.info.FUNC_SHOULD("this gameObject","add ModelGeometry component")),t.assert(n.morphTargets.getChild(e)&&n.morphTargets.getChild(e).getCount()>0,t.Log.info.FUNC_NOT_EXIST('"'+e+'" animation'))}),t.ensure(function(){t.assert(this._frameCount>1,t.Log.info.FUNC_SHOULD("frames.count","> 1"))})],n.prototype,"play",null),n}(t.Animation);t.MorphAnimation=e;var r;!function(t){t[t.DEFAULT=0]="DEFAULT",t[t.RUN=1]="RUN",t[t.STOP=2]="STOP",t[t.PAUSE=3]="PAUSE"}(r||(r={}))}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this._material=null,this.buffers=null}return __extends(r,e),Object.defineProperty(r.prototype,"material",{get:function(){return this._material},set:function(e){e!==this._material&&t.EventManager.trigger(this.gameObject,t.CustomEvent.create(t.EngineEvent.MATERIAL_CHANGE)),this._material=e,this._material.geometry=this},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"geometryData",{get:function(){return this.buffers.geometryData},enumerable:!0,configurable:!0}),r.prototype.init=function(){var t=null,e=this.computeData(),r=e.vertices,n=e.faces,o=e.texCoords,i=e.colors,a=e.morphTargets;this.buffers=this.createBufferContainer(),t=this.createGeometryData(r,n,o,i,a),this.buffers.geometryData=t,this.buffers.init(),this._material.init(),this.computeNormals()},r.prototype.computeNormals=function(){this.isSmoothShading()?this.hasVertexNormals()||this.computeVertexNormals():this.hasFaceNormals()||this.computeFaceNormals()},r.prototype.hasFaceNormals=function(){return this.buffers.geometryData.hasFaceNormals()},r.prototype.hasVertexNormals=function(){return this.buffers.geometryData.hasVertexNormals()},r.prototype.isSmoothShading=function(){return this._material.shading===t.Shading.SMOOTH},r.prototype.dispose=function(){this.buffers.dispose(),this._material.dispose()},r.prototype.computeFaceNormals=function(){this.buffers.geometryData.computeFaceNormals()},r.prototype.computeVertexNormals=function(){this.buffers.geometryData.computeVertexNormals()},r.prototype.createBufferContainer=function(){return t.CommonBufferContainer.create(this.gameObject)},r.prototype.createGeometryData=function(t,e,r,n,o){return this.createCommonGeometryData(t,e,r,n)},r.prototype.createCommonGeometryData=function(e,r,n,o){var i=t.CommonGeometryData.create(this);return i.vertices=e,i.faces=r,i.texCoords=n,i.colors=o,i},__decorate([t.ensure(function(){var e=this.buffers.geometryData;t.assert(e.vertices.length>0,t.Log.info.FUNC_MUST("vertices.count","> 0")),t.assert(3*e.faces.length===e.indices.length,t.Log.info.FUNC_SHOULD("faces.count","be "+e.indices.length/3+", but actual is "+e.faces.length))})],r.prototype,"init",null),__decorate([t.virtual],r.prototype,"computeNormals",null),__decorate([t.require(function(){t.assert(this.buffers&&this.buffers.geometryData,t.Log.info.FUNC_MUST_DEFINE("buffers->geometryData"))})],r.prototype,"hasFaceNormals",null),__decorate([t.require(function(){t.assert(this.buffers&&this.buffers.geometryData,t.Log.info.FUNC_MUST_DEFINE("buffers->geometryData"))})],r.prototype,"hasVertexNormals",null),__decorate([t.require(function(){t.assert(this.buffers&&this.buffers.geometryData,t.Log.info.FUNC_MUST_DEFINE("buffers->geometryData"))})],r.prototype,"computeFaceNormals",null),__decorate([t.virtual],r.prototype,"createBufferContainer",null),__decorate([t.virtual],r.prototype,"createGeometryData",null),r}(t.Component);t.Geometry=e}(wd||(wd={}));var __decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(){function e(){}return e.convertToFaces=function(e,r){for(var n=this.hasData(r),o=[],i=0,a=e.length;a>i;i+=3){var s=e[i],c=e[i+1],u=e[i+2],h=t.Face3.create(s,c,u);n&&(h.vertexNormals.addChildren([this.getThreeComponent(r,s),this.getThreeComponent(r,c),this.getThreeComponent(r,u)]),h.faceNormal=h.vertexNormals.getChild(0).copy()),o.push(h)}return o},e.hasData=function(t){return t&&(t.length&&t.length>0||t.getCount&&t.getCount()>0)},e.getThreeComponent=function(e,r){var n=3*r;return t.Vector3.create(e[n],e[n+1],e[n+2])},e.iterateThreeComponent=function(e,r){for(var n=0,o=e.length;o>n;n+=3)r(t.Vector3.create(e[n],e[n+1],e[n+2]))},e.setThreeComponent=function(e,r,n){r instanceof t.Vector3?(e[3*n]=r.x,e[3*n+1]=r.y,e[3*n+2]=r.z):(e[3*n]=r[0],e[3*n+1]=r[1],e[3*n+2]=r[2])},__decorate([t.require(function(e){e&&t.assert(e instanceof wdCb.Collection||e instanceof wdCb.Hash||t.JudgeUtils.isArray(e),t.Log.info.FUNC_SHOULD("data","be Array or Collection or Hash"))})],e,"hasData",null),__decorate([t.require(function(e,r){t.assert(e.length%3===0,t.Log.info.FUNC_SHOULD("dataArr.length","times of three"))})],e,"iterateThreeComponent",null),e}();t.GeometryUtils=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this._vertices=[],this._texCoords=[],this._colors=[],this._indices=[],this._normals=[]}return __extends(r,e),r.create=function(){var t=new this;return t},Object.defineProperty(r.prototype,"vertices",{get:function(){return this._vertices},set:function(e){this._vertices=e,this.buffers&&(this.buffers.geometryData.vertices=e,this.buffers.removeCache(t.BufferDataType.VERTICE))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"texCoords",{get:function(){return this._texCoords},set:function(e){this._texCoords=e,this.buffers&&(this.buffers.geometryData.texCoords=e,this.buffers.removeCache(t.BufferDataType.TEXCOORD))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"colors",{get:function(){return this._colors},set:function(e){this._colors=e,this.buffers&&(this.buffers.geometryData.colors=e,this.buffers.removeCache(t.BufferDataType.COLOR))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"indices",{get:function(){return this._indices},set:function(e){this._indices=e,this.buffers&&(this.buffers.geometryData.faces=t.GeometryUtils.convertToFaces(e,this.normals),this.buffers.removeCache(t.BufferDataType.INDICE))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"normals",{get:function(){return this._normals},set:function(e){this._normals=e,this.buffers&&(this.buffers.geometryData.faces=t.GeometryUtils.convertToFaces(this.indices,e),this.buffers.removeCache(t.BufferDataType.NORMAL))},enumerable:!0,configurable:!0}),r.prototype.computeData=function(){return{vertices:this.vertices,faces:t.GeometryUtils.convertToFaces(this.indices,this.normals),texCoords:this.texCoords,colors:this.colors}},r}(t.Geometry);t.CustomGeometry=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.vertices=null,this.colors=null,this.texCoords=null,this.faces=null,this.morphTargets=null,this.morphFaceNormals=wdCb.Hash.create(),this.morphVertexNormals=wdCb.Hash.create()}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.hasAnimation=function(){return this._hasMorphTargets()&&this.gameObject&&this.gameObject.hasComponent(t.MorphAnimation)},r.prototype.hasMorphFaceNormals=function(){return this.buffers.geometryData.hasMorphFaceNormals()},r.prototype.hasMorphVertexNormals=function(){return this.buffers.geometryData.hasMorphVertexNormals()},r.prototype.computeMorphNormals=function(){this.buffers.geometryData.computeMorphNormals()},r.prototype.computeNormals=function(){e.prototype.computeNormals.call(this),this._hasMorphTargets()&&(this.isSmoothShading()?this.hasMorphVertexNormals()||this.computeMorphNormals():this.hasMorphFaceNormals()||this.computeMorphNormals())},r.prototype.computeData=function(){return{vertices:this.vertices,faces:this.faces,texCoords:this.texCoords,colors:this.colors,morphTargets:this.morphTargets}},r.prototype.createBufferContainer=function(){return this.hasAnimation()?t.MorphBufferContainer.create(this.gameObject,this.gameObject.getComponent(t.MorphAnimation)):t.CommonBufferContainer.create(this.gameObject)},r.prototype.createGeometryData=function(e,r,n,o,i){if(this.hasAnimation()){var a=t.MorphGeometryData.create(this);return a.vertices=e,a.faces=r,a.texCoords=n,a.colors=o,a.morphTargets=i,a}return this.createCommonGeometryData(e,r,n,o)},r.prototype._hasMorphTargets=function(){return this.morphTargets&&this.morphTargets.getCount()>0},__decorate([t.require(function(){t.assert(this.buffers&&this.buffers.geometryData,t.Log.info.FUNC_MUST_DEFINE("buffers->geometryData"))})],r.prototype,"hasMorphFaceNormals",null),__decorate([t.require(function(){t.assert(this.buffers&&this.buffers.geometryData,t.Log.info.FUNC_MUST_DEFINE("buffers->geometryData"))})],r.prototype,"hasMorphVertexNormals",null),__decorate([t.require(function(){t.assert(this.buffers&&this.buffers.geometryData,t.Log.info.FUNC_MUST_DEFINE("buffers->geometryData"))})],r.prototype,"computeMorphNormals",null),__decorate([t.require(function(){this.hasAnimation()&&t.assert(this.gameObject.getComponent(t.MorphAnimation),t.Log.info.FUNC_SHOULD("gameObject with ModelGeometry","add MorphAnimation component"))})],r.prototype,"createBufferContainer",null),r}(t.Geometry);t.ModelGeometry=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.width=null,this.height=null,this.depth=null,this.widthSegments=1,this.heightSegments=1,this.depthSegments=1}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.computeData=function(){function e(e,r,n){var o,i,a,s,c=p.length/3;for(a=0;r>=a;a++)for(s=0;n>=s;s++){var y=t.Vector3.create(),m=t.Vector3.create(),g=t.Vector3.create(),v=t.Vector3.create();y.lerp(l[u[e][0]],l[u[e][1]],a/r),m.lerp(l[u[e][0]],l[u[e][2]],s/n),g.sub2(m,l[u[e][0]]),v.add2(y,g),o=a/r,i=s/n,p.push(v.x,v.y,v.z),f.push(h[e][0],h[e][1],h[e][2]),d.push(o,i),r>a&&n>s&&(_.push(c+s+a*(r+1),c+s+(a+1)*(r+1),c+s+a*(r+1)+1),_.push(c+s+(a+1)*(r+1),c+s+(a+1)*(r+1)+1,c+s+a*(r+1)+1))}}var r=this.width,n=this.height,o=this.depth,i=this.widthSegments,a=this.heightSegments,s=this.depthSegments,c={FRONT:0,BACK:1,TOP:2,BOTTOM:3,RIGHT:4,LEFT:5},u=[[0,1,3],[4,5,7],[3,2,6],[1,0,4],[1,4,2],[5,0,6]],h=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],l=[t.Vector3.create(-r,-n,o),t.Vector3.create(r,-n,o),t.Vector3.create(r,n,o),t.Vector3.create(-r,n,o),t.Vector3.create(r,-n,-o),t.Vector3.create(-r,-n,-o),t.Vector3.create(-r,n,-o),t.Vector3.create(r,n,-o)],p=[],f=[],d=[],_=[];return e(c.FRONT,i,a),e(c.BACK,i,a),e(c.TOP,i,s),e(c.BOTTOM,i,s),e(c.RIGHT,s,a),e(c.LEFT,s,a),{vertices:p,faces:t.GeometryUtils.convertToFaces(_,f),texCoords:d}},r}(t.Geometry);t.BoxGeometry=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.width=null,this.height=null}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.computeData=function(){var e=this.width,r=this.height,n=-e/2,o=e/2,i=r/2,a=-r/2,s=[],c=[],u=[],h=[];return s=[o,i,0,n,i,0,n,a,0,o,a,0],u=[0,1,2,0,2,3],c=[1,1,0,1,0,0,1,0],h=[0,0,1,0,0,1,0,0,1,0,0,1],{vertices:s,faces:t.GeometryUtils.convertToFaces(u,h),texCoords:c}},r}(t.Geometry);t.RectGeometry=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.width=null,this.height=null,this.widthSegments=1,this.heightSegments=1}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.computeData=function(){var e=this.width,r=this.height,n=this.widthSegments,o=this.heightSegments,i=null,a=null,s=null,c=null,u=null,h=null,l=null,p=[],f=[],d=[],_=[];for(h=0;n>=h;h++)for(l=0;o>=l;l++)i=-e+2*e*h/n,a=0,s=-(-r+2*r*l/o),c=h/n,u=l/o,p.push(i,a,s),d.push(0,1,0),f.push(c,u),n>h&&o>l&&(_.push(l+h*(n+1),l+(h+1)*(n+1),l+h*(n+1)+1),_.push(l+(h+1)*(n+1),l+(h+1)*(n+1)+1,l+h*(n+1)+1));return{vertices:p,faces:t.GeometryUtils.convertToFaces(_,d),texCoords:f}},r}(t.Geometry);t.PlaneGeometry=e}(wd||(wd={}));var wd;!function(t){!function(t){t[t.LATITUDELONGTITUDE=0]="LATITUDELONGTITUDE"}(t.SphereDrawMode||(t.SphereDrawMode={}));t.SphereDrawMode}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function n(){e.apply(this,arguments),this.radius=1,this.drawMode=t.SphereDrawMode.LATITUDELONGTITUDE,this.segments=20}return __extends(n,e),n.create=function(){var t=new this;return t},n.prototype.computeData=function(){var e=this.radius,n=this.drawMode,o=this.segments,i=null;if(n===t.SphereDrawMode.LATITUDELONGTITUDE){var a=r.create(e,o).getData(),s=a.vertices,c=a.indices,u=a.normals,h=a.texCoords;return{vertices:s,faces:t.GeometryUtils.convertToFaces(c,u),texCoords:h}}return i},n}(t.Geometry);t.SphereGeometry=e;var r=function(){function t(t,e){this._radius=null,this._latitudeBands=null,this._longitudeBands=null,this._radius=t,this._latitudeBands=e,this._longitudeBands=e}return t.create=function(t,e){var r=new this(t,e);return r},t.prototype.getData=function(){for(var t=[],e=[],r=[],n=[],o=0;o<=this._latitudeBands;o++)for(var i=o*Math.PI/this._latitudeBands,a=Math.sin(i),s=Math.cos(i),c=0;c<=this._longitudeBands;c++){var u=2*c*Math.PI/this._longitudeBands,h=Math.sin(u),l=Math.cos(u),p=this._radius*l*a,f=this._radius*s,d=this._radius*h*a,_=1-c/this._longitudeBands,y=1-o/this._latitudeBands;e.push(p),e.push(f),e.push(d),r.push(_),r.push(y),t.push(p),t.push(f),t.push(d)}for(var o=0;o<this._latitudeBands;o++)for(var c=0;c<this._longitudeBands;c++){var m=o*(this._longitudeBands+1)+c,g=m+this._longitudeBands+1;n.push(m+1),n.push(g),n.push(m),n.push(m+1),n.push(g+1),n.push(g)}return{vertices:t,indices:n,normals:e,texCoords:r}},t}()}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.width=null,this.height=null}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.computeData=function(){var e=this.width,r=this.height,n=-e/2,o=e/2,i=r/2,a=-r/2,s=[],c=[],u=[],h=[];return s=[0,i,0,n,a,0,o,a,0],u=[0,1,2],c=[.5,1,0,0,1,0],h=[0,0,1,0,0,1,0,0,1],{vertices:s,faces:t.GeometryUtils.convertToFaces(u,h),texCoords:c}},r}(t.Geometry);t.TriangleGeometry=e}(wd||(wd={}));var __decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(){function e(t){this._vertices=null,this._faces=null,this._texCoords=null,this._colors=null,this._tangents=null,this.isTangentDirty=!0,this.geometry=null,this._normalCache=null,this._normalFromFaceCache=null,this._normalFromVertexCache=null,this._indiceCache=null,this._normalDirty=!0,this._indiceDirty=!0,this.geometry=t}return Object.defineProperty(e.prototype,"vertices",{get:function(){return this._vertices},set:function(t){this._vertices=t,this.isTangentDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normals",{get:function(){var t=this.geometry;return t.isSmoothShading()?(this.hasVertexNormals()||this.computeVertexNormals(),this.normalsFromVertexNormals):(this.hasFaceNormals()||this.computeFaceNormals(),this.normalsFromFaceNormal)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normalsFromFaceNormal",{get:function(){var e=null;return this.hasFaceNormals()?(e=[],this._faces.forEach(function(r){var n=r.faceNormal;t.GeometryUtils.setThreeComponent(e,n,r.aIndex),t.GeometryUtils.setThreeComponent(e,n,r.bIndex),t.GeometryUtils.setThreeComponent(e,n,r.cIndex)}),this._fillEmptyData(e),e):[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normalsFromVertexNormals",{get:function(){var e=null;return this.hasVertexNormals()?(e=[],this._faces.forEach(function(r){t.GeometryUtils.setThreeComponent(e,r.vertexNormals.getChild(0),r.aIndex),t.GeometryUtils.setThreeComponent(e,r.vertexNormals.getChild(1),r.bIndex),t.GeometryUtils.setThreeComponent(e,r.vertexNormals.getChild(2),r.cIndex)}),this._fillEmptyData(e),e):[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indices",{get:function(){for(var t=[],e=0,r=this._faces;e<r.length;e++){var n=r[e];t.push(n.aIndex,n.bIndex,n.cIndex)}return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"faces",{get:function(){return this._faces},set:function(t){this._faces=t,this.onChangeFace()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texCoords",{get:function(){return this._texCoords},set:function(t){this._texCoords=t,this.isTangentDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colors",{get:function(){return this._getColors(this._colors,this._vertices)},set:function(t){this._colors=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tangents",{get:function(){return this.isTangentDirty&&(this.isTangentDirty=!1,this._tangents=this._calculateTangents(this._vertices,this.normals,this.texCoords,this.indices)),this._tangents},enumerable:!0,configurable:!0}),e.prototype.computeFaceNormals=function(){for(var t=this._vertices,e=0,r=this._faces;e<r.length;e++){var n=r[e];n.faceNormal=this.computeFaceNormalsHelper(t,n.aIndex,n.bIndex,n.cIndex)}},e.prototype.computeVertexNormals=function(){var t=null;this.hasFaceNormals()||this.computeFaceNormals(),t=this.computeVertexNormalsHelper(this._vertices);for(var e=0,r=this._faces;e<r.length;e++){var n=r[e];n.vertexNormals=wdCb.Collection.create([t[n.aIndex],t[n.bIndex],t[n.cIndex]])}},e.prototype.hasFaceNormals=function(){for(var t=0,e=this._faces;t<e.length;t++){var r=e[t];if(!r.hasFaceNormal())return!1}return!0},e.prototype.hasVertexNormals=function(){for(var t=0,e=this._faces;t<e.length;t++){var r=e[t];if(!r.hasVertexNormal())return!1}return!0},e.prototype.onChangeFace=function(){this.isTangentDirty=!0,this._normalDirty=!0,this._indiceDirty=!0},e.prototype.computeFaceNormalsHelper=function(e,r,n,o){var i=t.GeometryUtils.getThreeComponent(e,r),a=t.GeometryUtils.getThreeComponent(e,n),s=t.GeometryUtils.getThreeComponent(e,o),c=t.Vector3.create().sub2(s,a),u=t.Vector3.create().sub2(i,a);return t.Vector3.create().cross(c,u).normalize()},e.prototype.computeVertexNormalsHelper=function(e){var r=e.length/3,n=null;n=new Array(r);for(var o=0;r>o;o++)n[o]=t.Vector3.create();for(var i=0,a=this._faces;i<a.length;i++){var s=a[i],c=null;c=s.faceNormal,n[s.aIndex].add(c),n[s.bIndex].add(c),n[s.cIndex].add(c)}for(var o=0;r>o;o++)n[o].normalize();return n},e.prototype._getColors=function(t,e){return t&&t.length>0?t:this._getColorsFromMaterial(e)},e.prototype._getColorsFromMaterial=function(t){var e=[],r=0,n=this.geometry.material,o=n.color,i=null;for(wdCb.Log.error(!t||0===t.length,wdCb.Log.info.FUNC_MUST("has vertice data")),i=t.length,r=0;i>r;r++)e.push(o.r,o.g,o.b);return e},e.prototype._fillEmptyData=function(t){for(var e=0,r=t.length;r>e;e++)isNaN(t[e])&&(t[e]=0)},e.prototype._calculateTangents=function(e,r,n,o){var i,a,s,c,u,h,l,p,f,d,_,y,m,g,v,b=o.length/3,w=e.length/3,C=t.Vector3.create(),T=t.Vector3.create(),S=t.Vector3.create(),D=t.Vector3.create(),O=t.Vector3.create(),x=t.Vector2.create(),E=t.Vector2.create(),M=t.Vector2.create(),L=new Float32Array(3*w),A=new Float32Array(3*w),P=t.Vector3.create(),R=t.Vector3.create(),F=[];for(v=0;b>v;v++)i=o[3*v],a=o[3*v+1],s=o[3*v+2],S.set(e[3*i],e[3*i+1],e[3*i+2]),D.set(e[3*a],e[3*a+1],e[3*a+2]),O.set(e[3*s],e[3*s+1],e[3*s+2]),x.set(n[2*i],n[2*i+1]),E.set(n[2*a],n[2*a+1]),M.set(n[2*s],n[2*s+1]),c=D.x-S.x,u=O.x-S.x,h=D.y-S.y,l=O.y-S.y,p=D.z-S.z,f=O.z-S.z,d=E.x-x.x,_=M.x-x.x,y=E.y-x.y,m=M.y-x.y,g=1/(d*m-_*y),C.set((m*c-y*u)*g,(m*h-y*l)*g,(m*p-y*f)*g),T.set((d*u-_*c)*g,(d*l-_*h)*g,(d*f-_*p)*g),L[3*i+0]+=C.x,L[3*i+1]+=C.y,L[3*i+2]+=C.z,L[3*a+0]+=C.x,L[3*a+1]+=C.y,L[3*a+2]+=C.z,L[3*s+0]+=C.x,L[3*s+1]+=C.y,L[3*s+2]+=C.z,A[3*i+0]+=T.x,A[3*i+1]+=T.y,A[3*i+2]+=T.z,A[3*a+0]+=T.x,A[3*a+1]+=T.y,A[3*a+2]+=T.z,A[3*s+0]+=T.x,A[3*s+1]+=T.y,A[3*s+2]+=T.z;for(y=t.Vector3.create(),m=t.Vector3.create(),v=0;w>v;v++){var N=null;P.set(r[3*v],r[3*v+1],r[3*v+2]),y.set(L[3*v],L[3*v+1],L[3*v+2]),m.set(A[3*v],A[3*v+1],A[3*v+2]),N=P.dot(y),R=P.copy().scale(N),R.sub2(y,R).normalize(),F[4*v]=R.x,F[4*v+1]=R.y,F[4*v+2]=R.z,R.cross(P,y),F[4*v+3]=R.dot(m)<0?-1:1}return F},__decorate([t.requireGetter(function(){t.assert(this._faces.length>0,t.Log.info.FUNC_SHOULD("faces.count","> 0"));for(var e=0,r=this._faces;e<r.length;e++){var n=r[e];this.geometry.isSmoothShading()?t.assert(n.vertexNormals&&3===n.vertexNormals.getCount(),t.Log.info.FUNC_SHOULD("faces->vertexNormals.count","=== 3")):t.assert(n.hasFaceNormal(),t.Log.info.FUNC_SHOULD("faces->faceNormal","has data"))}}),t.cacheGetter(function(){return!this._normalDirty&&this._normalCache},function(){return this._normalCache},function(t){this._normalCache=t,this._normalDirty=!1})],e.prototype,"normals",null),__decorate([t.requireGetter(function(){t.assert(this._faces.length>0,t.Log.info.FUNC_SHOULD("geometry","has faces"))}),t.ensureGetter(function(e){for(var r=0;r<e.length;r++){var n=e[r];t.assert(t.JudgeUtils.isNumber(n),t.Log.info.FUNC_SHOULD("normals data","be number"))}}),t.cacheGetter(function(){return!this._normalDirty&&this._normalFromFaceCache},function(){return this._normalFromFaceCache},function(t){this._normalFromFaceCache=t,this._normalDirty=!1})],e.prototype,"normalsFromFaceNormal",null),__decorate([t.requireGetter(function(){t.assert(this._faces.length>0,t.Log.info.FUNC_SHOULD("geometry","has faces"))}),t.ensureGetter(function(e){for(var r=0;r<e.length;r++){var n=e[r];t.assert(t.JudgeUtils.isNumber(n),t.Log.info.FUNC_SHOULD("normals data","be number"))}}),t.cacheGetter(function(){return!this._normalDirty&&this._normalFromVertexCache},function(){return this._normalFromVertexCache},function(t){this._normalFromVertexCache=t,this._normalDirty=!1})],e.prototype,"normalsFromVertexNormals",null),__decorate([t.cacheGetter(function(){return!this._indiceDirty&&this._indiceCache},function(){return this._indiceCache},function(t){this._indiceCache=t,this._indiceDirty=!1})],e.prototype,"indices",null),__decorate([t.require(function(){t.assert(t.GeometryUtils.hasData(this.vertices),t.Log.info.FUNC_MUST("contain vertices"))}),t.ensure(function(){for(var e=0,r=this._faces;e<r.length;e++){var n=r[e];t.assert(n.faceNormal instanceof t.Vector3,t.Log.info.FUNC_SHOULD_NOT("faceNormal","be null"))}})],e.prototype,"computeFaceNormals",null),__decorate([t.virtual],e.prototype,"onChangeFace",null),e}();t.GeometryData=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.create=function(t){var e=new this(t);return e},e}(t.GeometryData);t.CommonGeometryData=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this._morphTargets=null,this._morphNormalCache=null,this._morphNormalDirty=!0}return __extends(r,e),r.create=function(t){var e=new this(t);return e},Object.defineProperty(r.prototype,"morphNormals",{get:function(){var t=this.geometry;return this._morphNormalDirty=!1,t.isSmoothShading()?(this.hasMorphVertexNormals()||this.computeMorphNormals(),t.morphVertexNormals):(this.hasMorphFaceNormals()||this.computeMorphNormals(),t.morphFaceNormals)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"morphTargets",{get:function(){return this._morphTargets},set:function(t){this._morphTargets=t,this._morphNormalDirty=!0},enumerable:!0,configurable:!0}),r.prototype.computeMorphNormals=function(){var t=this.geometry,e=this;this._morphTargets.forEach(function(n,o){var i=wdCb.Collection.create(),a=wdCb.Collection.create();n.forEach(function(n){var o=r.create(t),s=null,c=null;o.vertices=n,o.faces=e._copyFaces(t.faces),o.computeFaceNormals(),o.computeVertexNormals(),u=e._getMorphNormals(o),s=u[0],c=u[1],i.addChild(s),a.addChild(c);var u}),t.morphFaceNormals.addChild(o,i),t.morphVertexNormals.addChild(o,a)})},r.prototype.hasMorphFaceNormals=function(){return this.geometry.morphFaceNormals.getCount()>0},r.prototype.hasMorphVertexNormals=function(){return this.geometry.morphVertexNormals.getCount()>0},r.prototype.onChangeFace=function(){this._morphNormalDirty=!0},r.prototype._copyFaces=function(t){for(var e=[],r=0;r<t.length;r++){var n=t[r];e.push(n.copy())}return e},r.prototype._getMorphNormals=function(t){return[t.normalsFromFaceNormal,t.normalsFromVertexNormals]},__decorate([t.cacheGetter(function(){return!this._morphNormalDirty&&this._morphNormalCache},function(){return this._morphNormalCache},function(t){this._morphNormalCache=t})],r.prototype,"morphNormals",null),r}(t.GeometryData);t.MorphGeometryData=e}(wd||(wd={}));var __decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(){function e(t){this.geometryData=null,this.gameObject=null,this.container=wdCb.Hash.create(),this._colorBuffer=null,this._texCoordBuffer=null,this._tangentBuffer=null,this._indiceBuffer=null,this.gameObject=t}return e.prototype.init=function(){var e=this;t.EventManager.on(this.gameObject,t.EngineEvent.MATERIAL_CHANGE,function(){e.removeCache(t.BufferDataType.COLOR)})},e.prototype.removeCache=function(t){this.container.removeChild(t)},e.prototype.getChild=function(e){var r=null;switch(e){case t.BufferDataType.VERTICE:r=this.getVertice(e);break;case t.BufferDataType.NORMAL:r=this.getNormal(e);break;case t.BufferDataType.TANGENT:r=this._getTangent(e);break;case t.BufferDataType.COLOR:r=this._getColor(e);break;case t.BufferDataType.INDICE:r=this._getIndice(e);break;case t.BufferDataType.TEXCOORD:r=this._getTexCoord(e);break;default:wdCb.Log.error(!0,wdCb.Log.info.FUNC_UNKNOW("BufferDataType: "+e))}return r},e.prototype.hasChild=function(e){var r=this.geometryData[t.BufferDataTable.getGeometryDataName(e)];return r&&r.length>0},e.prototype.dispose=function(){this.container.forEach(function(t){t.dispose()})},e.prototype.createBufferOnlyOnce=function(t,e){this[t]||(this[t]=e.create())},e.prototype._getTangent=function(e){var r=null;return this.createBufferOnlyOnce("_tangentBuffer",t.ArrayBuffer),r=this.geometryData[t.BufferDataTable.getGeometryDataName(e)],this._tangentBuffer.resetData(new Float32Array(r),3,t.BufferType.FLOAT),this._tangentBuffer},e.prototype._getColor=function(e){var r=null;return this.createBufferOnlyOnce("_colorBuffer",t.ArrayBuffer),r=this.geometryData[t.BufferDataTable.getGeometryDataName(e)],this._colorBuffer.resetData(new Float32Array(r),3,t.BufferType.FLOAT),this._colorBuffer},e.prototype._getIndice=function(e){var r=null;return this.createBufferOnlyOnce("_indiceBuffer",t.ElementBuffer),r=this.geometryData[t.BufferDataTable.getGeometryDataName(e)],this._indiceBuffer.resetData(new Uint16Array(r),t.BufferType.UNSIGNED_SHORT),this._indiceBuffer},e.prototype._getTexCoord=function(e){var r=null;return this.createBufferOnlyOnce("_texCoordBuffer",t.ArrayBuffer),r=this.geometryData[t.BufferDataTable.getGeometryDataName(e)],
this._texCoordBuffer.resetData(new Float32Array(r),2,t.BufferType.FLOAT),this._texCoordBuffer},e.prototype._needReCalcuteTangent=function(e){return this.geometryData.isTangentDirty&&e===t.BufferDataType.TANGENT},__decorate([t.cache(function(t){return this.container.hasChild(t)&&!this._needReCalcuteTangent(t)},function(t){return this.container.getChild(t)},function(t,e){this.container.addChild(e,t)})],e.prototype,"_getTangent",null),__decorate([t.cache(function(t){return this.container.hasChild(t)},function(t){return this.container.getChild(t)},function(t,e){this.container.addChild(e,t)})],e.prototype,"_getColor",null),__decorate([t.cache(function(t){return this.container.hasChild(t)},function(t){return this.container.getChild(t)},function(t,e){this.container.addChild(e,t)})],e.prototype,"_getIndice",null),__decorate([t.cache(function(t){return this.container.hasChild(t)},function(t){return this.container.getChild(t)},function(t,e){this.container.addChild(e,t)})],e.prototype,"_getTexCoord",null),e}();t.BufferContainer=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this._verticeBuffer=null,this._normalBuffer=null}return __extends(r,e),r.create=function(t){var e=new this(t);return e},r.prototype.getVertice=function(e){var r=this.geometryData[t.BufferDataTable.getGeometryDataName(e)];return this.createBufferOnlyOnce("_verticeBuffer",t.ArrayBuffer),this._verticeBuffer.resetData(new Float32Array(r),3,t.BufferType.FLOAT),this._verticeBuffer},r.prototype.getNormal=function(e){var r=this.geometryData[t.BufferDataTable.getGeometryDataName(e)];return this.createBufferOnlyOnce("_normalBuffer",t.ArrayBuffer),this._normalBuffer.resetData(new Float32Array(r),3,t.BufferType.FLOAT),this._normalBuffer},__decorate([t.cache(function(t){return this.container.hasChild(t)},function(t){return this.container.getChild(t)},function(t,e){this.container.addChild(e,t)})],r.prototype,"getVertice",null),__decorate([t.cache(function(t){return this.container.hasChild(t)},function(t){return this.container.getChild(t)},function(t,e){this.container.addChild(e,t)})],r.prototype,"getNormal",null),r}(t.BufferContainer);t.CommonBufferContainer=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(t,r){e.call(this,t),this._animation=null,this._isCacheChangeFlag={},this._isCacheChangeInLastLoop={},this._currentVerticeBuffer=null,this._nextVerticeBuffer=null,this._currentNormalBuffer=null,this._nextNormalBuffer=null,this._animation=r}return __extends(r,e),r.create=function(t,e){var r=new this(t,e);return r},r.prototype.getVertice=function(t){return this._getMorphData(t,this.geometryData.morphTargets)},r.prototype.getNormal=function(t){return this._getMorphData(t,this.geometryData.morphNormals)},r.prototype._getMorphData=function(e,r){var n=null,o=null,i=null;if(this._isNotPlayAnimation())return this._getStaticData(e);if(o=r.getChild(this._animation.currentAnimName),wdCb.Log.error(!o,wdCb.Log.info.FUNC_SHOULD('"'+this._animation.currentAnimName+'" animation',"contain frame data")),n=this.container.getChild(e))if(this._animation.isFrameChange&&(this._isCacheChangeInLastLoop[e]||this._isCacheNotChange(e))){var a=n[0],s=n[1],c=null,u=null;c=s,u=a.resetData(new Float32Array(o.getChild(this._animation.nextFrame))),i=[c,u],this.container.addChild(e,i),this._isCacheChangeFlag[e]=!0,this._isCacheChangeInLastLoop[e]=!0}else this._isCacheChangeFlag[e]=!1,this._isCacheChangeInLastLoop[e]=!1,i=n;else{var a=this._getCurrentBuffer(e),s=this._getNextBuffer(e);a.resetData(new Float32Array(o.getChild(this._animation.currentFrame)),3,t.BufferType.FLOAT),s.resetData(new Float32Array(o.getChild(this._animation.nextFrame)),3,t.BufferType.FLOAT),i=[a,s],this.container.addChild(e,i),this._isCacheChangeInLastLoop[e]=!1}return i},r.prototype._getCurrentBuffer=function(e){return e===t.BufferDataType.VERTICE?(this.createBufferOnlyOnce("_currentVerticeBuffer",t.ArrayBuffer),this._currentVerticeBuffer):(this.createBufferOnlyOnce("_currentNormalBuffer",t.ArrayBuffer),this._currentNormalBuffer)},r.prototype._getNextBuffer=function(e){return e===t.BufferDataType.VERTICE?(this.createBufferOnlyOnce("_nextVerticeBuffer",t.ArrayBuffer),this._nextVerticeBuffer):(this.createBufferOnlyOnce("_nextNormalBuffer",t.ArrayBuffer),this._nextNormalBuffer)},r.prototype._isCacheNotChange=function(t){return!this._isCacheChangeFlag[t]},r.prototype._isNotPlayAnimation=function(){return null===this._animation.currentAnimName},r.prototype._getStaticData=function(e){var r=null,n=null;switch(e){case t.BufferDataType.VERTICE:r=this.geometryData.vertices;break;case t.BufferDataType.NORMAL:r=this.geometryData.normals;break;default:t.Log.error(!0,t.Log.info.FUNC_SHOULD("type","be BufferDataType.VERTICE or BufferDataType.NORMAL"))}return this._animation.interpolation=0,n=[this._getCurrentBuffer(e).resetData(new Float32Array(r),3,t.BufferType.FLOAT),this._getNextBuffer(e).resetData(new Float32Array(r),3,t.BufferType.FLOAT)]},r.prototype._getStaticDataCacheData=function(t){return"static_"+t},__decorate([t.require(function(e){t.assert(this.geometryData.morphTargets&&this.geometryData.morphTargets.getCount()>0,t.Log.info.FUNC_SHOULD("set morphTargets"))})],r.prototype,"getVertice",null),__decorate([t.require(function(e){t.assert(this.geometryData.morphTargets&&this.geometryData.morphTargets.getCount()>0,t.Log.info.FUNC_SHOULD("set morphTargets"))})],r.prototype,"getNormal",null),__decorate([t.require(function(e){t.assert(e===t.BufferDataType.VERTICE||e===t.BufferDataType.NORMAL,t.Log.info.FUNC_SHOULD("type","be BufferDataType.VERTICE or BufferDataType.NORMAL"))})],r.prototype,"_getCurrentBuffer",null),__decorate([t.require(function(e){t.assert(e===t.BufferDataType.VERTICE||e===t.BufferDataType.NORMAL,t.Log.info.FUNC_SHOULD("type","be BufferDataType.VERTICE or BufferDataType.NORMAL"))})],r.prototype,"_getNextBuffer",null),__decorate([t.cache(function(t){return this.container.hasChild(this._getStaticDataCacheData(t))},function(t){return this.container.getChild(this._getStaticDataCacheData(t))},function(t,e){this.container.addChild(this._getStaticDataCacheData(e),t)})],r.prototype,"_getStaticData",null),r}(t.BufferContainer);t.MorphBufferContainer=e}(wd||(wd={}));var __decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(){function e(){this._worldToCameraMatrix=null,this.pMatrix=t.Matrix4.create(),this.gameObject=null,this.dirty=!1}return Object.defineProperty(e.prototype,"cameraToWorldMatrix",{get:function(){return this.gameObject.transform.localToWorldMatrix.copy()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"worldToCameraMatrix",{get:function(){return this._worldToCameraMatrix?this._worldToCameraMatrix:this.cameraToWorldMatrix.invert()},set:function(t){this._worldToCameraMatrix=t},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.dirty&&(this.updateProjectionMatrix(),this.dirty=!1)},e.prototype.dispose=function(){},e.prototype.update=function(t){this.dirty&&(this.updateProjectionMatrix(),this.dirty=!1)},__decorate([t.requireGetter(function(){t.assert(this.gameObject,t.Log.info.FUNC_MUST_DEFINE("gameObject"))})],e.prototype,"cameraToWorldMatrix",null),__decorate([t.virtual],e.prototype,"init",null),__decorate([t.virtual],e.prototype,"dispose",null),e}();t.Camera=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments),this._left=null,this._right=null,this._bottom=null,this._top=null,this._near=null,this._far=null}return __extends(e,t),e.create=function(){var t=new this;return t},Object.defineProperty(e.prototype,"left",{get:function(){return this._left},set:function(t){this._left=t,this.dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this._right},set:function(t){this._right=t,this.dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this._bottom},set:function(t){this._bottom=t,this.dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this._top},set:function(t){this._top=t,this.dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"near",{get:function(){return this._near},set:function(t){this._near=t,this.dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"far",{get:function(){return this._far},set:function(t){this._far=t,this.dirty=!0},enumerable:!0,configurable:!0}),e.prototype.updateProjectionMatrix=function(){this.pMatrix.setOrtho(this._left,this._right,this._bottom,this._top,this._near,this._far)},e}(t.Camera);t.OrthographicCamera=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments),this._fovy=null,this._aspect=null,this._near=null,this._far=null}return __extends(e,t),e.create=function(){var t=new this;return t},Object.defineProperty(e.prototype,"fovy",{get:function(){return this._fovy},set:function(t){this._fovy=t,this.dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspect",{get:function(){return this._aspect},set:function(t){this._aspect=t,this.dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"near",{get:function(){return this._near},set:function(t){this._near=t,this.dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"far",{get:function(){return this._far},set:function(t){this._far=t,this.dirty=!0},enumerable:!0,configurable:!0}),e.prototype.zoomIn=function(t,e){void 0===e&&(e=1),this.fovy=Math.max(this.fovy-t,e)},e.prototype.zoomOut=function(t,e){void 0===e&&(e=179),this.fovy=Math.min(this.fovy+t,e)},e.prototype.updateProjectionMatrix=function(){this.pMatrix.setPerspective(this._fovy,this._aspect,this._near,this._far)},e}(t.Camera);t.PerspectiveCamera=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(e){t.call(this),this.camera=null,this.camera=e}return __extends(e,t),Object.defineProperty(e.prototype,"cameraToWorldMatrix",{get:function(){return this.camera.cameraToWorldMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"worldToCameraMatrix",{get:function(){return this.camera.worldToCameraMatrix},set:function(t){this.camera.worldToCameraMatrix=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pMatrix",{get:function(){return this.camera.pMatrix},set:function(t){this.camera.pMatrix=t},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.camera.gameObject=this.gameObject,this.camera.init()},e.prototype.update=function(t){this.camera.update(t)},e.prototype.dispose=function(){this.camera.dispose()},e}(t.Component);t.CameraController=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.create=function(t){var e=new this(t);return e},e}(t.CameraController);t.BasicCameraController=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(r){e.call(this,r),this._control=null,r instanceof t.PerspectiveCamera?this._control=t.FlyPerspectiveCameraControl.create(r):this._control=t.FlyOrthographicCameraControl.create(r)}return __extends(r,e),r.create=function(t){var e=new this(t);return e},r.prototype.init=function(){e.prototype.init.call(this),this._control.init(this.gameObject)},r.prototype.update=function(t){e.prototype.update.call(this,t),this._control.update(t)},r.prototype.dispose=function(){e.prototype.dispose.call(this),this._control.dispose()},r}(t.CameraController);t.FlyCameraController=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(t){this.moveSpeed=1.2,this.rotateSpeed=100,this.cameraComponent=null,this._rotateX=0,this._rotateY=0,this._isRotate=!1,this._mouseDragSubscription=null,this._keydownSubscription=null,this._gameObject=null,this.cameraComponent=t}return e.prototype.init=function(t){var e=t.transform.eulerAngles;this._rotateX=e.x,this._rotateY=e.y,this._gameObject=t,this._bindCanvasEvent()},e.prototype.update=function(e){this._isRotate&&(this._isRotate=!1,this._gameObject.transform.eulerAngles=t.Vector3.create(this._rotateX,this._rotateY,0))},e.prototype.dispose=function(){this._removeEvent()},e.prototype._move=function(e){var r=this.moveSpeed,n=this._gameObject,o=e.keyState;o.a||o.left?n.transform.translateLocal(t.Vector3.create(-r,0,0)):o.d||o.right?n.transform.translateLocal(t.Vector3.create(r,0,0)):o.w||o.up?n.transform.translateLocal(t.Vector3.create(0,0,-r)):(o.s||o.down)&&n.transform.translateLocal(t.Vector3.create(0,0,r))},e.prototype._bindCanvasEvent=function(){var e=this,r=this.rotateSpeed,n=t.Director.getInstance().scene,o=t.EventManager.fromEvent(n,t.EventName.MOUSEUP),i=t.EventManager.fromEvent(n,t.EventName.MOUSEMOVE),a=t.EventManager.fromEvent(n,t.EventName.MOUSEDOWN),s=t.EventManager.fromEvent(t.EventName.KEYDOWN),c=null,u=t.Director.getInstance().view;c=a.flatMap(function(t){return t.stopPropagation(),i.map(function(t){var n=t.movementDelta,o=null,i=null,a=r/u.height;return o=a*n.x,i=a*n.y,e._isRotate=!0,{dx:o,dy:i}}).takeUntil(o)}),this._mouseDragSubscription=c.subscribe(function(t){e._rotateY-=t.dx,e._rotateX-=t.dy}),this._keydownSubscription=s.subscribe(function(t){e._move(t),e.zoom(t)})},e.prototype._removeEvent=function(){this._mouseDragSubscription.dispose(),this._keydownSubscription.dispose()},e}();t.FlyCameraControl=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.zoomSpeed=10}return __extends(e,t),e.create=function(t){var e=new this(t);return e},e.prototype.zoom=function(t){var e=this.zoomSpeed,r=t.keyState;r.g?this.cameraComponent.zoomIn(e):r.h&&this.cameraComponent.zoomOut(e)},e}(t.FlyCameraControl);t.FlyPerspectiveCameraControl=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.create=function(t){var e=new this(t);return e},e.prototype.zoom=function(t){},e}(t.FlyCameraControl);t.FlyOrthographicCameraControl=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.moveSpeedX=1,this.moveSpeedY=1,this.rotateSpeed=1,this.distance=10,this.phi=Math.PI/2,this.theta=Math.PI/2,this.target=t.Vector3.create(0,0,0),this.thetaMargin=.05,this.minDistance=.05,this._isChange=!0,this._mouseDragSubscription=null,this._mouseWheelSubscription=null,this._keydownSubscription=null}return __extends(r,e),r.create=function(t){var e=new this(t);return e},r.prototype.init=function(){e.prototype.init.call(this),this._bindCanvasEvent()},r.prototype.update=function(r){var n=null,o=null,i=null;e.prototype.update.call(this,r),this._isChange&&(this._isChange=!1,n=this.distance*Math.cos(this.phi)*Math.sin(this.theta)+this.target.x,i=this.distance*Math.sin(this.phi)*Math.sin(this.theta)+this.target.z,o=this.distance*Math.cos(this.theta)+this.target.y,this.gameObject.transform.position=t.Vector3.create(n,o,i),this.gameObject.transform.lookAt(this.target))},r.prototype.dispose=function(){e.prototype.dispose.call(this),this._removeEvent()},r.prototype._bindCanvasEvent=function(){var e=this,r=t.Director.getInstance().scene,n=t.EventManager.fromEvent(r,t.EventName.MOUSEUP),o=t.EventManager.fromEvent(r,t.EventName.MOUSEMOVE),i=t.EventManager.fromEvent(r,t.EventName.MOUSEDOWN),a=t.EventManager.fromEvent(r,t.EventName.MOUSEWHEEL),s=t.EventManager.fromEvent(t.EventName.KEYDOWN),c=null;c=i.flatMap(function(t){return t.stopPropagation(),o.takeUntil(n)}),this._mouseDragSubscription=c.subscribe(function(t){e._changeOrbit(t)}),this._mouseWheelSubscription=a.subscribe(function(t){t.preventDefault(),e._changeDistance(t)}),this._keydownSubscription=s.subscribe(function(t){e._changeTarget(t)})},r.prototype._changeOrbit=function(t){var e=t.movementDelta;this._isChange=!0,this.phi+=e.x/(100/this.rotateSpeed),this.theta-=e.y/(100/this.rotateSpeed),this._contrainTheta()},r.prototype._changeTarget=function(e){var r=this.moveSpeedX,n=this.moveSpeedY,o=null,i=null,a=e.keyState,s=this.gameObject.transform;this._isChange=!0,a.a||a.left?o=-r:a.d||a.right?o=r:a.w||a.up?i=n:(a.s||a.down)&&(i=-n),this.target.add(t.Vector3.create(s.right.x*o,0,s.right.z*o)),this.target.add(t.Vector3.create(s.up.x*i,s.up.y*i,0))},r.prototype._changeDistance=function(t){this._isChange=!0,this.distance-=t.wheel,this._contrainDistance()},r.prototype._contrainDistance=function(){this.distance=t.MathUtils.bigThan(this.distance,this.minDistance)},r.prototype._contrainTheta=function(){this.theta=t.MathUtils.clamp(this.theta,this.thetaMargin,Math.PI-this.thetaMargin)},r.prototype._removeEvent=function(){this._mouseDragSubscription.dispose(),this._mouseWheelSubscription.dispose(),this._keydownSubscription.dispose()},r}(t.CameraController);t.ArcballCameraController=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.p_target=null,this.isFinish=!1}return __extends(r,e),Object.defineProperty(r.prototype,"isStart",{get:function(){return!this.isStop},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isStop",{get:function(){return t.Log.error(!0,t.Log.info.ABSTRACT_ATTRIBUTE)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isPause",{get:function(){return t.Log.error(!0,t.Log.info.ABSTRACT_ATTRIBUTE)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"target",{get:function(){return this.p_target},set:function(t){this.p_target=t},enumerable:!0,configurable:!0}),r.prototype.reset=function(){this.isFinish=!1},r.prototype.addToGameObject=function(t){e.prototype.addToGameObject.call(this,t),this.target=t,t.actionManager.addChild(this)},r.prototype.removeFromGameObject=function(t){e.prototype.removeFromGameObject.call(this,t),t.actionManager.removeChild(this)},r.prototype.init=function(){this.start()},r.prototype.finish=function(){this.isFinish=!0,this.stop()},r}(t.Component);t.Action=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),Object.defineProperty(e.prototype,"isStop",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPause",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype.start=function(){},e.prototype.stop=function(){},e.prototype.pause=function(){},e.prototype.resume=function(){},e}(t.Action);t.ActionInstant=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(r,n,o){e.call(this),this._context=null,this._callFunc=null,this._dataArr=null,this._context=n||t.root,this._callFunc=r,this._dataArr=wdCb.Collection.create(o)}return __extends(r,e),r.create=function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var o=Array.prototype.slice.call(arguments,2),i=new this(t,e,o);return i},r.prototype.reverse=function(){return this},r.prototype.update=function(t){this._callFunc&&this._callFunc.call(this._context,this.p_target,this._dataArr),this.finish()},r.prototype.copy=function(){return new r(this._context,this._callFunc,this._dataArr.copy(!0).getChildren())},r}(t.ActionInstant);t.CallFunc=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.elapsed=null,this.duration=null,this._isStop=!0,this._isPause=!1,this._timeController=t.CommonTimeController.create()}return __extends(r,e),Object.defineProperty(r.prototype,"isStop",{get:function(){return this._isStop},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isPause",{get:function(){return this._isPause},enumerable:!0,configurable:!0}),r.prototype.update=function(t){t<this._timeController.startTime||(this.elapsed=this._convertToRatio(this._timeController.computeElapseTime(t)),this.updateBody(t),1===this.elapsed&&this.finish())},r.prototype.start=function(){this._isStop=!1,this._timeController.start()},r.prototype.stop=function(){this._isStop=!0,this._timeController.stop()},r.prototype.reset=function(){e.prototype.reset.call(this),this._isStop=!0},r.prototype.pause=function(){this._isPause=!0,this._timeController.pause()},r.prototype.resume=function(){this._isPause=!1,this._timeController.resume()},r.prototype.updateBody=function(t){},r.prototype._convertToRatio=function(t){var e=t/this.duration;return e>1?1:e},__decorate([t.virtual],r.prototype,"updateBody",null),r}(t.Action);t.ActionInterval=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),Object.defineProperty(e.prototype,"target",{set:function(t){this.p_target=t,this.getInnerActions().forEach(function(e){e.target=t})},enumerable:!0,configurable:!0}),e.prototype.init=function(){t.prototype.init.call(this),this.iterate("init")},e.prototype.reverse=function(){return this.iterate("reverse"),this},e.prototype.reset=function(){return t.prototype.reset.call(this),this.iterate("reset"),this},e.prototype.iterate=function(t,e){this.getInnerActions().forEach(function(r){r[t].apply(r,e)})},e}(t.ActionInterval);t.Control=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(t){e.call(this),this._actions=wdCb.Collection.create(),this._currentAction=null,this._actionIndex=0,this._actions.addChildren(t)}return __extends(r,e),r.create=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=null;return t.Log.assert(e.length>=2,"Sequence should has two actions at least"),n=new this(e),n.initWhenCreate(),n},r.prototype.initWhenCreate=function(){this._currentAction=this._actions.getChild(0)},r.prototype.update=function(t){return this._actionIndex===this._actions.getCount()?void this.finish():(this._currentAction=this._actions.getChild(this._actionIndex),this._currentAction.isFinish?void this._startNextActionAndJudgeFinish():(this._currentAction.update(t),this._currentAction.isFinish&&this._startNextActionAndJudgeFinish(),null))},r.prototype.copy=function(){var t=[];return this._actions.forEach(function(e){t.push(e.copy())}),r.create.apply(r,t)},r.prototype.reset=function(){return e.prototype.reset.call(this),this._actionIndex=0,this._currentAction=this._actions.getChild(this._actionIndex),this},r.prototype.start=function(){return e.prototype.start.call(this),this._currentAction.start(),this},r.prototype.stop=function(){return e.prototype.stop.call(this),this._currentAction.stop(),this},r.prototype.pause=function(){return e.prototype.pause.call(this),this._currentAction.pause(),this},r.prototype.resume=function(){return e.prototype.resume.call(this),this._currentAction.resume(),this},r.prototype.reverse=function(){return this._actions=this._actions.reverse(),e.prototype.reverse.call(this),this},r.prototype.getInnerActions=function(){return this._actions},r.prototype._startNextActionAndJudgeFinish=function(){return this._actionIndex++,this._actionIndex===this._actions.getCount()?void this.finish():void this._actions.getChild(this._actionIndex).start()},r}(t.Control);t.Sequence=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(t){e.call(this),this._actions=wdCb.Collection.create(),this._actions.addChildren(t)}return __extends(r,e),r.create=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=null;return t.Log.assert(e.length>=2,"Sequence should has two actions at least"),n=new this(e)},r.prototype.update=function(t){return this._isFinish()?void this.finish():(this.iterate("update",[t]),void(this._isFinish()&&this.finish()))},r.prototype.start=function(){return e.prototype.start.call(this),this.iterate("start"),this},r.prototype.stop=function(){return e.prototype.stop.call(this),this.iterate("stop"),this},r.prototype.pause=function(){return e.prototype.pause.call(this),this.iterate("pause"),this},r.prototype.resume=function(){return e.prototype.resume.call(this),this.iterate("resume"),this},r.prototype.copy=function(){var t=[];return this._actions.forEach(function(e){t.push(e.copy())}),r.create.apply(r,t)},r.prototype.reset=function(){return e.prototype.reset.call(this),this.iterate("reset"),this},r.prototype.reverse=function(){return this._actions=this._actions.reverse(),e.prototype.reverse.call(this),this},r.prototype.getInnerActions=function(){return this._actions},r.prototype.iterate=function(t,e){this._actions.forEach(function(r){r[t].apply(r,e)})},r.prototype._isFinish=function(){var t=!0;return this._actions.forEach(function(e){return e.isFinish?void 0:(t=!1,wdCb.$BREAK)}),t},r}(t.Control);t.Spawn=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(e){t.call(this),this.duration=e}return __extends(e,t),e.create=function(t){var e=new this(t);return e},e.prototype.reverse=function(){return this},e.prototype.copy=function(){return e.create(this.duration)},e}(t.ActionInterval);t.DelayTime=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(e,r){t.call(this),this._innerAction=null,this._originTimes=null,this._times=null,this._innerAction=e,this._times=r}return __extends(e,t),e.create=function(t,e){var r=new this(t,e);return r.initWhenCreate(),r},e.prototype.initWhenCreate=function(){this._originTimes=this._times},e.prototype.update=function(t){if(0===this._times)return void this.finish();if(this._innerAction.update(t),this._innerAction.isFinish){if(this._times-=1,0!==this._times)return this._innerAction.reset(),void this._innerAction.start();this.finish()}},e.prototype.copy=function(){return e.create(this._innerAction.copy(),this._times)},e.prototype.reset=function(){return t.prototype.reset.call(this),this._times=this._originTimes,this},e.prototype.start=function(){t.prototype.start.call(this),this._innerAction.start()},e.prototype.stop=function(){t.prototype.stop.call(this),this._innerAction.stop()},e.prototype.pause=function(){t.prototype.pause.call(this),this._innerAction.pause()},e.prototype.resume=function(){t.prototype.resume.call(this),this._innerAction.resume()},e.prototype.getInnerActions=function(){return wdCb.Collection.create([this._innerAction])},e}(t.Control);t.Repeat=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(e){t.call(this),this._innerAction=null,this._innerAction=e}return __extends(e,t),e.create=function(t){var e=new this(t);return e},e.prototype.update=function(t){this._innerAction.update(t),this._innerAction.isFinish&&(this._innerAction.reset(),this._innerAction.start())},e.prototype.copy=function(){return e.create(this._innerAction.copy())},e.prototype.start=function(){t.prototype.start.call(this),this._innerAction.start()},e.prototype.stop=function(){t.prototype.stop.call(this),this._innerAction.stop()},e.prototype.pause=function(){t.prototype.pause.call(this),this._innerAction.pause()},e.prototype.resume=function(){t.prototype.resume.call(this),this._innerAction.resume()},e.prototype.getInnerActions=function(){return wdCb.Collection.create([this._innerAction])},e}(t.Control);t.RepeatForever=e;
}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this._object=null,this._valuesStart=wdCb.Hash.create(),this._valuesEnd=wdCb.Hash.create(),this._easingFunction=r.Easing.Linear.None,this._interpolationFunction=r.Interpolation.Linear,this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onFinishCallback=null,this._onStopCallback=null}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.updateBody=function(e){var r=this,n=null;return this._onStartCallbackFired===!1&&(null!==this._onStartCallback&&this._onStartCallback.call(this._object.getChildren()),this._onStartCallbackFired=!0),n=this._easingFunction(this.elapsed),this._valuesEnd.forEach(function(e,o){var i=r._valuesStart.getChild(o),a=e;a instanceof Array?r._object.setValue(o,r._interpolationFunction(a,n)):(t.JudgeUtils.isString(a)&&(a=i+t.root.parseFloat(a,10)),t.JudgeUtils.isNumber(a)&&r._object.setValue(o,i+(a-i)*n))}),null!==this._onUpdateCallback&&this._onUpdateCallback.call(this._object.getChildren(),n),!0},r.prototype.from=function(e){var r=this;return this._object=wdCb.Hash.create(e),this._object.forEach(function(e,n){r._valuesStart.addChild(n,t.root.parseFloat(e,10))}),this},r.prototype.to=function(t,e){return void 0===e&&(e=1e3),this.duration=e,this._valuesEnd=wdCb.Hash.create(t),this},r.prototype.init=function(){var t=this;e.prototype.init.call(this),this._valuesEnd.forEach(function(e,r){if(e instanceof Array){if(0===e.length)return;t._valuesEnd.setValue(r,[t._object.getChild(r)].concat(t._valuesEnd.getChild(r)))}t._valuesStart.setValue(r,t._object.getChild(r)),t._valuesStart.getChild(r)instanceof Array==!1&&t._valuesStart.setValue(r,1*t._valuesStart.getChild(r))})},r.prototype.start=function(){return e.prototype.start.call(this),this._onStartCallbackFired=!1,this},r.prototype.stop=function(){return e.prototype.stop.call(this),null!==this._onStopCallback&&this._onStopCallback.call(this._object.getChildren()),this},r.prototype.copy=function(){return r.create().from(this._valuesStart.getChildren()).to(this._valuesEnd.getChildren(),this.duration).easing(this._easingFunction).interpolation(this._interpolationFunction).onStart(this._onStartCallback).onStop(this._onStopCallback).onFinish(this._onFinishCallback).onUpdate(this._onUpdateCallback)},r.prototype.reverse=function(){var t=this._valuesStart;this._valuesStart=this._valuesEnd,this._valuesEnd=t},r.prototype.easing=function(t){return this._easingFunction=t,this},r.prototype.interpolation=function(t){return this._interpolationFunction=t,this},r.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},r.prototype.onFinish=function(t){return this._onFinishCallback=t,this},r.prototype.onStart=function(t){return this._onStartCallback=t,this},r.prototype.onStop=function(t){return this._onStopCallback=t,this},r.prototype.finish=function(){e.prototype.finish.call(this),null!==this._onFinishCallback&&this._onFinishCallback.call(this._object.getChildren())},r.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){var e,r=.1,n=.4;return 0===t?0:1===t?1:(!r||1>r?(r=1,e=n/4):e=n*Math.asin(1/r)/(2*Math.PI),-(r*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/n)))},Out:function(t){var e,r=.1,n=.4;return 0===t?0:1===t?1:(!r||1>r?(r=1,e=n/4):e=n*Math.asin(1/r)/(2*Math.PI),r*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/n)+1)},InOut:function(t){var e,r=.1,n=.4;return 0===t?0:1===t?1:(!r||1>r?(r=1,e=n/4):e=n*Math.asin(1/r)/(2*Math.PI),(t*=2)<1?-.5*(r*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/n)):r*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/n)*.5+1)}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?.5*(t*t*((e+1)*t-e)):.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-r.Easing.Bounce.Out(1-t)},Out:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return.5>t?.5*r.Easing.Bounce.In(2*t):.5*r.Easing.Bounce.Out(2*t-1)+.5}}},r.Interpolation={Linear:function(t,e){var n=t.length-1,o=n*e,i=Math.floor(o),a=r.Interpolation.Utils.Linear;return 0>e?a(t[0],t[1],o):e>1?a(t[n],t[n-1],n-o):a(t[i],t[i+1>n?n:i+1],o-i)},Bezier:function(t,e){var n,o=0,i=t.length-1,a=Math.pow,s=r.Interpolation.Utils.Bernstein;for(n=0;i>=n;n++)o+=a(1-e,i-n)*a(e,n)*t[n]*s(i,n);return o},CatmullRom:function(t,e){var n=t.length-1,o=n*e,i=Math.floor(o),a=r.Interpolation.Utils.CatmullRom;return t[0]===t[n]?(0>e&&(i=Math.floor(o=n*(1+e))),a(t[(i-1+n)%n],t[i],t[(i+1)%n],t[(i+2)%n],o-i)):0>e?t[0]-(a(t[0],t[0],t[1],t[1],-o)-t[0]):e>1?t[n]-(a(t[n],t[n],t[n-1],t[n-1],o-n)-t[n]):a(t[i?i-1:0],t[i],t[i+1>n?n:i+1],t[i+2>n?n:i+2],o-i)},Utils:{Linear:function(t,e,r){return(e-t)*r+t},Bernstein:function(t,e){var n=r.Interpolation.Utils.Factorial;return n(t)/n(e)/n(t-e)},Factorial:function(){var t=[1];return function(e){var r,n=1;if(t[e])return t[e];for(r=e;r>1;r--)n*=r;return t[e]=n}}(),CatmullRom:function(t,e,r,n,o){var i=.5*(r-t),a=.5*(n-e),s=o*o,c=o*s;return(2*e-2*r+i+a)*c+(-3*e+3*r-2*i-a)*s+i*o+e}}},r}(t.ActionInterval);t.Tween=e}(wd||(wd={}));var wd;!function(t){var e=function(){function t(){this._children=wdCb.Collection.create()}return t.create=function(){var t=new this;return t},t.prototype.addChild=function(t){this.hasChild(t)||this._children.addChild(t)},t.prototype.removeChild=function(t){this._children.removeChild(t)},t.prototype.hasChild=function(t){return this._children.hasChild(t)},t.prototype.update=function(t){var e=this,r=[];this._children.forEach(function(e){return e?e.isFinish?void r.push(e):void(e.isStop||e.isPause||e.update(t)):void 0}),r.forEach(function(t){e._children.removeChild(t)})},t}();t.ActionManager=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(t.Component);t.RendererComponent=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.drawMode=t.DrawMode.TRIANGLES}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.render=function(t,e,r){t.addCommand(this.createDrawCommand(t,e,r))},r.prototype.createDrawCommand=function(e,r,n){var o=e.createQuadCommand(),i=n.getComponent(t.CameraController),a=r.material;return o.buffers=r.buffers,o.animation=r.gameObject.getComponent(t.Animation),o.mMatrix=this.transform.localToWorldMatrix,o.vMatrix=i.worldToCameraMatrix,o.pMatrix=i.pMatrix,o.material=a,o.z=this.gameObject.transform.position.z,o.drawMode=this.drawMode,o},__decorate([t.require(function(e,r,n){var o=n.getComponent(t.CameraController);t.assert(!!o&&!!o.camera,t.Log.info.FUNC_MUST("camera","add Camera Component")),t.assert(!!r,t.Log.info.FUNC_MUST("Mesh","add geometry component"))})],r.prototype,"createDrawCommand",null),r}(t.RendererComponent);t.MeshRenderer=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.create=function(){var t=new this;return t},e.prototype.render=function(t,e,r){t.skyboxCommand=this.createDrawCommand(t,e,r)},e}(t.MeshRenderer);t.SkyboxRenderer=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.type=t.ABSTRACT_ATTRIBUTE,this.boundingRegion=null}return __extends(r,e),Object.defineProperty(r.prototype,"shape",{get:function(){return this.boundingRegion.shape},enumerable:!0,configurable:!0}),r.prototype.init=function(){this.boundingRegion=this.createBoundingRegion(),this.boundingRegion.init(),this.buildBoundingRegion()},r.prototype.update=function(t){this.boundingRegion.update()},r.prototype.updateShape=function(){this.boundingRegion.updateShape()},r.prototype.isIntersectWith=function(e){return e instanceof t.BoxCollider?this.boundingRegion.isIntersectWithBox(e.boundingRegion):e instanceof t.SphereCollider?this.boundingRegion.isIntersectWithSphere(e.boundingRegion):void t.Log.warn(t.Log.info.FUNC_NOT_SUPPORT(this.type+" collider","intersect with "+e.type+" collider"))},r.prototype.getCollideObjects=function(e){var n=this,o=wdCb.Collection.create();return e.forEach(function(e){var i=null;n._isSelf(e)||(i=e.getComponent(r),e.hasComponent(t.RigidBody)&&i.updateShape(),n.isIntersectWith(i)&&o.addChild(e))}),o},r.prototype._isSelf=function(t){return this.gameObject.uid===t.uid},__decorate([t.require(function(e){t.assert(e instanceof r,t.Log.info.FUNC_SHOULD("target","be collider"))})],r.prototype,"isIntersectWith",null),r}(t.Component);t.Collider=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.center=t.Vector3.create(0,0,0),this.halfExtents=null,this.type=t.ColliderType.BOX}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.createBoundingRegion=function(){return t.BoxBoundingRegion.create(this.gameObject)},r.prototype.buildBoundingRegion=function(){this.boundingRegion.build(this.center,this.halfExtents)},r}(t.Collider);t.BoxCollider=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.center=t.Vector3.create(0,0,0),this.radius=null,this.type=t.ColliderType.SPHERE}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.createBoundingRegion=function(){return t.SphereBoundingRegion.create(this.gameObject)},r.prototype.buildBoundingRegion=function(){this.boundingRegion.build(this.center,this.radius)},r}(t.Collider);t.SphereCollider=e}(wd||(wd={}));var __decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(){function e(t){this.shape=null,this.gameObject=null,this.isUserSpecifyTheRegion=!1,this.originShape=null,this.debugObject=null,this.gameObject=t}return e.prototype.init=function(){this.shape=this.createShape()},e.prototype.build=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var o=Array.prototype.slice.call(arguments,0);this.isBuildUserSpecifyBoundingRegion.apply(this,o)?(this.isUserSpecifyTheRegion=!0,this.shape.setFromShapeParam.apply(this.shape,o)):this.shape.setFromPoints(this.gameObject.getComponent(t.Geometry).geometryData.vertices),this.originShape=this.shape.copy(),t.DebugConfig.debugCollision&&(this.debugObject=this.buildDebugObjectFromShape(this.shape),t.Director.getInstance().scene.addChild(this.debugObject))},e.prototype.update=function(){this.isNotTransformed()||(t.DebugConfig.debugCollision?(this.updateShape(),this.updateDebugObjectFromShape(this.shape)):this.gameObject.hasComponent(t.RigidBody)||this.updateShape())},e.prototype.isIntersectWithSphere=function(t){return this.shape.isIntersectWithSphere(t.shape)},e.prototype.isIntersectWithBox=function(t){return this.shape.isIntersectWithBox(t.shape)},e.prototype.buildDebugObjectFromShape=function(e){var r=null,n=null,o=null,i=null;return r=t.BasicMaterial.create(),r.color=t.Color.create("rgb(255,0,0)"),n=t.CustomGeometry.create(),n.material=r,this.setDebugObjectGeometry(n,e),o=t.MeshRenderer.create(),o.drawMode=t.DrawMode.LINES,i=t.GameObject.create(),i.addComponent(n),i.addComponent(o),i.transform.translate(e.center),i.name="debugBoundingRegion"+this.gameObject.uid,i.init(),i},__decorate([t.ensure(function(e,r){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];this.isBuildUserSpecifyBoundingRegion.apply(this,Array.prototype.slice.call(arguments,1))?t.assert(this.shape.center.isEqual(r),t.Log.info.FUNC_SHOULD_NOT("transform shape when build")):t.assert(this.shape.center.isZero(),t.Log.info.FUNC_SHOULD_NOT("transform shape when build"))})],e.prototype,"build",null),e}();t.BoundingRegion=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.create=function(t){var e=new this(t);return e},r.prototype.updateShape=function(){var t=this.gameObject.transform;this.isUserSpecifyTheRegion?this.shape.setFromTranslationAndScale(this.originShape,t.localToWorldMatrix):t.isRotate?this.shape.setFromObject(this.gameObject):this.shape.setFromTranslationAndScale(this.originShape,t.localToWorldMatrix)},r.prototype.createShape=function(){return t.AABBShape.create()},r.prototype.updateDebugObjectFromShape=function(e){var r=this.debugObject.getComponent(t.CustomGeometry);this.setDebugObjectGeometry(r,e),this.debugObject.transform.position=e.center},r.prototype.setDebugObjectGeometry=function(t,e){var r=e.halfExtents,n=r.x,o=r.y,i=r.z;t.vertices=[-n,-o,-i,-n,-o,i,n,-o,i,n,-o,-i,-n,o,-i,-n,o,i,n,o,i,n,o,-i],t.indices=[0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]},r.prototype.isBuildUserSpecifyBoundingRegion=function(t,e){return!!t&&!!e},r.prototype.isNotTransformed=function(){var t=this.gameObject.transform;return!t.isRotate&&!t.isTranslate&&!t.isScale},__decorate([t.require(function(e){t.assert(this.debugObject,t.Log.info.FUNC_SHOULD("build debugObject"))})],r.prototype,"updateDebugObjectFromShape",null),__decorate([t.require(function(e,r){t.assert(r.halfExtents&&!r.halfExtents.isZero(),t.Log.info.FUNC_SHOULD_NOT("halfExtents","be zero"))})],r.prototype,"setDebugObjectGeometry",null),r}(t.BoundingRegion);t.BoxBoundingRegion=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.create=function(t){var e=new this(t);return e},r.prototype.updateShape=function(){var t=this.gameObject.transform;this.shape.setFromTranslationAndScale(this.originShape,t.localToWorldMatrix)},r.prototype.createShape=function(){return t.SphereShape.create()},r.prototype.updateDebugObjectFromShape=function(e){this.debugObject.transform.position=e.center;var r=e.radius/this.originShape.radius;this.debugObject.transform.scale=t.Vector3.create(r,r,r)},r.prototype.isNotTransformed=function(){var t=this.gameObject.transform;return!t.isTranslate&&!t.isScale},r.prototype.isBuildUserSpecifyBoundingRegion=function(t,e){return!!t&&!!e},r.prototype.setDebugObjectGeometry=function(t,e){for(var r=40,n=3,o=e.radius,i=[],a=0,s=0;n>s;s++){var c=0,u=1,h=2,l=null;1===s?(c=1,u=0,h=2):2===s&&(c=0,u=2,h=1);for(var p=0;r>p;p++)l=2*Math.PI*(p/r),i[a+c]=o*Math.cos(l),i[a+u]=0,i[a+h]=o*Math.sin(l),a+=3,l=2*Math.PI*((p+1)/r),i[a+c]=o*Math.cos(l),i[a+u]=0,i[a+h]=o*Math.sin(l),a+=3}t.vertices=i},__decorate([t.require(function(e){t.assert(this.debugObject,t.Log.info.FUNC_SHOULD("build debugObject"))})],r.prototype,"updateDebugObjectFromShape",null),__decorate([t.require(function(e,r){t.assert(r.radius>0,t.Log.info.FUNC_SHOULD("radius","> 0"))})],r.prototype,"setDebugObjectGeometry",null),r}(t.BoundingRegion);t.SphereBoundingRegion=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){this.center=t.Vector3.create(0,0,0)}return e.prototype.isBoxAndSphereIntersected=function(t,e){var r=e.center,n=e.radius;return r.distanceToSquared(t.closestPointTo(r))<Math.pow(n,2)},e}();t.Shape=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.halfExtents=t.Vector3.create(.5,.5,.5)}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.setMinMax=function(t,e){this.center.add2(e,t).scale(.5),this.halfExtents.sub2(e,t).scale(.5)},r.prototype.getMin=function(){return this.center.copy().sub(this.halfExtents)},r.prototype.getMax=function(){return this.center.copy().add(this.halfExtents)},r.prototype.setFromShapeParam=function(t,e){this.center=t,this.halfExtents=e},r.prototype.setFromPoints=function(e){var r=this,n=this._getEmptyMin(),o=this._getEmptyMax();return t.GeometryUtils.iterateThreeComponent(e,function(t){r._expandByPoint(t,n,o)}),this.setMinMax(n,o),this},r.prototype.setFromTransformedAABB=function(t,e){var r=this.center,n=this.halfExtents,o=t.center.values,i=t.halfExtents.values,a=e.values,s=a[0],c=a[4],u=a[8],h=a[1],l=a[5],p=a[9],f=a[2],d=a[6],_=a[10],y=Math.abs(s),m=Math.abs(c),g=Math.abs(u),v=Math.abs(h),b=Math.abs(l),w=Math.abs(p),C=Math.abs(f),T=Math.abs(d),S=Math.abs(_);r.set(a[12]+s*o[0]+c*o[1]+u*o[2],a[13]+h*o[0]+l*o[1]+p*o[2],a[14]+f*o[0]+d*o[1]+_*o[2]),n.set(y*i[0]+m*i[1]+g*i[2],v*i[0]+b*i[1]+w*i[2],C*i[0]+T*i[1]+S*i[2])},r.prototype.setFromTranslationAndScale=function(t,e){var r=e.getTranslation(),n=e.getScale();this.center=t.center.copy().add(r),this.halfExtents=t.halfExtents.copy().mul(n)},r.prototype.setFromObject=function(e){var r=e.transform.localToWorldMatrix,n=e.getComponent(t.Geometry).geometryData.vertices,o=this,i=this._getEmptyMin(),a=this._getEmptyMax();t.GeometryUtils.iterateThreeComponent(n,function(t){t.applyMatrix4(r),o._expandByPoint(t,i,a)}),this.setMinMax(i,a)},r.prototype.isIntersectWithBox=function(t){var e=this.getMax(),r=this.getMin(),n=t.getMax(),o=t.getMin();return r.x<=n.x&&e.x>=o.x&&r.y<=n.y&&e.y>=o.y&&r.z<=n.z&&e.z>=o.z},r.prototype.isIntersectWithSphere=function(t){return this.isBoxAndSphereIntersected(this,t)},r.prototype.closestPointTo=function(e){var r=this.getMin(),n=this.getMax(),o=t.Vector3.create();return e.x<r.x?o.x=r.x:e.x>n.x?o.x=n.x:o.x=e.x,e.y<r.y?o.y=r.y:e.y>n.y?o.y=n.y:o.y=e.y,e.z<r.z?o.z=r.z:e.z>n.z?o.z=n.z:o.z=e.z,o},r.prototype.containPoint=function(t){for(var e=this.getMin(),r=this.getMax(),n=0;3>n;++n)if(t.values[n]<e.values[n]||t.values[n]>r.values[n])return!1;return!0},r.prototype.copy=function(){var t=r.create();return t.center=this.center.copy(),t.halfExtents=this.halfExtents.copy(),t},r.prototype._getEmptyMin=function(){return t.Vector3.create(1/0,1/0,1/0)},r.prototype._getEmptyMax=function(){return t.Vector3.create(-(1/0),-(1/0),-(1/0))},r.prototype._expandByPoint=function(t,e,r){e.min(t),r.max(t)},__decorate([t.require(function(e){var r=e.getComponent(t.Geometry).geometryData.vertices;t.assert(r&&r.length>0,t.Log.info.FUNC_MUST_DEFINE("vertices"))})],r.prototype,"setFromObject",null),r}(t.Shape);t.AABBShape=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.radius=1}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.setFromShapeParam=function(t,e){this.center=t,this.radius=e},r.prototype.setFromPoints=function(e){var r=t.AABBShape.create();this.center=r.setFromPoints(e).center,this.radius=this._findMaxDistanceOfPointsToCenter(e)},r.prototype.setFromTranslationAndScale=function(t,e){var r=e.getTranslation(),n=e.getScale();this.center=t.center.copy().add(r),this.radius=t.radius*Math.max(n.x,n.y,n.z)},r.prototype.isIntersectWithSphere=function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=Math.pow(e,2)},r.prototype.isIntersectWithBox=function(t){return this.isBoxAndSphereIntersected(t,this)},r.prototype.containPoint=function(t){return t.distanceToSquared(this.center)<=Math.pow(this.radius,2)},r.prototype.copy=function(){var t=r.create();return t.center=this.center.copy(),t.radius=this.radius,t},r.prototype._findMaxDistanceOfPointsToCenter=function(e){var r=0,n=this.center;return t.GeometryUtils.iterateThreeComponent(e,function(t){r=Math.max(r,n.distanceToSquared(t))}),Math.sqrt(r)},r}(t.Shape);t.SphereShape=e}(wd||(wd={}));var wd;!function(t){!function(t){t[t.BOX="box"]="BOX",t[t.SPHERE="sphere"]="SPHERE"}(t.ColliderType||(t.ColliderType={}));t.ColliderType}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this._friction=0,this._restitution=0,this._children=wdCb.Collection.create(),this.lockConstraint=t.LockConstraint.create(this),this.distanceConstraint=t.DistanceConstraint.create(this),this.hingeConstraint=t.HingeConstraint.create(this),this.pointToPointConstraintList=t.PointToPointConstraintList.create(this)}return __extends(r,e),Object.defineProperty(r.prototype,"friction",{get:function(){return this._friction},set:function(t){this._friction=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"restitution",{get:function(){return this._restitution},set:function(t){this._restitution=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"children",{get:function(){return this._children},set:function(e){if(t.JudgeUtils.isArray(e)){var r=e;this._children=wdCb.Collection.create(r)}else{var n=e;this._children=n}this._children.forEach(function(t){t.isRigidbodyChild=!0})},enumerable:!0,configurable:!0}),r.prototype.init=function(){var e=this;t.EventManager.on(t.EngineEvent.AFTER_INIT,function(){e.addBody()}),t.EventManager.on(t.EngineEvent.AFTER_INIT_RIGIDBODY_ADD_CONSTRAINT,function(){e.addConstraint()})},r.prototype.addConstraint=function(){var t=this,e=this.getPhysicsEngineAdapter();this.lockConstraint&&this.lockConstraint.connectedBody&&e.addLockConstraint(this.gameObject,this.lockConstraint),this.distanceConstraint&&this.distanceConstraint.connectedBody&&e.addDistanceConstraint(this.gameObject,this.distanceConstraint),this.hingeConstraint&&this.hingeConstraint.connectedBody&&e.addHingeConstraint(this.gameObject,this.hingeConstraint),this.pointToPointConstraintList&&this.pointToPointConstraintList.getCount()>0&&this.pointToPointConstraintList.forEach(function(r){e.addPointToPointConstraint(t.gameObject,r)},this)},r.prototype.dispose=function(){this._children.forEach(function(t){t.isRigidbodyChild=!1}),this.getPhysicsEngineAdapter().removeGameObject(this.gameObject),this.getPhysicsEngineAdapter().removeConstraints(this.gameObject)},r.prototype.getPhysicsEngineAdapter=function(){return t.Director.getInstance().scene.physicsEngineAdapter},r.prototype.isPhysicsEngineAdapterExist=function(){return!!t.Director.getInstance().scene&&!!t.Director.getInstance().scene.physicsEngineAdapter},r.prototype.addBodyToPhysicsEngine=function(t,e){void 0===e&&(e={});var r=this.getPhysicsEngineAdapter(),n=this.gameObject.transform.position,o=this.gameObject.transform.rotation;r[t](this.gameObject,wdCb.ExtendUtils.extend({position:n,rotation:o,children:this._children,lockConstraint:this.lockConstraint,onContact:wdCb.FunctionUtils.bind(this,this._onContact),onCollisionStart:wdCb.FunctionUtils.bind(this,this._onCollisionStart),onCollisionEnd:wdCb.FunctionUtils.bind(this,this._onCollisionEnd),friction:this.friction,restitution:this.restitution},e))},r.prototype._onContact=function(t){this.gameObject.execScript("onContact",wdCb.Collection.create([t]))},r.prototype._onCollisionStart=function(t){this.gameObject.execScript("onCollisionStart",wdCb.Collection.create([t]))},r.prototype._onCollisionEnd=function(){this.gameObject.execScript("onCollisionEnd")},r.prototype._isContainer=function(t){var e=t.getComponent(r);return e.children.getCount()>0},__decorate([t.operateBodyDataGetterAndSetter("Friction")],r.prototype,"friction",null),__decorate([t.operateBodyDataGetterAndSetter("Restitution")],r.prototype,"restitution",null),__decorate([t.require(function(){this._isContainer(this.gameObject)?t.assert(!this.gameObject.getComponent(t.Collider),t.Log.info.FUNC_SHOULD_NOT("container","add collider component in the case of compound")):(t.assert(!!this.gameObject.getComponent(t.Collider),t.Log.info.FUNC_MUST_DEFINE("collider component when add rigid body component")),t.assert(!!this.gameObject.getComponent(t.Collider).shape,t.Log.info.FUNC_SHOULD("create collider.shape before adding rigid body component")))})],r.prototype,"addBodyToPhysicsEngine",null),r}(t.Component);t.RigidBody=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this._linearDamping=0,this._angularDamping=0,this._velocity=t.Vector3.create(0,0,0),this._angularVelocity=t.Vector3.create(0,0,0),this._mass=1,this.impulse=null,this.force=null,this.hitPoint=null}return __extends(r,e),r.create=function(){var t=new this;return t},Object.defineProperty(r.prototype,"linearDamping",{get:function(){return this._linearDamping},set:function(t){this._linearDamping=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"angularDamping",{get:function(){return this._angularDamping},set:function(t){this._angularDamping=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"velocity",{get:function(){return this._velocity},set:function(t){this._velocity=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"angularVelocity",{get:function(){return this._angularVelocity},set:function(t){this._angularVelocity=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"mass",{get:function(){return this._mass},set:function(t){this._mass=t},enumerable:!0,configurable:!0}),r.prototype.addBody=function(){this.addBodyToPhysicsEngine("addDynamicBody",{mass:this.mass,linearDamping:this.linearDamping,angularDamping:this.angularDamping,velocity:this.velocity,angularVelocity:this.angularVelocity,impulse:this.impulse,force:this.force,hitPoint:this.hitPoint})},__decorate([t.operateBodyDataGetterAndSetter("LinearDamping")],r.prototype,"linearDamping",null),__decorate([t.operateBodyDataGetterAndSetter("AngularDamping")],r.prototype,"angularDamping",null),__decorate([t.operateBodyDataGetterAndSetter("Velocity")],r.prototype,"velocity",null),__decorate([t.operateBodyDataGetterAndSetter("AngularVelocity")],r.prototype,"angularVelocity",null),__decorate([t.operateBodyDataGetterAndSetter("Mass")],r.prototype,"mass",null),r}(t.RigidBody);t.DynamicRigidBody=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(){function t(t){this.maxForce=null,this.rigidBody=null,this.rigidBody=t}return t}();t.PhysicsConstraint=e;var r=function(t){function e(){t.apply(this,arguments),
this._connectedBody=null}return __extends(e,t),e.create=function(t){var e=new this(t);return e},Object.defineProperty(e.prototype,"connectedBody",{get:function(){return this._connectedBody},set:function(t){var e=null;this._connectedBody=t,this.rigidBody.isPhysicsEngineAdapterExist()&&(e=this.rigidBody.getPhysicsEngineAdapter(),e.removeLockConstraint(this.rigidBody.gameObject),this.rigidBody.addConstraint())},enumerable:!0,configurable:!0}),e}(e);t.LockConstraint=r;var n=function(t){function e(){t.apply(this,arguments),this._connectedBody=null,this.distance=null}return __extends(e,t),e.create=function(t){var e=new this(t);return e},Object.defineProperty(e.prototype,"connectedBody",{get:function(){return this._connectedBody},set:function(t){var e=null;this._connectedBody=t,this.rigidBody.isPhysicsEngineAdapterExist()&&(e=this.rigidBody.getPhysicsEngineAdapter(),e.removeDistanceConstraint(this.rigidBody.gameObject),this.rigidBody.addConstraint())},enumerable:!0,configurable:!0}),e}(e);t.DistanceConstraint=n;var o=function(t){function e(){t.apply(this,arguments),this._connectedBody=null,this.pivotA=null,this.pivotB=null,this.axisA=null,this.axisB=null}return __extends(e,t),e.create=function(t){var e=new this(t);return e},Object.defineProperty(e.prototype,"connectedBody",{get:function(){return this._connectedBody},set:function(t){var e=null;this._connectedBody=t,this.rigidBody.isPhysicsEngineAdapterExist()&&(e=this.rigidBody.getPhysicsEngineAdapter(),e.removeHingeConstraint(this.rigidBody.gameObject),this.rigidBody.addConstraint())},enumerable:!0,configurable:!0}),e}(e);t.HingeConstraint=o;var i=function(t){function e(){t.apply(this,arguments),this.connectedBody=null,this.pivotA=null,this.pivotB=null}return __extends(e,t),e.create=function(t){var e=new this(t);return e},e}(e);t.PointToPointConstraint=i;var a=function(){function e(t){this._rigidBody=null,this._list=wdCb.Collection.create(),this._rigidBody=t}return e.create=function(t){var e=new this(t);return e},e.prototype.forEach=function(e,r){void 0===r&&(r=t.root),this._list.forEach(e,r)},e.prototype.getCount=function(){return this._list.getCount()},e.prototype.addChild=function(t){var e=null;this._list.addChild(t),this._rigidBody.isPhysicsEngineAdapterExist()&&(e=this._rigidBody.getPhysicsEngineAdapter(),e.addPointToPointConstraint(this._rigidBody.gameObject,t))},e.prototype.addChildren=function(e){var r=this;if(t.JudgeUtils.isArray(e))for(var n=0,o=e;n<o.length;n++){var i=o[n];this.addChild(i)}else{var a=e;a.forEach(function(t){r.addChild(t)},this)}},e.prototype.removeChild=function(t){var e=null;this._list.removeChild(t),this._rigidBody.isPhysicsEngineAdapterExist()&&(e=this._rigidBody.getPhysicsEngineAdapter(),e.removePointToPointConstraint(t))},e}();t.PointToPointConstraintList=a}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){}return e.create=function(e){var r=null;switch(e){case t.PhysicsEngineType.CANNON:r=t.CannonAdapter.create();break;default:wdCb.Log.error(!0,wdCb.Log.info.FUNC_UNEXPECT("physics engine type"))}return r},e}();t.PhysicsEngineFactory=e}(wd||(wd={}));var wd;!function(t){!function(t){t[t.CANNON=0]="CANNON"}(t.PhysicsEngineType||(t.PhysicsEngineType={}));t.PhysicsEngineType}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){this.dataList=wdCb.Collection.create()}return e.prototype.getCount=function(){return this.dataList.getCount()},e.prototype.removeByGameObject=function(e){this.dataList.removeChild(function(r){var n=r.gameObject;r.body;return t.JudgeUtils.isEqual(n,e)})},e}();t.CannonDataList=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.remove=function(t){this.removeByGameObject(t)},r.prototype.updateBodyTransformData=function(){this.dataList.forEach(function(e){var r=e.gameObject,n=e.body,o=r.transform;(o.isTranslate||o.isRotate)&&(n.position=t.CannonUtils.convertToCannonVector3(r.transform.position),n.quaternion=t.CannonUtils.convertToCannonQuaternion(r.transform.rotation))})},r.prototype.updateGameObjectTransformData=function(){this.dataList.forEach(function(e){var r=e.gameObject,n=e.body;r.isRigidbodyChild||(r.transform.position=t.CannonUtils.convertToWonderVector3(n.position),r.transform.rotation=t.CannonUtils.convertToWonderQuaternion(n.quaternion))})},r.prototype.add=function(t,e){this.dataList.addChild({gameObject:t,body:e})},r.prototype.findGameObjectByBody=function(t){var e=this.dataList.findOne(function(e){var r=(e.gameObject,e.body);return r===t});return null!==e?e.gameObject:null},r.prototype.findBodyByGameObject=function(e){var r=this.dataList.findOne(function(r){var n=r.gameObject;r.body;return t.JudgeUtils.isEqual(n,e)});return null!==r?r.body:null},r}(t.CannonDataList);t.CannonGameObjectDataList=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.remove=function(t){this.removeByGameObject(t)},r.prototype.findMaterialByGameObject=function(e){var r=this.dataList.findOne(function(r){var n=r.gameObject;r.material;return t.JudgeUtils.isEqual(n,e)});return null!==r?r.material:null},r.prototype.add=function(t,e){this.dataList.addChild({gameObject:t,material:e})},r.prototype.addContactMaterial=function(t,e,r,n){this.dataList.forEach(function(o){var i=(o.gameObject,o.material);t.addContactMaterial(new CANNON.ContactMaterial(i,e,{friction:r,restitution:n}))})},r.prototype.getContactMaterialData=function(t,e,r){var n=null;return this.dataList.forEach(function(o){var i=(o.gameObject,o.material),a=t.getContactMaterial(i,e);return a?(n=a[r],wdCb.$BREAK):void 0}),n},r.prototype.getContactMaterials=function(t,e){var r=[];return this.dataList.forEach(function(n){var o=(n.gameObject,n.material),i=t.getContactMaterial(o,e);i&&r.push(i)}),r},r.prototype.setContactMaterialData=function(t,e,r,n){this.dataList.forEach(function(o){var i=(o.gameObject,o.material),a=t.getContactMaterial(i,e);a&&(a[r]=n)})},r}(t.CannonDataList);t.CannonMaterialList=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(t.CannonDataList);t.CannonConstraintDataList=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.prototype.add=function(t,e){this.dataList.addChild({gameObject:t,constraint:e})},r.prototype.remove=function(t){this.removeByGameObject(t)},r.prototype.findConstraintByGameObject=function(e){var r=this.dataList.findOne(function(r){var n=r.gameObject;return t.JudgeUtils.isEqual(n,e)});return null!==r?r.constraint:null},r}(t.CannonConstraintDataList);t.CannonSingleConstraintDataList=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.create=function(){var t=new this;return t},e}(t.CannonSingleConstraintDataList);t.CannonLockConstraintDataList=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.filter=function(t){return this.dataList.filter(t)},r.prototype.forEach=function(t){this.dataList.forEach(t)},r.prototype.add=function(t,e,r){this.dataList.addChild({gameObject:t,pointToPointConstraint:e,cannonConstraint:r})},r.prototype.remove=function(e){this.dataList.removeChild(function(r){var n=r.pointToPointConstraint;return t.JudgeUtils.isEqual(n,e)})},r.prototype.findCannonConstraintByPointToPointConstraint=function(e){var r=this.dataList.findOne(function(r){var n=r.pointToPointConstraint;return t.JudgeUtils.isEqual(n,e)});return null!==r?r.cannonConstraint:null},r}(t.CannonConstraintDataList);t.CannonPointToPointConstraintDataList=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.create=function(){var t=new this;return t},e}(t.CannonSingleConstraintDataList);t.CannonDistanceConstraintDataList=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.create=function(){var t=new this;return t},e}(t.CannonSingleConstraintDataList);t.CannonHingeConstraintDataList=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){}return e.convertToCannonVector3=function(t){return new CANNON.Vec3(t.x,t.y,t.z)},e.convertToCannonQuaternion=function(t){return new CANNON.Quaternion(t.x,t.y,t.z,t.w)},e.convertToWonderVector3=function(e){return t.Vector3.create(e.x,e.y,e.z)},e.convertToWonderQuaternion=function(e){return t.Quaternion.create(e.x,e.y,e.z,e.w)},e}();t.CannonUtils=e}(wd||(wd={}));var __decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(){function e(){this.world=null,this._materialList=t.CannonMaterialList.create(),this._gameObjectDataList=t.CannonGameObjectDataList.create(),this._lockConstraintDataList=t.CannonLockConstraintDataList.create(),this._distanceConstraintDataList=t.CannonDistanceConstraintDataList.create(),this._hingeConstraintDataList=t.CannonHingeConstraintDataList.create(),this._pointToPointConstraintDataList=t.CannonPointToPointConstraintDataList.create(),this._dynamicBody=null,this._kinematicBody=null,this._staticBody=null,this._lockConstraint=null,this._distanceConstraint=null,this._hingeConstraint=null,this._pointToPointConstraint=null}return e.create=function(){var t=new this;return t},e.prototype.getGravity=function(e){return t.CannonUtils.convertToWonderVector3(this.world.gravity)},e.prototype.setGravity=function(e){this.world.gravity=t.CannonUtils.convertToCannonVector3(e)},e.prototype.getFriction=function(t,e){return this._getMaterialData(t,"friction")},e.prototype.setFriction=function(t,e){this._setMaterialData(t,"friction",e)},e.prototype.getRestitution=function(t,e){return this._getMaterialData(t,"restitution")},e.prototype.setRestitution=function(t,e){this._setMaterialData(t,"restitution",e)},e.prototype.getLinearDamping=function(t){return this._getNumberData(t,"linearDamping")},e.prototype.setLinearDamping=function(t,e){return this._setNumberData(t,"linearDamping",e)},e.prototype.getAngularDamping=function(t){return this._getNumberData(t,"angularDamping")},e.prototype.setAngularDamping=function(t,e){return this._setNumberData(t,"angularDamping",e)},e.prototype.getMass=function(t){return this._getNumberData(t,"mass")},e.prototype.setMass=function(t,e){return this._setNumberData(t,"mass",e)},e.prototype.getVelocity=function(t){return this._getVec3Data(t,"velocity")},e.prototype.setVelocity=function(t,e){this._setVec3Data(t,"velocity",e)},e.prototype.getAngularVelocity=function(t){return this._getVec3Data(t,"angularVelocity")},e.prototype.setAngularVelocity=function(t,e){this._setVec3Data(t,"angularVelocity",e)},e.prototype.init=function(){var e=t.Director.getInstance().scene.physics,r=e.gravity,n=e.iterations;this.world=new CANNON.World,this.world.broadphase=new CANNON.NaiveBroadphase,this.world.solver.iterations=n,this.world.gravity.set(r.x,r.y,r.z),this._dynamicBody=t.CannonDynamicBody.create(this.world,this._gameObjectDataList,this._materialList),this._kinematicBody=t.CannonKinematicBody.create(this.world,this._gameObjectDataList,this._materialList),this._staticBody=t.CannonStaticBody.create(this.world,this._gameObjectDataList,this._materialList),this._lockConstraint=t.CannonLockConstraint.create(this.world,this._gameObjectDataList,this._lockConstraintDataList),this._distanceConstraint=t.CannonDistanceConstraint.create(this.world,this._gameObjectDataList,this._distanceConstraintDataList),this._hingeConstraint=t.CannonHingeConstraint.create(this.world,this._gameObjectDataList,this._hingeConstraintDataList),this._pointToPointConstraint=t.CannonPointToPointConstraint.create(this.world,this._gameObjectDataList,this._pointToPointConstraintDataList)},e.prototype.addDynamicBody=function(t,e){this._dynamicBody.addBody(t,e)},e.prototype.addKinematicBody=function(t,e){this._kinematicBody.addBody(t,e)},e.prototype.addStaticBody=function(t,e){this._staticBody.addBody(t,e)},e.prototype.addLockConstraint=function(t,e){this._lockConstraint.addConstraint(t,e)},e.prototype.removeLockConstraint=function(t){this._lockConstraint.removeConstraint(t)},e.prototype.addDistanceConstraint=function(t,e){this._distanceConstraint.addConstraint(t,e)},e.prototype.removeDistanceConstraint=function(t){this._distanceConstraint.removeConstraint(t)},e.prototype.addHingeConstraint=function(t,e){this._hingeConstraint.addConstraint(t,e)},e.prototype.removeHingeConstraint=function(t){this._hingeConstraint.removeConstraint(t)},e.prototype.addPointToPointConstraint=function(t,e){this._pointToPointConstraint.addConstraint(t,e)},e.prototype.removePointToPointConstraint=function(t){this._pointToPointConstraint.removeConstraint(t)},e.prototype.removeGameObject=function(t){var e=(this._getMaterial(t),this._gameObjectDataList.findBodyByGameObject(t));e&&this.world.remove(e),this._gameObjectDataList.remove(t),this._materialList.remove(t)},e.prototype.removeConstraints=function(e){var r=this;this._lockConstraint.removeConstraint(e),this._distanceConstraint.removeConstraint(e),this._hingeConstraint.removeConstraint(e),this._pointToPointConstraintDataList.filter(function(r){var n=r.gameObject;return t.JudgeUtils.isEqual(n,e)}).forEach(function(t){var e=t.pointToPointConstraint;r._pointToPointConstraint.removeConstraint(e)})},e.prototype.update=function(e){this._gameObjectDataList.updateBodyTransformData(),this.world.step(t.Director.getInstance().getDeltaTime()/1e3),this._gameObjectDataList.updateGameObjectTransformData()},e.prototype._getMaterial=function(t){return this._materialList.findMaterialByGameObject(t)},e.prototype._getNumberData=function(t,e){var r=this._gameObjectDataList.findBodyByGameObject(t);return r?r[e]:null},e.prototype._setNumberData=function(t,e,r){var n=this._gameObjectDataList.findBodyByGameObject(t);return n?void(n[e]=r):null},e.prototype._getVec3Data=function(e,r){var n=this._gameObjectDataList.findBodyByGameObject(e);return n?t.CannonUtils.convertToWonderVector3(n[r]):null},e.prototype._setVec3Data=function(e,r,n){var o=this._gameObjectDataList.findBodyByGameObject(e);return o?void(o[r]=t.CannonUtils.convertToCannonVector3(n)):null},e.prototype._getMaterialData=function(t,e){var r=this._getMaterial(t);return r?this._materialList.getContactMaterialData(this.world,r,e):null},e.prototype._setMaterialData=function(e,r,n){var o=(this.world,this._getMaterial(e));return o?void this._materialList.setContactMaterialData(this.world,o,r,n):void t.Log.warn("no material find, please add material first")},__decorate([t.require(function(e,r){var n=[],o=null,i=this._getMaterial(e);if(!i)return null;n=this._materialList.getContactMaterials(this.world,i),o=n[0];for(var a=0;a<n.length;a++){var s=n[a];t.assert(s===o,t.Log.info.FUNC_SHOULD("the data of contact material which contains the same material","be the same"))}})],e.prototype,"_getMaterialData",null),e}();t.CannonAdapter=e}(wd||(wd={}));var __decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(){function e(t,e,r){this.world=null,this.materialList=null,this.gameObjectList=null,this.world=t,this.gameObjectList=e,this.materialList=r}return e.prototype.addBody=function(e,r){var n=this.createBody(r);return r.children.getCount()>0?this._addCompounds(e,r.children,n):n.addShape(this._createShape(e.getComponent(t.Collider).shape)),this.afterAddShape(n,r),n.material=this._createMaterial(e,r.friction,r.restitution),n.position=t.CannonUtils.convertToCannonVector3(r.position),n.quaternion=t.CannonUtils.convertToCannonQuaternion(r.rotation),this.world.addBody(n),this.gameObjectList.add(e,n),this._bindCollideEvent(n,r.onCollisionStart,r.onContact,r.onCollisionEnd),n},e.prototype.afterAddShape=function(t,e){},e.prototype._createShape=function(e){var r=null;return e instanceof t.AABBShape?r=new CANNON.Box(t.CannonUtils.convertToCannonVector3(e.halfExtents)):e instanceof t.SphereShape&&(r=new CANNON.Sphere(e.radius)),r},e.prototype._bindCollideEvent=function(t,e,r,n){var o=this;t.addEventListener("collide",function(t){var i=o.gameObjectList.findGameObjectByBody(t.body),a=null;i&&(a=i,e(a),r(a),n(a))})},e.prototype._createMaterial=function(t,e,r){var n=null,o=null;return(n=this._getMaterial(t))?n:(o=new CANNON.Material("material"),this._addMaterial(t,o,e,r),o)},e.prototype._getMaterial=function(t){return this.materialList.findMaterialByGameObject(t)},e.prototype._addMaterial=function(t,e,r,n){this.materialList.add(t,e),this.materialList.addContactMaterial(this.world,e,r,n)},e.prototype._addCompounds=function(e,r,n){var o=this,i=e.transform.position,a=e.transform.rotation;r.forEach(function(e){n.addShape(o._createShape(e.getComponent(t.Collider).shape),t.CannonUtils.convertToCannonVector3(e.transform.position.copy().sub(i)),t.CannonUtils.convertToCannonQuaternion(e.transform.rotation.copy().sub(a)))},this)},__decorate([t.virtual],e.prototype,"afterAddShape",null),__decorate([t.require(function(e,r,n){r.forEach(function(e){t.assert(!!e.getComponent(t.Collider),t.Log.info.FUNC_MUST_DEFINE("collider component")),t.assert(!!e.getComponent(t.Collider).shape,t.Log.info.FUNC_SHOULD("create collider.shape"))})})],e.prototype,"_addCompounds",null),e}();t.CannonBody=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.create=function(t,e,r){var n=new this(t,e,r);return n},r.prototype.createBody=function(e){var r=e.mass,n=e.linearDamping,o=e.angularDamping,i=e.velocity,a=e.angularVelocity;return new CANNON.Body({mass:r,linearDamping:n,angularDamping:o,velocity:t.CannonUtils.convertToCannonVector3(i),angularVelocity:t.CannonUtils.convertToCannonVector3(a)})},r.prototype.afterAddShape=function(e,r){var n=r.impulse,o=r.force,i=r.hitPoint;n&&i&&e.applyImpulse(t.CannonUtils.convertToCannonVector3(n),t.CannonUtils.convertToCannonVector3(i)),o&&i&&e.applyForce(t.CannonUtils.convertToCannonVector3(o),t.CannonUtils.convertToCannonVector3(i))},r}(t.CannonBody);t.CannonDynamicBody=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.create=function(t,e,r){var n=new this(t,e,r);return n},r.prototype.createBody=function(e){var r=e.mass,n=e.velocity,o=e.angularVelocity;return new CANNON.Body({type:CANNON.Body.KINEMATIC,mass:r,velocity:t.CannonUtils.convertToCannonVector3(n),angularVelocity:t.CannonUtils.convertToCannonVector3(o)})},r}(t.CannonBody);t.CannonKinematicBody=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.create=function(t,e,r){var n=new this(t,e,r);return n},e.prototype.createBody=function(t){return new CANNON.Body({mass:0})},e}(t.CannonBody);t.CannonStaticBody=e}(wd||(wd={}));var __decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(){function e(t,e,r){this.world=null,this.gameObjectList=null,this.constraintDataList=null,this.world=t,this.gameObjectList=e,this.constraintDataList=r}return e.prototype.addConstraint=function(t,e){var r=null,n=this.gameObjectList.findBodyByGameObject(t);r=this.createCannonConstraint(n,e),this.world.addConstraint(r),this.addToConstraintDataList(t,e,r)},e.prototype.findBody=function(t){return this.gameObjectList.findBodyByGameObject(t.gameObject)},__decorate([t.require(function(e,r){t.assert(null!==this.gameObjectList.findBodyByGameObject(e),t.Log.info.FUNC_SHOULD("add rigid body")),t.assert(this.findBody(r.connectedBody),t.Log.info.FUNC_SHOULD("add connectedBody"))})],e.prototype,"addConstraint",null),e}();t.CannonConstraint=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.removeConstraint=function(t){var e=this.constraintDataList.findConstraintByGameObject(t);e&&this.world.removeConstraint(e),this.constraintDataList.remove(t)},e.prototype.addToConstraintDataList=function(t,e,r){this.constraintDataList.add(t,r)},e}(t.CannonConstraint);t.CannonSingleConstraint=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.create=function(t,e,r){var n=new this(t,e,r);return n},e.prototype.createCannonConstraint=function(t,e){var r=null,n=this.findBody(e.connectedBody);return r=e.maxForce?new CANNON.LockConstraint(t,n,e.maxForce):new CANNON.LockConstraint(t,n)},e}(t.CannonSingleConstraint);t.CannonLockConstraint=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.create=function(t,e,r){var n=new this(t,e,r);return n},r.prototype.removeConstraint=function(t){var e=this.constraintDataList.findCannonConstraintByPointToPointConstraint(t);e&&this.world.removeConstraint(e),this.constraintDataList.remove(t)},r.prototype.createCannonConstraint=function(e,r){var n=null,o=this.findBody(r.connectedBody),i=t.CannonUtils.convertToCannonVector3(r.pivotA),a=t.CannonUtils.convertToCannonVector3(r.pivotB);return n=r.maxForce?new CANNON.PointToPointConstraint(e,i,o,a,r.maxForce):new CANNON.PointToPointConstraint(e,i,o,a)},r.prototype.addToConstraintDataList=function(t,e,r){this.constraintDataList.add(t,e,r)},r}(t.CannonConstraint);t.CannonPointToPointConstraint=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.create=function(t,e,r){var n=new this(t,e,r);return n},e.prototype.createCannonConstraint=function(t,e){var r=null,n=this.findBody(e.connectedBody);return r=new CANNON.DistanceConstraint(t,n,null!==e.distance?e.distance:void 0,null!==e.maxForce?e.maxForce:void 0)},e}(t.CannonSingleConstraint);t.CannonDistanceConstraint=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.create=function(t,e,r){var n=new this(t,e,r);return n},r.prototype.createCannonConstraint=function(e,r){var n=null,o=this.findBody(r.connectedBody),i=t.CannonUtils.convertToCannonVector3(r.pivotA),a=t.CannonUtils.convertToCannonVector3(r.axisA),s=t.CannonUtils.convertToCannonVector3(r.pivotB),c=t.CannonUtils.convertToCannonVector3(r.axisB),u={};return r.pivotA&&(u.pivotA=i),r.axisA&&(u.axisA=a),r.pivotB&&(u.pivotB=s),r.axisB&&(u.axisB=c),r.maxForce&&(u.maxForce=r.maxForce),n=new CANNON.HingeConstraint(e,o,u)},r}(t.CannonSingleConstraint);t.CannonHingeConstraint=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.create=function(){var t=new this;return t},e.prototype.init=function(){},e.prototype.dispose=function(){},e.prototype.isPick=function(t,e){return!0},e}(t.Component);t.Pick=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(t){void 0===t&&(t=null),e.call(this),this.url=null,this.url=t}return __extends(r,e),r.create=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];if(0===t.length)return new this;if(1===t.length){var r=t[0];return new this(r)}},r.addScript=function(t,e){this.script.push({name:t,"class":e})},r.prototype.createLoadJsStream=function(){return t.Log.error(!this.url,t.Log.info.FUNC_MUST_DEFINE("url")),t.LoaderManager.getInstance().load(this.url).map(function(){return r.script.pop()})},r.prototype.addToGameObject=function(r){var n=this;e.prototype.addToGameObject.call(this,r),t.Director.getInstance().scriptStreams.addChild(this.uid.toString(),this.createLoadJsStream()["do"](function(t){n._addScriptToGameObject(r,t)}))},r.prototype.removeFromGameObject=function(r){e.prototype.removeFromGameObject.call(this,r),t.Director.getInstance().scriptStreams.removeChild(this.uid.toString())},r.prototype._addScriptToGameObject=function(t,e){t.script.addChild(e.name,new e["class"](t))},r.script=wdCb.Stack.create(),r}(t.Component);t.Script=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this._shadowMapWidth=null,this._shadowMapHeight=null,this.color=t.Color.create("#ffffff"),this.castShadow=!1,this.shadowCameraNear=.1,this.shadowCameraFar=5e3,this.shadowBias=t.ShaderChunk.NULL,this.shadowDarkness=0,this.shadowMap=null,this.shadowMapRenderer=null}return __extends(r,e),Object.defineProperty(r.prototype,"position",{get:function(){return this.gameObject.transform.position},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"shadowMapWidth",{get:function(){var e=t.GPUDetector.getInstance().maxCubemapTextureSize;return!this._shadowMapWidth||this._shadowMapWidth>e?e:this._shadowMapWidth},set:function(t){this._shadowMapWidth=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"shadowMapHeight",{get:function(){var e=t.GPUDetector.getInstance().maxCubemapTextureSize;return!this._shadowMapHeight||this._shadowMapHeight>e?e:this._shadowMapHeight},set:function(t){this._shadowMapHeight=t},enumerable:!0,configurable:!0}),r}(t.Component);t.Light=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.create=function(){var t=new this;return t},e.type="ambientLight",e}(t.Light);t.AmbientLight=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this._shadowRenderList=null,this.intensity=1,this.shadowCameraLeft=-1e3,this.shadowCameraRight=1e3,this.shadowCameraTop=1e3,this.shadowCameraBottom=-1e3,this._beforeInitHandler=null}return __extends(r,e),r.create=function(){var t=new this;return t.initWhenCreate(),t},Object.defineProperty(r.prototype,"shadowRenderList",{get:function(){return this._shadowRenderList},set:function(t){this._shadowRenderList=wdCb.Collection.create(t)},enumerable:!0,configurable:!0}),r.prototype.initWhenCreate=function(){var e=this;this._beforeInitHandler=wdCb.FunctionUtils.bind(this,function(){e.castShadow&&(e.shadowMap=t.TwoDShadowMapTexture.create(),e.shadowMapRenderer=t.TwoDShadowMapRenderTargetRenderer.create(e),t.Director.getInstance().scene.addRenderTargetRenderer(e.shadowMapRenderer))}),t.EventManager.on(t.EngineEvent.BEFORE_INIT,this._beforeInitHandler)},r.prototype.dispose=function(){this.castShadow&&(this.shadowMap.dispose(),t.Director.getInstance().scene.removeRenderTargetRenderer(this.shadowMapRenderer)),t.EventManager.off(t.EngineEvent.BEFORE_INIT,this._beforeInitHandler)},r.type="directionLight",r.defaultPosition=t.Vector3.create(0,0,1),r}(t.Light);t.DirectionLight=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){
var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this._rangeLevel=null,this._shadowRenderList=wdCb.Hash.create(),this.intensity=1,this._attenuation=t.Attenuation.create(),this._beforeInitHandler=null}return __extends(r,e),r.create=function(){var t=new this;return t.initWhenCreate(),t},Object.defineProperty(r.prototype,"rangeLevel",{get:function(){return this._rangeLevel},set:function(t){this._rangeLevel=t,this._attenuation.rangeLevel=this._rangeLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"range",{get:function(){return this._attenuation.range},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"constant",{get:function(){return this._attenuation.constant},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"linear",{get:function(){return this._attenuation.linear},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"quadratic",{get:function(){return this._attenuation.quadratic},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"shadowRenderList",{get:function(){return this._shadowRenderList},set:function(t){t=t;for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];this._shadowRenderList.addChild(e,wdCb.Collection.create(r))}},enumerable:!0,configurable:!0}),r.prototype.initWhenCreate=function(){var e=this;this._beforeInitHandler=wdCb.FunctionUtils.bind(this,function(){e.castShadow&&(e.shadowMap=t.CubemapShadowMapTexture.create(),e.shadowMapRenderer=t.CubemapShadowMapRenderTargetRenderer.create(e),t.Director.getInstance().scene.addRenderTargetRenderer(e.shadowMapRenderer))}),t.EventManager.on(t.EngineEvent.BEFORE_INIT,this._beforeInitHandler)},r.prototype.dispose=function(){this.castShadow&&(this.shadowMap.dispose(),t.Director.getInstance().scene.removeRenderTargetRenderer(this.shadowMapRenderer))},r.type="pointLight",r}(t.Light);t.PointLight=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){this._range=null,this._linear=null,this._quadratic=null,this._rangeLevel=0}return e.create=function(){var t=new this;return t},Object.defineProperty(e.prototype,"constant",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"range",{get:function(){return this._range},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"linear",{get:function(){return this._linear},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"quadratic",{get:function(){return this._quadratic},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rangeLevel",{get:function(){return this._rangeLevel},set:function(t){this._rangeLevel=t,this.setByRangeLevel()},enumerable:!0,configurable:!0}),e.prototype.setByRangeLevel=function(){switch(this._rangeLevel){case 0:this._range=7,this._linear=.7,this._quadratic=1.8;break;case 1:this._range=13,this._linear=.35,this._quadratic=.44;break;case 2:this._range=20,this._linear=.22,this._quadratic=.2;break;case 3:this._range=32,this._linear=.14,this._quadratic=.07;break;case 4:this._range=50,this._linear=.09,this._quadratic=.032;break;case 5:this._range=65,this._linear=.07,this._quadratic=.017;break;case 6:this._range=100,this._linear=.045,this._quadratic=.0075;break;case 7:this._range=160,this._linear=.027,this._quadratic=.0028;break;case 8:this._range=200,this._linear=.022,this._quadratic=.0019;break;case 9:this._range=325,this._linear=.014,this._quadratic=7e-4;break;case 10:this._range=600,this._linear=.007,this._quadratic=2e-4;break;case 11:this._range=3250,this._linear=.0014,this._quadratic=7e-6;break;default:t.Log.error(!0,"over light range")}},e}();t.Attenuation=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.isView=function(t){return!!t&&t.offset&&t.width&&t.height&&this.isFunction(t.getContext)},e.isEqual=function(t,e){return t.uid&&e.uid?t.uid===e.uid:t===e},e.isPowerOfTwo=function(t){return 0===(t&t-1)&&0!==t},e.isFloatArray=function(t){return"[object Float32Array]"===Object.prototype.toString.call(t)||"[object Float16Array]"===Object.prototype.toString.call(t)},e}(wdCb.JudgeUtils);t.JudgeUtils=e}(wd||(wd={}));var wd;!function(t){var e=function(){function t(){}return t.clamp=function(t,e,r){return e>t?e:t>r?r:t},t.bigThan=function(t,e){return e>t?e:t},t}();t.MathUtils=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(wdCb.Log);t.Log=e}(wd||(wd={}));var wd;!function(t){var e=function(){function t(){this.elapsed=null,this.pauseElapsed=0,this.pauseTime=null,this.startTime=null}return t.prototype.start=function(){this.startTime=this.getNow(),this.pauseElapsed=null},t.prototype.stop=function(){this.startTime=null},t.prototype.pause=function(){this.pauseTime=this.getNow()},t.prototype.resume=function(){this.pauseElapsed+=this.getNow()-this.pauseTime,this.pauseTime=null},t.prototype.computeElapseTime=function(t){return this.pauseElapsed?(this.elapsed=t-this.pauseElapsed-this.startTime,this.elapsed):(this.elapsed=t-this.startTime,this.elapsed)},t}();t.TimeController=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=60,r=1e3,n=function(n){function o(){n.apply(this,arguments),this.gameTime=null,this.fps=null,this.isTimeChange=!1,this.deltaTime=null,this._lastTime=null}return __extends(o,n),o.create=function(){var t=new this;return t},o.prototype.tick=function(t){this.deltaTime=null!==this._lastTime?t-this._lastTime:t,this._updateFps(this.deltaTime),this.gameTime=t/r,this._lastTime=t},o.prototype.start=function(){n.prototype.start.call(this),this.isTimeChange=!0,this.elapsed=0},o.prototype.resume=function(){n.prototype.resume.call(this),this.isTimeChange=!0},o.prototype.getNow=function(){return t.root.performance.now()},o.prototype._updateFps=function(t){null===this._lastTime?this.fps=e:this.fps=1e3/t},o}(t.TimeController);t.DirectorTimeController=n}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.getNow=function(){return t.Director.getInstance().isTimeChange?t.Director.getInstance().elapsed:t.root.performance.now()},r}(t.TimeController);t.CommonTimeController=e}(wd||(wd={}));var __decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(){function e(t){this.texture=null,this.frameBufferOperator=null,this.texture=t}return e.prototype.initWhenCreate=function(){this.frameBufferOperator=t.FrameBuffer.create(this.texture.width,this.texture.height)},e.prototype.init=function(){this.texture.createEmptyTexture(),this.initFrameBuffer()},e.prototype.render=function(t,e){this.beforeRender(),this.renderFrameBufferTexture(t,e),this.afterRender()},e.prototype.dispose=function(){this.frameBufferOperator.dispose(),this.disposeFrameBuffer(),this.texture.dispose()},e.prototype.beforeRender=function(){},e.prototype.afterRender=function(){},__decorate([t.virtual],e.prototype,"beforeRender",null),__decorate([t.virtual],e.prototype,"afterRender",null),e}();t.RenderTargetRenderer=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.frameBuffer=null,this.renderBuffer=null}return __extends(r,e),r.prototype.initFrameBuffer=function(){var e=this.frameBufferOperator,r=t.DeviceManager.getInstance().gl;this.frameBuffer=e.createFrameBuffer(),this.renderBuffer=e.createRenderBuffer(),e.bindFrameBuffer(this.frameBuffer),e.attachTexture(r.TEXTURE_2D,this.texture.glTexture),e.attachRenderBuffer("DEPTH_ATTACHMENT",this.renderBuffer),e.check(),e.unBind()},r.prototype.renderFrameBufferTexture=function(t,e){var r=this.createCamera(e);this.beforeRenderFrameBufferTexture(r),this.frameBufferOperator.bindFrameBuffer(this.frameBuffer),this.texture.bindToUnit(0),this.frameBufferOperator.setViewport(),this.getRenderList().forEach(function(e){e.render(t,r)}),this.renderRenderer(t),this.frameBufferOperator.unBind(),this.frameBufferOperator.restoreViewport()},r.prototype.disposeFrameBuffer=function(){var e=t.DeviceManager.getInstance().gl;e.deleteFramebuffer(this.frameBuffer),e.deleteRenderbuffer(this.renderBuffer)},r}(t.RenderTargetRenderer);t.TwoDRenderTargetRenderer=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.create=function(t){var e=new this(t);return e.initWhenCreate(),e},r.prototype.beforeRenderFrameBufferTexture=function(t){},r.prototype.getRenderList=function(){return this.texture.renderList},r.prototype.renderRenderer=function(e){this._setSceneSide(t.Side.BACK),e.render(),this._setSceneSide(null)},r.prototype.createCamera=function(e){var r=null,n=null,o=e.getComponent(t.CameraController),i=null,a=null;return n=this.texture.getPlane(),i=n.getReflectionMatrix().applyMatrix(o.worldToCameraMatrix),a=this._setClipPlane(i,o.pMatrix,n),r=t.PerspectiveCamera.create(),r.worldToCameraMatrix=i.copy(),r.pMatrix=a,t.GameObject.create().addComponent(t.BasicCameraController.create(r)).init()},r.prototype._setSceneSide=function(e){var r=t.Director.getInstance().scene;r.side=e},r.prototype._setClipPlane=function(e,r,n){var o=r.copy(),i=t.Vector4.create(),a=this._getClipPlaneInCameraSpace(e,n),s=t.Vector4.create();return i.x=(Math.sign(a.x)+o.values[8])/o.values[0],i.y=(Math.sign(a.y)+o.values[9])/o.values[5],i.z=-1,i.w=(1+o.values[10])/o.values[14],s=a.multiplyScalar(2/a.dot(i)),o.values[2]=s.x,o.values[6]=s.y,o.values[10]=s.z+1,o.values[14]=s.w,o},r.prototype._getClipPlaneInCameraSpace=function(e,r){var n=t.Vector4.create(),o=e.multiplyVector3(this.texture.getPosition()),i=e.copy().invert().transpose().multiplyVector3(r.normal).normalize();return n.set(i.x,i.y,i.z,-o.dot(i)),n},r}(t.TwoDRenderTargetRenderer);t.MirrorRenderTargetRenderer=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(t){e.call(this,t.shadowMap),this._light=null,this._shadowMapRendererUtils=null,this._light=t}return __extends(r,e),r.create=function(t){var e=new this(t);return e.initWhenCreate(),e},r.prototype.initWhenCreate=function(){this._shadowMapRendererUtils=t.TwoDShadowMapRenderTargetRendererUtils.create(this._light,this.texture),e.prototype.initWhenCreate.call(this)},r.prototype.init=function(){var r=this;this._handleShadowRendererList(),this._shadowMapRendererUtils.bindEndLoop(function(){r._light.shadowRenderList.forEach(function(t){r._shadowMapRendererUtils.clearTwoDShadowMapData(t)})}),this._shadowMapRendererUtils.createShaderWithShaderLib(t.BuildTwoDShadowMapShaderLib.create()),e.prototype.init.call(this)},r.prototype.dispose=function(){e.prototype.dispose.call(this),this._shadowMapRendererUtils.unBindEndLoop()},r.prototype.beforeRenderFrameBufferTexture=function(t){var e=this;this._light.shadowRenderList.removeRepeatItems().forEach(function(r){e._shadowMapRendererUtils.setShadowMapData(r,t)})},r.prototype.getRenderList=function(){return this._light.shadowRenderList},r.prototype.renderRenderer=function(t){t.render()},r.prototype.beforeRender=function(){this._shadowMapRendererUtils.beforeRender()},r.prototype.afterRender=function(){this._shadowMapRendererUtils.afterRender()},r.prototype.createCamera=function(){var e=t.OrthographicCamera.create(),r=this._light,n=t.GameObject.create();return e.left=r.shadowCameraLeft,e.right=r.shadowCameraRight,e.top=r.shadowCameraTop,e.bottom=r.shadowCameraBottom,e.near=r.shadowCameraNear,e.far=r.shadowCameraFar,n.addComponent(t.BasicCameraController.create(e)),n.transform.translate(r.position),n.transform.lookAt(0,0,0),n.init(),n},r.prototype._handleShadowRendererList=function(){var t=this,e=this,r=[];this._light.shadowRenderList.forEach(function(e){r=r.concat(t._shadowMapRendererUtils.addAllChildren(e))},this),this._light.shadowRenderList.addChildren(r),this._light.shadowRenderList.removeChild(function(t){return e._shadowMapRendererUtils.isContainer(t)})},r}(t.TwoDRenderTargetRenderer);t.TwoDShadowMapRenderTargetRenderer=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this._frameBuffers=wdCb.Collection.create(),this._renderBuffers=wdCb.Collection.create()}return __extends(r,e),r.prototype.initFrameBuffer=function(){for(var e=this.frameBufferOperator,r=t.DeviceManager.getInstance().gl,n=0;6>n;n++){var o=e.createFrameBuffer(),i=e.createRenderBuffer();this._frameBuffers.addChild(o),this._renderBuffers.addChild(i),e.bindFrameBuffer(o),e.attachTexture(r.TEXTURE_CUBE_MAP_POSITIVE_X+n,this.texture.glTexture),e.attachRenderBuffer("DEPTH_ATTACHMENT",i),e.check()}e.unBind()},r.prototype.renderFrameBufferTexture=function(t,e){var r=null,n=null,o=null,i=null;for(i=this.getRenderList(),this.texture.bindToUnit(0),r=0;6>r;r++)o=i.getChild(this._convertIndexToFaceKey(r)),this._isEmpty(o)||(n=this.createCamera(r),this.frameBufferOperator.bindFrameBuffer(this._frameBuffers.getChild(r)),this.frameBufferOperator.setViewport(),o.forEach(function(e){e.render(t,n)}),t.render());this.frameBufferOperator.unBind(),this.frameBufferOperator.restoreViewport()},r.prototype.disposeFrameBuffer=function(){var e=t.DeviceManager.getInstance().gl;this._frameBuffers.forEach(function(t){return e.deleteFramebuffer(t)}),this._renderBuffers.forEach(function(t){return e.deleteRenderbuffer(t)})},r.prototype.createCamera=function(e){var r=t.PerspectiveCamera.create(),n=t.GameObject.create(),o=this.getPosition();return r.fovy=90,this.setCamera(r),n.addComponent(t.BasicCameraController.create(r)),n.transform.translate(o),this._lookAtFace(n,o,e),n.init(),n},r.prototype._isEmpty=function(t){return!t||t.length&&0===t.length||t.getCount&&0===t.getCount()},r.prototype._convertIndexToFaceKey=function(t){var e=null;switch(t){case 0:e="px";break;case 1:e="nx";break;case 2:e="py";break;case 3:e="ny";break;case 4:e="pz";break;case 5:e="nz"}return e},r.prototype._lookAtFace=function(t,e,r){switch(r){case 0:t.transform.lookAt(e.x+1,e.y,e.z,0,-1,0);break;case 1:t.transform.lookAt(e.x-1,e.y,e.z,0,-1,0);break;case 2:t.transform.lookAt(e.x,e.y+1,e.z,0,0,1);break;case 3:t.transform.lookAt(e.x,e.y-1,e.z,0,0,-1);break;case 4:t.transform.lookAt(e.x,e.y,e.z+1,0,-1,0);break;case 5:t.transform.lookAt(e.x,e.y,e.z-1,0,-1,0)}},r}(t.RenderTargetRenderer);t.CubemapRenderTargetRenderer=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(t){e.call(this,t.shadowMap),this._light=null,this._shadowMapRendererUtils=null,this._light=t}return __extends(r,e),r.create=function(t){var e=new this(t);return e.initWhenCreate(),e},r.prototype.initWhenCreate=function(){this._shadowMapRendererUtils=t.CubemapShadowMapRenderTargetRendererUtils.create(this._light,this.texture),e.prototype.initWhenCreate.call(this)},r.prototype.init=function(){var r=this;this._handleShadowRendererList(),this._shadowMapRendererUtils.bindEndLoop(function(){r._light.shadowRenderList.forEach(function(t){t.forEach(function(t){r._shadowMapRendererUtils.clearCubemapShadowMapData(t)})})}),this._shadowMapRendererUtils.createShaderWithShaderLib(t.BuildCubemapShadowMapShaderLib.create()),e.prototype.init.call(this)},r.prototype.dispose=function(){e.prototype.dispose.call(this),this._shadowMapRendererUtils.unBindEndLoop()},r.prototype.getRenderList=function(){return this._light.shadowRenderList},r.prototype.beforeRender=function(){var t=this._shadowMapRendererUtils;this._convertRenderListToCollection(this.getRenderList()).removeRepeatItems().forEach(function(e){t.setShadowMapData(e)}),this._shadowMapRendererUtils.beforeRender()},r.prototype.afterRender=function(){this._shadowMapRendererUtils.afterRender()},r.prototype.setCamera=function(t){var e=this._light;t.aspect=e.shadowMapWidth/e.shadowMapHeight,t.near=e.shadowCameraNear,t.far=e.shadowCameraFar},r.prototype.getPosition=function(){return this._light.position},r.prototype._convertRenderListToCollection=function(t){var e=wdCb.Collection.create();return t.forEach(function(t){e.addChildren(t)}),e},r.prototype._handleShadowRendererList=function(){var t=this,e=wdCb.Hash.create();this._light.shadowRenderList.forEach(function(r,n){var o=[];r.forEach(function(e){o=o.concat(t._shadowMapRendererUtils.addAllChildren(e))}),e.addChild(n,o)},this),this._light.shadowRenderList.forEach(function(t,r){t.addChildren(e.getChild(r))}),this._light.shadowRenderList.forEach(function(e){e.removeChild(function(e){return t._shadowMapRendererUtils.isContainer(e)})})},r}(t.CubemapRenderTargetRenderer);t.CubemapShadowMapRenderTargetRenderer=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.create=function(t){var e=new this(t);return e.initWhenCreate(),e},e.prototype.getRenderList=function(){return this.texture.renderList},e.prototype.setCamera=function(t){t.aspect=1,t.near=this.texture.near,t.far=this.texture.far},e.prototype.getPosition=function(){return this.texture.getPosition()},e}(t.CubemapRenderTargetRenderer);t.DynamicCubemapRenderTargetRenderer=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(t,e){this.texture=null,this.light=null,this._endLoopHandler=null,this._shader=null,this.light=t,this.texture=e}return e.prototype.initWhenCreate=function(){this.texture.width=this.light.shadowMapWidth,this.texture.height=this.light.shadowMapHeight},e.prototype.init=function(){this.texture.init()},e.prototype.setShadowMapData=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=e[0],o=n.getComponent(t.Geometry).material,i=null;2===e.length&&(i=e[1]),t.Log.error(!(o instanceof t.LightMaterial),t.Log.info.FUNC_MUST_BE("material","LightMaterial when set shadowMap")),this.setMaterialShadowMapData(o,n,i)},e.prototype.bindEndLoop=function(e){this._endLoopHandler=e,t.EventManager.on(t.EngineEvent.ENDLOOP,this._endLoopHandler)},e.prototype.unBindEndLoop=function(){t.EventManager.off(t.EngineEvent.ENDLOOP,this._endLoopHandler)},e.prototype.beforeRender=function(){var e=t.Director.getInstance().scene;e.useProgram(this._shader)},e.prototype.afterRender=function(){var e=t.Director.getInstance().scene;e.unUseProgram()},e.prototype.createShaderWithShaderLib=function(e){this._shader=t.Shader.create(),this._shader.addLib(t.CommonShaderLib.create()),this._shader.addLib(t.CommonVerticeShaderLib.create()),this._shader.addLib(e)},e.prototype.isContainer=function(e){return!e.hasComponent(t.Geometry)},e.prototype.addAllChildren=function(t){var e=[],r=function(t){t.forEach(function(t){e.push(t),r(t)})};return r(t),e},e.prototype.setShadowMap=function(e,r){var n=null;e.hasComponent(t.Geometry)&&(n=e.getComponent(t.Geometry).material,n.hasShadowMap(r)||(t.Log.error(!(n instanceof t.LightMaterial),t.Log.info.FUNC_MUST_BE("material","LightMaterial when set shadowMap")),this.addShadowMap(n,r)))},e}();t.ShadowMapRenderTargetRendererUtils=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.create=function(t,e){var r=new this(t,e);return r.initWhenCreate(),r},r.prototype.initWhenCreate=function(){var t=this;e.prototype.initWhenCreate.call(this),this.light.shadowRenderList.forEach(function(e){e.forEach(function(e){t.setShadowMap(e,t.texture)})})},r.prototype.clearCubemapShadowMapData=function(e){var r=e.getComponent(t.Geometry).material;r.clearCubemapShadowMapData()},r.prototype.setMaterialShadowMapData=function(t,e,r){t.addCubemapShadowMapData({shadowBias:this.light.shadowBias,shadowDarkness:this.light.shadowDarkness,lightPos:this.light.position,farPlane:this.light.shadowCameraFar}),t.buildCubemapShadowMapData={lightPos:this.light.position,farPlane:this.light.shadowCameraFar}},r.prototype.addShadowMap=function(t,e){t.addCubemapShadowMap(e)},__decorate([t.require(function(e){var r=e.getComponent(t.Geometry).material;t.assert(r instanceof t.LightMaterial,t.Log.info.FUNC_MUST_BE("material","LightMaterial when set shadowMap"))})],r.prototype,"clearCubemapShadowMapData",null),r}(t.ShadowMapRenderTargetRendererUtils);t.CubemapShadowMapRenderTargetRendererUtils=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.create=function(t,e){var r=new this(t,e);return r.initWhenCreate(),r},r.prototype.initWhenCreate=function(){var t=this;e.prototype.initWhenCreate.call(this),this.light.shadowRenderList.forEach(function(e){t.setShadowMap(e,t.texture)})},r.prototype.clearTwoDShadowMapData=function(e){var r=e.getComponent(t.Geometry).material;r.clearTwoDShadowMapData()},r.prototype.setMaterialShadowMapData=function(e,r,n){var o=n.getComponent(t.CameraController);e.addTwoDShadowMapData({shadowBias:this.light.shadowBias,shadowDarkness:this.light.shadowDarkness,shadowSize:[this.light.shadowMapWidth,this.light.shadowMapHeight],lightPos:this.light.position,vpMatrixFromLight:o.worldToCameraMatrix.applyMatrix(o.pMatrix)}),e.buildTwoDShadowMapData={vpMatrixFromLight:o.worldToCameraMatrix.applyMatrix(o.pMatrix)}},r.prototype.addShadowMap=function(t,e){t.addTwoDShadowMap(e)},__decorate([t.require(function(e){var r=e.getComponent(t.Geometry).material;t.assert(r instanceof t.LightMaterial,t.Log.info.FUNC_MUST_BE("material","LightMaterial when set shadowMap"))})],r.prototype,"clearTwoDShadowMapData",null),r}(t.ShadowMapRenderTargetRendererUtils);t.TwoDShadowMapRenderTargetRendererUtils=e}(wd||(wd={}));var wd;!function(t){var e=function(){function t(){this.skyboxCommand=null}return t.prototype.init=function(){},t}();t.Renderer=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this._commandQueue=wdCb.Collection.create(),this._clearOptions={color:t.Color.create("#000000")}}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.createQuadCommand=function(){return t.QuadCommand.create()},r.prototype.addCommand=function(t){this._commandQueue.hasChild(t)||(this._commandQueue.addChild(t),t.init())},r.prototype.render=function(){var e=t.DeviceManager.getInstance();e.clear(this._clearOptions),this._renderOpaqueCommands(),e.depthWrite=!1,this._renderSortedTransparentCommands(),e.depthWrite=!0,this.skyboxCommand&&(e.depthFunc=t.DepthFunction.LEQUAL,this.skyboxCommand.execute(),e.depthFunc=t.DepthFunction.LESS),this._clearCommand()},r.prototype.init=function(){var e=t.DeviceManager.getInstance();e.depthTest=!0,e.blend=!1,e.setColorWrite(!0,!0,!0,!0),e.side=t.Side.FRONT,e.depthWrite=!0},r.prototype.setClearColor=function(t){this._setClearOptions({color:t})},r.prototype._renderOpaqueCommands=function(){this._commandQueue.removeChild(function(t){return!t.material.blend}).forEach(function(t){t.execute()})},r.prototype._renderSortedTransparentCommands=function(){var t=this;this._commandQueue.sort(function(e,r){return t._getObjectToCameraZDistance(r)-t._getObjectToCameraZDistance(e)}).forEach(function(t){t.execute()})},r.prototype._getObjectToCameraZDistance=function(e){return t.Director.getInstance().scene.camera.transform.position.z-e.z},r.prototype._clearCommand=function(){this._commandQueue.removeAllChildren(),this.skyboxCommand=null},r.prototype._setClearOptions=function(t){wdCb.ExtendUtils.extend(this._clearOptions,t)},r}(t.Renderer);t.WebGLRenderer=e}(wd||(wd={}));var wd;!function(t){!function(t){t[t.TRIANGLES="TRIANGLES"]="TRIANGLES",t[t.LINES="LINES"]="LINES"}(t.DrawMode||(t.DrawMode={}));t.DrawMode}(wd||(wd={}));var wd;!function(t){!function(t){t[t.UNSIGNED_BYTE="UNSIGNED_BYTE"]="UNSIGNED_BYTE",t[t.SHORT="SHORT"]="SHORT",t[t.UNSIGNED_SHORT="UNSIGNED_SHORT"]="UNSIGNED_SHORT",t[t.INT="INT"]="INT",t[t.UNSIGNED_INT="UNSIGNED_INT"]="UNSIGNED_INT",t[t.FLOAT="FLOAT"]="FLOAT"}(t.BufferType||(t.BufferType={}));t.BufferType}(wd||(wd={}));var wd;!function(t){!function(t){t[t.VERTICE="VERTICE"]="VERTICE",t[t.INDICE="INDICE"]="INDICE",t[t.NORMAL="NORMAL"]="NORMAL",t[t.TEXCOORD="TEXCOORD"]="TEXCOORD",t[t.TANGENT="TANGENT"]="TANGENT",t[t.COLOR="COLOR"]="COLOR"}(t.BufferDataType||(t.BufferDataType={}));t.BufferDataType}(wd||(wd={}));var wd;!function(t){!function(t){t[t.STREAM_DRAW="STREAM_DRAW"]="STREAM_DRAW",t[t.STATIC_DRAW="STATIC_DRAW"]="STATIC_DRAW",t[t.DYNAMIC_DRAW="DYNAMIC_DRAW"]="DYNAMIC_DRAW"}(t.BufferUsage||(t.BufferUsage={}));t.BufferUsage}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){this.buffer=null,this.type=null,this.count=null}return e.prototype.dispose=function(){t.DeviceManager.getInstance().gl.deleteBuffer(this.buffer),delete this.buffer},e}();t.Buffer=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this._typeSize=null,this.data=null,this._type=null}return __extends(r,e),r.create=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var r=new this;return r.initWhenCreate.apply(r,t),r},Object.defineProperty(r.prototype,"typeSize",{get:function(){return this._typeSize},enumerable:!0,configurable:!0}),r.prototype.initWhenCreate=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=t.DeviceManager.getInstance().gl;if(this.buffer=n.createBuffer(),!this.buffer)return t.Log.log("Failed to create the this.buffer object"),null;if(0!==e.length){var o=e[0],i=e[1],a=e[2]||t.BufferUsage.STATIC_DRAW;return o&&this._checkDataType(o,i)?(n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,o,n[a]),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),this.type=n[i],this._type=i,this.count=o.length,this.data=o,this._typeSize=this._getInfo(i).size,this.buffer):null}},r.prototype.resetData=function(e,r){void 0===r&&(r=this._type);var n=t.DeviceManager.getInstance().gl;return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.DYNAMIC_DRAW),this.type=n[r],this._type=r,this.data=e,this.count=e.length,this._typeSize=this._getInfo(r).size,this},r.prototype._checkDataType=function(t,e){var r=this._getInfo(e);return t instanceof r.typeClass},r.prototype._getInfo=function(e){var r=null;switch(e){case t.BufferType.UNSIGNED_BYTE:r={typeClass:Uint8Array,size:1};break;case t.BufferType.SHORT:r={typeClass:Int16Array,size:2};break;case t.BufferType.UNSIGNED_SHORT:r={typeClass:Uint16Array,size:2};break;case t.BufferType.INT:r={typeClass:Int32Array,size:4};break;case t.BufferType.UNSIGNED_INT:r={typeClass:Uint32Array,size:4};break;case t.BufferType.FLOAT:r={typeClass:Float32Array,size:4};break;default:t.Log.error(!0,t.Log.info.FUNC_INVALID("BufferType"))}return r},__decorate([t.require(function(e,r){void 0===r&&(r=this._type),t.assert(this.buffer,t.Log.info.FUNC_MUST("create gl buffer"))})],r.prototype,"resetData",null),r}(t.Buffer);t.ElementBuffer=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.size=null,this.data=null,this._type=null}return __extends(r,e),r.create=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var r=new this;return r.initWhenCreate.apply(r,t),r},r.prototype.initWhenCreate=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=t.DeviceManager.getInstance().gl;if(this.buffer=n.createBuffer(),!this.buffer)return t.Log.log("Failed to create the this.buffer object"),null;if(0!==e.length){var o=e[0],i=e[1],a=e[2],s=e[3]||t.BufferUsage.STATIC_DRAW;return o?(n.bindBuffer(n.ARRAY_BUFFER,this.buffer),
n.bufferData(n.ARRAY_BUFFER,o,n[s]),n.bindBuffer(n.ARRAY_BUFFER,null),this.size=i,this.type=n[a],this._type=a,this.count=o.length/i,this.data=o,this.buffer):null}},r.prototype.resetData=function(e,r,n){void 0===r&&(r=this.size),void 0===n&&(n=this._type);var o=t.DeviceManager.getInstance().gl;return o.bindBuffer(o.ARRAY_BUFFER,this.buffer),o.bufferData(o.ARRAY_BUFFER,e,o.DYNAMIC_DRAW),this.size=r,this.type=o[n],this._type=n,this.count=e.length/r,this.data=e,this},__decorate([t.require(function(e,r,n){void 0===r&&(r=this.size),void 0===n&&(n=this._type),t.assert(this.buffer,t.Log.info.FUNC_MUST("create gl buffer"))})],r.prototype,"resetData",null),r}(t.Buffer);t.ArrayBuffer=e}(wd||(wd={}));var wd;!function(t){var e=wdCb.Hash.create();e.addChild(t.BufferDataType.VERTICE,"vertices"),e.addChild(t.BufferDataType.INDICE,"indices"),e.addChild(t.BufferDataType.NORMAL,"normals"),e.addChild(t.BufferDataType.TEXCOORD,"texCoords"),e.addChild(t.BufferDataType.COLOR,"colors"),e.addChild(t.BufferDataType.TANGENT,"tangents");var r=function(){function r(){}return r.getGeometryDataName=function(r){var n=e.getChild(r);return t.Log.error(void 0===n,t.Log.info.FUNC_NOT_EXIST(r,"in BufferDataTable")),n},r}();t.BufferDataTable=r}(wd||(wd={}));var __decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(){function e(){this._program=null,this._shader=null}return e.create=function(){var t=new this;return t},e.prototype.use=function(){t.DeviceManager.getInstance().gl.useProgram(this._program)},e.prototype.getUniformLocation=function(e){return t.DeviceManager.getInstance().gl.getUniformLocation(this._program,e)},e.prototype.sendUniformData=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=t.DeviceManager.getInstance().gl,o=null,i=null,a=null;if(null===e[0]||e[0]instanceof WebGLUniformLocation)o=e[0];else{var s=e[0];o=this.getUniformLocation(s)}if(i=e[1],a=e[2],!this.isUniformDataNotExistByLocation(o)&&null!==a)switch(t.JudgeUtils.isFunction(a)&&(a=a()),i){case t.VariableType.FLOAT_1:n.uniform1f(o,a);break;case t.VariableType.FLOAT_2:n.uniform2f(o,a[0],a[1]);break;case t.VariableType.FLOAT_3:a=this._convertToVector3(a),n.uniform3f(o,a.x,a.y,a.z);break;case t.VariableType.FLOAT_4:a=this._convertToVector4(a),n.uniform4f(o,a.x,a.y,a.z,a.w);break;case t.VariableType.FLOAT_MAT3:n.uniformMatrix3fv(o,!1,a.values);break;case t.VariableType.FLOAT_MAT4:n.uniformMatrix4fv(o,!1,a.values);break;case t.VariableType.NUMBER_1:case t.VariableType.SAMPLER_CUBE:case t.VariableType.SAMPLER_2D:n.uniform1i(o,a);break;default:t.Log.error(!0,t.Log.info.FUNC_INVALID("VariableType:",i))}},e.prototype.sendUniformDataFromCustomShader=function(){var e=this;this._shader.uniforms.filter(function(e){return e.value!==t.VariableCategory.ENGINE}).forEach(function(r,n){if(r.type===t.VariableType.STRUCTURE){t.Log.error(!t.JudgeUtils.isDirectObject(r.value),t.Log.info.FUNC_MUST_BE("value's type","object{}"));for(var o in r.value)e.sendStructureData(n+"."+o,r.value[o].type,r.value[o].value)}else e.sendUniformData(n,r.type,r.value)})},e.prototype.sendAttributeData=function(e,r,n){var o=t.DeviceManager.getInstance().gl,i=null,a=null;if(i=o.getAttribLocation(this._program,e),-1!==i&&null!==n)switch(t.JudgeUtils.isFunction(n)?(a=n(),t.Log.error(!(n instanceof t.ArrayBuffer),t.Log.info.FUNC_MUST_BE("ArrayBuffer"))):a=n,r){case t.VariableType.BUFFER:o.bindBuffer(o.ARRAY_BUFFER,a.buffer),o.vertexAttribPointer(i,a.size,a.type,!1,0,0),o.enableVertexAttribArray(i);break;default:t.Log.error(!0,t.Log.info.FUNC_INVALID("VariableType:",r))}},e.prototype.sendAttributeDataFromCustomShader=function(){var e=this;this._shader.attributes.filter(function(e){return e.value!==t.VariableCategory.ENGINE}).forEach(function(t,r){e.sendAttributeData(r,e._convertAttributeDataType(t),t.value)})},e.prototype.sendStructureData=function(t,e,r){this.sendUniformData(t,e,r)},e.prototype.initWithShader=function(e){var r=t.DeviceManager.getInstance().gl,n=null,o=null;return this._program=t.DeviceManager.getInstance().gl.createProgram(),n=e.createVsShader(),o=e.createFsShader(),this._shader=e,r.attachShader(this._program,n),r.attachShader(this._program,o),r.bindAttribLocation(this._program,0,"a_position"),r.linkProgram(this._program),t.Log.error(r.getProgramParameter(this._program,r.LINK_STATUS)===!1,r.getProgramInfoLog(this._program)),r.deleteShader(n),r.deleteShader(o),this},e.prototype.dispose=function(){var e=t.DeviceManager.getInstance().gl;e.deleteProgram(this._program),this._program=void 0},e.prototype.isUniformDataNotExistByLocation=function(t){return null===t},e.prototype._convertAttributeDataType=function(e){return t.VariableType.BUFFER},e.prototype._convertToVector3=function(e){return t.JudgeUtils.isArray(e)?t.Vector3.create(e[0],e[1],e[2]):e},e.prototype._convertToVector4=function(e){return t.JudgeUtils.isArray(e)?t.Vector4.create(e[0],e[1],e[2],e[3]):e},__decorate([t.require(function(e){t.assert(t.JudgeUtils.isArray(e)||e instanceof t.Vector3,t.Log.info.FUNC_MUST_BE("shader->attributes->value","Array<Array<any>> or Array<Vector3> stucture"))})],e.prototype,"_convertToVector3",null),__decorate([t.require(function(e){t.assert(t.JudgeUtils.isArray(e)||e instanceof t.Vector4,t.Log.info.FUNC_MUST_BE("shader->attributes->value","Array<Array<any>> or Array<Vector4> stucture"))})],e.prototype,"_convertToVector4",null),e}();t.Program=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){this.buffers=null,this.mMatrix=null,this.vMatrix=null,this.pMatrix=null,this.drawMode=t.DrawMode.TRIANGLES,this.z=null,this.material=null,this.animation=null}return e.create=function(){var t=new this;return t},Object.defineProperty(e.prototype,"program",{get:function(){return this.material.program},enumerable:!0,configurable:!0}),e.prototype.execute=function(){this.material.updateTexture(),this.material.updateShader(this),this._draw()},e.prototype.init=function(){},e.prototype._draw=function(){var e=0,r=0,n=null,o=t.DeviceManager.getInstance().gl;if(this._setEffects(),this.buffers.hasChild(t.BufferDataType.INDICE)){var i=this.buffers.getChild(t.BufferDataType.INDICE);e=i.count,o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,i.buffer),o.drawElements(o[this.drawMode],e,i.type,i.typeSize*r)}else n=this.buffers.getChild(t.BufferDataType.VERTICE),e=n.count,o.drawArrays(o[this.drawMode],r,e)},e.prototype._setEffects=function(){var e=t.DeviceManager.getInstance(),r=this.material;e.setColorWrite(r.redWrite,r.greenWrite,r.blueWrite,r.alphaWrite),e.polygonOffsetMode=r.polygonOffsetMode,e.side=this._getSide(),e.blend=r.blend,r.blendFuncSeparate&&r.blendEquationSeparate?(e.setBlendFuncSeparate(r.blendFuncSeparate),e.setBlendEquationSeparate(r.blendEquationSeparate)):(wdCb.Log.error(!r.blendSrc||!r.blendDst||!r.blendEquation,wdCb.Log.info.FUNC_MUST("material.blendSrc || material.blendDst || material.blendEquation","be set")),e.setBlendFunc(r.blendSrc,r.blendDst),e.setBlendEquation(r.blendEquation))},e.prototype._getSide=function(){var e=t.Director.getInstance().scene;return e.side?e.side:this.material.side},e}();t.QuadCommand=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(t,e){this.width=null,this.height=null,this._originScissorTest=null,this.width=t,this.height=e}return e.create=function(t,e){var r=new this(t,e);return r},Object.defineProperty(e.prototype,"gl",{get:function(){return t.DeviceManager.getInstance().gl},enumerable:!0,configurable:!0}),e.prototype.createFrameBuffer=function(){return this.gl.createFramebuffer()},e.prototype.bindFrameBuffer=function(t){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t)},e.prototype.setViewport=function(){var e=t.DeviceManager.getInstance();e.setViewport(0,0,this.width,this.height),this._originScissorTest=e.scissorTest,e.scissorTest=!1},e.prototype.restoreViewport=function(){var e=t.DeviceManager.getInstance(),r=e.view;e.setViewport(0,0,r.width,r.height),e.scissorTest=this._originScissorTest},e.prototype.dispose=function(){this.unBind()},e.prototype.unBind=function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null)},e.prototype.createRenderBuffer=function(){var e=this.gl,r=e.createRenderbuffer();return t.Log.error(!r,"Failed to create renderbuffer object"),r},e.prototype.attachTexture=function(t,e){var r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,t,e,0)},e.prototype.attachRenderBuffer=function(t,e){var r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,e),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,this.width,this.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r[t],r.RENDERBUFFER,e)},e.prototype.check=function(){var e=this.gl,r=e.checkFramebufferStatus(e.FRAMEBUFFER);r!==e.FRAMEBUFFER_COMPLETE&&t.Log.error(!0,"Frame buffer object is incomplete:"+r.toString())},e}();t.FrameBuffer=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){this._attributes=wdCb.Hash.create(),this._uniforms=wdCb.Hash.create(),this._vsSource="",this._fsSource="",this.program=t.Program.create(),this._definitionDataDirty=!0,this._libs=wdCb.Collection.create(),this._sourceBuilder=t.ShaderSourceBuilder.create()}return e.create=function(){var t=new this;return t},Object.defineProperty(e.prototype,"attributes",{get:function(){return this._attributes},set:function(t){this._isNotEqual(t,this._attributes)&&(this._definitionDataDirty=!0),this._attributes=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uniforms",{get:function(){return this._uniforms},set:function(t){this._isNotEqual(t,this._uniforms)&&(this._definitionDataDirty=!0),this._uniforms=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vsSource",{get:function(){return this._vsSource},set:function(t){t!==this._vsSource&&(this._definitionDataDirty=!0),this._vsSource=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fsSource",{get:function(){return this._fsSource},set:function(t){t!==this._fsSource&&(this._definitionDataDirty=!0),this._fsSource=t},enumerable:!0,configurable:!0}),e.prototype.createVsShader=function(){var e=t.DeviceManager.getInstance().gl;return this._initShader(e.createShader(e.VERTEX_SHADER),this.vsSource)},e.prototype.createFsShader=function(){var e=t.DeviceManager.getInstance().gl;return this._initShader(e.createShader(e.FRAGMENT_SHADER),this.fsSource)},e.prototype.isEqual=function(t){return this.vsSource===t.vsSource&&this.fsSource===t.fsSource},e.prototype.init=function(){},e.prototype.update=function(t,e){var r=this.program;this.buildDefinitionData(t,e),this._definitionDataDirty&&(this.program.initWithShader(this),this._definitionDataDirty=!1),this.program.use(),this._libs.forEach(function(n){n.sendShaderVariables(r,t,e)}),r.sendAttributeDataFromCustomShader(),r.sendUniformDataFromCustomShader(),e.mapManager.sendData(r)},e.prototype.hasLib=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];if(e[0]instanceof t.ShaderLib){var n=e[0];return this._libs.hasChild(n)}var o=e[0];return this._libs.hasChild(function(t){return t instanceof o})},e.prototype.addLib=function(t){this._libs.addChild(t)},e.prototype.addShaderLibToTop=function(t){this._libs.unShiftChild(t)},e.prototype.getLib=function(t){return this._libs.findOne(function(e){return e instanceof t})},e.prototype.getLibs=function(){return this._libs},e.prototype.removeLib=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return this._libs.removeChild(t[0])},e.prototype.removeAllLibs=function(){this._libs.removeAllChildren()},e.prototype.sortLib=function(t){this._libs=this._libs.sort(t)},e.prototype.read=function(t){this._sourceBuilder.read(t)},e.prototype.buildDefinitionData=function(t,e){this._libs.forEach(function(r){r.setShaderDefinition(t,e)}),this._sourceBuilder.clearShaderDefinition(),this._sourceBuilder.build(this._libs),this.attributes=this._sourceBuilder.attributes,this.uniforms=this._sourceBuilder.uniforms,this.vsSource=this._sourceBuilder.vsSource,this.fsSource=this._sourceBuilder.fsSource},e.prototype._initShader=function(e,r){var n=t.DeviceManager.getInstance().gl;return n.shaderSource(e,r),n.compileShader(e),n.getShaderParameter(e,n.COMPILE_STATUS)?e:(t.Log.log(n.getShaderInfoLog(e)),t.Log.log("attributes:\n",this.attributes),t.Log.log("uniforms:\n",this.uniforms),t.Log.log("source:\n",r),void 0)},e.prototype._isNotEqual=function(t,e){var r=!1;return t.forEach(function(t,n){var o=e.getChild(n);return o&&t.type===o.type&&t.value===o.value?void 0:(r=!0,wdCb.$BREAK)}),r},e}();t.Shader=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){this.attributes=wdCb.Hash.create(),this.uniforms=wdCb.Hash.create(),this.vsSource="",this.vsSourceTop="",this.vsSourceDefine="",this.vsSourceVarDeclare="",this.vsSourceFuncDeclare="",this.vsSourceFuncDefine="",this.vsSourceBody="",this.fsSource="",this.fsSourceTop="",this.fsSourceDefine="",this.fsSourceVarDeclare="",this.fsSourceFuncDeclare="",this.fsSourceFuncDefine="",this.fsSourceBody="",this.vsSourceDefineList=wdCb.Collection.create(),this.fsSourceDefineList=wdCb.Collection.create(),this.attributesFromShaderLib=wdCb.Hash.create(),this.uniformsFromShaderLib=wdCb.Hash.create(),this.vsSourceFromShaderLib="",this.vsSourceTopFromShaderLib="",this.vsSourceDefineFromShaderLib="",this.vsSourceVarDeclareFromShaderLib="",this.vsSourceFuncDeclareFromShaderLib="",this.vsSourceFuncDefineFromShaderLib="",this.vsSourceBodyFromShaderLib="",this.fsSourceFromShaderLib="",this.fsSourceTopFromShaderLib="",this.fsSourceDefineFromShaderLib="",this.fsSourceVarDeclareFromShaderLib="",this.fsSourceFuncDeclareFromShaderLib="",this.fsSourceFuncDefineFromShaderLib="",this.fsSourceBodyFromShaderLib="",this.vsSourceDefineListFromShaderLib=wdCb.Collection.create(),this.fsSourceDefineListFromShaderLib=wdCb.Collection.create()}return e.create=function(){var t=new this;return t},e.prototype.read=function(t){t.attributes&&(this.attributesFromShaderLib=t.attributes instanceof wdCb.Hash?t.attributes:wdCb.Hash.create(t.attributes)),t.uniforms&&(this.uniformsFromShaderLib=t.uniforms instanceof wdCb.Hash?t.uniforms:wdCb.Hash.create(t.uniforms)),this.vsSourceTopFromShaderLib=t.vsSourceTop||"",this.vsSourceDefineFromShaderLib=t.vsSourceDefine||"",this.vsSourceVarDeclareFromShaderLib=t.vsSourceVarDeclare||"",this.vsSourceFuncDeclareFromShaderLib=t.vsSourceFuncDeclare||"",this.vsSourceFuncDefineFromShaderLib=t.vsSourceFuncDefine||"",this.vsSourceBodyFromShaderLib=t.vsSourceBody||"",this.fsSourceTopFromShaderLib=t.fsSourceTop||"",this.fsSourceDefineFromShaderLib=t.fsSourceDefine||"",this.fsSourceVarDeclareFromShaderLib=t.fsSourceVarDeclare||"",this.fsSourceFuncDeclareFromShaderLib=t.fsSourceFuncDeclare||"",this.fsSourceFuncDefineFromShaderLib=t.fsSourceFuncDefine||"",this.fsSourceBodyFromShaderLib=t.fsSourceBody||""},e.prototype.build=function(e){var r=this;this._readLibSource(e),this._buildVsSource(),this._buildFsSource(),this.attributes.filter(function(e){return(t.JudgeUtils.isArray(e.value)||t.JudgeUtils.isFloatArray(e.value))&&e.value!==t.VariableCategory.ENGINE}).forEach(function(t,e){t.value=r._convertArrayToArrayBuffer(t.type,t.value)})},e.prototype.clearShaderDefinition=function(){this.attributes.removeAllChildren(),this.uniforms.removeAllChildren(),this.vsSourceDefineList.removeAllChildren(),this.fsSourceDefineList.removeAllChildren(),this.vsSourceTop="",this.vsSourceDefine="",this.vsSourceVarDeclare="",this.vsSourceFuncDeclare="",this.vsSourceFuncDefine="",this.vsSourceBody="",this.fsSourceTop="",this.fsSourceDefine="",this.fsSourceVarDeclare="",this.fsSourceFuncDeclare="",this.fsSourceFuncDefine="",this.fsSourceBody=""},e.prototype._readLibSource=function(t){var e=this,r="",n="",o="",i="",a="",s="",c="",u="",h="",l="",p="",f="";t.forEach(function(t){e.attributes.addChildren(t.attributes),e.uniforms.addChildren(t.uniforms),r+=t.vsSourceTop,n+=t.vsSourceDefine,o+=t.vsSourceVarDeclare,i+=t.vsSourceFuncDeclare,a+=t.vsSourceFuncDefine,s+=t.vsSourceBody,c+=t.fsSourceTop,u+=t.fsSourceDefine,h+=t.fsSourceVarDeclare,l+=t.fsSourceFuncDeclare,p+=t.fsSourceFuncDefine,f+=t.fsSourceBody,e.vsSourceDefineList.addChildren(t.vsSourceDefineList),e.fsSourceDefineList.addChildren(t.fsSourceDefineList)}),this.attributes.addChildren(this.attributesFromShaderLib),this.uniforms.addChildren(this.uniformsFromShaderLib),this.vsSourceTop=r+this.vsSourceTopFromShaderLib,this.vsSourceDefine=n+this.vsSourceDefineFromShaderLib,this.vsSourceVarDeclare=o+this.vsSourceVarDeclareFromShaderLib,this.vsSourceFuncDeclare=i+this.vsSourceFuncDeclareFromShaderLib,this.vsSourceFuncDefine=a+this.vsSourceFuncDefineFromShaderLib,this.vsSourceBody=s+this.vsSourceBodyFromShaderLib,this.fsSourceTop=c+this.fsSourceTopFromShaderLib,this.fsSourceDefine=u+this.fsSourceDefineFromShaderLib,this.fsSourceVarDeclare=h+this.fsSourceVarDeclareFromShaderLib,this.fsSourceFuncDeclare=l+this.fsSourceFuncDeclareFromShaderLib,this.fsSourceFuncDefine=p+this.fsSourceFuncDefineFromShaderLib,this.fsSourceBody=f+this.fsSourceBodyFromShaderLib},e.prototype._buildVsSource=function(){this.vsSource=this._buildVsSourceTop()+this._buildVsSourceDefine()+this._buildVsSourceVarDeclare()+this._buildVsSourceFuncDeclare()+this._buildVsSourceFuncDefine()+this._buildVsSourceBody()},e.prototype._buildFsSource=function(){this.fsSource=this._buildFsSourceTop()+this._buildFsSourceDefine()+this._buildFsSourceVarDeclare()+this._buildFsSourceFuncDeclare()+this._buildFsSourceFuncDefine()+this._buildFsSourceBody()},e.prototype._buildVsSourceTop=function(){return this._getPrecisionSource()+this.vsSourceTop},e.prototype._buildVsSourceDefine=function(){return this._buildSourceDefine(this.vsSourceDefineList)+this.vsSourceDefine},e.prototype._buildVsSourceVarDeclare=function(){return this._generateAttributeSource()+this._generateUniformSource(this.vsSourceVarDeclare,this.vsSourceFuncDefine,this.vsSourceBody)+this.vsSourceVarDeclare},e.prototype._buildVsSourceFuncDeclare=function(){return this.vsSourceFuncDeclare},e.prototype._buildVsSourceFuncDefine=function(){return this.vsSourceFuncDefine},e.prototype._buildVsSourceBody=function(){return t.ShaderSnippet.main_begin+this.vsSourceBody+t.ShaderSnippet.main_end},e.prototype._buildFsSourceTop=function(){return this._getPrecisionSource()+this.fsSourceTop},e.prototype._buildFsSourceDefine=function(){return this._buildSourceDefine(this.fsSourceDefineList)+this.fsSourceDefine},e.prototype._buildFsSourceVarDeclare=function(){return this._generateUniformSource(this.fsSourceVarDeclare,this.fsSourceFuncDefine,this.fsSourceBody)+this.fsSourceVarDeclare},e.prototype._buildFsSourceFuncDeclare=function(){return this.fsSourceFuncDeclare},e.prototype._buildFsSourceFuncDefine=function(){return this.fsSourceFuncDefine},e.prototype._buildFsSourceBody=function(){return t.ShaderSnippet.main_begin+this.fsSourceBody+t.ShaderSnippet.main_end},e.prototype._buildSourceDefine=function(t){var e="";return t.forEach(function(t){e+=void 0===t.value?"#define "+t.name+"\n":"#define "+t.name+" "+t.value+"\n"}),e},e.prototype._getPrecisionSource=function(){var e=t.GPUDetector.getInstance().precision,r=null;switch(e){case t.GPUPrecision.HIGHP:r=t.ShaderChunk.highp_fragment.top;break;case t.GPUPrecision.MEDIUMP:r=t.ShaderChunk.mediump_fragment.top;break;case t.GPUPrecision.LOWP:r=t.ShaderChunk.lowp_fragment.top;break;default:r=""}return r},e.prototype._generateAttributeSource=function(){var e="";return this.attributes.filter(function(t,e){return!!t}).forEach(function(r,n){e+="attribute "+t.VariableTypeTable.getVariableType(r.type)+" "+n+";\n"}),e},e.prototype._generateUniformSource=function(e,r,n){var o="",i=this;return this.uniforms.filter(function(o,a){return!!o&&o.type!==t.VariableType.STRUCTURE&&o.type!==t.VariableType.STRUCTURES&&!i._isExistInSource(a,e)&&(i._isExistInSource(a,r)||i._isExistInSource(a,n))}).forEach(function(e,r){o+="uniform "+t.VariableTypeTable.getVariableType(e.type)+" "+r+";\n"}),o},e.prototype._isExistInSource=function(t,e){return-1!==e.indexOf(t)},e.prototype._convertArrayToArrayBuffer=function(e,r){var n=this._getBufferSize(e);return t.JudgeUtils.isArray(r)?t.ArrayBuffer.create(new Float32Array(r),n,t.BufferType.FLOAT):t.JudgeUtils.isFloatArray(r)?t.ArrayBuffer.create(r,n,t.BufferType.FLOAT):void 0},e.prototype._getBufferSize=function(e){var r=null;switch(e){case t.VariableType.FLOAT_1:case t.VariableType.NUMBER_1:r=1;break;case t.VariableType.FLOAT_3:r=3;break;case t.VariableType.FLOAT_4:r=4;break;default:t.Log.error(!0,t.Log.info.FUNC_UNEXPECT("VariableType",e))}return r},e}();t.ShaderSourceBuilder=e}(wd||(wd={}));var wd;!function(t){!function(t){t[t.FLOAT_1=0]="FLOAT_1",t[t.FLOAT_2=1]="FLOAT_2",t[t.FLOAT_3=2]="FLOAT_3",t[t.FLOAT_4=3]="FLOAT_4",t[t.FLOAT_MAT3=4]="FLOAT_MAT3",t[t.FLOAT_MAT4=5]="FLOAT_MAT4",t[t.BUFFER=6]="BUFFER",t[t.SAMPLER_CUBE=7]="SAMPLER_CUBE",t[t.SAMPLER_2D=8]="SAMPLER_2D",t[t.NUMBER_1=9]="NUMBER_1",t[t.STRUCTURE=10]="STRUCTURE",t[t.STRUCTURES=11]="STRUCTURES"}(t.VariableType||(t.VariableType={}));t.VariableType}(wd||(wd={}));var wd;!function(t){!function(t){t[t.ENGINE="ENGINE"]="ENGINE",t[t.CUSTOM="CUSTOM"]="CUSTOM"}(t.VariableCategory||(t.VariableCategory={}));t.VariableCategory}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){}return e.a_position={type:t.VariableType.FLOAT_3,value:t.VariableCategory.ENGINE},e.a_currentFramePosition={type:t.VariableType.FLOAT_3,value:t.VariableCategory.ENGINE},e.a_nextFramePosition={type:t.VariableType.FLOAT_3,value:t.VariableCategory.ENGINE},e.a_normal={type:t.VariableType.FLOAT_3,value:t.VariableCategory.ENGINE},e.a_currentFrameNormal={type:t.VariableType.FLOAT_3,value:t.VariableCategory.ENGINE},e.a_nextFrameNormal={type:t.VariableType.FLOAT_3,value:t.VariableCategory.ENGINE},e.a_color={type:t.VariableType.FLOAT_3,value:t.VariableCategory.ENGINE},e.a_texCoord={type:t.VariableType.FLOAT_2,value:t.VariableCategory.ENGINE},e.a_tangent={type:t.VariableType.FLOAT_3,value:t.VariableCategory.ENGINE},e.u_mMatrix={type:t.VariableType.FLOAT_MAT4,value:t.VariableCategory.ENGINE},e.u_vMatrix={type:t.VariableType.FLOAT_MAT4,value:t.VariableCategory.ENGINE},e.u_pMatrix={type:t.VariableType.FLOAT_MAT4,value:t.VariableCategory.ENGINE},e.u_normalMatrix={type:t.VariableType.FLOAT_MAT3,value:t.VariableCategory.ENGINE},e.u_samplerCube0={type:t.VariableType.SAMPLER_CUBE,value:t.VariableCategory.ENGINE},e.u_sampler2D0={type:t.VariableType.SAMPLER_2D,value:t.VariableCategory.ENGINE},e.u_sampler2D1={type:t.VariableType.SAMPLER_2D,value:t.VariableCategory.ENGINE},e.u_diffuseMapSampler={type:t.VariableType.SAMPLER_2D,value:t.VariableCategory.ENGINE},e.u_specularMapSampler={type:t.VariableType.SAMPLER_2D,value:t.VariableCategory.ENGINE},e.u_normalMapSampler={type:t.VariableType.SAMPLER_2D,value:t.VariableCategory.ENGINE},e.u_mirrorSampler={type:t.VariableType.SAMPLER_2D,value:t.VariableCategory.ENGINE},e.u_cameraPos={type:t.VariableType.FLOAT_3,value:t.VariableCategory.ENGINE},e.u_refractionRatio={type:t.VariableType.FLOAT_1,value:t.VariableCategory.ENGINE},e.u_reflectivity={type:t.VariableType.FLOAT_1,value:t.VariableCategory.ENGINE},e.u_sourceRegion={type:t.VariableType.FLOAT_4,value:t.VariableCategory.ENGINE},e.u_repeatRegion={type:t.VariableType.FLOAT_4,value:t.VariableCategory.ENGINE},e.u_combineMode={type:t.VariableType.NUMBER_1,value:t.VariableCategory.ENGINE},e.u_mixRatio={type:t.VariableType.FLOAT_1,value:t.VariableCategory.ENGINE},e.u_diffuse={type:t.VariableType.FLOAT_3,value:t.VariableCategory.ENGINE},e.u_specular={type:t.VariableType.FLOAT_3,value:t.VariableCategory.ENGINE},e.u_shininess={type:t.VariableType.FLOAT_1,value:t.VariableCategory.ENGINE},e.u_isBothSide={type:t.VariableType.NUMBER_1,value:t.VariableCategory.ENGINE},e.u_opacity={type:t.VariableType.FLOAT_1,value:t.VariableCategory.ENGINE},e.u_ambient={type:t.VariableType.FLOAT_3,value:t.VariableCategory.ENGINE},e.u_directionLights={type:t.VariableType.STRUCTURES,value:t.VariableCategory.ENGINE},e.u_pointLights={type:t.VariableType.STRUCTURES,value:t.VariableCategory.ENGINE},e.u_vpMatrixFromLight={type:t.VariableType.FLOAT_MAT4,value:t.VariableCategory.ENGINE},e.u_lightPos={type:t.VariableType.FLOAT_3,value:t.VariableCategory.ENGINE},e.u_farPlane={type:t.VariableType.FLOAT_1,value:t.VariableCategory.ENGINE},e.u_interpolation={type:t.VariableType.FLOAT_1,value:t.VariableCategory.ENGINE},e}();t.VariableLib=e}(wd||(wd={}));var wd;!function(t){var e=wdCb.Hash.create();e.addChild(t.VariableType.FLOAT_1,"float"),e.addChild(t.VariableType.FLOAT_2,"vec2"),e.addChild(t.VariableType.FLOAT_3,"vec3"),e.addChild(t.VariableType.FLOAT_4,"vec4"),e.addChild(t.VariableType.FLOAT_MAT3,"mat3"),e.addChild(t.VariableType.FLOAT_MAT4,"mat4"),e.addChild(t.VariableType.NUMBER_1,"int"),e.addChild(t.VariableType.SAMPLER_CUBE,"samplerCube"),e.addChild(t.VariableType.SAMPLER_2D,"sampler2D");var r=function(){function r(){}return r.getVariableType=function(r){var n=e.getChild(r);return t.Log.error(void 0===n,t.Log.info.FUNC_NOT_EXIST(r,"in VariableTypeTable")),n},r}();t.VariableTypeTable=r}(wd||(wd={}));var wd;!function(t){var e=wdCb.Hash.create();e.addChild("diffuseMap","u_diffuseMapSampler"),e.addChild("specularMap","u_specularMapSampler"),e.addChild("normalMap","u_normalMapSampler"),e.addChild("mirrorReflectionMap","u_mirrorSampler");var r=function(){function r(){}return r.getVariableName=function(r){var n=e.getChild(r);return t.Log.error(void 0===n,t.Log.info.FUNC_NOT_EXIST(r,"in VariableNameTable")),n},r}();t.VariableNameTable=r}(wd||(wd={}));var __decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(){function e(){this.type=t.ABSTRACT_ATTRIBUTE,this.attributes=wdCb.Hash.create(),this.uniforms=wdCb.Hash.create(),this.vsSourceTop="",this.vsSourceDefine="",this.vsSourceVarDeclare="",this.vsSourceFuncDeclare="",this.vsSourceFuncDefine="",this.vsSourceBody="",this.fsSourceTop="",this.fsSourceDefine="",this.fsSourceVarDeclare="",this.fsSourceFuncDeclare="",this.fsSourceFuncDefine="",this.fsSourceBody="",this.vsSourceDefineList=wdCb.Collection.create(),this.fsSourceDefineList=wdCb.Collection.create()}return e.prototype.setShaderDefinition=function(t,e){var r=null,n=null;this._clearShaderDefinition(),r=this.getVsChunk(),n=this.getFsChunk(),r&&this.setVsSource(r),n&&this.setFsSource(n)},e.prototype.getVsChunk=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var n=0===t.length?this.type:t[0];return this._getChunk(n,r.vs)},e.prototype.getFsChunk=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var n=0===t.length?this.type:t[0];return this._getChunk(n,r.fs)},e.prototype.setVsSource=function(t,e){void 0===e&&(e="="),this._setSource(t,r.vs,e)},e.prototype.setFsSource=function(t,e){void 0===e&&(e="="),this._setSource(t,r.fs,e)},e.prototype.addAttributeVariable=function(t){this._addVariable(this.attributes,t)},e.prototype.addUniformVariable=function(t){this._addVariable(this.uniforms,t)},e.prototype.sendAttributeData=function(e,r,n){e.sendAttributeData(r,t.VariableType.BUFFER,n)},e.prototype.sendUniformData=function(e,r,n){e.sendUniformData(r,t.VariableLib[r].type,n)},e.prototype._clearShaderDefinition=function(){this.attributes.removeAllChildren(),this.uniforms.removeAllChildren(),this.vsSourceDefineList.removeAllChildren(),this.fsSourceDefineList.removeAllChildren(),this.vsSourceTop="",this.vsSourceDefine="",this.vsSourceVarDeclare="",this.vsSourceFuncDeclare="",this.vsSourceFuncDefine="",this.vsSourceBody="",this.fsSourceTop="",this.fsSourceDefine="",this.fsSourceVarDeclare="",this.fsSourceFuncDeclare="",this.fsSourceFuncDefine="",this.fsSourceBody=""},e.prototype._getChunk=function(e,n){var o=null;return o=e.indexOf(".glsl")>-1?""+wdCb.PathUtils.basename(e,".glsl"):n===r.vs?e+"_vertex":e+"_fragment",t.ShaderChunk[o]?t.ShaderChunk[o]:t.ShaderChunk.empty},e.prototype._setSource=function(e,r,n){if(e)switch(n){case"+":this[r+"SourceTop"]+=e.top,this[r+"SourceDefine"]+=e.define,this[r+"SourceVarDeclare"]+=e.varDeclare,this[r+"SourceFuncDeclare"]+=e.funcDeclare,this[r+"SourceFuncDefine"]+=e.funcDefine,this[r+"SourceBody"]+=e.body;break;case"=":this[r+"SourceTop"]=e.top,this[r+"SourceDefine"]=e.define,this[r+"SourceVarDeclare"]=e.varDeclare,this[r+"SourceFuncDeclare"]=e.funcDeclare,this[r+"SourceFuncDefine"]=e.funcDefine,this[r+"SourceBody"]=e.body;break;default:t.Log.error(!0,t.Log.info.FUNC_INVALID("opertor:",n))}},e.prototype._addVariable=function(e,r){r.forEach(function(r){t.Log.assert(t.VariableLib[r],t.Log.info.FUNC_SHOULD(r,"exist in VariableLib")),e.addChild(r,t.VariableLib[r])})},__decorate([t.virtual],e.prototype,"setShaderDefinition",null),__decorate([t.require(function(e,r,n){t.assert(!!t.VariableLib[r],r+" should exist in VariableLib")})],e.prototype,"sendUniformData",null),e}();t.ShaderLib=e;var r;!function(t){t[t.vs="vs"]="vs",t[t.fs="fs"]="fs"}(r||(r={}))}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.type="common"}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.sendShaderVariables=function(t,e,r){this.sendUniformData(t,"u_mMatrix",e.mMatrix),this.sendUniformData(t,"u_vMatrix",e.vMatrix),this.sendUniformData(t,"u_pMatrix",e.pMatrix)},r.prototype.setShaderDefinition=function(r,n){e.prototype.setShaderDefinition.call(this,r,n),this.addUniformVariable(["u_mMatrix","u_vMatrix","u_pMatrix"]),this.vsSourceDefine=t.ShaderChunk.common_define.define+t.ShaderChunk.common_vertex.define,this.vsSourceFuncDefine=t.ShaderChunk.common_function.funcDefine+t.ShaderChunk.common_vertex.funcDefine,this.fsSourceDefine=t.ShaderChunk.common_define.define+t.ShaderChunk.common_fragment.define,this.fsSourceFuncDefine=t.ShaderChunk.common_function.funcDefine+t.ShaderChunk.common_fragment.funcDefine},r}(t.ShaderLib);t.CommonShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.type="commonVertice"}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.sendShaderVariables=function(t,e,r){this._sendAttributeVariables(t,e)},r.prototype.setShaderDefinition=function(t,r){e.prototype.setShaderDefinition.call(this,t,r),this.addAttributeVariable(["a_position"])},r.prototype._sendAttributeVariables=function(e,r){r.buffers.hasChild(t.BufferDataType.VERTICE)&&this.sendAttributeData(e,"a_position",r.buffers.getChild(t.BufferDataType.VERTICE))},r}(t.ShaderLib);t.CommonVerticeShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.type="commonNormal"}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.sendShaderVariables=function(t,e,r){this._sendAttributeVariables(t,e)},r.prototype.setShaderDefinition=function(t,r){e.prototype.setShaderDefinition.call(this,t,r),this.addAttributeVariable(["a_normal"])},r.prototype._sendAttributeVariables=function(e,r){
r.buffers.hasChild(t.BufferDataType.NORMAL)&&this.sendAttributeData(e,"a_normal",r.buffers.getChild(t.BufferDataType.NORMAL))},r}(t.ShaderLib);t.CommonNormalShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.type="basic"}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.sendShaderVariables=function(e,r,n){r.buffers.hasChild(t.BufferDataType.COLOR)&&(this.sendAttributeData(e,"a_color",r.buffers.getChild(t.BufferDataType.COLOR)),this.sendUniformData(e,"u_opacity",n.opacity))},r.prototype.setShaderDefinition=function(r,n){e.prototype.setShaderDefinition.call(this,r,n),this.addAttributeVariable(["a_color"]),this.addUniformVariable(["u_opacity"]),this.vsSourceBody=t.ShaderSnippet.setPos_mvp+t.ShaderChunk.basic_vertex.body},r}(t.ShaderLib);t.BasicShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.type="basicEnd"}return __extends(e,t),e.create=function(){var t=new this;return t},e.prototype.sendShaderVariables=function(t,e,r){},e}(t.ShaderLib);t.BasicEndShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.type="morphCommon"}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.sendShaderVariables=function(t,e,r){var n=e.animation;this.sendUniformData(t,"u_interpolation",n.interpolation)},r.prototype.setShaderDefinition=function(t,r){e.prototype.setShaderDefinition.call(this,t,r),this.addUniformVariable(["u_interpolation"])},__decorate([t.require(function(e,r,n){t.assert(!!r.animation,t.Log.info.FUNC_SHOULD("gameObject","add MorphAnimation component"))})],r.prototype,"sendShaderVariables",null),r}(t.ShaderLib);t.MorphCommonShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.type="morphVertice"}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.sendShaderVariables=function(e,r,n){if(r.buffers.hasChild(t.BufferDataType.VERTICE)){var o=r.buffers.getChild(t.BufferDataType.VERTICE);this.sendAttributeData(e,"a_currentFramePosition",o[0]),this.sendAttributeData(e,"a_nextFramePosition",o[1])}},r.prototype.setShaderDefinition=function(t,r){e.prototype.setShaderDefinition.call(this,t,r),this.addAttributeVariable(["a_currentFramePosition","a_nextFramePosition"])},__decorate([t.require(function(e,r,n){t.assert(!!r.animation,t.Log.info.FUNC_SHOULD("gameObject","add MorphAnimation component"))})],r.prototype,"sendShaderVariables",null),r}(t.ShaderLib);t.MorphVerticeShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.type="morphNormal"}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.sendShaderVariables=function(e,r,n){if(r.buffers.hasChild(t.BufferDataType.NORMAL)){var o=r.buffers.getChild(t.BufferDataType.NORMAL);this.sendAttributeData(e,"a_currentFrameNormal",o[0]),this.sendAttributeData(e,"a_nextFrameNormal",o[1])}},r.prototype.setShaderDefinition=function(t,r){e.prototype.setShaderDefinition.call(this,t,r),this.addAttributeVariable(["a_currentFrameNormal","a_nextFrameNormal"])},r}(t.ShaderLib);t.MorphNormalShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.type="skybox"}return __extends(e,t),e.create=function(){var t=new this;return t},e.prototype.sendShaderVariables=function(t,e,r){},e.prototype.setShaderDefinition=function(e,r){t.prototype.setShaderDefinition.call(this,e,r),this.addUniformVariable(["u_samplerCube0"])},e}(t.ShaderLib);t.SkyboxShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.prototype.sendShaderVariables=function(e,r,n){this.sendUniformData(e,"u_normalMatrix",r.mMatrix.copy().invertTo3x3().transpose()),this.sendUniformData(e,"u_cameraPos",t.Director.getInstance().scene.camera.transform.position)},r.prototype.setShaderDefinition=function(r,n){e.prototype.setShaderDefinition.call(this,r,n),this.addUniformVariable(["u_samplerCube0","u_cameraPos","u_normalMatrix"]),this.vsSourceBody=t.ShaderSnippet.setPos_mvp+this.getVsChunk().body},r.prototype.setEnvMapSource=function(){var t=this.getVsChunk("envMap_forBasic"),e=this.getFsChunk("envMap_forBasic");this.vsSourceTop=t.top,this.vsSourceDefine=t.define,this.vsSourceVarDeclare=t.varDeclare,this.vsSourceFuncDeclare=t.funcDeclare,this.vsSourceFuncDefine=t.funcDefine,this.vsSourceBody+=t.body,this.setFsSource(e)},r}(t.ShaderLib);t.EnvMapForBasicShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.type="basic_envMap_forBasic"}return __extends(e,t),e.create=function(){var t=new this;return t},e}(t.EnvMapForBasicShaderLib);t.BasicEnvMapForBasicShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.type="reflection_forBasic"}return __extends(e,t),e.create=function(){var t=new this;return t},e.prototype.setShaderDefinition=function(e,r){t.prototype.setShaderDefinition.call(this,e,r),this.setEnvMapSource(),this.setFsSource(this.getFsChunk(),"+")},e}(t.EnvMapForBasicShaderLib);t.ReflectionForBasicShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.type="refraction_forBasic"}return __extends(e,t),e.create=function(){var t=new this;return t},e.prototype.sendShaderVariables=function(e,r,n){t.prototype.sendShaderVariables.call(this,e,r,n),this.sendUniformData(e,"u_refractionRatio",n.refractionRatio)},e.prototype.setShaderDefinition=function(e,r){t.prototype.setShaderDefinition.call(this,e,r),this.addUniformVariable(["u_refractionRatio"]),this.setEnvMapSource(),this.setFsSource(this.getFsChunk(),"+")},e}(t.EnvMapForBasicShaderLib);t.RefractionForBasicShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.type="fresnel_forBasic"}return __extends(e,t),e.create=function(){var t=new this;return t},e.prototype.sendShaderVariables=function(e,r,n){t.prototype.sendShaderVariables.call(this,e,r,n),this.sendUniformData(e,"u_refractionRatio",n.refractionRatio),this.sendUniformData(e,"u_reflectivity",n.reflectivity)},e.prototype.setShaderDefinition=function(e,r){t.prototype.setShaderDefinition.call(this,e,r),this.addUniformVariable(["u_refractionRatio","u_reflectivity"]),this.setEnvMapSource(),this.setFsSource(this.getFsChunk(),"+")},e}(t.EnvMapForBasicShaderLib);t.FresnelForBasicShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.prototype.sendShaderVariables=function(t,e,r){},r.prototype.setShaderDefinition=function(r,n){e.prototype.setShaderDefinition.call(this,r,n),this.addUniformVariable(["u_samplerCube0"]),this.vsSourceBody=t.ShaderSnippet.setPos_mvp+this.getVsChunk().body},r.prototype.setEnvMapSource=function(){var t=this.getVsChunk("envMap_forLight"),e=this.getFsChunk("envMap_forLight");this.vsSourceTop=t.top,this.vsSourceDefine=t.define,this.vsSourceVarDeclare=t.varDeclare,this.vsSourceFuncDeclare=t.funcDeclare,this.vsSourceFuncDefine=t.funcDefine,this.vsSourceBody+=t.body,this.setFsSource(e)},r}(t.ShaderLib);t.EnvMapForLightShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.type="basic_forLight_envMap"}return __extends(e,t),e.create=function(){var t=new this;return t},e}(t.EnvMapForLightShaderLib);t.BasicEnvMapForLightShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.type="reflection_forLight"}return __extends(e,t),e.create=function(){var t=new this;return t},e.prototype.setShaderDefinition=function(e,r){t.prototype.setShaderDefinition.call(this,e,r),this.setEnvMapSource(),this.setFsSource(this.getFsChunk(),"+")},e}(t.EnvMapForLightShaderLib);t.ReflectionForLightShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.type="refraction_forLight"}return __extends(e,t),e.create=function(){var t=new this;return t},e.prototype.sendShaderVariables=function(e,r,n){t.prototype.sendShaderVariables.call(this,e,r,n),this.sendUniformData(e,"u_refractionRatio",n.refractionRatio)},e.prototype.setShaderDefinition=function(e,r){t.prototype.setShaderDefinition.call(this,e,r),this.addUniformVariable(["u_refractionRatio"]),this.setEnvMapSource(),this.setFsSource(this.getFsChunk(),"+")},e}(t.EnvMapForLightShaderLib);t.RefractionForLightShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.type="fresnel_forLight"}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.sendShaderVariables=function(r,n,o){e.prototype.sendShaderVariables.call(this,r,n,o),o.reflectivity!==t.ShaderChunk.NULL?this.sendUniformData(r,"u_reflectivity",o.reflectivity):(this.sendUniformData(r,"u_reflectivity",t.ShaderChunk.NULL),this.sendUniformData(r,"u_refractionRatio",o.refractionRatio))},r.prototype.setShaderDefinition=function(t,r){e.prototype.setShaderDefinition.call(this,t,r),this.addUniformVariable(["u_refractionRatio","u_reflectivity"]),this.setEnvMapSource(),this.setFsSource(this.getFsChunk(),"+")},r}(t.EnvMapForLightShaderLib);t.FresnelForLightShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.prototype.sendShaderVariables=function(e,r,n){r.buffers.hasChild(t.BufferDataType.TEXCOORD)&&this.sendAttributeData(e,"a_texCoord",r.buffers.getChild(t.BufferDataType.TEXCOORD))},r.prototype.setShaderDefinition=function(t,r){e.prototype.setShaderDefinition.call(this,t,r),this.addAttributeVariable(["a_texCoord"]),this.addUniformVariable(["u_sampler2D0","u_sourceRegion","u_repeatRegion"]),this._setMapSource()},r.prototype._setMapSource=function(){var t=this.getVsChunk("map_forBasic"),e=this.getFsChunk("map_forBasic");this.vsSourceTop=t.top,this.vsSourceDefine=t.define,this.vsSourceVarDeclare=t.varDeclare,this.vsSourceFuncDeclare=t.funcDeclare,this.vsSourceFuncDefine=t.funcDefine,this.vsSourceBody=t.body,this.setFsSource(e)},r}(t.ShaderLib);t.MapShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.type="map_forBasic"}return __extends(e,t),e.create=function(){var t=new this;return t},e}(t.MapShaderLib);t.BasicMapShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.type="multi_map_forBasic"}return __extends(e,t),e.create=function(){var t=new this;return t},e.prototype.sendShaderVariables=function(e,r,n){t.prototype.sendShaderVariables.call(this,e,r,n),this.sendUniformData(e,"u_combineMode",n.mapCombineMode),this.sendUniformData(e,"u_mixRatio",n.mapMixRatio)},e.prototype.setShaderDefinition=function(e,r){t.prototype.setShaderDefinition.call(this,e,r),this.addUniformVariable(["u_sampler2D1","u_combineMode","u_mixRatio"]),this.fsSourceFuncDefine=this.getFsChunk().funcDefine,this.fsSourceBody=this.getFsChunk().body},e}(t.MapShaderLib);t.MultiMapShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.type="mirror_forBasic"}return __extends(e,t),e.create=function(){var t=new this;return t},e.prototype.sendShaderVariables=function(t,e,r){},e.prototype.setShaderDefinition=function(e,r){t.prototype.setShaderDefinition.call(this,e,r),this.addUniformVariable(["u_mirrorSampler"])},e}(t.ShaderLib);t.MirrorForBasicShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.type="lightCommon"}return __extends(e,t),e.create=function(){var t=new this;return t},e.prototype.sendShaderVariables=function(t,e,r){},e.prototype.setShaderDefinition=function(e,r){t.prototype.setShaderDefinition.call(this,e,r),this.setVsSource(this.getVsChunk("light_common.glsl")),this.setVsSource(this.getVsChunk(),"+"),this.setFsSource(this.getFsChunk("light_common.glsl")),this.setFsSource(this.getFsChunk(),"+")},e}(t.ShaderLib);t.LightCommonShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.type="light"}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.sendShaderVariables=function(e,r,n){this.sendUniformData(e,"u_normalMatrix",r.mMatrix.copy().invertTo3x3().transpose()),this.sendUniformData(e,"u_cameraPos",t.Director.getInstance().scene.camera.transform.position),this.sendUniformData(e,"u_shininess",n.shininess),this.sendUniformData(e,"u_opacity",n.opacity),this._sendLightVariables(e)},r.prototype.setShaderDefinition=function(t,r){e.prototype.setShaderDefinition.call(this,t,r),this.addUniformVariable(["u_normalMatrix","u_cameraPos","u_shininess","u_ambient","u_opacity","u_isBothSide"]),this._setLightDefinition(r)},r.prototype._sendLightVariables=function(e){var r=t.Director.getInstance().scene,n=r.directionLights,o=r.ambientLight,i=r.pointLights;o&&this.sendUniformData(e,"u_ambient",o.getComponent(t.AmbientLight).color.toVector3()),i&&this._sendPointLightVariables(e,i),n&&this._sendDirectionLightVariables(e,n)},r.prototype._sendPointLightVariables=function(e,r){r.forEach(function(r,n){var o=r.getComponent(t.PointLight);e.sendStructureData("u_pointLights["+n+"].position",t.VariableType.FLOAT_3,o.position),e.sendStructureData("u_pointLights["+n+"].color",t.VariableType.FLOAT_3,o.color.toVector3()),e.sendStructureData("u_pointLights["+n+"].intensity",t.VariableType.FLOAT_1,o.intensity),e.sendStructureData("u_pointLights["+n+"].range",t.VariableType.FLOAT_1,o.range),e.sendStructureData("u_pointLights["+n+"].constant",t.VariableType.FLOAT_1,o.constant),e.sendStructureData("u_pointLights["+n+"].linear",t.VariableType.FLOAT_1,o.linear),e.sendStructureData("u_pointLights["+n+"].quadratic",t.VariableType.FLOAT_1,o.quadratic)})},r.prototype._sendDirectionLightVariables=function(e,r){var n=this;r.forEach(function(r,o){var i=r.getComponent(t.DirectionLight);n._isZero(i.position)?e.sendStructureData("u_directionLights["+o+"].position",t.VariableType.FLOAT_3,t.DirectionLight.defaultPosition):e.sendStructureData("u_directionLights["+o+"].position",t.VariableType.FLOAT_3,i.position),e.sendStructureData("u_directionLights["+o+"].color",t.VariableType.FLOAT_3,i.color.toVector3()),e.sendStructureData("u_directionLights["+o+"].intensity",t.VariableType.FLOAT_1,i.intensity)})},r.prototype._isZero=function(t){var e=t.values;return 0===e[0]&&0===e[1]&&0===e[2]},r.prototype._setLightDefinition=function(e){var r=t.Director.getInstance().scene,n=r.directionLights,o=r.pointLights,i=0,a=0;n&&(this.addUniformVariable(["u_directionLights"]),i=n.getCount()),o&&(this.addUniformVariable(["u_pointLights"]),a=o.getCount()),this._addDefine(this.vsSourceDefineList,i,a),this._addDefine(this.fsSourceDefineList,i,a),e.side===t.Side.BOTH&&this.fsSourceDefineList.addChildren([{name:"BOTH_SIDE"}])},r.prototype._addDefine=function(t,e,r){t.addChildren([{name:"DIRECTION_LIGHTS_COUNT",value:e},{name:"POINT_LIGHTS_COUNT",value:r}])},r}(t.ShaderLib);t.LightShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.type="lightEnd"}return __extends(e,t),e.create=function(){var t=new this;return t},e.prototype.sendShaderVariables=function(t,e,r){},e}(t.ShaderLib);t.LightEndShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.prototype.sendShaderVariables=function(e,r,n){r.buffers.hasChild(t.BufferDataType.TEXCOORD)&&this.sendAttributeData(e,"a_texCoord",r.buffers.getChild(t.BufferDataType.TEXCOORD))},r.prototype.setShaderDefinition=function(t,r){e.prototype.setShaderDefinition.call(this,t,r),this.addAttributeVariable(["a_texCoord"])},r}(t.ShaderLib);t.LightMapShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.type="diffuseMap"}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.setShaderDefinition=function(r,n){e.prototype.setShaderDefinition.call(this,r,n),this.addUniformVariable([t.VariableNameTable.getVariableName("diffuseMap"),"u_sourceRegion","u_repeatRegion"])},r}(t.LightMapShaderLib);t.DiffuseMapShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.type="specularMap"}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.setShaderDefinition=function(r,n){e.prototype.setShaderDefinition.call(this,r,n),this.addUniformVariable([t.VariableNameTable.getVariableName("specularMap")])},r}(t.LightMapShaderLib);t.SpecularMapShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.type="normalMap"}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.sendShaderVariables=function(r,n,o){e.prototype.sendShaderVariables.call(this,r,n,o),n.buffers.hasChild(t.BufferDataType.TANGENT)&&this.sendAttributeData(r,"a_tangent",n.buffers.getChild(t.BufferDataType.TANGENT))},r.prototype.setShaderDefinition=function(r,n){e.prototype.setShaderDefinition.call(this,r,n),this.addAttributeVariable(["a_tangent"]),this.addUniformVariable([t.VariableNameTable.getVariableName("normalMap")])},r}(t.LightMapShaderLib);t.NormalMapShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.type="noDiffuseMap"}return __extends(e,t),e.create=function(){var t=new this;return t},e.prototype.sendShaderVariables=function(t,e,r){this.sendUniformData(t,"u_diffuse",r.color.toVector3())},e.prototype.setShaderDefinition=function(e,r){t.prototype.setShaderDefinition.call(this,e,r),this.addUniformVariable(["u_diffuse"])},e}(t.ShaderLib);t.NoDiffuseMapShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.type="noSpecularMap"}return __extends(e,t),e.create=function(){var t=new this;return t},e.prototype.sendShaderVariables=function(t,e,r){this.sendUniformData(t,"u_specular",r.specular.toVector3())},e.prototype.setShaderDefinition=function(e,r){t.prototype.setShaderDefinition.call(this,e,r),this.addUniformVariable(["u_specular"])},e}(t.ShaderLib);t.NoSpecularMapShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.type="noNormalMap"}return __extends(e,t),e.create=function(){var t=new this;return t},e.prototype.sendShaderVariables=function(t,e,r){},e}(t.ShaderLib);t.NoNormalMapShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.setShaderDefinition=function(e,r){t.prototype.setShaderDefinition.call(this,e,r),this.setFsSource(this.getFsChunk("commonBuildShadowMap_fragment.glsl")),this.setFsSource(this.getFsChunk(),"+")},e}(t.ShaderLib);t.BuildShadowMapShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.type="buildTwoDShadowMap"}return __extends(e,t),e.create=function(){var t=new this;return t},e.prototype.sendShaderVariables=function(t,e,r){this.sendUniformData(t,"u_vpMatrixFromLight",r.buildTwoDShadowMapData.vpMatrixFromLight)},e.prototype.setShaderDefinition=function(e,r){t.prototype.setShaderDefinition.call(this,e,r),this.addUniformVariable(["u_vpMatrixFromLight"])},e}(t.BuildShadowMapShaderLib);t.BuildTwoDShadowMapShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.type="buildCubemapShadowMap"}return __extends(e,t),e.create=function(){var t=new this;return t},e.prototype.sendShaderVariables=function(t,e,r){this.sendUniformData(t,"u_lightPos",r.buildCubemapShadowMapData.lightPos),this.sendUniformData(t,"u_farPlane",r.buildCubemapShadowMapData.farPlane)},e.prototype.setShaderDefinition=function(e,r){t.prototype.setShaderDefinition.call(this,e,r),this.addUniformVariable(["u_lightPos","u_farPlane"])},e}(t.BuildShadowMapShaderLib);t.BuildCubemapShadowMapShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.type="totalShadowMap"}return __extends(e,t),e.create=function(){var t=new this;return t},e.prototype.sendShaderVariables=function(t,e,r){},e}(t.ShaderLib);t.TotalShadowMapShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.prototype.setShaderDefinition=function(t,r){e.prototype.setShaderDefinition.call(this,t,r),this._setShadowMapSource()},r.prototype._setShadowMapSource=function(){var e=t.Director.getInstance().scene,r=e.directionLights?e.directionLights.filter(function(e){return e.getComponent(t.DirectionLight).castShadow}).getCount():0,n=e.pointLights?e.pointLights.filter(function(e){return e.getComponent(t.PointLight).castShadow}).getCount():0;e.shadowMap.softType===t.ShadowMapSoftType.PCF&&this.fsSourceDefineList.addChildren([{name:"SHADOWMAP_TYPE_PCF"}]),this.vsSourceDefineList.addChild({name:"TWOD_SHADOWMAP_COUNT",value:r}),this.fsSourceDefineList.addChildren([{name:"TWOD_SHADOWMAP_COUNT",value:r},{name:"CUBEMAP_SHADOWMAP_COUNT",value:n}])},r}(t.ShaderLib);t.ShadowMapShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.type="twoDShadowMap"}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.sendShaderVariables=function(e,r,n){n.twoDShadowMapDatas.forEach(function(r,n){e.sendStructureData("u_vpMatrixFromLight["+n+"]",t.VariableType.FLOAT_MAT4,r.vpMatrixFromLight),e.sendStructureData("u_twoDShadowSize["+n+"]",t.VariableType.FLOAT_2,r.shadowSize),e.sendStructureData("u_twoDShadowBias["+n+"]",t.VariableType.FLOAT_1,r.shadowBias),e.sendStructureData("u_twoDShadowDarkness["+n+"]",t.VariableType.FLOAT_1,r.shadowDarkness),e.sendStructureData("u_twoDLightPos["+n+"]",t.VariableType.FLOAT_3,r.lightPos)})},r}(t.ShadowMapShaderLib);t.TwoDShadowMapShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.type="cubemapShadowMap"}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.sendShaderVariables=function(e,r,n){n.cubemapShadowMapDatas.forEach(function(r,n){e.sendStructureData("u_cubemapLightPos["+n+"]",t.VariableType.FLOAT_3,r.lightPos),e.sendStructureData("u_farPlane["+n+"]",t.VariableType.FLOAT_1,r.farPlane),e.sendStructureData("u_cubemapShadowBias["+n+"]",t.VariableType.FLOAT_1,r.shadowBias),e.sendStructureData("u_cubemapShadowDarkness["+n+"]",t.VariableType.FLOAT_1,r.shadowDarkness)})},r}(t.ShadowMapShaderLib);t.CubemapShadowMapShaderLib=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.type="noShadowMap"}return __extends(e,t),e.create=function(){var t=new this;return t},e.prototype.sendShaderVariables=function(t,e,r){},e}(t.ShaderLib);t.NoShadowMapShaderLib=e}(wd||(wd={}));var wd;!function(t){var e=function(){function t(){}return t.empty={top:"",define:"",varDeclare:"",funcDeclare:"",funcDefine:"",body:""},t.NULL=-1,t.morphNormal_vertex={top:"",define:"",varDeclare:"",funcDeclare:"",funcDefine:"",body:"vec3 a_normal = a_currentFrameNormal + (a_nextFrameNormal - a_currentFrameNormal) * u_interpolation;\n"},t.morphVertice_vertex={top:"",define:"",varDeclare:"",funcDeclare:"",funcDefine:"",body:"vec3 a_position = a_currentFramePosition + (a_nextFramePosition - a_currentFramePosition) * u_interpolation;\n"},t.basicEnd_fragment={top:"",define:"",varDeclare:"",funcDeclare:"",funcDefine:"",body:"gl_FragColor = vec4(totalColor.rgb, totalColor.a * u_opacity);\n"},t.basic_fragment={top:"",define:"",varDeclare:"varying vec3 v_color;\n",funcDeclare:"",funcDefine:"",body:"vec4 totalColor = vec4(v_color, 1.0);\n"},t.basic_vertex={top:"",define:"",varDeclare:"varying vec3 v_color;\n",
funcDeclare:"",funcDefine:"",body:"v_color = a_color;\n"},t.common_define={top:"",define:"#define NULL -1.0\n",varDeclare:"",funcDeclare:"",funcDefine:"",body:""},t.common_fragment={top:"",define:"",varDeclare:"",funcDeclare:"",funcDefine:"",body:""},t.common_function={top:"",define:"",varDeclare:"",funcDeclare:"",funcDefine:"mat2 transpose(mat2 m) {\n  return mat2(  m[0][0], m[1][0],   // new col 0\n                m[0][1], m[1][1]    // new col 1\n             );\n  }\nmat3 transpose(mat3 m) {\n  return mat3(  m[0][0], m[1][0], m[2][0],  // new col 0\n                m[0][1], m[1][1], m[2][1],  // new col 1\n                m[0][2], m[1][2], m[2][2]   // new col 1\n             );\n  }\n",body:""},t.common_vertex={top:"",define:"",varDeclare:"",funcDeclare:"",funcDefine:"",body:""},t.highp_fragment={top:"precision highp float;\nprecision highp int;\n",define:"",varDeclare:"",funcDeclare:"",funcDefine:"",body:""},t.lowp_fragment={top:"precision lowp float;\nprecision lowp int;\n",define:"",varDeclare:"",funcDeclare:"",funcDefine:"",body:""},t.mediump_fragment={top:"precision mediump float;\nprecision mediump int;\n",define:"",varDeclare:"",funcDeclare:"",funcDefine:"",body:""},t.lightCommon_fragment={top:"",define:"",varDeclare:"varying vec3 v_worldPosition;\n#if POINT_LIGHTS_COUNT > 0\nstruct PointLight {\n    vec3 position;\n    vec3 color;\n    float intensity;\n\n    float range;\n    float constant;\n    float linear;\n    float quadratic;\n};\nuniform PointLight u_pointLights[POINT_LIGHTS_COUNT];\n\n#endif\n\n\n#if DIRECTION_LIGHTS_COUNT > 0\nstruct DirectionLight {\n    vec3 position;\n\n    float intensity;\n\n    vec3 color;\n};\nuniform DirectionLight u_directionLights[DIRECTION_LIGHTS_COUNT];\n#endif\n",funcDeclare:"",funcDefine:"",body:""},t.lightCommon_vertex={top:"",define:"",varDeclare:"varying vec3 v_worldPosition;\n#if POINT_LIGHTS_COUNT > 0\nstruct PointLight {\n    vec3 position;\n    vec3 color;\n    float intensity;\n\n    float range;\n    float constant;\n    float linear;\n    float quadratic;\n};\nuniform PointLight u_pointLights[POINT_LIGHTS_COUNT];\n\n#endif\n\n\n#if DIRECTION_LIGHTS_COUNT > 0\nstruct DirectionLight {\n    vec3 position;\n\n    float intensity;\n\n    vec3 color;\n};\nuniform DirectionLight u_directionLights[DIRECTION_LIGHTS_COUNT];\n#endif\n",funcDeclare:"",funcDefine:"",body:"v_worldPosition = vec3(u_mMatrix * vec4(a_position, 1.0));\n"},t.lightEnd_fragment={top:"",define:"",varDeclare:"",funcDeclare:"",funcDefine:"",body:"gl_FragColor = vec4(totalColor.rgb, totalColor.a * u_opacity);\n"},t.light_common={top:"",define:"",varDeclare:"",funcDeclare:"vec3 getDirectionLightDirByLightPos(vec3 lightPos);\nvec3 getPointLightDirByLightPos(vec3 lightPos);\nvec3 getPointLightDirByLightPos(vec3 lightPos, vec3 worldPosition);\n",funcDefine:"vec3 getDirectionLightDirByLightPos(vec3 lightPos){\n    return lightPos - vec3(0.0);\n    //return vec3(0.0) - lightPos;\n}\nvec3 getPointLightDirByLightPos(vec3 lightPos){\n    return lightPos - v_worldPosition;\n}\nvec3 getPointLightDirByLightPos(vec3 lightPos, vec3 worldPosition){\n    return lightPos - worldPosition;\n}\n",body:""},t.light_fragment={top:"",define:"",varDeclare:"",funcDeclare:"",funcDefine:"float getBlinnPhongShininess(float shininess, vec3 normal, vec3 lightDir, vec3 viewDir, float dotResultBetweenNormAndLight){\n    vec3 halfAngle = normalize(lightDir + viewDir);\n    float blinnTerm = dot(normal, halfAngle);\n\n    blinnTerm = clamp(blinnTerm, 0.0, 1.0);\n    blinnTerm = dotResultBetweenNormAndLight < 0.0 ? 0.0 : blinnTerm;\n    blinnTerm = pow(blinnTerm, shininess);\n\n	return blinnTerm;\n}\n\nvec3 calcLight(vec3 lightDir, vec3 color, float intensity, float attenuation, vec3 normal, vec3 viewDir)\n{\n    vec3 materialDiffuse = getMaterialDiffuse();\n    vec3 materialSpecular = getMaterialSpecular();\n\n    float dotResultBetweenNormAndLight = dot(normal, lightDir);\n    float diff = max(dotResultBetweenNormAndLight, 0.0);\n\n\n    vec3 ambientColor = u_ambient * materialDiffuse;\n\n    vec3 diffuseColor = diff * color * materialDiffuse * intensity;\n\n\n    float spec = getBlinnPhongShininess(u_shininess, normal, lightDir, viewDir, dotResultBetweenNormAndLight);\n\n    vec3 specularColor = spec * materialSpecular * intensity;\n\n    return  ambientColor + attenuation * (diffuseColor + specularColor);\n}\n\n\n\n\n\n#if POINT_LIGHTS_COUNT > 0\nvec3 calcPointLight(vec3 lightDir, PointLight light, vec3 normal, vec3 viewDir)\n{\n    //lightDir is not normalize computing distance\n    float distance = length(lightDir);\n\n    float attenuation = 0.0;\n    if(distance < light.range)\n    {\n        attenuation = 1.0 / (light.constant + light.linear * distance + light.quadratic * (distance * distance));\n    }\n\n    lightDir = normalize(lightDir);\n\n    return calcLight(lightDir, light.color, light.intensity, attenuation, normal, viewDir);\n}\n#endif\n\n\n\n#if DIRECTION_LIGHTS_COUNT > 0\nvec3 calcDirectionLight(vec3 lightDir, DirectionLight light, vec3 normal, vec3 viewDir)\n{\n    float attenuation = 1.0;\n\n    lightDir = normalize(lightDir);\n\n    return calcLight(lightDir, light.color, light.intensity, attenuation, normal, viewDir);\n}\n#endif\n\n\n\nvec3 calcTotalLight(vec3 norm, vec3 viewDir){\n    vec3 totalLight = vec3(0.0);\n\n    #if POINT_LIGHTS_COUNT > 0\n       for(int i = 0; i < POINT_LIGHTS_COUNT; i++){\n            totalLight += calcPointLight(getPointLightDir(i), u_pointLights[i], norm, viewDir);\n       }\n    #endif\n\n    #if DIRECTION_LIGHTS_COUNT > 0\n       for(int i = 0; i < DIRECTION_LIGHTS_COUNT; i++){\n            totalLight += calcDirectionLight(getDirectionLightDir(i), u_directionLights[i], norm, viewDir);\n       }\n    #endif\n\n    return totalLight;\n}\n",body:"vec3 normal = normalize(getNormal());\n\n	#ifdef BOTH_SIDE\n		normal = normal * (-1.0 + 2.0 * float(gl_FrontFacing));\n	#endif\n\n    vec3 viewDir = normalize(getViewDir());\n\n    vec4 totalColor = vec4(calcTotalLight(normal, viewDir), 1.0);\n\n    totalColor *= vec4(getShadowVisibility(), 1.0);\n"},t.light_vertex={top:"",define:"",varDeclare:"",funcDeclare:"",funcDefine:"",body:"gl_Position = u_pMatrix * u_vMatrix * vec4(v_worldPosition, 1.0);\n"},t.map_forBasic_fragment={top:"",define:"",varDeclare:"varying vec2 v_mapCoord;\n",funcDeclare:"",funcDefine:"",body:"totalColor *= texture2D(u_sampler2D0, v_mapCoord);\n"},t.map_forBasic_vertex={top:"",define:"",varDeclare:"varying vec2 v_mapCoord;\n",funcDeclare:"",funcDefine:"",body:"vec2 sourceTexCoord = a_texCoord * u_sourceRegion.zw + u_sourceRegion.xy;\n    v_mapCoord = sourceTexCoord * u_repeatRegion.zw + u_repeatRegion.xy;\n"},t.multi_map_forBasic_fragment={top:"",define:"",varDeclare:"",funcDeclare:"",funcDefine:"vec4 getMapColor(){\n            vec4 color0 = texture2D(u_sampler2D0, v_mapCoord);\n            vec4 color1 = texture2D(u_sampler2D1, v_mapCoord);\n            if(u_combineMode == 0){\n                return mix(color0, color1, u_mixRatio);\n            }\n            else if(u_combineMode == 1){\n                return color0 * color1;\n            }\n            else if(u_combineMode == 2){\n                return color0 + color1;\n            }\n		}\n",body:"totalColor *= getMapColor();\n"},t.mirror_forBasic_fragment={top:"",define:"",varDeclare:"varying vec4 v_mirrorCoord;\n",funcDeclare:"",funcDefine:"//todo add more blend way to mix mirror color and textureColor\n		float blendOverlay(float base, float blend) {\n			return( base < 0.5 ? ( 2.0 * base * blend ) : (1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n		}\n		vec4 getMirrorColor(in vec4 materialColor){\n			vec4 color = texture2DProj(u_mirrorSampler, v_mirrorCoord);\n\n			color = vec4(blendOverlay(materialColor.r, color.r), blendOverlay(materialColor.g, color.g), blendOverlay(materialColor.b, color.b), 1.0);\n\n			return color;\n		}\n",body:"totalColor = getMirrorColor(totalColor);\n"},t.mirror_forBasic_vertex={top:"",define:"",varDeclare:"varying vec4 v_mirrorCoord;\n",funcDeclare:"",funcDefine:"",body:"mat4 textureMatrix = mat4(\n                        0.5, 0.0, 0.0, 0.0,\n                        0.0, 0.5, 0.0, 0.0,\n                        0.0, 0.0, 0.5, 0.0,\n                        0.5, 0.5, 0.5, 1.0\n);\n\nv_mirrorCoord = textureMatrix * gl_Position;\n"},t.skybox_fragment={top:"",define:"",varDeclare:"varying vec3 v_dir;\n",funcDeclare:"",funcDefine:"",body:"gl_FragColor = textureCube(u_samplerCube0, v_dir);\n"},t.skybox_vertex={top:"",define:"",varDeclare:"varying vec3 v_dir;\n",funcDeclare:"",funcDefine:"",body:"vec4 pos = u_pMatrix * mat4(mat3(u_vMatrix)) * u_mMatrix * vec4(a_position, 1.0);\n\n    gl_Position = pos.xyww;\n\n    v_dir = a_position;\n"},t.basic_envMap_forBasic_fragment={top:"",define:"",varDeclare:"varying vec3 v_dir;\n",funcDeclare:"",funcDefine:"",body:"totalColor *= textureCube(u_samplerCube0, v_dir);\n"},t.basic_envMap_forBasic_vertex={top:"",define:"",varDeclare:"varying vec3 v_dir;\n",funcDeclare:"",funcDefine:"",body:"v_dir = a_position;\n"},t.envMap_forBasic_fragment={top:"",define:"",varDeclare:"varying vec3 v_normal;\nvarying vec3 v_position;\n",funcDeclare:"",funcDefine:"",body:"vec3 inDir = normalize(v_position - u_cameraPos);\n"},t.envMap_forBasic_vertex={top:"",define:"",varDeclare:"varying vec3 v_normal;\nvarying vec3 v_position;\n",funcDeclare:"",funcDefine:"",body:"v_normal = normalize( u_normalMatrix * a_normal);\n    v_position = vec3(u_mMatrix * vec4(a_position, 1.0));\n"},t.fresnel_forBasic_fragment={top:"",define:"",varDeclare:"",funcDeclare:"",funcDefine:"float computeFresnelRatio(vec3 inDir, vec3 normal, float refractionRatio){\n    float f = pow(1.0 - refractionRatio, 2.0) / pow(1.0 + refractionRatio, 2.0);\n    float fresnelPower = 5.0;\n    float ratio = f + (1.0 - f) * pow((1.0 - dot(inDir, normal)), fresnelPower);\n\n    return ratio / 100.0;\n}\nvec4 getEnvMapTotalColor(vec3 inDir, vec3 normal){\n    vec3 reflectDir = reflect(inDir, normal);\n    vec3 refractDir = refract(inDir, normal, u_refractionRatio);\n\n    vec4 reflectColor = textureCube(u_samplerCube0, reflectDir);\n    vec4 refractColor = textureCube(u_samplerCube0, refractDir);\n\n    vec4 totalColor = vec4(0.0);\n\n	if(u_reflectivity != NULL){\n        totalColor = mix(reflectColor, refractColor, u_reflectivity);\n	}\n	else{\n        totalColor = mix(reflectColor, refractColor, computeFresnelRatio(inDir, normal, u_refractionRatio));\n	}\n\n	return totalColor;\n}\n",body:"totalColor *= getEnvMapTotalColor(inDir, normalize(v_normal));\n"},t.reflection_forBasic_fragment={top:"",define:"",varDeclare:"",funcDeclare:"",funcDefine:"",body:"totalColor *= textureCube(u_samplerCube0, reflect(inDir, normalize(v_normal)));\n"},t.refraction_forBasic_fragment={top:"",define:"",varDeclare:"",funcDeclare:"",funcDefine:"",body:"totalColor *= textureCube(u_samplerCube0, refract(inDir, normalize(v_normal), u_refractionRatio));\n"},t.basic_envMap_forLight_fragment={top:"",define:"",varDeclare:"varying vec3 v_basicEnvMap_dir;\n",funcDeclare:"",funcDefine:"",body:"totalColor *= textureCube(u_samplerCube0, v_basicEnvMap_dir);\n"},t.basic_envMap_forLight_vertex={top:"",define:"",varDeclare:"varying vec3 v_basicEnvMap_dir;\n",funcDeclare:"",funcDefine:"",body:"v_basicEnvMap_dir = a_position;\n"},t.envMap_forLight_fragment={top:"",define:"",varDeclare:"",funcDeclare:"",funcDefine:"",body:"vec3 inDir = normalize(v_worldPosition - u_cameraPos);\n"},t.envMap_forLight_vertex={top:"",define:"",varDeclare:"",funcDeclare:"",funcDefine:"",body:""},t.fresnel_forLight_fragment={top:"",define:"",varDeclare:"",funcDeclare:"",funcDefine:"float computeFresnelRatio(vec3 inDir, vec3 normal, float refractionRatio){\n    float f = pow(1.0 - refractionRatio, 2.0) / pow(1.0 + refractionRatio, 2.0);\n    float fresnelPower = 5.0;\n    float ratio = f + (1.0 - f) * pow((1.0 - dot(inDir, normal)), fresnelPower);\n\n    return ratio / 100.0;\n}\n\nvec4 getEnvMapTotalColor(vec3 inDir, vec3 normal){\n    vec3 reflectDir = reflect(inDir, normal);\n    vec3 refractDir = refract(inDir, normal, u_refractionRatio);\n\n    vec4 reflectColor = textureCube(u_samplerCube0, reflectDir);\n    vec4 refractColor = textureCube(u_samplerCube0, refractDir);\n\n    vec4 totalColor = vec4(0.0);\n\n	if(u_reflectivity != NULL){\n        totalColor = mix(reflectColor, refractColor, u_reflectivity);\n	}\n	else{\n        totalColor = mix(reflectColor, refractColor, computeFresnelRatio(inDir, normal, u_refractionRatio));\n	}\n\n	return totalColor;\n}\n",body:"totalColor *= getEnvMapTotalColor(inDir, normalize(getNormal()));\n"},t.reflection_forLight_fragment={top:"",define:"",varDeclare:"",funcDeclare:"",funcDefine:"",body:"totalColor *= textureCube(u_samplerCube0, reflect(inDir, normalize(getNormal())));\n"},t.refraction_forLight_fragment={top:"",define:"",varDeclare:"",funcDeclare:"",funcDefine:"",body:"totalColor *= textureCube(u_samplerCube0, refract(inDir, getNormal(), u_refractionRatio));\n"},t.diffuseMap_fragment={top:"",define:"",varDeclare:"varying vec2 v_diffuseMapTexCoord;\n",funcDeclare:"",funcDefine:"vec3 getMaterialDiffuse() {\n        return vec3(texture2D(u_diffuseMapSampler, v_diffuseMapTexCoord));\n    }\n",body:""},t.diffuseMap_vertex={top:"",define:"",varDeclare:"varying vec2 v_diffuseMapTexCoord;\n",funcDeclare:"",funcDefine:"",body:"vec2 sourceTexCoord = a_texCoord * u_sourceRegion.zw + u_sourceRegion.xy;\n    v_diffuseMapTexCoord = sourceTexCoord * u_repeatRegion.zw + u_repeatRegion.xy;\n    //v_diffuseMapTexCoord = a_texCoord;\n"},t.noDiffuseMap_fragment={top:"",define:"",varDeclare:"",funcDeclare:"",funcDefine:"vec3 getMaterialDiffuse() {\n        return u_diffuse;\n    }\n",body:""},t.noNormalMap_fragment={top:"",define:"",varDeclare:"varying vec3 v_normal;\n",funcDeclare:"vec3 getNormal();\n\n",funcDefine:"#if POINT_LIGHTS_COUNT > 0\nvec3 getPointLightDir(int index){\n    //workaround '[] : Index expression must be constant' error\n    for (int x = 0; x <= POINT_LIGHTS_COUNT; x++) {\n        if(x == index){\n            return getPointLightDirByLightPos(u_pointLights[x].position);\n        }\n    }\n}\n#endif\n\n#if DIRECTION_LIGHTS_COUNT > 0\nvec3 getDirectionLightDir(int index){\n    //workaround '[] : Index expression must be constant' error\n    for (int x = 0; x <= DIRECTION_LIGHTS_COUNT; x++) {\n        if(x == index){\n            return getDirectionLightDirByLightPos(u_directionLights[x].position);\n        }\n    }\n\n    /*!\n    try to solve error in window7 chrome/firefox:\n    not all control paths return a value.\n    failed to create d3d shaders\n    */\n    return vec3(0.0);\n}\n#endif\n\n\nvec3 getViewDir(){\n    return normalize(u_cameraPos - v_worldPosition);\n}\nvec3 getNormal(){\n    return v_normal;\n}\n\n",body:""},t.noNormalMap_vertex={top:"",define:"",varDeclare:"varying vec3 v_normal;\n",funcDeclare:"",funcDefine:"",body:"//v_normal = normalize( vec3(u_normalMatrix * vec4(a_normal, 1.0)));\n    v_normal = normalize( u_normalMatrix * a_normal);\n"},t.noSpecularMap_fragment={top:"",define:"",varDeclare:"",funcDeclare:"",funcDefine:"vec3 getMaterialSpecular() {\n        return u_specular;\n    }\n",body:""},t.normalMap_fragment={top:"",define:"",varDeclare:"varying vec2 v_normalMapTexCoord;\nvarying vec3 v_viewDir;\n#if POINT_LIGHTS_COUNT > 0\nvarying vec3 v_pointLightDir[POINT_LIGHTS_COUNT];\n#endif\n\n#if DIRECTION_LIGHTS_COUNT > 0\nvarying vec3 v_directionLightDir[DIRECTION_LIGHTS_COUNT];\n#endif\n\n",funcDeclare:"vec3 getNormal();\n\nvec3 getLightDir(vec3 lightPos);\n\n",funcDefine:"#if POINT_LIGHTS_COUNT > 0\nvec3 getPointLightDir(int index){\n    //workaround '[] : Index expression must be constant' error\n    for (int x = 0; x <= POINT_LIGHTS_COUNT; x++) {\n        if(x == index){\n            return v_pointLightDir[x];\n        }\n    }\n}\n#endif\n\n#if DIRECTION_LIGHTS_COUNT > 0\n\nvec3 getDirectionLightDir(int index){\n    //workaround '[] : Index expression must be constant' error\n    for (int x = 0; x <= DIRECTION_LIGHTS_COUNT; x++) {\n        if(x == index){\n            return v_directionLightDir[x];\n        }\n    }\n\n    /*!\n    solve error in window7 chrome/firefox:\n    not all control paths return a value.\n    failed to create d3d shaders\n    */\n    return vec3(0.0);\n}\n#endif\n\n\nvec3 getViewDir(){\n    return v_viewDir;\n}\nvec3 getNormal(){\n        // Obtain normal from normal map in range [0,1]\n        vec3 normal = texture2D(u_normalMapSampler, v_normalMapTexCoord).rgb;\n\n        // Transform normal vector to range [-1,1]\n        return normalize(normal * 2.0 - 1.0);  // this normal is in tangent space\n}\n",body:""},t.normalMap_vertex={top:"",define:"",varDeclare:"varying vec2 v_normalMapTexCoord;\n	varying vec3 v_viewDir;\n\n\n#if POINT_LIGHTS_COUNT > 0\nvarying vec3 v_pointLightDir[POINT_LIGHTS_COUNT];\n#endif\n\n#if DIRECTION_LIGHTS_COUNT > 0\nvarying vec3 v_directionLightDir[DIRECTION_LIGHTS_COUNT];\n#endif\n\n",funcDeclare:"",funcDefine:"mat3 computeTBN(){\n            //vec3 T = normalize(normalMatrix * tangent);\n            //vec3 B = normalize(normalMatrix * bitangent);\n            //vec3 N = normalize(normalMatrix * normal);\n\n            vec3 T = normalize(u_normalMatrix * a_tangent);\n            vec3 N = normalize(u_normalMatrix * a_normal);\n            // re-orthogonalize T with respect to N\n            T = normalize(T - dot(T, N) * N);\n            // then retrieve perpendicular vector B with the cross product of T and N\n            vec3 B = cross(T, N);\n\n\n            return transpose(mat3(T, B, N));\n        }\n",body:"mat3 TBN = computeTBN();\n\n    //v_tangentLightPos = TBN * light.position;\n    //v_tangentCameraPos  = TBN * u_cameraPos;\n    //v_tangentPos  = TBN * v_position;\n\n\n    vec3 tangentPosition = TBN * vec3(u_mMatrix * vec4(a_position, 1.0));\n\n    v_normalMapTexCoord = a_texCoord;\n\n    v_viewDir = normalize(TBN * u_cameraPos - tangentPosition);\n\n\n#if POINT_LIGHTS_COUNT > 0\n       for(int i = 0; i < POINT_LIGHTS_COUNT; i++){\n            //not normalize for computing distance\n            v_pointLightDir[i] = TBN * getPointLightDirByLightPos(u_pointLights[i].position, tangentPosition);\n       }\n#endif\n\n#if DIRECTION_LIGHTS_COUNT > 0\n       for(int i = 0; i < DIRECTION_LIGHTS_COUNT; i++){\n            v_directionLightDir[i] = normalize(- TBN * getDirectionLightDirByLightPos(u_directionLights[i].position));\n       }\n#endif\n\n"},t.specularMap_fragment={top:"",define:"",varDeclare:"varying vec2 v_specularMapTexCoord;\n",funcDeclare:"",funcDefine:"vec3 getMaterialSpecular() {\n        return vec3(texture2D(u_specularMapSampler, v_specularMapTexCoord));\n    }\n",body:""},t.specularMap_vertex={top:"",define:"",varDeclare:"varying vec2 v_specularMapTexCoord;\n",funcDeclare:"",funcDefine:"",body:"v_specularMapTexCoord = a_texCoord;\n"},t.buildCubemapShadowMap_fragment={top:"",define:"",varDeclare:"varying vec3 v_worldPosition;\n",funcDeclare:"",funcDefine:"",body:"\n// get distance between fragment and light source\n    float lightDistance = length(v_worldPosition - u_lightPos);\n\n    // map to [0,1] range by dividing by farPlane\n    lightDistance = lightDistance / u_farPlane;\n\n\ngl_FragData[0] = packDepth(lightDistance);\n\n\n//gl_FragColor = vec4(0.5, 0.0, 1.0, 1.0);\n//gl_FragData[0] = vec4(lightDistance, 1.0, 1.0, 1.0);\n"},t.buildCubemapShadowMap_vertex={top:"",define:"",varDeclare:"varying vec3 v_worldPosition;\n",funcDeclare:"",funcDefine:"",body:"v_worldPosition = vec3(u_mMatrix * vec4(a_position, 1.0));\n    gl_Position = u_pMatrix * u_vMatrix * vec4(v_worldPosition, 1.0);\n"},t.buildTwoDShadowMap_fragment={top:"",define:"",varDeclare:"",funcDeclare:"",funcDefine:"",body:"gl_FragData[0] = packDepth(gl_FragCoord.z);\n"},t.buildTwoDShadowMap_vertex={top:"",define:"",varDeclare:"",funcDeclare:"",funcDefine:"",body:"gl_Position = u_vpMatrixFromLight * u_mMatrix * vec4(a_position, 1.0);\n//gl_Position = u_pMatrix* u_vMatrix * u_mMatrix * vec4(a_position, 1.0);\n"},t.commonBuildShadowMap_fragment={top:"",define:"",varDeclare:"",funcDeclare:"",funcDefine:"// Packing a float in GLSL with multiplication and mod\nvec4 packDepth(in float depth) {\n    const vec4 bit_shift = vec4(256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0);\n    const vec4 bit_mask = vec4(0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);\n    // combination of mod and multiplication and division works better\n    vec4 res = mod(depth * bit_shift * vec4(255), vec4(256) ) / vec4(255);\n    res -= res.xxyz * bit_mask;\n\n    return res;\n}\n",body:""},t.cubemapShadowMap_fragment={top:"",define:"",varDeclare:"uniform samplerCube u_cubemapShadowMapSampler[ CUBEMAP_SHADOWMAP_COUNT ];\n	uniform float u_cubemapShadowDarkness[ CUBEMAP_SHADOWMAP_COUNT ];\n	uniform float u_cubemapShadowBias[ CUBEMAP_SHADOWMAP_COUNT ];\n	uniform float u_farPlane[ CUBEMAP_SHADOWMAP_COUNT ];\n	uniform vec3 u_cubemapLightPos[ CUBEMAP_SHADOWMAP_COUNT ];\n",funcDeclare:"",funcDefine:"// PCF\nfloat getCubemapShadowVisibilityByPCF(float currentDepth, vec3 fragToLight, samplerCube cubemapShadowMapSampler, float shadowBias, float farPlane, float shadowDarkness){\n    //only support in opengl es 3.0+\n    //vec3 sampleOffsetDirections[20] = vec3[]\n    //(\n       //vec3( 1,  1,  1), vec3( 1, -1,  1), vec3(-1, -1,  1), vec3(-1,  1,  1),\n       //vec3( 1,  1, -1), vec3( 1, -1, -1), vec3(-1, -1, -1), vec3(-1,  1, -1),\n       //vec3( 1,  1,  0), vec3( 1, -1,  0), vec3(-1, -1,  0), vec3(-1,  1,  0),\n       //vec3( 1,  0,  1), vec3(-1,  0,  1), vec3( 1,  0, -1), vec3(-1,  0, -1),\n       //vec3( 0,  1,  1), vec3( 0, -1,  1), vec3( 0, -1, -1), vec3( 0,  1, -1)\n    //);\n\n    vec3 sampleOffsetDirections[20];\n\n    sampleOffsetDirections[0] = vec3( 1,  1,  1);\n    sampleOffsetDirections[1] = vec3( 1,  -1,  1);\n    sampleOffsetDirections[2] = vec3( -1,  -1,  1);\n    sampleOffsetDirections[3] = vec3( -1,  1,  1);\n\n    sampleOffsetDirections[4] = vec3( 1,  1,  -1);\n    sampleOffsetDirections[5] = vec3( 1,  -1,  -1);\n    sampleOffsetDirections[6] = vec3( -1,  -1,  -1);\n    sampleOffsetDirections[7] = vec3( -1,  1,  -1);\n\n    sampleOffsetDirections[8] = vec3( 1,  1,  0);\n    sampleOffsetDirections[9] = vec3( 1,  -1,  0);\n    sampleOffsetDirections[10] = vec3( -1,  -1,  0);\n    sampleOffsetDirections[11] = vec3( -1,  1,  0);\n\n    sampleOffsetDirections[12] = vec3( 1,  0,  1);\n    sampleOffsetDirections[13] = vec3( -1,  0,  1);\n    sampleOffsetDirections[14] = vec3( 1,  0,  -1);\n    sampleOffsetDirections[15] = vec3( -1,  0,  -1);\n\n    sampleOffsetDirections[16] = vec3( 0,  1,  1);\n    sampleOffsetDirections[17] = vec3( 0,  -1,  1);\n    sampleOffsetDirections[18] = vec3( 0,  -1,  -1);\n    sampleOffsetDirections[19] = vec3( 0,  1,  -1);\n\n    float shadow = 0.0;\n    int samples = 20;\n\n    //float diskRadius = 0.00000;\n    //Another interesting trick we can apply here is that we can change the diskRadius based on how far the viewer is away from a fragment; this way we can increase the offset radius by the distance to the viewer, making the shadows softer when far away and sharper when close by.\n    float viewDistance = length(u_cameraPos - v_worldPosition);\n    float diskRadius = (1.0 + (viewDistance / farPlane)) / 25.0;\n\n    //for(int i = 0; i < samples; ++i)\n    for(int i = 0; i < 20; ++i)\n    {\n        float pcfDepth = unpackDepth(textureCube(cubemapShadowMapSampler, fragToLight + sampleOffsetDirections[i] * diskRadius));\n        pcfDepth *= farPlane;   // Undo mapping [0;1]\n        shadow += currentDepth - shadowBias > pcfDepth  ? shadowDarkness : 1.0;\n    }\n    shadow /= float(samples);\n\n    return shadow;\n}\n\n\nfloat getCubemapShadowVisibility(vec3 lightDir, samplerCube cubemapShadowMapSampler, vec3 lightPos, float farPlane, float shadowBias, float  shadowDarkness) {\n// Get vector between fragment position and light position\n    vec3 fragToLight= v_worldPosition - lightPos;\n    // Use the light to fragment vector to sample from the depth map\n    // Now get current linear depth as the length between the fragment and light position\n    float currentDepth = length(fragToLight);\n\n    #if defined(SHADOWMAP_TYPE_PCF)\n    return getCubemapShadowVisibilityByPCF(currentDepth, fragToLight, cubemapShadowMapSampler, getShadowBias(lightDir, shadowBias), farPlane, shadowDarkness);\n    #endif\n\n    float closestDepth = unpackDepth(textureCube(cubemapShadowMapSampler, fragToLight));\n\n    // It is currently in linear range between [0,1]. Re-transform back to original value\n    closestDepth *= farPlane;\n\n\n    return float(currentDepth > closestDepth + getShadowBias(lightDir, shadowBias) ? shadowDarkness : 1.0);\n}\n",body:""},t.noShadowMap_fragment={top:"",define:"",varDeclare:"",funcDeclare:"",funcDefine:"vec3 getShadowVisibility() {\n        return vec3(1.0);\n    }\n",body:""},t.totalShadowMap_fragment={top:"",define:"",varDeclare:"",funcDeclare:"float getShadowBias(vec3 lightDir, float shadowBias);\nfloat unpackDepth(vec4 rgbaDepth);\n",funcDefine:"float getShadowBias(vec3 lightDir, float shadowBias){\n    float bias = shadowBias;\n\n    if(shadowBias == NULL){\n        bias = 0.005;\n    }\n\n\n     /*!\n     A shadow bias of 0.005 solves the issues of our scene by a large extent, but some surfaces that have a steep angle to the light source might still produce shadow acne. A more solid approach would be to change the amount of bias based on the surface angle towards the light: something we can solve with the dot product:\n     */\n\n     return max(bias * (1.0 - dot(normalize(getNormal()), lightDir)), bias);\n\n    //return bias;\n}\n\nfloat unpackDepth(vec4 rgbaDepth) {\n    const vec4 bitShift = vec4(1.0 / (256.0 * 256.0 * 256.0), 1.0 / (256.0 * 256.0), 1.0 / 256.0, 1.0);\n    return dot(rgbaDepth, bitShift);\n}\n\nvec3 getShadowVisibility() {\n    vec3 shadowColor = vec3(1.0);\n    vec3 twoDLightDir = vec3(0.0);\n    vec3 cubemapLightDir = vec3(0.0);\n\n\n    //to normalMap, the lightDir use the origin one instead of normalMap's lightDir here(the lightDir is used for computing shadowBias, the origin one is enough for it)\n\n    #if TWOD_SHADOWMAP_COUNT > 0\n	for( int i = 0; i < TWOD_SHADOWMAP_COUNT; i ++ ) {\n        twoDLightDir = getDirectionLightDirByLightPos(u_twoDLightPos[i]);\n\n	////if is opposite to direction of light rays, no shadow\n\n        shadowColor *= getTwoDShadowVisibility(twoDLightDir, u_twoDShadowMapSampler[i], v_positionFromLight[i], u_twoDShadowBias[i], u_twoDShadowDarkness[i], u_twoDShadowSize[i]);\n	}\n	#endif\n\n\n	#if CUBEMAP_SHADOWMAP_COUNT > 0\n	for( int i = 0; i < CUBEMAP_SHADOWMAP_COUNT; i ++ ) {\n        cubemapLightDir = getPointLightDirByLightPos(u_cubemapLightPos[i]);\n\n	////if is opposite to direction of light rays, no shadow\n\n        shadowColor *= getCubemapShadowVisibility(cubemapLightDir, u_cubemapShadowMapSampler[i], u_cubemapLightPos[i], u_farPlane[i], u_cubemapShadowBias[i], u_cubemapShadowDarkness[i]);\n	}\n	#endif\n\n	return shadowColor;\n}\n\n",body:""},t.twoDShadowMap_fragment={top:"",define:"",varDeclare:"varying vec4 v_positionFromLight[ TWOD_SHADOWMAP_COUNT ];\n	uniform sampler2D u_twoDShadowMapSampler[ TWOD_SHADOWMAP_COUNT ];\n	uniform float u_twoDShadowDarkness[ TWOD_SHADOWMAP_COUNT ];\n	uniform float u_twoDShadowBias[ TWOD_SHADOWMAP_COUNT ];\n	uniform vec2 u_twoDShadowSize[ TWOD_SHADOWMAP_COUNT ];\n	uniform vec3 u_twoDLightPos[ TWOD_SHADOWMAP_COUNT ];\n",funcDeclare:"",funcDefine:"// PCF\nfloat getTwoDShadowVisibilityByPCF(float currentDepth, vec2 shadowCoord, sampler2D twoDShadowMapSampler, float shadowBias, float shadowDarkness, vec2 shadowMapSize){\n\n    float shadow = 0.0;\n    vec2 texelSize = vec2(1.0 / shadowMapSize[0], 1.0 / shadowMapSize[1]);\n\n    for(int x = -1; x <= 1; ++x)\n    {\n        for(int y = -1; y <= 1; ++y)\n        {\n            float pcfDepth = unpackDepth(texture2D(twoDShadowMapSampler, shadowCoord + vec2(x, y) * texelSize));\n            shadow += currentDepth - shadowBias > pcfDepth  ? shadowDarkness : 1.0;\n        }\n    }\n    shadow /= 9.0;\n\n    return shadow;\n}\n\n\n\nfloat getTwoDShadowVisibility(vec3 lightDir, sampler2D twoDShadowMapSampler, vec4 v_positionFromLight, float shadowBias, float shadowDarkness, vec2 shadowSize) {\n    //project texture\n    vec3 shadowCoord = (v_positionFromLight.xyz / v_positionFromLight.w) / 2.0 + 0.5;\n    //vec3 shadowCoord = vec3(0.5, 0.5, 0.5);\n\n    #ifdef SHADOWMAP_TYPE_PCF\n    // Percentage-close filtering\n    // (9 pixel kernel)\n    return getTwoDShadowVisibilityByPCF(shadowCoord.z, shadowCoord.xy, twoDShadowMapSampler, getShadowBias(lightDir, shadowBias), shadowDarkness, shadowSize);\n\n    #else\n    return shadowCoord.z > unpackDepth(texture2D(twoDShadowMapSampler, shadowCoord.xy)) + getShadowBias(lightDir, shadowBias) ? shadowDarkness : 1.0;\n    #endif\n}\n",body:""},t.twoDShadowMap_vertex={top:"",define:"",varDeclare:"varying vec4 v_positionFromLight[ TWOD_SHADOWMAP_COUNT ];\nuniform mat4 u_vpMatrixFromLight[ TWOD_SHADOWMAP_COUNT ];\n",funcDeclare:"",funcDefine:"",body:"for( int i = 0; i < TWOD_SHADOWMAP_COUNT; i ++ ) {\n    v_positionFromLight[i] = u_vpMatrixFromLight[i] * vec4(v_worldPosition, 1.0);\n	}\n"},t}();t.ShaderChunk=e}(wd||(wd={}));var wd;!function(t){var e=function(){function t(){}return t.main_begin="void main(void){\n",t.main_end="}\n",t.setPos_mvp="gl_Position = u_pMatrix * u_vMatrix * u_mMatrix * vec4(a_position, 1.0);\n",t}();t.ShaderSnippet=e}(wd||(wd={}));var __decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(){function e(){this._blendType=null,this._blendSrc=t.BlendFunc.ONE,this._blendDst=t.BlendFunc.ZERO,this._blendEquation=t.BlendEquation.ADD,this.shader=t.Shader.create(),this.color=t.Color.create("#ffffff"),this.redWrite=!0,this.greenWrite=!0,this.blueWrite=!0,this.alphaWrite=!0,this.polygonOffsetMode=t.PolygonOffsetMode.NONE,this.side=t.Side.FRONT,this.blend=!1,this.blendFuncSeparate=null,this.blendEquationSeparate=[t.BlendEquation.ADD,t.BlendEquation.ADD],this.shading=t.Shading.FLAT,this.refractionRatio=0,this.reflectivity=t.ShaderChunk.NULL,this.mapCombineMode=t.TextureCombineMode.MIX,this.mapMixRatio=.5,this.mapManager=t.MapManager.create(this),this.geometry=null}return Object.defineProperty(e.prototype,"program",{get:function(){return this.shader.program},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendType",{get:function(){return this._blendType?this._blendType:this.blendSrc===t.BlendFunc.ONE&&this.blendDst===t.BlendFunc.ZERO&&this.blendEquation===t.BlendEquation.ADD?t.BlendType.NONE:this.blendSrc===t.BlendFunc.SRC_ALPHA&&this.blendDst===t.BlendFunc.ONE_MINUS_SRC_ALPHA&&this.blendEquation===t.BlendEquation.ADD?t.BlendType.NORMAL:this.blendSrc===t.BlendFunc.ONE&&this.blendDst===t.BlendFunc.ONE&&this.blendEquation===t.BlendEquation.ADD?t.BlendType.ADDITIVE:this.blendSrc===t.BlendFunc.SRC_ALPHA&&this.blendDst===t.BlendFunc.ONE&&this.blendEquation===t.BlendEquation.ADD?t.BlendType.ADDITIVEALPHA:this.blendSrc===t.BlendFunc.DST_COLOR&&this.blendDst===t.BlendFunc.ZERO&&this.blendEquation===t.BlendEquation.ADD?t.BlendType.MULTIPLICATIVE:this.blendSrc===t.BlendFunc.ONE&&this.blendDst===t.BlendFunc.ONE_MINUS_SRC_ALPHA&&this.blendEquation===t.BlendEquation.ADD?t.BlendType.PREMULTIPLIED:t.BlendType.NORMAL},set:function(e){switch(e){case t.BlendType.NONE:this.blend=!1,this.blendSrc=t.BlendFunc.ONE,this.blendDst=t.BlendFunc.ZERO,this.blendEquation=t.BlendEquation.ADD;break;case t.BlendType.NORMAL:this.blend=!0,this.blendSrc=t.BlendFunc.SRC_ALPHA,this.blendDst=t.BlendFunc.ONE_MINUS_SRC_ALPHA,this.blendEquation=t.BlendEquation.ADD;
break;case t.BlendType.PREMULTIPLIED:this.blend=!0,this.blendSrc=t.BlendFunc.ONE,this.blendDst=t.BlendFunc.ONE_MINUS_SRC_ALPHA,this.blendEquation=t.BlendEquation.ADD;break;case t.BlendType.ADDITIVE:this.blend=!0,this.blendSrc=t.BlendFunc.ONE,this.blendDst=t.BlendFunc.ONE,this.blendEquation=t.BlendEquation.ADD;break;case t.BlendType.ADDITIVEALPHA:this.blend=!0,this.blendSrc=t.BlendFunc.SRC_ALPHA,this.blendDst=t.BlendFunc.ONE,this.blendEquation=t.BlendEquation.ADD;break;case t.BlendType.MULTIPLICATIVE:this.blend=!0,this.blendSrc=t.BlendFunc.DST_COLOR,this.blendDst=t.BlendFunc.ZERO,this.blendEquation=t.BlendEquation.ADD;break;default:t.Log.error(!0,t.Log.info.FUNC_INVALID("blendType"))}this._blendType=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"envMap",{get:function(){return this.mapManager.getEnvMap()},set:function(t){this.mapManager.setEnvMap(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendSrc",{get:function(){return this._blendSrc},set:function(t){this._blendSrc=t,this.blendFuncSeparate=null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendDst",{get:function(){return this._blendDst},set:function(t){this._blendDst=t,this.blendFuncSeparate=null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendEquation",{get:function(){return this._blendEquation},set:function(t){this._blendEquation=t,this.blendEquationSeparate=null},enumerable:!0,configurable:!0}),e.prototype.init=function(){var e=this;this.shader.init(),this.mapManager.init(),t.EventManager.on(t.EngineEvent.AFTER_INIT,function(){e._addTopShaderLib(),e.addShaderLib()})},e.prototype.dispose=function(){this.mapManager.dispose()},e.prototype.updateTexture=function(){this.mapManager.update()},e.prototype.updateShader=function(e){var r=t.Director.getInstance().scene;r.isUseProgram?r.shader.update(e,this):this.shader.update(e,this)},e.prototype.addShaderLib=function(){},e.prototype.addMap=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];this.mapManager.addMap.apply(this.mapManager,t)},e.prototype.addNormalShaderLib=function(){this._hasAnimation()&&!this.shader.hasLib(t.MorphNormalShaderLib)?this._addShaderLibToTop(t.MorphNormalShaderLib.create()):this.shader.hasLib(t.CommonNormalShaderLib)||this._addShaderLibToTop(t.CommonNormalShaderLib.create())},e.prototype.setBlendByOpacity=function(t){1>t&&t>0?this.blend=!0:this.blend=!1},e.prototype._addTopShaderLib=function(){this.shader.addLib(t.CommonShaderLib.create()),this._hasAnimation()?(this.shader.addLib(t.MorphCommonShaderLib.create()),this.shader.addLib(t.MorphVerticeShaderLib.create())):this.shader.addLib(t.CommonVerticeShaderLib.create())},e.prototype._addShaderLibToTop=function(t){this.shader.addShaderLibToTop(t)},e.prototype._hasAnimation=function(){if(this.geometry instanceof t.ModelGeometry){var e=this.geometry;return e.hasAnimation()}return!1},__decorate([t.require(function(){t.assert(!(this.mirrorMap&&this.envMap),t.Log.info.FUNC_SHOULD_NOT("mirrorMap and envMap","be set both"))})],e.prototype,"init",null),__decorate([t.virtual],e.prototype,"addShaderLib",null),e}();t.Material=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this._opacity=1}return __extends(r,e),r.create=function(){var t=new this;return t},Object.defineProperty(r.prototype,"map",{set:function(e){if(e instanceof t.Texture||e instanceof t.TextureAsset)this.addMap(e);else{var r=arguments[0];wdCb.Log.error(r.length>2,wdCb.Log.info.FUNC_SUPPORT("only","map.count <= 2"));for(var n=0;n<r.length;n++){var o=r[n];this.addMap(o)}}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"mirrorMap",{get:function(){return this.mapManager.getMirrorMap()},set:function(t){this.mapManager.setMirrorMap(t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"opacity",{get:function(){return this._opacity},set:function(t){this.setBlendByOpacity(t),this._opacity=t},enumerable:!0,configurable:!0}),r.prototype.addShaderLib=function(){var e=null;this.shader.addLib(t.BasicShaderLib.create()),this._setMapShaderLib(),e=this.envMap,e&&this._setEnvMapShaderLib(e),this._setMirrorMapShaderLib(),this.shader.addLib(t.BasicEndShaderLib.create())},r.prototype._setMapShaderLib=function(){var e=this.mapManager,r=e.getMapCount(function(t){return!e.isMirrorMap(t)});r>0&&(r>1?this.shader.addLib(t.MultiMapShaderLib.create()):this.shader.addLib(t.BasicMapShaderLib.create()))},r.prototype._setEnvMapShaderLib=function(e){switch(this.addNormalShaderLib(),e.mode){case t.EnvMapMode.BASIC:this.shader.addLib(t.BasicEnvMapForBasicShaderLib.create());break;case t.EnvMapMode.REFLECTION:this.shader.addLib(t.ReflectionForBasicShaderLib.create());break;case t.EnvMapMode.REFRACTION:this.shader.addLib(t.RefractionForBasicShaderLib.create());break;case t.EnvMapMode.FRESNEL:this.shader.addLib(t.FresnelForBasicShaderLib.create());break;default:t.Log.error(!0,t.Log.info.FUNC_INVALID("EnvMapMode"))}},r.prototype._setMirrorMapShaderLib=function(){this.mirrorMap&&this.shader.addLib(t.MirrorForBasicShaderLib.create())},r}(t.Material);t.BasicMaterial=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.create=function(){var t=new this;return t.initWhenCreate(),t},r.prototype.initWhenCreate=function(){this.side=t.Side.BACK},r.prototype.addShaderLib=function(){this.shader.addLib(t.SkyboxShaderLib.create())},r}(t.Material);t.SkyboxMaterial=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this._diffuseMap=null,this._specularMap=null,this._normalMap=null,this._shininess=32,this._opacity=1,this.twoDShadowMapDatas=wdCb.Collection.create(),this.cubemapShadowMapDatas=wdCb.Collection.create(),this.buildTwoDShadowMapData=null,this.buildCubemapShadowMapData=null,this.specular=t.Color.create("0x111111"),this._twoDShadowMapSamplerIndex=0,this._cubemapShadowMapSamplerIndex=0}return __extends(r,e),r.create=function(){var t=new this;return t},Object.defineProperty(r.prototype,"diffuseMap",{get:function(){return this._diffuseMap},set:function(e){this.addMap(e,{samplerVariableName:t.VariableNameTable.getVariableName("diffuseMap")}),this._diffuseMap=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"specularMap",{get:function(){return this._specularMap},set:function(e){this.addMap(e,{samplerVariableName:t.VariableNameTable.getVariableName("specularMap")}),this._specularMap=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"normalMap",{get:function(){return this._normalMap},set:function(e){this.addMap(e,{samplerVariableName:t.VariableNameTable.getVariableName("normalMap")}),this._normalMap=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"shininess",{get:function(){return Number(this._shininess)<=0?32:this._shininess},set:function(t){this._shininess=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"opacity",{get:function(){return this._opacity},set:function(t){this.setBlendByOpacity(t),this._opacity=t},enumerable:!0,configurable:!0}),r.prototype.addTwoDShadowMap=function(t){this.addMap(t,{samplerData:this._twoDShadowMapSamplerIndex}),this._twoDShadowMapSamplerIndex++},r.prototype.addCubemapShadowMap=function(t){this.addMap(t,{samplerData:this._cubemapShadowMapSamplerIndex}),this._cubemapShadowMapSamplerIndex++},r.prototype.hasShadowMap=function(t){return this.mapManager.hasMap(t)},r.prototype.addTwoDShadowMapData=function(t){this.twoDShadowMapDatas.addChild(t)},r.prototype.addCubemapShadowMapData=function(t){this.cubemapShadowMapDatas.addChild(t)},r.prototype.clearTwoDShadowMapData=function(){this.twoDShadowMapDatas.removeAllChildren()},r.prototype.clearCubemapShadowMapData=function(){this.cubemapShadowMapDatas.removeAllChildren()},r.prototype.addShaderLib=function(){var e=null;this.addNormalShaderLib(),this.shader.addLib(t.LightCommonShaderLib.create()),this._setPhongMapShaderLib(),this.shader.addLib(t.LightShaderLib.create()),e=this.envMap,e&&this._setEnvMapShaderLib(e),this.shader.addLib(t.LightEndShaderLib.create())},r.prototype._setPhongMapShaderLib=function(){var e=t.Director.getInstance().scene;this._diffuseMap?this.shader.addLib(t.DiffuseMapShaderLib.create()):this.shader.addLib(t.NoDiffuseMapShaderLib.create()),this._specularMap?this.shader.addLib(t.SpecularMapShaderLib.create()):this.shader.addLib(t.NoSpecularMapShaderLib.create()),this._normalMap?this.shader.addLib(t.NormalMapShaderLib.create()):this.shader.addLib(t.NoNormalMapShaderLib.create()),e.shadowMap.enable&&(this._hasTwoDShadowMap()||this._hasCubemapShadowMap())?(this._hasTwoDShadowMap()&&this.shader.addLib(t.TwoDShadowMapShaderLib.create()),this._hasCubemapShadowMap()&&this.shader.addLib(t.CubemapShadowMapShaderLib.create()),this.shader.addLib(t.TotalShadowMapShaderLib.create())):this.shader.addLib(t.NoShadowMapShaderLib.create())},r.prototype._setEnvMapShaderLib=function(e){switch(e.mode){case t.EnvMapMode.BASIC:this.shader.addLib(t.BasicEnvMapForLightShaderLib.create());break;case t.EnvMapMode.REFLECTION:this.shader.addLib(t.ReflectionForLightShaderLib.create());break;case t.EnvMapMode.REFRACTION:this.shader.addLib(t.RefractionForLightShaderLib.create());break;case t.EnvMapMode.FRESNEL:this.shader.addLib(t.FresnelForLightShaderLib.create());break;default:t.Log.error(!0,t.Log.info.FUNC_INVALID("EnvMapMode"))}},r.prototype._hasTwoDShadowMap=function(){return this.mapManager.hasMap(function(e){return e instanceof t.TwoDShadowMapTexture})},r.prototype._hasCubemapShadowMap=function(){return this.mapManager.hasMap(function(e){return e instanceof t.CubemapShadowMapTexture})},r}(t.Material);t.LightMaterial=e}(wd||(wd={}));var wd;!function(t){!function(t){t[t.FLAT=0]="FLAT",t[t.SMOOTH=1]="SMOOTH"}(t.Shading||(t.Shading={}));t.Shading}(wd||(wd={}));var wd;!function(t){var e=function(){function e(t){this._material=null,this._textures=wdCb.Hash.create(),this._mirrorMap=null,this._material=t}return e.create=function(t){var e=new this(t);return e},e.prototype.init=function(){this._getMapList().forEach(function(t){t.init()})},e.prototype.addMap=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=null;if(e[0]instanceof t.TextureAsset){var o=e[0];n=o.toTexture()}else e[0]instanceof t.Texture&&(n=e[0]);if(2===e.length){var i=e[1];this._setMapOption(n,i)}n.material=this._material,this._textures.appendChild("map",n)},e.prototype.getMap=function(t){return this._textures.getChild("map").getChild(t)},e.prototype.hasMap=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var r=null;return r=this._textures.getChild("map"),r&&r.hasChild(t[0])},e.prototype.getMapCount=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];if(0===t.length){var r=this._textures.getChild("map");return r?r.getCount():0}var n=t[0],r=this._textures.getChild("map");return r?r.filter(n).getCount():0},e.prototype.getEnvMap=function(){return this._getMap("envMap")},e.prototype.setEnvMap=function(t){this._setMap("envMap",t)},e.prototype.getMirrorMap=function(){return this._mirrorMap},e.prototype.setMirrorMap=function(e){this.addMap(e,{samplerVariableName:t.VariableNameTable.getVariableName("mirrorReflectionMap")}),this._mirrorMap=e},e.prototype.isMirrorMap=function(t){return t===this._mirrorMap},e.prototype.removeAllChildren=function(){this._textures.removeAllChildren()},e.prototype.dispose=function(){this._getMapList().forEach(function(t){t.dispose()}),this.removeAllChildren()},e.prototype.update=function(){this._getMapList().filter(function(e){return e instanceof t.BasicTexture&&e.needUpdate}).forEach(function(t,e){t.update(e)})},e.prototype.sendData=function(t){this._getMapList().forEach(function(e,r){var n=e.getSamplerName(r),o=t.getUniformLocation(n);t.isUniformDataNotExistByLocation(o)||(e.bindToUnit(r),e.sendData(t,o,r))})},e.prototype._getMapList=function(){return this._textures.toCollection()},e.prototype._getMap=function(t){return this._textures.getChild(t)},e.prototype._setMap=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var r=t[0],n=t[1];if(!n)return void this._removeMap(r,n);if(3===arguments.length){var o=t[1];this._setMapOption(n,o)}n.material=this._material,this._textures.addChild(r,n)},e.prototype._removeMap=function(t,e){this._textures.removeChild(t)},e.prototype._setMapOption=function(t,e){t.variableData=e},e}();t.MapManager=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){this._container=wdCb.Hash.create()}return e.prototype.load=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=e[0],o=null,i=this,a=null,s=null;return o=1===e.length?t.JudgeUtils.isArray(n)?n.join("-"):n:e[1],a=this._container.getChild(o),s=a?wdFrp.just(a):this.loadAsset(n)["do"](function(t){i._container.addChild(o,t)},function(t){i._errorHandle(n,t)},null)},e.prototype.get=function(t){return this._container.getChild(t)},e.prototype.has=function(t){return this._container.hasChild(t)},e.prototype.dispose=function(){this._container.removeAllChildren()},e.prototype._errorHandle=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=null,o=null;n=t.JudgeUtils.isArray(e[0])?e[0].join(","):e[0],o=e[1],t.Log.log("load "+n+" asset fail:"+o)},e}();t.Loader=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.getInstance=function(){return null===this._instance&&(this._instance=new this),this._instance},r.prototype.loadAsset=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=e[0];return t.AjaxLoader.load(n,"text")},r._instance=null,__decorate([t.require(function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];t.assert(!t.JudgeUtils.isArray(e[0]),t.Log.info.FUNC_MUST_BE("url","string"))})],r.prototype,"loadAsset",null),r}(t.Loader);t.GLSLLoader=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.getInstance=function(){return null===this._instance&&(this._instance=new this),this._instance},r.prototype.loadAsset=function(){for(var t=this,e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=this,o=e[0];return wdFrp.fromPromise(new RSVP.Promise(function(e,r){var i=n._createScript();i.addEventListener("error",function(t){r("error")}),i.readyState?i.onreadystatechange=function(){("loaded"===i.readyState||"complete"===i.readyState)&&(i.onreadystatechange=null,e(o))}:i.onload=function(){e(o)},i.src=o,t._appendScript(i)}))},r.prototype._createScript=function(){var t=document.createElement("script");return t.type="text/javascript",t},r.prototype._appendScript=function(t){document.getElementsByTagName("head")[0].appendChild(t)},r._instance=null,__decorate([t.require(function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];t.assert(!t.JudgeUtils.isArray(e[0]),t.Log.info.FUNC_MUST_BE("url","string"))})],r.prototype,"loadAsset",null),r}(t.Loader);t.JsLoader=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.getInstance=function(){return null===this._instance&&(this._instance=new this),this._instance},r.prototype.loadAsset=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=null;return n=t.JudgeUtils.isString(e[0])?[e[0]]:e[0],wdFrp.fromPromise(new RSVP.Promise(function(e,r){t.Video.create({urlArr:n,onLoad:function(r){e(t.VideoTextureAsset.create(r))},onError:function(t){r(t)}})}))},r._instance=null,r}(t.Loader);t.VideoLoader=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.getInstance=function(){return null===this._instance&&(this._instance=new this),this._instance},r.prototype.loadAsset=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=null,o=null,i=e[0];switch(n=wdCb.PathUtils.extname(i).toLowerCase()){case".jpg":case".jpeg":case".gif":case".bmp":o=t.ImageLoader.load(i).map(function(e){var r=t.ImageTextureAsset.create(e);return r.format=t.TextureFormat.RGB,r});break;case".png":o=t.ImageLoader.load(i).map(function(e){return t.ImageTextureAsset.create(e)});break;case".dds":o=t.CompressedTextureLoader.load(i);break;default:t.Log.error(!0,t.Log.info.FUNC_NOT_SUPPORT(n))}return o},r._instance=null,__decorate([t.require(function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];t.assert(!t.JudgeUtils.isArray(e[0]),t.Log.info.FUNC_MUST_BE("url","string"))})],r.prototype,"loadAsset",null),r}(t.Loader);t.TextureLoader=e}(wd||(wd={}));var wd;!function(t){var e=function(){function t(){}return t.load=function(t){return wdFrp.fromPromise(new RSVP.Promise(function(e,r){var n=null;n=new Image,n.onload=function(){this.onload=null,e(n)},n.onerror=function(){r("error")},n.src=t}))},t}();t.ImageLoader=e}(wd||(wd={}));var wd;!function(t){var e=function(){function t(){}return t.load=function(t,e){return wdFrp.fromPromise(new RSVP.Promise(function(r,n){wdCb.AjaxUtils.ajax({type:"get",url:t,contentType:"text/plain; charset=utf-8",dataType:e,success:function(t){r(t)},error:function(e,r){n("url:"+t+"\nreadyState:"+e.readyState+"\nstatus:"+e.status+"\nmessage:"+r.message+"\nresponseText:"+e.responseText)}})}))},t}();t.AjaxLoader=e}(wd||(wd={}));var wd;!function(t){var e=function(){function t(){}return t.getPath=function(t,e){return wdCb.PathUtils.dirname(t)+"/"+e},t}();t.ModelLoaderUtils=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){}return e.load=function(e){var r=this;return t.AjaxLoader.load(e,"arraybuffer").map(function(e){var n=t.DDSParser.parse(e,!0),o=t.CompressedTextureAsset.create();return o.width=n.width,o.height=n.height,o.mipmaps=n.mipmaps,1==n.mipmapCount&&(o.minFilter=t.TextureFilterMode.LINEAR),o.format=r._getCompressedFormat(n.format),o})},e._getCompressedFormat=function(e){var r=t.GPUDetector.getInstance().extensionCompressedTextureS3TC;if(e===t.TextureFormat.RGBA)return e;if(!r)return null;switch(e){case t.TextureFormat.RGB_S3TC_DXT1:e=r.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case t.TextureFormat.RGBA_S3TC_DXT1:e=r.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case t.TextureFormat.RGBA_S3TC_DXT3:e=r.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case t.TextureFormat.RGBA_S3TC_DXT5:e=r.COMPRESSED_RGBA_S3TC_DXT5_EXT}return e},e}();t.CompressedTextureLoader=e}(wd||(wd={}));var wd;!function(t){var e=542327876,r=131072,n=512,o=4,i=function(){function i(){}return i.parse=function(i,s){void 0===s&&(s=!0);var c=new a,u=this._fourCCToInt32("DXT1"),h=this._fourCCToInt32("DXT3"),l=this._fourCCToInt32("DXT5"),p=31,f=0,d=1,_=2,y=3,m=4,g=7,v=20,b=21,w=22,C=23,T=24,S=25,D=26,O=28,x=new Int32Array(i,0,p),E=null,M=null,L=null,A=null,P=null,R=null,F=null;if(x[f]!==e)return t.Log.error(!0,"Invalid magic number in DDS header."),c;if(!x[v]&o)return t.Log.error(!0,"Unsupported format, must contain a FourCC code."),c;switch(M=x[b],L=!1,M){case u:E=8,c.format=t.TextureFormat.RGB_S3TC_DXT1;break;case h:E=16,c.format=t.TextureFormat.RGBA_S3TC_DXT3;break;case l:E=16,c.format=t.TextureFormat.RGBA_S3TC_DXT5;break;default:if(!(32==x[w]&&16711680&x[C]&&65280&x[T]&&255&x[S]&&4278190080&x[D]))return t.Log.error(!0,"Unsupported FourCC code "+this._int32ToFourCC(M)),c;L=!0,E=64,c.format=t.TextureFormat.RGBA}c.mipmapCount=1,x[_]&r&&s!==!1&&(c.mipmapCount=Math.max(1,x[g])),c.isCubemap=x[O]&n?!0:!1,c.width=x[m],c.height=x[y],A=x[d]+4,P=c.width,R=c.height,F=c.isCubemap?6:1;for(var N=0;F>N;N++){for(var U=0;U<c.mipmapCount;U++){var B=null,I=null,j=null;L?(I=this._loadARGBMip(i,A,P,R),j=I.length):(j=Math.max(4,P)/4*Math.max(4,R)/4*E,I=new Uint8Array(i,A,j)),B={data:I,width:P,height:R},c.mipmaps.addChild(B),A+=j,P=Math.max(.5*P,1),R=Math.max(.5*R,1)}P=c.width,R=c.height}return c},i._fourCCToInt32=function(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)},i._int32ToFourCC=function(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)},i._loadARGBMip=function(t,e,r,n){for(var o=r*n*4,i=new Uint8Array(t,e,o),a=new Uint8Array(o),s=0,c=0,u=0;n>u;u++)for(var h=0;r>h;h++){var l=null,p=null,f=null,d=null;l=i[c],c++,p=i[c],c++,f=i[c],c++,d=i[c],c++,a[s]=f,s++,a[s]=p,s++,a[s]=l,s++,a[s]=d,s++}return a},i}();t.DDSParser=i;var a=function(){function t(){this.mipmaps=wdCb.Collection.create(),this.width=0,this.height=0,this.format=null,this.mipmapCount=1,this.isCubemap=!1}return t}();t.DDSData=a}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){this._width=null,this._height=null,this.generateMipmaps=!0,this.sourceRegionMethod=t.TextureSourceRegionMethod.CHANGE_TEXCOORDS_IN_GLSL,this.format=t.TextureFormat.RGBA,this.source=e.defaultTexture,this.repeatRegion=t.RectRegion.create(0,0,1,1),this.sourceRegion=null,this.sourceRegionMapping=t.TextureSourceRegionMapping.CANVAS,this.flipY=!0,this.premultiplyAlpha=!1,this.unpackAlignment=4,this.wrapS=t.TextureWrapMode.CLAMP_TO_EDGE,this.wrapT=t.TextureWrapMode.CLAMP_TO_EDGE,this.magFilter=t.TextureFilterMode.LINEAR,this.minFilter=t.TextureFilterMode.LINEAR_MIPMAP_LINEAR,this.type=t.TextureType.UNSIGNED_BYTE,this.mipmaps=wdCb.Collection.create(),this.anisotropy=0,this.needUpdate=!0}return Object.defineProperty(e.prototype,"width",{get:function(){return null===this._width?this.source?this.source.width:null:this._width},set:function(t){this._width=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return null===this._height?this.source?this.source.height:null:this._height},set:function(t){this._height=t},enumerable:!0,configurable:!0}),e.prototype.copyToCubemapTexture=function(e){e.generateMipmaps=this.generateMipmaps,e.minFilter=this.minFilter,e.magFilter=this.magFilter,e.width=this.width,e.height=this.height,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.anisotropy=this.anisotropy,e.premultiplyAlpha=this.premultiplyAlpha,e.unpackAlignment=this.unpackAlignment,e.needUpdate=this.needUpdate,e.mode=t.EnvMapMode.BASIC},e.prototype.copyTo=function(e){return t.Log.error(!e,t.Log.info.FUNC_MUST_DEFINE("texture")),e.source=this.source,e.width=this.width,e.height=this.height,e.mipmaps=this.mipmaps.copy(),e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.repeatRegion=this.repeatRegion.copy(),e.sourceRegion=this.sourceRegion&&this.sourceRegion.copy(),e.sourceRegionMapping=this.sourceRegionMapping,e.sourceRegionMethod=this.sourceRegionMethod,e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e.needUpdate=this.needUpdate,e},e.defaultTexture=null,e}();t.TextureAsset=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(t){e.call(this),this.source=t}return __extends(r,e),r.create=function(t){var e=new this(t);return e},r.prototype.toTexture=function(){return t.ImageTexture.create(this)},r.prototype.toCubemapFaceTexture=function(){return t.CubemapFaceImageTexture.create(this)},r.prototype.copyToCubemapFaceTexture=function(e){e.source=this.source,e.type=this.type,e.format=this.format,e.width=this.width,e.height=this.height,e.sourceRegion=this.sourceRegion,e.sourceRegionMethod=t.TextureSourceRegionMethod.DRAW_IN_CANVAS},r}(t.TextureAsset);t.ImageTextureAsset=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(t){e.call(this),this.video=null,this.video=t,this.source=this.video.source}return __extends(r,e),r.create=function(t){var e=new this(t);return e.initWhenCreate(),e},r.prototype.initWhenCreate=function(){this.width=0,this.height=0,this.generateMipmaps=!1,this.minFilter=null,this.magFilter=null,this.sourceRegion=null,this.sourceRegionMethod=null},r.prototype.toTexture=function(){return t.VideoTexture.create(this)},r.prototype.toCubemapFaceTexture=function(){return t.Log.error(!0,t.Log.info.FUNC_NOT_SUPPORT("video texture","cubemap"))},r.prototype.copyToCubemapFaceTexture=function(e){t.Log.error(!0,t.Log.info.FUNC_NOT_SUPPORT("video texture","cubemap"))},r}(t.TextureAsset);t.VideoTextureAsset=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.create=function(){var t=new this;return t.initWhenCreate(),t},r.prototype.initWhenCreate=function(){this.generateMipmaps=!1,this.flipY=!1},r.prototype.toTexture=function(){return t.CompressedTexture.create(this)},r.prototype.toCubemapFaceTexture=function(){return t.CubemapFaceCompressedTexture.create(this)},r.prototype.copyToCubemapFaceTexture=function(t){t.type=this.type,t.format=this.format,t.width=this.width,t.height=this.height,t.mipmaps=this.mipmaps,t.minFilter=this.minFilter},r}(t.TextureAsset);t.CompressedTextureAsset=e}(wd||(wd={}));var wd;!function(t){!function(t){t[t.NEAREST="NEAREST"]="NEAREST",t[t.NEAREST_MIPMAP_MEAREST="NEAREST_MIPMAP_MEAREST"]="NEAREST_MIPMAP_MEAREST",t[t.NEAREST_MIPMAP_LINEAR="NEAREST_MIPMAP_LINEAR"]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR="LINEAR"]="LINEAR",t[t.LINEAR_MIPMAP_NEAREST="LINEAR_MIPMAP_NEAREST"]="LINEAR_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_LINEAR="LINEAR_MIPMAP_LINEAR"]="LINEAR_MIPMAP_LINEAR"}(t.TextureFilterMode||(t.TextureFilterMode={}));t.TextureFilterMode}(wd||(wd={}));var wd;!function(t){!function(t){t[t.REPEAT="REPEAT"]="REPEAT",t[t.MIRRORED_REPEAT="MIRRORED_REPEAT"]="MIRRORED_REPEAT",t[t.CLAMP_TO_EDGE="CLAMP_TO_EDGE"]="CLAMP_TO_EDGE"}(t.TextureWrapMode||(t.TextureWrapMode={}));t.TextureWrapMode}(wd||(wd={}));var wd;!function(t){!function(t){t[t.RGB="RGB"]="RGB",t[t.RGBA="RGBA"]="RGBA",t[t.ALPHA="ALPHA"]="ALPHA",t[t.LUMINANCE="LUMINANCE"]="LUMINANCE",t[t.LUMINANCE_ALPHA="LUMINANCE_ALPHA"]="LUMINANCE_ALPHA",t[t.RGB_S3TC_DXT1="RGB_S3TC_DXT1"]="RGB_S3TC_DXT1",t[t.RGBA_S3TC_DXT1="RGBA_S3TC_DXT1"]="RGBA_S3TC_DXT1",t[t.RGBA_S3TC_DXT3="RGBA_S3TC_DXT3"]="RGBA_S3TC_DXT3",t[t.RGBA_S3TC_DXT5="RGBA_S3TC_DXT5"]="RGBA_S3TC_DXT5"}(t.TextureFormat||(t.TextureFormat={}));t.TextureFormat}(wd||(wd={}));var wd;!function(t){!function(t){t[t.UNSIGNED_BYTE="UNSIGNED_BYTE"]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT_5_6_5="UNSIGNED_SHORT_5_6_5"]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4="UNSIGNED_SHORT_4_4_4_4"]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1="UNSIGNED_SHORT_5_5_5_1"]="UNSIGNED_SHORT_5_5_5_1"}(t.TextureType||(t.TextureType={}));t.TextureType}(wd||(wd={}));var wd;!function(t){!function(t){t[t.BASIC=0]="BASIC",t[t.REFLECTION=1]="REFLECTION",t[t.REFRACTION=2]="REFRACTION",t[t.FRESNEL=3]="FRESNEL"}(t.EnvMapMode||(t.EnvMapMode={}));t.EnvMapMode}(wd||(wd={}));var wd;!function(t){!function(t){t[t.MIX=0]="MIX",t[t.MULTIPLY=1]="MULTIPLY",t[t.ADD=2]="ADD"}(t.TextureCombineMode||(t.TextureCombineMode={}));t.TextureCombineMode}(wd||(wd={}));var wd;!function(t){!function(t){t[t.CANVAS=0]="CANVAS",t[t.UV=1]="UV"}(t.TextureSourceRegionMapping||(t.TextureSourceRegionMapping={}));t.TextureSourceRegionMapping}(wd||(wd={}));var wd;!function(t){!function(t){t[t.CHANGE_TEXCOORDS_IN_GLSL=0]="CHANGE_TEXCOORDS_IN_GLSL",t[t.DRAW_IN_CANVAS=1]="DRAW_IN_CANVAS"}(t.TextureSourceRegionMethod||(t.TextureSourceRegionMethod={}));t.TextureSourceRegionMethod}(wd||(wd={}));var wd;!function(t){!function(t){t[t.TEXTURE_2D="TEXTURE_2D"]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP="TEXTURE_CUBE_MAP"]="TEXTURE_CUBE_MAP"}(t.TextureTarget||(t.TextureTarget={}));t.TextureTarget}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){this.assetCount=0,this.currentLoadedCount=0,this._assetTable=wdCb.Hash.create()}return e.getInstance=function(){return null===this._instance&&(this._instance=new this),this._instance},e.prototype.load=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=this;if(t.JudgeUtils.isString(e[0])){var o=e[0],i=o;return this._createLoadSingleAssetStream(o,i)}var a=e[0];return wdFrp.fromArray(a).flatMap(function(t){return n._createLoadMultiAssetStream(t.url,t.id)})},e.prototype.reset=function(){this.assetCount=0,this.currentLoadedCount=0},e.prototype.dispose=function(){this.reset(),t.LoaderFactory.createAllLoader().forEach(function(t){t.dispose()})},e.prototype.get=function(t){return this._assetTable.getChild(t).get(t)},e.prototype._createLoadMultiAssetStream=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var r=t[0],n=t[1],o=this._getLoader(r),i=this;return o.has(n)||i.assetCount++,this._addToAssetTable(o.load(r,n).map(function(t){return i.currentLoadedCount++,{currentLoadedCount:i.currentLoadedCount,assetCount:i.assetCount}}),n,o)},e.prototype._createLoadSingleAssetStream=function(t,e){var r=this._getLoader(t);return this._addToAssetTable(r.load(t,e),e,r)},e.prototype._getLoader=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=null;return n=t.JudgeUtils.isArray(e[0])?wdCb.PathUtils.extname(e[0][0]):wdCb.PathUtils.extname(e[0]),t.LoaderFactory.create(n.toLowerCase())},e.prototype._addToAssetTable=function(t,e,r){var n=this;return t["do"](null,null,function(){n._assetTable.addChild(e,r)})},e._instance=null,
e}();t.LoaderManager=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){}return e.create=function(e){var r=null;switch(e){case".js":r=t.JsLoader.getInstance();break;case".glsl":r=t.GLSLLoader.getInstance();break;case".jpg":case".jpeg":case".png":case".dds":case".gif":case".bmp":r=t.TextureLoader.getInstance();break;case".mp4":case".ogv":case".webm":r=t.VideoLoader.getInstance();break;case".wd":r=t.WDLoader.getInstance();break;default:t.Log.error(!0,t.Log.info.FUNC_UNEXPECT(e))}return r},e.createAllLoader=function(){return wdCb.Collection.create([t.JsLoader.getInstance(),t.GLSLLoader.getInstance(),t.TextureLoader.getInstance(),t.VideoLoader.getInstance()])},e}();t.LoaderFactory=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this._wdParser=t.WDParser.create(),this._wdBuilder=t.WDBuilder.create(),this._parseData=null}return __extends(r,e),r.getInstance=function(){return null===this._instance&&(this._instance=new this),this._instance},r.prototype.loadAsset=function(){for(var e=this,r=[],n=0;n<arguments.length;n++)r[n-0]=arguments[n];var o=r[0],i=this;return t.AjaxLoader.load(o,"json").flatMap(function(t){return i._parseData=i._wdParser.parse(t),e._createLoadMapStream(o)}).concat(wdFrp.callFunc(function(){return i._wdBuilder.build(i._parseData)}))},r.prototype._createLoadMapStream=function(e){var r=[],n=this._parseData;return n.materials.forEach(function(n){var o=[];n.diffuseMapUrl&&o.push(["diffuseMap",n.diffuseMapUrl]),n.specularMapUrl&&o.push(["specularMap",n.specularMapUrl]),n.normalMapUrl&&o.push(["normalMap",n.normalMapUrl]),r.push(wdFrp.fromArray(o).flatMap(function(r){var o=r[0],i=r[1];return t.TextureLoader.getInstance().load(t.ModelLoaderUtils.getPath(e,i))["do"](function(t){n[o]=t.toTexture()},null,null)}))}),wdFrp.fromArray(r).mergeAll()},r._instance=null,__decorate([t.require(function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];t.assert(!t.JudgeUtils.isArray(e[0]),t.Log.info.FUNC_MUST_BE("url","string"))})],r.prototype,"loadAsset",null),r}(t.Loader);t.WDLoader=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){this._data={},this._objectParser=t.WDObjectParser.create()}return e.create=function(){var t=new this;return t},e.prototype.parse=function(t){return this._parseMetadata(t),this._parseScene(t),this._parseMaterial(t),this._parseObject(t),this._data},e.prototype._parseMetadata=function(t){this._data.metadata=t.metadata},e.prototype._parseObject=function(t){this._objectParser.parse(this._data,t)},e.prototype._parseScene=function(t){this._data.scene=t.scene,t.scene.ambientColor&&(this._data.scene.ambientColor=this._createColor(t.scene.ambientColor))},e.prototype._parseMaterial=function(t){var e=this;this._data.materials=wdCb.Hash.create(t.materials),this._data.materials.forEach(function(t){t.diffuseColor&&(t.diffuseColor=e._createColor(t.diffuseColor)),t.specularColor&&(t.specularColor=e._createColor(t.specularColor))})},e.prototype._createColor=function(e){return t.Color.create("rgb("+e.join(",").replace(/^(\d+),/g,"$1.0,").replace(/,(\d+),/g,",$1.0,").replace(/,(\d+)$/g,",$1.0")+")")},e}();t.WDParser=e}(wd||(wd={}));var __decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(){function e(){}return e.create=function(){var t=new this;return t},e.prototype.parse=function(t,e){var r=null,n=this;t.objects=wdCb.Collection.create(e.objects),r=function(t){n._isObjectContainer(t)?t.isContainer=!0:(t.isContainer=!1,n._parseFromIndices(t)),t.children&&(t.children=wdCb.Collection.create(t.children),t.children.forEach(function(e){e.parent=t,r(e)}))},t.objects.forEach(function(t){t.parent=null,r(t),n._removeObjectContainerData(t)})},e.prototype._isObjectContainer=function(e){return!t.GeometryUtils.hasData(e.verticeIndices)},e.prototype._parseFromIndices=function(t){this._duplicateVertexWithDifferentUvs(t),this._parseObjectFromIndices(t),this._removeRebundantIndiceData(t)},e.prototype._duplicateVertexWithDifferentUvs=function(e){var r=[],n=wdCb.Hash.create(),o=e.verticeIndices,i=e.uvIndices;if(t.GeometryUtils.hasData(i))for(var a=0,s=o.length;s>a;a++){var c=o[a];this._isSameVertexWithDifferentUvsByCompareToFirstOne(r,i[a],c)&&(this._isUvIndiceEqualTheOneOfAddedVertex(n,c,i[a])?o[a]=this._getVerticeIndexOfAddedVertexByFindContainer(n,c,i[a]):this._addVertexData(e,n,c,a),c=o[a]),r[c]=i[a]}},e.prototype._isSameVertexWithDifferentUvsByCompareToFirstOne=function(t,e,r){return void 0!==t[r]&&t[r]!==e},e.prototype._addVertexData=function(e,r,n,o){var i=e.verticeIndices,a=e.uvIndices,s=e.normalIndices,c=this._findData(e,"vertices"),u=this._findData(e,"normals"),h=this._findData(e,"morphTargets"),l=null;if(this._addThreeComponent(c,n),l=this._getVerticeIndexOfAddedVertex(c),i[o]=l,t.GeometryUtils.hasData(h))for(var p=0;p<h.length;p++){var f=h[p];this._addThreeComponent(f.vertices,n),t.GeometryUtils.hasData(f.normals)&&this._addDuplicateNormalOfAddedVertex(f.normals,s,o,n)}t.GeometryUtils.hasData(u)&&(this._addDuplicateNormalOfAddedVertex(u,s,o,n),t.GeometryUtils.hasData(s)&&(s[o]=l)),r.appendChild(String(n),[a[o],l])},e.prototype._addDuplicateNormalOfAddedVertex=function(e,r,n,o){return t.GeometryUtils.hasData(r)?void this._addThreeComponent(e,e,r[n]):void this._addThreeComponent(e,e,o)},e.prototype._isUvIndiceEqualTheOneOfAddedVertex=function(t,e,r){var n=t.getChild(String(e));return n?n.hasChild(function(t){var e=t[0];t[1];return e===r}):!1},e.prototype._getVerticeIndexOfAddedVertexByFindContainer=function(t,e,r){var n=t.getChild(String(e));return n.findOne(function(t){var e=t[0];t[1];return e===r})[1]},e.prototype._getVerticeIndexOfAddedVertex=function(t){return t.length/3-1},e.prototype._addThreeComponent=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];if(2===t.length){var r=t[0],n=t[1];r.push(r[3*n],r[3*n+1],r[3*n+2])}else{var o=t[0],i=t[1],n=t[2];o.push(i[3*n],i[3*n+1],i[3*n+2])}},e.prototype._parseObjectFromIndices=function(e){for(var r=[],n=[],o=null,i=this._findData(e,"vertices"),a=this._findData(e,"uvs"),s=this._findData(e,"normals"),c=this._findData(e,"colors"),u=0,h=e.verticeIndices.length;h>u;u+=3){var l=e.verticeIndices[u],p=e.verticeIndices[u+1],f=e.verticeIndices[u+2],d=[u,u+1,u+2],_=[l,p,f];o=t.Face3.create(l,p,f),t.GeometryUtils.hasData(e.uvIndices)&&t.GeometryUtils.hasData(a)&&this._setUV(r,a,e.uvIndices,d,_),t.GeometryUtils.hasData(s)&&this._setNormal(o.vertexNormals,s,e.normalIndices,d,_),n.push(o)}e.vertices=i,t.GeometryUtils.hasData(e.uvIndices)?e.uvs=r:e.uvs=a,e.colors=c,e.faces=n,this._setMorphTargets(e,e.verticeIndices,e.normalIndices)},e.prototype._getAnimName=function(t){var e=/([a-z]+)_?(\d+)/,r="default",n=t.match(e);return n&&n.length>1?n[1]:r},e.prototype._removeRebundantIndiceData=function(t){delete t.verticeIndices,delete t.uvIndices,delete t.normalIndices},e.prototype._removeObjectContainerData=function(t){var e=null;(e=function(t){t.isContainer&&(delete t.vertices,delete t.uvs,delete t.colors),t.children&&t.children.forEach(function(t){e(t)})})(t)},e.prototype._findData=function(t,e){var r=null;do r=t[e];while(!r&&null!==(t=t.parent));return r},e.prototype._setUV=function(t,e,r,n,o){var i=null,a=null,s=null,c=n[0],u=n[1],h=n[2],l=o[0],p=o[1],f=o[2];i=r[c],a=r[u],s=r[h],this._setTwoComponentData(t,e,l,i),this._setTwoComponentData(t,e,p,a),this._setTwoComponentData(t,e,f,s)},e.prototype._setTwoComponentData=function(t,e,r,n){t[2*r]=e[2*n],t[2*r+1]=e[2*n+1]},e.prototype._setThreeComponentData=function(t,e,r,n){t[3*r]=e[3*n],t[3*r+1]=e[3*n+1],t[3*r+2]=e[3*n+2]},e.prototype._getThreeComponentData=function(e,r){var n=3*r;return t.Vector3.create(e[n],e[n+1],e[n+2])},e.prototype._setNormal=function(e,r,n,o,i){var a=o[0],s=o[1],c=o[2];return t.GeometryUtils.hasData(n)?void this._addNormalData(e,r,[n[a],n[s],n[c]]):void this._addNormalData(e,r,i)},e.prototype._addNormalData=function(t,e,r){var n=r[0],o=r[1],i=r[2];if(t instanceof wdCb.Collection)t.addChildren([this._getThreeComponentData(e,n),this._getThreeComponentData(e,o),this._getThreeComponentData(e,i)]);else for(var a=t,s=0,c=[this._getThreeComponentData(e,n),this._getThreeComponentData(e,o),this._getThreeComponentData(e,i)];s<c.length;s++){var u=c[s];a.push(u.x,u.y,u.z)}},e.prototype._setMorphTargets=function(e,r,n){var o=this._findData(e,"morphTargets"),i=null,a=null;if(t.GeometryUtils.hasData(o)){i=wdCb.Hash.create(),a=wdCb.Hash.create();for(var s=0;s<o.length;s++){var c=o[s],u=this._getAnimName(c.name);if(i.appendChild(u,c.vertices),t.GeometryUtils.hasData(c.normals))if(t.GeometryUtils.hasData(n)){for(var h=[],l=0,p=r.length;p>l;l++)this._setThreeComponentData(h,c.normals,r[l],n[l]);a.appendChild(u,h)}else a.appendChild(u,c.normals)}}e.morphTargets=i,e.morphNormals=a},__decorate([t.require(function(e,r,n){t.assert(this._isUvIndiceEqualTheOneOfAddedVertex(e,r,n),t.Log.info.FUNC_SHOULD("uvIndex","equal the one of added vertex"))})],e.prototype,"_getVerticeIndexOfAddedVertexByFindContainer",null),__decorate([t.ensure(function(e,r){t.assert(!r.verticeIndices,t.Log.info.FUNC_SHOULD("object.verticeIndices","be removed")),t.assert(!r.uvIndices,t.Log.info.FUNC_SHOULD("object.uvIndices","be removed")),t.assert(!r.normalIndices,t.Log.info.FUNC_SHOULD("object.normalIndices","be removed"))})],e.prototype,"_removeRebundantIndiceData",null),e}();t.WDObjectParser=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){this._result=wdCb.Hash.create()}return e.create=function(){var t=new this;return t},e.prototype.build=function(t){return this._buildMetadata(t),this._buildScene(t),this._buildModels(t),this._result},e.prototype._buildMetadata=function(t){var e=wdCb.Hash.create();for(var r in t.metadata)t.metadata.hasOwnProperty(r)&&e.addChild(r,t.metadata[r]);this._result.addChild("metadata",e)},e.prototype._buildScene=function(t){var e=wdCb.Hash.create();t.scene.ambientColor&&e.addChild("ambientColor",t.scene.ambientColor),this._result.addChild("scene",e)},e.prototype._buildModels=function(e){var r=wdCb.Collection.create(),n=this,o=null;o=function(r,i){r.forEach(function(r){var a=null,s=null;s=t.GameObject.create(),n._isModelContainer(r)||(a=t.ModelGeometry.create(),a.vertices=r.vertices,a.faces=r.faces,a.texCoords=r.uvs,a.colors=r.colors,r.material&&(a.material=n._buildMaterial(r.material,e.materials)),a.morphTargets=r.morphTargets,a.morphFaceNormals=r.morphNormals,a.morphVertexNormals=r.morphNormals,t.GeometryUtils.hasData(a.morphTargets)&&s.addComponent(t.MorphAnimation.create()),s.addComponent(a)),s.name=r.name,s.addComponent(t.MeshRenderer.create()),i.addChild(s),r.children&&o(r.children,s)})},o(e.objects,r),this._result.addChild("models",r)},e.prototype._isModelContainer=function(t){return t.isContainer},e.prototype._buildMaterial=function(e,r){var n="LightMaterial",o=null,i=null,a=null;return s=r.findOne(function(t,r){return r===e}),o=s[1],i=o.type||n,wdCb.Log.error(!t[i],wdCb.Log.info.FUNC_NOT_EXIST("materialClass:"+i)),a=t[i].create(),a.name=e,o.diffuseColor&&(a.color=o.diffuseColor),o.specularColor&&(a.specular=o.specularColor),o.diffuseMap&&(a.diffuseMap=o.diffuseMap),o.specularMap&&(a.specularMap=o.specularMap),o.normalMap&&(a.normalMap=o.normalMap),null!==o.shininess&&(a.shininess=o.shininess),null!==o.opacity&&(a.opacity=o.opacity),a;var s},e}();t.WDBuilder=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){this._listenerMap=wdCb.Hash.create()}return e.create=function(){var t=new this;return t},e.prototype.appendChild=function(t,e,r){this._listenerMap.appendChild(this._buildKey(t,e),r)},e.prototype.getChild=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=this;if(1===e.length&&t.JudgeUtils.isString(e[0])){var o=e[0];return this._listenerMap.getChild(o)}if(1===e.length){var i=e[0];return this._listenerMap.filter(function(t,e){return n.isTarget(e,i,t)})}if(2===e.length){var i=e[0],o=e[1];return this._listenerMap.getChild(this._buildKey(i,o))}},e.prototype.hasChild=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];if(1===e.length&&t.JudgeUtils.isFunction(e[0]))return this._listenerMap.hasChild(e[0]);if(2===e.length){var n=e[0],o=e[1],i=this._listenerMap.getChild(this._buildKey(n,o));return i&&i.getCount()>0}},e.prototype.filter=function(t){return this._listenerMap.filter(t)},e.prototype.forEach=function(t){return this._listenerMap.forEach(t)},e.prototype.removeChild=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=this,o=null;if(1===e.length&&t.JudgeUtils.isString(e[0])){var i=e[0];o=this._listenerMap.removeChild(i)}else if(2===e.length&&t.JudgeUtils.isFunction(e[1])){var i=e[0],a=e[1],s=null;s=this._listenerMap.getChild(i),o=wdCb.Collection.create().addChild(s.removeChild(function(t){return t.originHandler===a})),0===s.getCount()&&this._listenerMap.removeChild(i)}else if(2===e.length&&t.JudgeUtils.isNumber(e[0])){var c=e[0],i=e[1];o=this._listenerMap.removeChild(this._buildKey(c,i))}else if(1===e.length){var u=e[0];o=this._listenerMap.removeChild(function(t,e){return n.isTarget(e,u,t)})}else if(2===e.length){var u=e[0],i=e[1];o=this._listenerMap.removeChild(this._buildKey(u,i))}else if(3===e.length){var u=e[0],i=e[1],h=wdCb.Collection.create(),a=e[2];this._listenerMap.forEach(function(t,e){var r=t.removeChild(function(t){return t.originHandler===a});return r.getCount()>0&&h.addChild(r),0===t.getCount()?wdCb.$REMOVE:void 0}),o=h}return o},e.prototype.getEventOffDataList=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var r=wdCb.Collection.create(),n=t[0],o=this;if(1===t.length)return this.getChild(n).forEach(function(t,e){t&&t.getCount()>0&&r.addChild({eventName:o.getEventNameFromKey(e),domHandler:t.getChild(0).domHandler})}),r;if(2===t.length){var i=t[1],a=this.getChild(n,i);return a&&a.getCount()>0&&r.addChild({eventName:i,domHandler:a.getChild(0).domHandler}),r}},e.prototype.getEventNameFromKey=function(t){var r=""+e.eventSeparator;return t.indexOf(r)>-1?t.split(r)[1]:t},e.prototype.getUidFromKey=function(t){var r=""+e.eventSeparator;return t.indexOf(r)>-1?Number(t.split(r)[0]):null},e.prototype.isTarget=function(t,e,r){return t.indexOf(String(e.uid))>-1&&void 0!==r},e.prototype._buildKey=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];if(t.JudgeUtils.isNumber(e[0])){var n=e[0],o=e[1];return this._buildKeyWithUid(n,o)}var i=e[0],o=e[1];return i?this._buildKeyWithUid(i.uid,o):o},e.prototype._buildKeyWithUid=function(t,r){return""+String(t)+e.eventSeparator+r},e.eventSeparator="@",e}();t.EventListenerMap=e}(wd||(wd={}));var wd;!function(t){!function(t){t[t.MOUSE=0]="MOUSE",t[t.KEYBOARD=1]="KEYBOARD",t[t.CUSTOM=2]="CUSTOM"}(t.EventType||(t.EventType={}));t.EventType}(wd||(wd={}));var wd;!function(t){var e;!function(t){t[t.FALLBACK="fallback"]="FALLBACK",t[t.FIREFOX="firefox"]="FIREFOX",t[t.CHROME="chrome"]="CHROME"}(e||(e={})),function(t){t[t.CLICK="click"]="CLICK",t[t.MOUSEOVER="mouseover"]="MOUSEOVER",t[t.MOUSEUP="mouseup"]="MOUSEUP",t[t.MOUSEOUT="mouseout"]="MOUSEOUT",t[t.MOUSEMOVE="mousemove"]="MOUSEMOVE",t[t.MOUSEDOWN="mousedown"]="MOUSEDOWN",t[t.MOUSEWHEEL="mousewheel|DOMMouseScroll*"+e.FIREFOX]="MOUSEWHEEL",t[t.KEYDOWN="keydown"]="KEYDOWN",t[t.KEYUP="keyup"]="KEYUP",t[t.KEYPRESS="keypress"]="KEYPRESS"}(t.EventName||(t.EventName={}));var r=(t.EventName,"|"),n="*",o=function(){function t(){}return t.handleEventName=function(t){for(var e=t,n=null,o=[],i=null,a=0,s=e.split(r);a<s.length;a++){var c=s[a];this._isFallbackEventName(c)?n=c:o.push(c)}return i=this._getSpecifyBrowserEventName(o),null!==i?i:n},t._isFallbackEventName=function(t){return 1===t.split(n).length},t._getSpecifyBrowserEventName=function(t){for(var r=null,o=0;o<t.length;o++){var i=t[o],a=i.split(n),s=a[0],c=a[1];switch(c){case e.CHROME:bowser.chrome&&(r=s);break;case e.FIREFOX:bowser.firefox&&(r=s)}if(r)break}return r},t}();t.EventNameHandler=o}(wd||(wd={}));var wd;!function(t){!function(t){t[t.BROADCAST=0]="BROADCAST",t[t.EMIT=1]="EMIT"}(t.EventPhase||(t.EventPhase={}));t.EventPhase}(wd||(wd={}));var wd;!function(t){var e=wdCb.Hash.create();e.addChild(t.EventName.CLICK,t.EventType.MOUSE),e.addChild(t.EventName.MOUSEOVER,t.EventType.MOUSE),e.addChild(t.EventName.MOUSEOUT,t.EventType.MOUSE),e.addChild(t.EventName.MOUSEMOVE,t.EventType.MOUSE),e.addChild(t.EventName.MOUSEDOWN,t.EventType.MOUSE),e.addChild(t.EventName.MOUSEUP,t.EventType.MOUSE),e.addChild(t.EventName.MOUSEWHEEL,t.EventType.MOUSE),e.addChild(t.EventName.KEYDOWN,t.EventType.KEYBOARD),e.addChild(t.EventName.KEYPRESS,t.EventType.KEYBOARD),e.addChild(t.EventName.KEYUP,t.EventType.KEYBOARD);var r=function(){function r(){}return r.getEventType=function(r){var n=e.getChild(r);return void 0===n&&(n=t.EventType.CUSTOM),n},r}();t.EventTable=r}(wd||(wd={}));var wd;!function(t){var e=function(){function e(t){this.p_type=null,this.name=null,this.target=null,this.currentTarget=null,this.isStopPropagation=!1,this.phase=null,this.name=t}return Object.defineProperty(e.prototype,"type",{get:function(){return t.Log.error(null===this.p_type,t.Log.info.ABSTRACT_ATTRIBUTE),this.p_type},enumerable:!0,configurable:!0}),e.prototype.stopPropagation=function(){this.isStopPropagation=!0},e.prototype.copyMember=function(t,e,r){return r.forEach(function(r){t[r]=e[r]}),t},e}();t.Event=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(t,r){e.call(this,r),this._event=null,this.event=t}return __extends(r,e),Object.defineProperty(r.prototype,"event",{get:function(){return this._event},set:function(e){this._event=e||t.root.event},enumerable:!0,configurable:!0}),r.prototype.preventDefault=function(){var t=this._event;bowser.msie&&Number(bowser.version)<=8?t.returnValue=!1:t.preventDefault()},r}(t.Event);t.DomEvent=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.p_type=t.EventType.MOUSE,this._location=null,this._locationInView=null,this._button=null}return __extends(r,e),r.create=function(t,e){var r=new this(t,e);return r},Object.defineProperty(r.prototype,"location",{get:function(){var e=null,r=this.event;return this._location?this._location:(e=t.Point.create(),bowser.msie?(e.x=r.clientX+document.body.scrollLeft||document.documentElement.scrollLeft,e.y=r.clientY+document.body.scrollTop||document.documentElement.scrollTop):(e.x=r.pageX,e.y=r.pageY),e)},set:function(t){this._location=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"locationInView",{get:function(){var e=null,r=null;return this._locationInView?this._locationInView:(e=this.location,r=t.DeviceManager.getInstance().view.offset,t.Point.create(e.x-r.x,e.y-r.y))},set:function(t){this._locationInView=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"button",{get:function(){var e=this.event,r=null;if(this._button)return this._button;if(bowser.msie)switch(e.button){case 1:r=t.MouseButton.LEFT;break;case 4:r=t.MouseButton.RIGHT;break;case 2:r=t.MouseButton.CENTER;break;default:t.Log.error(!0,t.Log.info.FUNC_NOT_SUPPORT("multi mouse button"))}else switch(e.button){case 0:r=t.MouseButton.LEFT;break;case 1:r=t.MouseButton.RIGHT;break;case 2:r=t.MouseButton.CENTER;break;default:t.Log.error(!0,t.Log.info.FUNC_NOT_SUPPORT("multi mouse button"))}return r},set:function(t){this._button=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"wheel",{get:function(){var t=this.event;return t.detail?-1*t.detail:t.wheelDelta?t.wheelDelta/120:0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"movementDelta",{get:function(){var e=this.event,r=null,n=null;if(this._isPointerLocked())r=e.movementX||e.webkitMovementX||e.mozMovementX||0,n=e.movementY||e.webkitMovementY||e.mozMovementY||0;else{var o=this.location,i=t.MouseEventHandler.getInstance(),a=i.lastX,s=i.lastY;null===a&&null===s?(r=0,n=0):(r=o.x-a,n=o.y-s)}return{x:r,y:n}},enumerable:!0,configurable:!0}),r.prototype.copy=function(){var t=r.create(this.event,this.name);return this.copyMember(t,this,["target","currentTarget","isStopPropagation","phase","lastX","lastY"])},r.prototype._isPointerLocked=function(){return!!(document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement)},r}(t.DomEvent);t.MouseEvent=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e={8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},r={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"},n=function(n){function o(){n.apply(this,arguments),this.p_type=t.EventType.KEYBOARD}return __extends(o,n),o.create=function(t,e){var r=new this(t,e);return r},Object.defineProperty(o.prototype,"ctrlKey",{get:function(){return this.event.ctrlKey},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"altKey",{get:function(){return this.event.altKey},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"shiftKey",{get:function(){return this.event.shiftKey},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"metaKey",{get:function(){return this.event.metaKey},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"keyCode",{get:function(){return this.event.keyCode},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"key",{get:function(){var t=e[this.keyCode],n=null;return t?t:(n=String.fromCharCode(this.keyCode).toLowerCase(),this.shiftKey?r[n]:n)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"keyState",{get:function(){return t.KeyboardEventHandler.getInstance().keyState},enumerable:!0,configurable:!0}),o.prototype.copy=function(){var t=o.create(this.event,this.name);return this.copyMember(t,this,["altKey","shiftKey","ctrlKey","metaKey","keyCode","key"])},o}(t.DomEvent);t.KeyboardEvent=n}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.p_type=t.EventType.CUSTOM,this.userData=null}return __extends(r,e),r.create=function(t){var e=new this(t);return e},r.prototype.copyPublicAttri=function(e,r){return wdCb.ExtendUtils.extend(e,function(e,r){return"_"!==r.slice(0,1)&&!t.JudgeUtils.isFunction(e)}),e},r.prototype.copy=function(){var t=r.create(this.name);return this.copyMember(t,this,["target","currentTarget","isStopPropagation","phase"])},r}(t.Event);t.CustomEvent=e}(wd||(wd={}));var wd;!function(t){!function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.CENTER=2]="CENTER"}(t.MouseButton||(t.MouseButton={}));t.MouseButton}(wd||(wd={}));var wd;!function(t){var e=function(){function t(t){this.eventType=null,this.priority=null,this.handlerDataList=wdCb.Collection.create(),this.eventType=t.eventType,this.priority=t.priority||1}return t.create=function(t){var e=new this(t);return e.initWhenCreate(t),e},t.prototype.initWhenCreate=function(t){this._setHandlerDataList(t)},t.prototype._setHandlerDataList=function(t){var e=null,r=/on\w+/;for(e in t)t.hasOwnProperty(e)&&r.test(e)&&this.handlerDataList.addChild({eventName:this._parseEventName(e),handler:t[e]})},t.prototype._parseEventName=function(t){return t.slice(2).toLowerCase()},t}();t.EventListener=e}(wd||(wd={}));var wd;!function(t){var e=function(){function t(){}return t}();t.EventHandler=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.prototype.off=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=this,o=this.getDom(),i=t.EventRegister.getInstance(),a=null;a=i.remove.apply(i,e),a&&a.forEach(function(t){t.forEach(function(t){n._unBind(o,t.eventName,t.domHandler)})}),this.clearHandler()},r.prototype.clearHandler=function(){},r.prototype.buildDomHandler=function(e,r){var n=this,o=t.root;return wdCb.EventUtils.bindEvent(o,function(t){n.triggerDomEvent(t,r,e)})},r.prototype.handler=function(e,r,n,o){var i=null,a=n;n=this.addEngineHandler(e,r,n),i=t.EventRegister.getInstance().isBinded(e,r)?t.EventRegister.getInstance().getDomHandler(e,r):this._bind(this.getDom(),r,e),t.EventRegister.getInstance().register(e,r,n,a,i,o)},r.prototype._bind=function(e,r,n){var o=null;return o=this.buildDomHandler(n,r),wdCb.EventUtils.addEvent(e,t.EventNameHandler.handleEventName(r),o),o},r.prototype._unBind=function(t,e,r){wdCb.EventUtils.removeEvent(t,e,r)},__decorate([t.virtual],r.prototype,"clearHandler",null),r}(t.EventHandler);t.DomEventHandler=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.lastX=null,this.lastY=null}return __extends(r,e),r.getInstance=function(){return null===this._instance&&(this._instance=new this),this._instance},r.prototype.on=function(t,e,r,n){this.handler(t,e,r,n)},r.prototype.trigger=function(e,r,n){var o=r.name,i=null,a=!1;return e instanceof t.GameObject?(n||(r.target=e),i=t.EventRegister.getInstance().getEventRegisterDataList(e,o),null!==i&&0!==i.getCount()?(i.forEach(function(t){var e=r.copy();t.handler(e),e.isStopPropagation&&(a=!0)}),a):void 0):void t.Log.log("target is not GameObject, can't trigger event")},r.prototype.getDom=function(){return t.DeviceManager.getInstance().view.dom},r.prototype.triggerDomEvent=function(e,r,n){var o=this._createEventObject(e,r,n);t.EventManager.emit(this._getTopTarget(o),o)},r.prototype.addEngineHandler=function(e,r,n){var o=null;switch(r){case t.EventName.MOUSEMOVE:o=this._handleMove(n);break;default:o=n}return o},r.prototype.clearHandler=function(){this.lastX=null,this.lastY=null},r.prototype._getTopTarget=function(e){return t.Director.getInstance().getTopUnderPoint(e.locationInView)},r.prototype._handleMove=function(t){var e=this;return function(r){t(r),e._saveLocation(r)}},r.prototype._createEventObject=function(e,r,n){var o=t.MouseEvent.create(e?e:t.root.event,r);return o.currentTarget=n,o},r.prototype._saveLocation=function(t){var e=null;e=t.location,this.lastX=e.x,this.lastY=e.y},r._instance=null,__decorate([t.require(function(e,r,n,o){t.assert(e instanceof t.GameObject,t.Log.info.FUNC_MUST_BE("target","GameObject"))})],r.prototype,"on",null),r}(t.DomEventHandler);t.MouseEventHandler=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.keyState={}}return __extends(r,e),r.getInstance=function(){return null===this._instance&&(this._instance=new this),this._instance},r.prototype.on=function(t,e,r){this.handler(null,t,e,r)},r.prototype.trigger=function(e){var r=e.name,n=null;return n=t.EventRegister.getInstance().getEventRegisterDataList(r),null!==n&&0!==n.getCount()?(n.forEach(function(t){var r=e.copy();t.handler(r)}),!0):void 0},r.prototype.getDom=function(){return document},r.prototype.triggerDomEvent=function(e,r,n){var o=this._createEventObject(e,r);t.EventManager.trigger(o)},r.prototype.addEngineHandler=function(e,r,n){var o=null;switch(r){case t.EventName.KEYDOWN:o=this._handleKeyDown(n);break;case t.EventName.KEYUP:o=this._handleKeyUp(n);break;default:o=n}return o},r.prototype.clearHandler=function(){this.keyState={}},r.prototype._handleKeyDown=function(t){var e=this;return function(r){e._setKeyStateAllFalse(),e.keyState[r.key]=!0,t(r)}},r.prototype._handleKeyUp=function(t){var e=this;return function(r){e._setKeyStateAllFalse(),t(r)}},r.prototype._setKeyStateAllFalse=function(){for(var t in this.keyState)this.keyState.hasOwnProperty(t)&&(this.keyState[t]=!1)},r.prototype._createEventObject=function(e,r){var n=t.KeyboardEvent.create(e?e:t.root.event,r);return n},r._instance=null,r}(t.DomEventHandler);t.KeyboardEventHandler=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.getInstance=function(){return null===this._instance&&(this._instance=new this),this._instance},r.prototype.on=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];if(3===e.length){var n=e[0],o=e[1],i=o,a=e[2];t.EventRegister.getInstance().register(null,n,o,i,null,a)}else if(4===e.length){var s=e[0],n=e[1],o=e[2],i=o,a=e[3];t.EventRegister.getInstance().register(s,n,o,i,null,a)}},r.prototype.off=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=t.EventRegister.getInstance();n.remove.apply(n,e)},r.prototype.trigger=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];
var r=null;if(1===t.length||2===t.length){var n=null;return 1===t.length?r=t[0]:(r=t[0],n=t[1]),this._triggerEventHandler(r,n)}if(3===t.length||4===t.length){var o=null,n=null,i=null;return 3===t.length?(o=t[0],r=t[1],i=t[2]):(o=t[0],r=t[1],n=t[2],i=t[3]),this._triggerTargetAndEventHandler(o,r,n,i)}},r.prototype._triggerEventHandler=function(e,r){var n=null,o=this;return n=t.EventRegister.getInstance().getEventRegisterDataList(e.name),null===n||0===n.getCount()?!1:(n.forEach(function(t){var n=e.copy();n.currentTarget=t.target,n.target=t.target,o._setUserData(n,r),t.handler(n)}),!0)},r.prototype._triggerTargetAndEventHandler=function(e,r,n,o){var i=null,a=!1,s=this;return o||(r.target=e),i=t.EventRegister.getInstance().getEventRegisterDataList(e,r.name),null===i||0===i.getCount()?!1:(i.forEach(function(t){var e=r.copy();e.currentTarget=t.target,s._setUserData(e,n),t.handler(e),e.isStopPropagation&&(a=!0)}),a)},r.prototype._setUserData=function(t,e){e&&(t.userData=e)},r._instance=null,r}(t.EventHandler);t.CustomEventHandler=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){}return e.create=function(){var t=new this;return t},e.prototype.trigger=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];if(1===e.length){var n=e[0],o=n.type;return t.FactoryEventHandler.createEventHandler(o).trigger(n)}if(!(2!==e.length||e[1]instanceof t.Event)){var i=e[0],a=e[1],o=i.type;return t.Log.error(o!==t.EventType.CUSTOM,t.Log.info.FUNC_MUST_BE("event type","CUSTOM")),t.FactoryEventHandler.createEventHandler(o).trigger(i,a)}if(2===e.length||3===e.length&&t.JudgeUtils.isBoolean(e[2])){var s=e[0],c=e[1],u=void 0===e[2]?!1:e[2],o=c.type;return t.FactoryEventHandler.createEventHandler(o).trigger(s,c,u)}if(3===e.length||4===e.length){var s=e[0],h=e[1],a=e[2],u=void 0===e[3]?!1:e[3],o=h.type;return t.Log.error(o!==t.EventType.CUSTOM,t.Log.info.FUNC_MUST_BE("event type","CUSTOM")),t.FactoryEventHandler.createEventHandler(o).trigger(s,h,a,u)}},e.prototype.emit=function(e,r,n){var o=!1;r.phase=t.EventPhase.EMIT,r.target=e;do{if(o=this._triggerWithUserData(e,r,n,!0))break;e=this._getParent(e)}while(e)},e.prototype.broadcast=function(e,r,n){function o(t){var e=t.getChildren();0!==e.getCount()&&e.forEach(function(t){i._triggerWithUserData(t,r.copy(),n,!0),o(t)})}var i=this;r.phase=t.EventPhase.BROADCAST,r.target=e,this._triggerWithUserData(e,r,n,!0),o(e)},e.prototype._getParent=function(t){var e=t.bubbleParent;return e?e:t.parent},e.prototype._triggerWithUserData=function(t,e,r,n){return r?this.trigger(t,e,r,n):this.trigger(t,e,n)},e}();t.EventDispatcher=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){this._listenerMap=t.EventListenerMap.create()}return e.getInstance=function(){return null===this._instance&&(this._instance=new this),this._instance},e.prototype.register=function(t,e,r,n,o,i){this._listenerMap.appendChild(t,e,{target:t,eventName:e,handler:r,originHandler:n,domHandler:o,priority:i})},e.prototype.remove=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=e[0],o=null;if(1===e.length&&t.JudgeUtils.isString(e[0])){var i=e[0];o=this._listenerMap.removeChild(i)}else if(2===e.length&&t.JudgeUtils.isFunction(e[1])){var i=e[0],a=e[1];o=this._listenerMap.removeChild(i,a)}else if(2===e.length&&t.JudgeUtils.isNumber(e[0])){var s=e[0],i=e[1];o=this._listenerMap.removeChild(s,i)}else 1===e.length?(o=this._listenerMap.removeChild(n),this._handleAfterAllEventHandlerRemoved(n)):(2===e.length||3===e.length)&&(o=this._listenerMap.removeChild.apply(this._listenerMap,e),this._isAllEventHandlerRemoved(n)&&this._handleAfterAllEventHandlerRemoved(n));return o},e.prototype.getEventRegisterDataList=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var r=this._listenerMap.getChild.apply(this._listenerMap,t);return r?r.sort(function(t,e){return e.priority-t.priority}):null},e.prototype.setBubbleParent=function(t,e){t.bubbleParent=e},e.prototype.isBinded=function(t,e){return this._listenerMap.hasChild(t,e)},e.prototype.filter=function(t){return this._listenerMap.filter(t)},e.prototype.forEach=function(t){return this._listenerMap.forEach(t)},e.prototype.getChild=function(t,e){return this._listenerMap.getChild.apply(this._listenerMap,Array.prototype.slice.call(arguments,0))},e.prototype.getEventNameFromKey=function(t){return this._listenerMap.getEventNameFromKey(t)},e.prototype.getUidFromKey=function(t){return this._listenerMap.getUidFromKey(t)},e.prototype.getDomHandler=function(t,e){var r=this.getChild(t,e);return r&&r.getCount()>0?r.getChild(0).domHandler:void 0},e.prototype.isTarget=function(t,e,r){return this._listenerMap.isTarget(t,e,r)},e.prototype._isAllEventHandlerRemoved=function(t){return!this._listenerMap.hasChild(function(e,r){return r.indexOf(String(t.uid))>-1&&e&&e.getCount()>0})},e.prototype._handleAfterAllEventHandlerRemoved=function(t){this.setBubbleParent(t,null)},e._instance=null,e}();t.EventRegister=e}(wd||(wd={}));var __decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(){function e(){}return e.create=function(){var t=new this;return t},e.prototype.on=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];if(1===e.length){var n=e[0]instanceof t.EventListener?e[0]:t.EventListener.create(e[0]);n.handlerDataList.forEach(function(e){t.FactoryEventHandler.createEventHandler(n.eventType).on(e.eventName,e.handler,n.priority)})}else if(2===e.length){var o=e[0],n=e[1]instanceof t.EventListener?e[1]:t.EventListener.create(e[1]);n.handlerDataList.forEach(function(e){t.FactoryEventHandler.createEventHandler(n.eventType).on(o,e.eventName,e.handler,n.priority)})}else if(3===e.length){var i=e[0],a=e[1],s=e[2];t.FactoryEventHandler.createEventHandler(t.EventTable.getEventType(i)).on(i,a,s)}else if(4===e.length){var o=e[0],i=e[1],a=e[2],s=e[3];t.FactoryEventHandler.createEventHandler(t.EventTable.getEventType(i)).on(o,i,a,s)}},e.prototype.off=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=t.EventRegister.getInstance();if(0===e.length)n.forEach(function(e,r){var o=n.getEventNameFromKey(r),i=n.getUidFromKey(r);i?t.FactoryEventHandler.createEventHandler(t.EventTable.getEventType(o)).off(i,o):t.FactoryEventHandler.createEventHandler(t.EventTable.getEventType(o)).off(o)});else if(1===e.length&&t.JudgeUtils.isString(e[0])){var o=e[0];t.FactoryEventHandler.createEventHandler(t.EventTable.getEventType(o)).off(o)}else if(2===e.length&&t.JudgeUtils.isFunction(e[1])){var o=e[0],i=e[1];t.FactoryEventHandler.createEventHandler(t.EventTable.getEventType(o)).off(o,i)}else if(1===e.length){var a=e[0];n.forEach(function(e,r){var o=n.getEventNameFromKey(r);n.isTarget(r,a,e)&&t.FactoryEventHandler.createEventHandler(t.EventTable.getEventType(o)).off(a,o)})}else if(2===e.length){var a=e[0],o=e[1];t.FactoryEventHandler.createEventHandler(t.EventTable.getEventType(o)).off(a,o)}else if(3===e.length){var a=e[0],o=e[1],i=e[2];t.FactoryEventHandler.createEventHandler(t.EventTable.getEventType(o)).off(a,o,i)}},e.prototype._checkEventSeparator=function(e){t.assert(-1===e.indexOf(t.EventListenerMap.eventSeparator),t.Log.info.FUNC_SHOULD_NOT("eventName","contain "+t.EventListenerMap.eventSeparator))},__decorate([t.require(function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];if(1===t.length);else if(2===t.length);else if(3===t.length){var r=t[0];t[1],t[2];this._checkEventSeparator(r)}else if(4===t.length){var r=(t[0],t[1]);t[2],t[3];this._checkEventSeparator(r)}})],e.prototype,"on",null),e}();t.EventBinder=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){}return e.createEventHandler=function(e){var r=null;switch(e){case t.EventType.MOUSE:r=t.MouseEventHandler.getInstance();break;case t.EventType.KEYBOARD:r=t.KeyboardEventHandler.getInstance();break;case t.EventType.CUSTOM:r=t.CustomEventHandler.getInstance();break;default:t.Log.error(!0,t.Log.info.FUNC_INVALID("eventType"))}return r},e}();t.FactoryEventHandler=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){}return e.on=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];if(1===e.length){var n=e[0];this._eventBinder.on(n)}else if(2===e.length&&t.JudgeUtils.isString(e[0])&&t.JudgeUtils.isFunction(e[1])){var o=e[0],i=e[1],a=1;this._eventBinder.on(o,i,a)}else if(2===e.length){var s=e[0],n=e[1];this._eventBinder.on(s,n)}else if(3===e.length&&t.JudgeUtils.isString(e[0])&&t.JudgeUtils.isFunction(e[1])&&t.JudgeUtils.isNumber(e[2])){var o=e[0],i=e[1],a=e[2];this._eventBinder.on(o,i,a)}else if(3===e.length||4===e.length){var s=e[0],o=e[1],i=e[2],a=void 0===e[3]?1:e[3];this._eventBinder.on(s,o,i,a)}},e.off=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];this._eventBinder.off.apply(this._eventBinder,t)},e.trigger=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];this._eventDispatcher.trigger.apply(this._eventDispatcher,t)},e.broadcast=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];this._eventDispatcher.broadcast.apply(this._eventDispatcher,t)},e.emit=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];this._eventDispatcher.emit.apply(this._eventDispatcher,t)},e.fromEvent=function(){for(var r=[],n=0;n<arguments.length;n++)r[n-0]=arguments[n];var o=null,i=null;if(1===r.length){var a=r[0];o=function(t){e.on(a,t)},i=function(t){e.off(a,t)}}else if(2===r.length&&t.JudgeUtils.isNumber(r[1])){var a=r[0],s=r[1];o=function(t){e.on(a,t,s)},i=function(t){e.off(a,t)}}else if(2===r.length){var c=r[0],a=r[1];o=function(t){e.on(c,a,t)},i=function(t){e.off(c,a,t)}}else if(3===r.length){var c=r[0],a=r[1],s=r[2];o=function(t){e.on(c,a,t,s)},i=function(t){e.off(c,a,t)}}return wdFrp.fromEventPattern(o,i)},e.setBubbleParent=function(e,r){t.EventRegister.getInstance().setBubbleParent(e,r)},e._eventBinder=t.EventBinder.create(),e._eventDispatcher=t.EventDispatcher.create(),e}();t.EventManager=e}(wd||(wd={}));var wd;!function(t){!function(t){t[t.STARTLOOP="dy_startLoop"]="STARTLOOP",t[t.ENDLOOP="dy_endLoop"]="ENDLOOP",t[t.BEFORE_INIT="dy_beforeInit"]="BEFORE_INIT",t[t.AFTER_INIT="dy_afterInit"]="AFTER_INIT",t[t.AFTER_INIT_RIGIDBODY_ADD_CONSTRAINT="dy_afterInit_rigidBody_addConstraint"]="AFTER_INIT_RIGIDBODY_ADD_CONSTRAINT",t[t.MATERIAL_CHANGE="dy_material_change"]="MATERIAL_CHANGE"}(t.EngineEvent||(t.EngineEvent={}));t.EngineEvent}(wd||(wd={}));var __decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(){function e(){this.view=null,this.gl=null,this._scissorTest=null,this._depthTest=null,this._depthFunc=null,this._side=null,this.polygonOffset=null,this._polygonOffsetMode=null,this._depthWrite=null,this._blend=null,this._writeRed=null,this._writeGreen=null,this._writeBlue=null,this._writeAlpha=null,this._blendSrc=null,this._blendDst=null,this._blendEquation=null,this._blendFuncSeparate=null,this._blendEquationSeparate=null}return e.getInstance=function(){return null===this._instance&&(this._instance=new this),this._instance},Object.defineProperty(e.prototype,"scissorTest",{get:function(){return this._scissorTest},set:function(t){var e=this.gl;t?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),this._scissorTest=t},enumerable:!0,configurable:!0}),e.prototype.setScissor=function(t,e,r,n){this.gl.scissor(t,e,r,n),this.scissorTest||(this.scissorTest=!0)},e.prototype.setViewport=function(t,e,r,n){this.gl.viewport(t,e,r,n)},Object.defineProperty(e.prototype,"depthTest",{get:function(){return this._depthTest},set:function(t){var e=this.gl;this._depthTest!==t&&(t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._depthTest=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(t){var e=this.gl;this._depthFunc!==t&&(e.depthFunc(e[t]),this._depthFunc=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"side",{get:function(){return this._side},set:function(e){var n=this.gl;if(this._side!==e){switch(e){case r.NONE:n.enable(n.CULL_FACE),n.cullFace(n.FRONT_AND_BACK);break;case r.BOTH:n.disable(n.CULL_FACE);break;case r.FRONT:n.enable(n.CULL_FACE),n.cullFace(n.BACK);break;case r.BACK:n.enable(n.CULL_FACE),n.cullFace(n.FRONT);break;default:t.Log.error(!0,t.Log.info.FUNC_UNEXPECT("side",e))}this._side=e}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"polygonOffsetMode",{get:function(){return this._polygonOffsetMode},set:function(e){var r=this.gl;if(this._polygonOffsetMode!==e){switch(e){case n.NONE:r.polygonOffset(0,0),r.disable(r.POLYGON_OFFSET_FILL);break;case n.IN:r.enable(r.POLYGON_OFFSET_FILL),r.polygonOffset(1,1);break;case n.OUT:r.enable(r.POLYGON_OFFSET_FILL),r.polygonOffset(-1,-1);break;case n.CUSTOM:r.enable(r.POLYGON_OFFSET_FILL),t.Log.error(!this.polygonOffset,t.Log.info.FUNC_MUST_DEFINE("polygonOffset")),r.polygonOffset(this.polygonOffset.x,this.polygonOffset.y)}this._polygonOffsetMode=e}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthWrite",{get:function(){return this._depthWrite},set:function(t){this._depthWrite!==t&&(this.gl.depthMask(t),this._depthWrite=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blend",{get:function(){return this._blend},set:function(t){var e=this.gl;this._blend!==t&&(t?e.enable(e.BLEND):e.disable(e.BLEND),this._blend=t)},enumerable:!0,configurable:!0}),e.prototype.setBlendFunc=function(t,e){(this._blendSrc!==t||this._blendDst!==e)&&(this._blend&&this.gl.blendFunc(this.gl[t],this.gl[e]),this._blendSrc=t,this._blendDst=e)},e.prototype.setBlendEquation=function(t){this._blendEquation!==t&&(this._blend&&this.gl.blendEquation(this.gl[t]),this._blendEquation=t)},e.prototype.setBlendFuncSeparate=function(t){var e=this.gl;this._blendFuncSeparate&&this._blendFuncSeparate[0]===t[0]&&this._blendFuncSeparate[1]===t[1]||(this._blend&&e.blendFuncSeparate(e[t[0]],e[t[1]],e[t[2]],e[t[3]]),this._blendFuncSeparate=t)},e.prototype.setBlendEquationSeparate=function(t){var e=this.gl;this._blendEquationSeparate&&this._blendEquationSeparate[0]===t[0]&&this._blendEquationSeparate[1]===t[1]||(this._blend&&e.blendEquationSeparate(e[t[0]],e[t[1]]),this._blendEquationSeparate=t)},e.prototype.setColorWrite=function(t,e,r,n){(this._writeRed!==t||this._writeGreen!==e||this._writeBlue!==r||this._writeAlpha!==n)&&(this.gl.colorMask(t,e,r,n),this._writeRed=t,this._writeGreen=e,this._writeBlue=r,this._writeAlpha=n)},e.prototype.clear=function(t){var e=this.gl,r=t.color;e.clearColor(r.r,r.g,r.b,r.a),this.setColorWrite(!0,!0,!0,!0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT)},e.prototype.createGL=function(e){var r=null;r=e?wdCb.DomQuery.create(e).get(0):wdCb.DomQuery.create("<canvas></canvas>").prependTo("body").get(0),this.view=t.ViewWebGL.create(r),this.gl=this.view.getContext()},e.prototype.setScreen=function(){var e=t.Main.screenSize,r=null,n=null,o=null,i=null;e===t.ScreenSize.FULL?(r=0,n=0,o=t.root.innerWidth,i=t.root.innerHeight,wdCb.DomQuery.create("body").css("margin","0")):(r=e.x||0,n=e.y||0,o=e.width||t.root.innerWidth,i=e.height||t.root.innerHeight),this.view.x=r,this.view.y=n,this.view.width=o,this.view.height=i,this.setViewport(0,0,o,i)},e._instance=null,__decorate([t.require(function(){t.assert(null!==t.Main.screenSize,t.Log.info.FUNC_NOT_EXIST("Main.screenSize"))})],e.prototype,"setScreen",null),e}();t.DeviceManager=e,function(t){t[t.NEVER="NEVER"]="NEVER",t[t.ALWAYS="ALWAYS"]="ALWAYS",t[t.LESS="LESS"]="LESS",t[t.LEQUAL="LEQUAL"]="LEQUAL",t[t.EQUAL="EQUAL"]="EQUAL",t[t.GEQUAL="GEQUAL"]="GEQUAL",t[t.GREATER="GREATER"]="GREATER",t[t.NOTEQUAL="NOTEQUAL"]="NOTEQUAL"}(t.DepthFunction||(t.DepthFunction={}));t.DepthFunction;!function(t){t[t.NONE=0]="NONE",t[t.BOTH=1]="BOTH",t[t.BACK=2]="BACK",t[t.FRONT=3]="FRONT"}(t.Side||(t.Side={}));var r=t.Side;!function(t){t[t.NONE=0]="NONE",t[t.IN=1]="IN",t[t.OUT=2]="OUT",t[t.CUSTOM=3]="CUSTOM"}(t.PolygonOffsetMode||(t.PolygonOffsetMode={}));var n=t.PolygonOffsetMode;!function(t){t[t.ZERO="ZEOR"]="ZERO",t[t.ONE="ONE"]="ONE",t[t.SRC_COLOR="SRC_COLOR"]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR="ONE_MINUS_SRC_COLOR"]="ONE_MINUS_SRC_COLOR",t[t.DST_COLOR="DST_COLOR"]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR="ONE_MINUS_DST_COLOR"]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA="SRC_ALPHA"]="SRC_ALPHA",t[t.SRC_ALPHA_SATURATE="SRC_ALPHA_SATURATE"]="SRC_ALPHA_SATURATE",t[t.ONE_MINUS_SRC_ALPHA="ONE_MINUS_SRC_ALPHA"]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA="DST_ALPHA"]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPH="ONE_MINUS_DST_ALPHA"]="ONE_MINUS_DST_ALPH"}(t.BlendFunc||(t.BlendFunc={}));t.BlendFunc;!function(t){t[t.ADD="FUNC_ADD"]="ADD",t[t.SUBTRACT="FUNC_SUBTRACT"]="SUBTRACT",t[t.REVERSE_SUBTRAC="FUNC_REVERSE_SUBTRACT"]="REVERSE_SUBTRAC"}(t.BlendEquation||(t.BlendEquation={}));t.BlendEquation;!function(t){t[t.NONE=0]="NONE",t[t.NORMAL=1]="NORMAL",t[t.ADDITIVE=2]="ADDITIVE",t[t.ADDITIVEALPHA=3]="ADDITIVEALPHA",t[t.MULTIPLICATIVE=4]="MULTIPLICATIVE",t[t.PREMULTIPLIED=5]="PREMULTIPLIED"}(t.BlendType||(t.BlendType={}));t.BlendType}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){this.maxTextureUnit=null,this.maxTextureSize=null,this.maxCubemapTextureSize=null,this.maxAnisotropy=null,this.extensionCompressedTextureS3TC=null,this.extensionTextureFilterAnisotropic=null,this.precision=null,this._isDetected=!1}return e.getInstance=function(){return null===this._instance&&(this._instance=new this),this._instance},Object.defineProperty(e.prototype,"gl",{get:function(){return t.DeviceManager.getInstance().gl},enumerable:!0,configurable:!0}),e.prototype.detect=function(){this._isDetected=!0,this._detectExtension(),this._detectCapabilty()},e.prototype._detectExtension=function(){this.extensionCompressedTextureS3TC=this._getExtension("WEBGL_compressed_texture_s3tc"),this.extensionTextureFilterAnisotropic=this._getExtension("EXT_texture_filter_anisotropic")},e.prototype._detectCapabilty=function(){var t=this.gl;this.maxTextureUnit=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxCubemapTextureSize=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),this.maxAnisotropy=this._getMaxAnisotropy(),this._detectPrecision()},e.prototype._getExtension=function(t){var e,r=this.gl;switch(t){case"EXT_texture_filter_anisotropic":e=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":e=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":e=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:e=r.getExtension(t)}return e},e.prototype._getMaxAnisotropy=function(){var t=this.extensionTextureFilterAnisotropic,e=this.gl;return null!==t?e.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},e.prototype._detectPrecision=function(){var e=this.gl,n=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT),o=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT),i=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT),a=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT),s=n.precision>0&&i.precision>0,c=o.precision>0&&a.precision>0;s?this.precision=r.HIGHP:c?(this.precision=r.MEDIUMP,t.Log.warn(t.Log.info.FUNC_NOT_SUPPORT("gpu","highp, using mediump"))):(this.precision=r.LOWP,t.Log.warn(t.Log.info.FUNC_NOT_SUPPORT("gpu","highp and mediump, using lowp")))},e._instance=null,e}();t.GPUDetector=e,function(t){t[t.HIGHP=0]="HIGHP",t[t.MEDIUMP=1]="MEDIUMP",t[t.LOWP=2]="LOWP"}(t.GPUPrecision||(t.GPUPrecision={}));var r=t.GPUPrecision}(wd||(wd={}));var wd;!function(t){!function(t){t[t.FULL=0]="FULL"}(t.ScreenSize||(t.ScreenSize={}));t.ScreenSize}(wd||(wd={}));var wd;!function(t){var e=function(){function t(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this.x=null,this.y=null,this.x=t,this.y=e}return t.create=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null);var r=new this(t,e);return r},t}();t.Point=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(t,e,r,n,o){this._faceNormal=null,this.aIndex=null,this.bIndex=null,this.cIndex=null,this.vertexNormals=null,this.aIndex=t,this.bIndex=e,this.cIndex=r,this._faceNormal=n,this.vertexNormals=o}return e.create=function(t,e,r,n,o){void 0===n&&(n=null),void 0===o&&(o=wdCb.Collection.create());var i=new this(t,e,r,n,o);return i},Object.defineProperty(e.prototype,"faceNormal",{get:function(){return null!==this._faceNormal?this._faceNormal:t.Vector3.create(0,0,0)},set:function(t){this._faceNormal=t},enumerable:!0,configurable:!0}),e.prototype.hasFaceNormal=function(){return null!==this._faceNormal},e.prototype.hasVertexNormal=function(){return this.vertexNormals.getCount()>0},e.prototype.copy=function(){var t=this._faceNormal?this._faceNormal.copy():null,r=null;return this.vertexNormals&&(r=wdCb.Collection.create(),this.vertexNormals.forEach(function(t){r.addChild(t.copy())})),e.create(this.aIndex,this.bIndex,this.cIndex,t,r)},e}();t.Face3=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),Object.defineProperty(e.prototype,"width",{get:function(){return this.z},set:function(t){this.z=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.w},set:function(t){this.w=t},enumerable:!0,configurable:!0}),e.prototype.copy=function(){return this.copyHelper(e.create())},e.prototype.isNotEmpty=function(){return 0!==this.x||0!==this.y||0!==this.width||0!==this.height},e}(t.Vector4);t.RectRegion=e}(wd||(wd={}));var wd;!function(t){var e=function(){function t(t){this._dom=null,this._dom=t}return t.create=function(t){var e=new this(t);return e},Object.defineProperty(t.prototype,"offset",{get:function(){for(var t=this._dom,e={x:t.offsetLeft,y:t.offsetTop};t=t.offsetParent;)e.x+=t.offsetLeft,e.y+=t.offsetTop;return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dom",{get:function(){return this._dom},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._dom.width},set:function(t){this._dom.width=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._dom.height},set:function(t){this._dom.height=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return Number(this._dom.style.left.slice(0,-2))},set:function(t){this._dom.style.position="absolute",this._dom.style.left=t+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return Number(this._dom.style.top.slice(0,-2))},set:function(t){this._dom.style.position="absolute",this._dom.style.top=t+"px"},enumerable:!0,configurable:!0}),t.prototype.getContext=function(){return this._dom.getContext("webgl")||this._dom.getContext("experimental-webgl")},t}();t.ViewWebGL=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){this.r=null,this.g=null,this.b=null,this.a=null}return e.create=function(t){var e=new this;return e.initWhenCreate(t),e},e.prototype.initWhenCreate=function(t){this._setColor(t)},e.prototype.toVector3=function(){return t.Vector3.create(this.r,this.g,this.b)},e.prototype.toVector4=function(){return t.Vector4.create(this.r,this.g,this.b,this.a)},e.prototype._setColor=function(t){var e=/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*([^\)]+)\)$/i,r=/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/i,n=/^rgb\((\d+\.\d+),\s*(\d+\.\d+),\s*(\d+\.\d+)\)$/i,o=/^\#([0-9a-f]{6})$/i,i=null;return e.test(t)?(i=e.exec(t),this.r=this._getColorValue(i,1),this.g=this._getColorValue(i,2),this.b=this._getColorValue(i,3),this.a=Number(i[4]),this):r.test(t)?(i=r.exec(t),this.r=this._getColorValue(i,1),this.g=this._getColorValue(i,2),this.b=this._getColorValue(i,3),this.a=1,this):n.test(t)?(i=n.exec(t),this.r=parseFloat(i[1]),this.g=parseFloat(i[2]),this.b=parseFloat(i[3]),this.a=1,this):o.test(t)?(i=o.exec(t),this._setHex(parseInt(i[1],16)),this):void 0},e.prototype._getColorValue=function(t,e,r){return void 0===r&&(r=255),Math.min(r,parseInt(t[e],10))/r},e.prototype._setHex=function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this.a=1,this},e}();t.Color=e}(wd||(wd={}));var __decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(){function e(){this.material=null,this.width=null,this.height=null,this.variableData=null,this.wrapS=null,this.wrapT=null,this.magFilter=null,this.minFilter=null,this.glTexture=null,this.target=t.TextureTarget.TEXTURE_2D}return Object.defineProperty(e.prototype,"geometry",{get:function(){return this.material.geometry},enumerable:!0,configurable:!0}),e.prototype.bindToUnit=function(e){var r=t.DeviceManager.getInstance().gl,n=t.GPUDetector.getInstance().maxTextureUnit;return e>=n&&t.Log.warn("trying to use "+e+" texture units, but GPU only supports "+n+" units"),r.activeTexture(r["TEXTURE"+String(e)]),r.bindTexture(r[this.target],this.glTexture),this},e.prototype.sendData=function(t,e,r){t.sendUniformData(e,this.getSamplerType(),r),this.sendOtherData(t,r)},e.prototype.dispose=function(){var e=t.DeviceManager.getInstance().gl;e.deleteTexture(this.glTexture),delete this.glTexture},e.prototype.filterFallback=function(e){return e===t.TextureFilterMode.NEAREST||e===t.TextureFilterMode.NEAREST_MIPMAP_MEAREST||e===t.TextureFilterMode.NEAREST_MIPMAP_LINEAR?t.TextureFilterMode.NEAREST:t.TextureFilterMode.LINEAR},e.prototype.sendOtherData=function(t,e){},e.prototype.getSamplerNameByVariableData=function(e,r){var n=null;return this.variableData?this.variableData.samplerVariableName&&(n=this.variableData.samplerVariableName):n=r===t.VariableType.SAMPLER_2D?"u_sampler2D"+e:"u_samplerCube"+e,n},e.prototype.getSamplerType=function(){var e=null;switch(this.target){case t.TextureTarget.TEXTURE_2D:e=t.VariableType.SAMPLER_2D;break;case t.TextureTarget.TEXTURE_CUBE_MAP:e=t.VariableType.SAMPLER_CUBE}return e},e.prototype.isSourcePowerOfTwo=function(){return t.TextureUtils.isPowerOfTwo(this.width,this.height)},e.prototype.setTextureParameters=function(e,r){var n=t.DeviceManager.getInstance().gl;r?(n.texParameteri(e,n.TEXTURE_WRAP_S,n[this.wrapS]),n.texParameteri(e,n.TEXTURE_WRAP_T,n[this.wrapT]),n.texParameteri(e,n.TEXTURE_MAG_FILTER,n[this.magFilter]),n.texParameteri(e,n.TEXTURE_MIN_FILTER,n[this.minFilter])):(n.texParameteri(e,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(e,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(e,n.TEXTURE_MAG_FILTER,n[this.filterFallback(this.magFilter)]),n.texParameteri(e,n.TEXTURE_MIN_FILTER,n[this.filterFallback(this.minFilter)]))},__decorate([t.virtual],e.prototype,"sendOtherData",null),__decorate([t.virtual],e.prototype,"isSourcePowerOfTwo",null),e}();t.Texture=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){}return e.isPowerOfTwo=function(e,r){return t.JudgeUtils.isPowerOfTwo(e)&&t.JudgeUtils.isPowerOfTwo(r)},e}();t.TextureUtils=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.isDrawPartOfTexture=function(e,r){return e&&e.isNotEmpty()&&r===t.TextureSourceRegionMethod.DRAW_IN_CANVAS},r.drawPartOfTextureByCanvas=function(t,e,r,n,o,i,a,s,c,u,h){var l=wdCb.DomQuery.create("<canvas></canvas>").get(0),p=null;return l.width=e,l.height=r,p=l.getContext("2d"),p.drawImage(t,n,o,i,a,s,c,u,h),l},r.isSourcePowerOfTwo=function(t,e,r,n){return this.isDrawPartOfTexture(t,e)?this.isPowerOfTwo(t.width,t.height):this.isPowerOfTwo(r,n)},r.needClampMaxSize=function(t,e,r){return e>t||r>t},r.clampToMaxSize=function(e,r){var n=null,o=null,i=null,a=null;return n=Math.max(e.width,e.height),o=Math.floor(e.width*r/n),i=Math.floor(e.height*r/n),a=this.drawPartOfTextureByCanvas(e,o,i,0,0,e.width,e.height,0,0,o,i),t.Log.log("source is too big (width:"+e.width+", height:"+e.height+"), resize it to be width:"+a.width+", height:"+a.height+"."),a},r}(t.TextureUtils);t.BasicTextureUtils=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.prototype.init=function(){return this.minFilter=t.TextureFilterMode.LINEAR,this.magFilter=t.TextureFilterMode.LINEAR,this.wrapS=t.TextureWrapMode.CLAMP_TO_EDGE,this.wrapT=t.TextureWrapMode.CLAMP_TO_EDGE,this},r.prototype.getPosition=function(){return this.geometry.gameObject.transform.position},r.prototype.setEmptyTexture=function(e){var r=t.DeviceManager.getInstance().gl;t.Log.error(!e,"Failed to create texture object"),r.bindTexture(r[this.target],e),this.setTextureParameters(r[this.target],this.isSourcePowerOfTwo())},r}(t.Texture);t.RenderTargetTexture=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this._renderList=null,this.width=256,this.height=256}return __extends(r,e),Object.defineProperty(r.prototype,"renderList",{get:function(){return this._renderList},set:function(e){t.JudgeUtils.isArray(e)?this._renderList=wdCb.Collection.create(e):e instanceof wdCb.Collection?this._renderList=e:t.Log.error(!0,t.Log.info.FUNC_MUST_BE("renderList","array or wdCb.Collection"))},enumerable:!0,configurable:!0}),r.prototype.createEmptyTexture=function(){var e=t.DeviceManager.getInstance().gl,r=e.createTexture();this.setEmptyTexture(r),e.texImage2D(e[this.target],0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),this.glTexture=r},r}(t.RenderTargetTexture);t.TwoDRenderTargetTexture=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){}return e.setTextureParameters=function(e){var r=t.DeviceManager.getInstance().gl,n=t.Director.getInstance().scene;n.shadowMap.softType===t.ShadowMapSoftType.PCF&&(r.texParameteri(e,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(e,r.TEXTURE_MIN_FILTER,r.NEAREST))},e}();t.ShadowMapTextureUtils=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this._plane=null}return __extends(r,e),r.create=function(){var t=new this;
return t},r.prototype.init=function(){return e.prototype.init.call(this),t.Director.getInstance().scene.addRenderTargetRenderer(t.MirrorRenderTargetRenderer.create(this)),this},r.prototype.getSamplerName=function(e){return this.getSamplerNameByVariableData(e,t.VariableType.SAMPLER_2D)},r.prototype.getPlane=function(){var e=null,r=null,n=null;return this._plane&&!this.geometry.gameObject.transform.dirtyLocal?this._plane:(t.Log.error(!(this.geometry instanceof t.PlaneGeometry),t.Log.info.FUNC_MUST_BE("geometry","PlaneGeometry")),e=this.geometry.geometryData.normals,r=this.geometry.gameObject.transform.localRotation.multiplyVector3(t.Vector3.create(e[0],e[1],e[2])).normalize(),n=this.getPosition(),this._plane=t.Plane.create(r.x,r.y,r.z,-n.dot(r)),this._plane)},r}(t.TwoDRenderTargetTexture);t.MirrorTexture=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.getSamplerName=function(e){return t.Log.error(!t.JudgeUtils.isNumber(this.variableData.samplerData),t.Log.info.FUNC_MUST_BE("shadowMapTexture->variableData.samplerData","samplerIndex")),"u_twoDShadowMapSampler["+this.variableData.samplerData+"]"},r.prototype.setTextureParameters=function(r,n){e.prototype.setTextureParameters.call(this,r,n),t.ShadowMapTextureUtils.setTextureParameters(r)},r}(t.TwoDRenderTargetTexture);t.TwoDShadowMapTexture=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.target=t.TextureTarget.TEXTURE_CUBE_MAP}return __extends(r,e),r.prototype.createEmptyTexture=function(){var e=t.DeviceManager.getInstance().gl,r=e.createTexture(),n=null;for(this.setEmptyTexture(r),n=0;6>n;n++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null);this.glTexture=r},r}(t.RenderTargetTexture);t.CubemapRenderTargetTexture=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.getSamplerName=function(e){return t.Log.error(!t.JudgeUtils.isNumber(this.variableData.samplerData),t.Log.info.FUNC_MUST_BE("shadowMapTexture->variableData.samplerData","samplerIndex")),"u_cubemapShadowMapSampler["+this.variableData.samplerData+"]"},r}(t.CubemapRenderTargetTexture);t.CubemapShadowMapTexture=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this._renderList=null,this.size=256,this.near=.1,this.far=100,this.mode=null}return __extends(r,e),r.create=function(){var t=new this;return t},Object.defineProperty(r.prototype,"renderList",{get:function(){return this._renderList},set:function(e){t.JudgeUtils.isDirectObject(e)?this._renderList=wdCb.Hash.create(e):e instanceof wdCb.Hash?this._renderList=e:t.Log.error(!0,t.Log.info.FUNC_MUST_BE("renderList","array or wdCb.Collection"))},enumerable:!0,configurable:!0}),r.prototype.init=function(){return e.prototype.init.call(this),this.width=this.size,this.height=this.size,t.Director.getInstance().scene.addRenderTargetRenderer(t.DynamicCubemapRenderTargetRenderer.create(this)),this},r.prototype.getSamplerName=function(e){return this.getSamplerNameByVariableData(e,t.VariableType.SAMPLER_CUBE)},r}(t.CubemapRenderTargetTexture);t.DynamicCubemapTexture=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.p_sourceRegionMethod=null,this.generateMipmaps=null,this.format=null,this.source=null,this.repeatRegion=null,this.sourceRegion=null,this.sourceRegionMapping=null,this.flipY=null,this.premultiplyAlpha=null,this.unpackAlignment=null,this.type=null,this.mipmaps=null,this.anisotropy=null,this.needUpdate=null}return __extends(r,e),Object.defineProperty(r.prototype,"sourceRegionMethod",{get:function(){return this.p_sourceRegionMethod},set:function(t){this.p_sourceRegionMethod=t},enumerable:!0,configurable:!0}),r.prototype.initWhenCreate=function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var n=t.DeviceManager.getInstance().gl;this.glTexture=n.createTexture()},r.prototype.init=function(){},r.prototype.update=function(e){var r=t.DeviceManager.getInstance().gl,n=this.isSourcePowerOfTwo();return this.bindToUnit(e),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,this.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,this.unpackAlignment),this.needClampMaxSize()&&(this.clampToMaxSize(),n=this.isSourcePowerOfTwo(),n||t.Log.warn("texture size is not power of two after clampToMaxSize()")),this.setTextureParameters(r[this.target],n),this.allocateSourceToTexture(n),this.generateMipmaps&&n&&r.generateMipmap(r[this.target]),this.needUpdate=!1,this},r.prototype.getSamplerName=function(e){return this.getSamplerNameByVariableData(e,t.VariableType.SAMPLER_2D)},r.prototype.sendOtherData=function(e,r){var n=null;return n=this.sourceRegion&&this.sourceRegionMethod===t.TextureSourceRegionMethod.CHANGE_TEXCOORDS_IN_GLSL?this._convertSourceRegionToUV():t.RectRegion.create(0,0,1,1),e.sendUniformData("u_sourceRegion",t.VariableType.FLOAT_4,n),e.sendUniformData("u_repeatRegion",t.VariableType.FLOAT_4,this.repeatRegion),this},r.prototype.needClampMaxSize=function(){return this.source?t.BasicTextureUtils.needClampMaxSize(t.GPUDetector.getInstance().maxTextureSize,this.source.width,this.source.height):!1},r.prototype.clampToMaxSize=function(){this.source=t.BasicTextureUtils.clampToMaxSize(this.source,t.GPUDetector.getInstance().maxTextureSize)},r.prototype.setTextureParameters=function(t,r){e.prototype.setTextureParameters.call(this,t,r),this._setAnisotropy(t)},r.prototype.isSourcePowerOfTwo=function(){return t.BasicTextureUtils.isSourcePowerOfTwo(this.sourceRegion,this.sourceRegionMethod,this.width,this.height)},r.prototype._setAnisotropy=function(e){var r=t.GPUDetector.getInstance(),n=t.DeviceManager.getInstance().gl;r.extensionTextureFilterAnisotropic&&this.anisotropy>1&&n.texParameterf(e,r.extensionTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(this.anisotropy,r.maxAnisotropy))},r.prototype._convertSourceRegionCanvasMapToUV=function(e){var r=this.width,n=this.height,o=null;return o=t.RectRegion.create(e.x/r,e.y/n,e.width/r,e.height/n),o.y=1-o.y-o.height,o},r.prototype._convertSourceRegionToUV=function(){return this.sourceRegionMapping===t.TextureSourceRegionMapping.CANVAS?this._convertSourceRegionCanvasMapToUV(this.sourceRegion):this.sourceRegionMapping===t.TextureSourceRegionMapping.UV?this.sourceRegion:void 0},__decorate([t.virtual],r.prototype,"needClampMaxSize",null),r}(t.Texture);t.BasicTexture=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.initWhenCreate=function(e){t.prototype.initWhenCreate.call(this),e.copyTo(this)},e}(t.BasicTexture);t.TwoDTexture=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.prototype.allocateSourceToTexture=function(e){var r=null,n=null,o=t.DeviceManager.getInstance().gl;e&&this.mipmaps.getCount()>0?(r=t.DrawMipmapTwoDTextureCommand.create(),r.mipmaps=this.mipmaps,r.format=this.format,r.type=this.type,r.sourceRegion=this.sourceRegion,r.sourceRegionMethod=this.sourceRegionMethod,r.glTarget=o.TEXTURE_2D,r.execute(),this.generateMipmaps=!1):(n=t.DrawNoMipmapTwoDTextureCommand.create(),n.source=this.source,n.format=this.format,n.type=this.type,n.sourceRegion=this.sourceRegion,n.sourceRegionMethod=this.sourceRegionMethod,n.glTarget=o.TEXTURE_2D,n.execute())},r}(t.TwoDTexture);t.CommonTexture=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.create=function(t){var e=new this;return e.initWhenCreate(t),e},r.prototype.initWhenCreate=function(r){if(arguments[0]instanceof t.ImageTextureAsset){var n=arguments[0];e.prototype.initWhenCreate.call(this,n)}else{var o=arguments[0];e.prototype.initWhenCreate.call(this,t.ImageTextureAsset.create(o))}},r}(t.CommonTexture);t.ImageTexture=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this._video=null,this._startLoopHandler=null}return __extends(r,e),r.create=function(t){var e=new this;return e.initWhenCreate(t),e},r.prototype.initWhenCreate=function(t){e.prototype.initWhenCreate.call(this,t),this._video=t.video},r.prototype.init=function(){var r=this;return e.prototype.init.call(this),this._startLoopHandler=wdCb.FunctionUtils.bind(this,function(){r._video.isStop?r.needUpdate=!1:r.needUpdate=!0}),t.EventManager.on(t.EngineEvent.STARTLOOP,this._startLoopHandler),this},r.prototype.dispose=function(){t.EventManager.off(t.EngineEvent.STARTLOOP,this._startLoopHandler)},r.prototype.needClampMaxSize=function(){return!1},r}(t.CommonTexture);t.VideoTexture=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(r){e.call(this),this.assets=null,this.textures=wdCb.Collection.create(),this.mode=null,this.target=t.TextureTarget.TEXTURE_CUBE_MAP,this._areAllCompressedAsset=!1,this.assets=r}return __extends(r,e),r.create=function(t){var e=new this(t);return e.initWhenCreate(t),e},r.prototype.initWhenCreate=function(t){e.prototype.initWhenCreate.call(this),this._areAssetsAllCompressedAsset(t)?this._areAllCompressedAsset=!0:this._areAllCompressedAsset=!1,this._createTextures(t),this._getRepresentAsset(t).copyToCubemapTexture(this),this._areAllCompressedAsset?(this.generateMipmaps=!1,this._hasNoMipmapCompressedAsset()&&(this.minFilter=this.filterFallback(this.minFilter))):this.generateMipmaps=!0,this.flipY=!1},r.prototype.getSamplerName=function(e){return this.getSamplerNameByVariableData(e,t.VariableType.SAMPLER_CUBE)},r.prototype.sendOtherData=function(e,r){return e.sendUniformData("u_repeatRegion",t.VariableType.FLOAT_4,this.repeatRegion),this},r.prototype.allocateSourceToTexture=function(t){this._areAllCompressedAsset?this.textures.forEach(function(t,e){t.draw(e)}):this.textures.forEach(function(t,e){t.draw(e)})},r.prototype.needClampMaxSize=function(){var t=!1;return this.textures.forEach(function(e){return e.needClampMaxSize()?(t=!0,wdCb.$BREAK):void 0}),t},r.prototype.isSourcePowerOfTwo=function(){var t=!0;return this.textures.forEach(function(e){return e.isSourcePowerOfTwo()?void 0:(t=!1,wdCb.$BREAK)}),t},r.prototype.clampToMaxSize=function(){this.textures.forEach(function(t){t.clampToMaxSize()})},r.prototype._hasNoMipmapCompressedAsset=function(){var t=this;return this._areAllCompressedAsset?this.textures.filter(function(e){return!t._isMipmapFilter(e.minFilter)}).getCount()>0:!1},r.prototype._isMipmapFilter=function(e){return e===t.TextureFilterMode.LINEAR_MIPMAP_LINEAR||e===t.TextureFilterMode.LINEAR_MIPMAP_NEAREST||e===t.TextureFilterMode.NEAREST_MIPMAP_LINEAR||e===t.TextureFilterMode.NEAREST_MIPMAP_MEAREST},r.prototype._getRepresentAsset=function(t){return t[0].asset},r.prototype._areAssetsAllImageAssets=function(e){for(var r=[],n=0;n<e.length;n++){var o=e[n];o.asset instanceof t.ImageTextureAsset&&r.push(o)}return 6===r.length},r.prototype._areAssetsAllCompressedAsset=function(e){for(var r=[],n=0;n<e.length;n++){var o=e[n];o.asset instanceof t.CompressedTextureAsset&&r.push(o)}return 6===r.length},r.prototype._createTextures=function(e){for(var r=this,n=0;n<e.length;n++){var o=e[n],i=o.asset.toCubemapFaceTexture();if(o.sourceRegion&&i instanceof t.CubemapFaceImageTexture){var a=i;a.sourceRegion=o.sourceRegion}o.type&&(i.type=o.type),r.textures.addChild(i)}},r.prototype._areTextureSizOfAllFaceseEqual=function(t){for(var e=[],r=[],n=0;n<t.length;n++){var o=t[n];o.sourceRegion?(e.push(o.sourceRegion.width),r.push(o.sourceRegion.height)):(e.push(o.asset.width),r.push(o.asset.height))}return this._areAllElementsEqual(e)&&this._areAllElementsEqual(r)},r.prototype._hasSourceRegion=function(t){for(var e=0;e<t.length;e++){var r=t[e];if(r.sourceRegion)return!0}return!1},r.prototype._areAllElementsEqual=function(t){for(var e=t[0],r=0;r<t.length;r++){var n=t[r];if(n!==e)return!1}return!0},__decorate([t.require(function(e){t.assert(6===e.length,t.Log.info.FUNC_MUST("cubemap","has 6 assets")),t.assert(this._areAssetsAllImageAssets(e)||this._areAssetsAllCompressedAsset(e),t.Log.info.FUNC_MUST_BE("cubemap six face's assets","all ImageTextureAsset or all CompressedTextureAsset")),this._areAssetsAllCompressedAsset(e)&&t.assert(!this._hasSourceRegion(e),t.Log.info.FUNC_SHOULD_NOT("compressed face","contain sourceRegion data")),t.assert(this._areTextureSizOfAllFaceseEqual(e),t.Log.info.FUNC_MUST_BE("all cubemap faces' texture size","equal"))})],r.prototype,"initWhenCreate",null),r}(t.BasicTexture);t.CubemapTexture=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){this.type=t.TextureType.UNSIGNED_BYTE,this.format=null,this.width=null,this.height=null}return e}();t.CubemapFaceTexture=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.sourceRegion=null,this.source=null}return __extends(r,e),r.create=function(t){var e=new this;return e.initWhenCreate(t),e},Object.defineProperty(r.prototype,"sourceRegionMethod",{get:function(){return t.TextureSourceRegionMethod.DRAW_IN_CANVAS},set:function(t){},enumerable:!0,configurable:!0}),r.prototype.initWhenCreate=function(t){t.copyToCubemapFaceTexture(this)},r.prototype.isSourcePowerOfTwo=function(){return t.BasicTextureUtils.isSourcePowerOfTwo(this.sourceRegion,this.sourceRegionMethod,this.width,this.height)},r.prototype.needClampMaxSize=function(){return this.source?t.BasicTextureUtils.needClampMaxSize(t.GPUDetector.getInstance().maxCubemapTextureSize,this.source.width,this.source.height):!1},r.prototype.clampToMaxSize=function(){var e=t.GPUDetector.getInstance().maxCubemapTextureSize;this.source=t.BasicTextureUtils.clampToMaxSize(this.source,e)},r.prototype.draw=function(e){var r=t.DrawNoMipmapTwoDTextureCommand.create(),n=t.DeviceManager.getInstance().gl;r.source=this.source,r.sourceRegion=this.sourceRegion,r.sourceRegionMethod=this.sourceRegionMethod,r.glTarget=n.TEXTURE_CUBE_MAP_POSITIVE_X+e,r.format=this.format,r.type=this.type,r.execute()},__decorate([t.requireSetter(function(e){t.assert(e===t.TextureSourceRegionMethod.DRAW_IN_CANVAS,t.Log.info.FUNC_SUPPORT("cubemap twoD face texture->sourceRegionMethod only","DRAW_IN_CANVAS"))})],r.prototype,"sourceRegionMethod",null),r}(t.CubemapFaceTexture);t.CubemapFaceImageTexture=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.mipmaps=null,this.minFilter=null}return __extends(r,e),r.create=function(t){var e=new this;return e.initWhenCreate(t),e},r.prototype.initWhenCreate=function(t){t.copyToCubemapFaceTexture(this)},r.prototype.isSourcePowerOfTwo=function(){return t.BasicTextureUtils.isSourcePowerOfTwo(null,null,this.width,this.height)},r.prototype.needClampMaxSize=function(){return t.BasicTextureUtils.needClampMaxSize(t.GPUDetector.getInstance().maxCubemapTextureSize,this.width,this.height)},r.prototype.clampToMaxSize=function(){t.Log.warn("CubemapFaceCompressedTexture's texture size is over maxCubemapTextureSize")},r.prototype.draw=function(e){var r=t.DrawCompressedTextureCommand.create(),n=t.DeviceManager.getInstance().gl;r.glTarget=n.TEXTURE_CUBE_MAP_POSITIVE_X+e,r.type=this.type,r.format=this.format,r.mipmaps=this.mipmaps,r.execute()},r}(t.CubemapFaceTexture);t.CubemapFaceCompressedTexture=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.create=function(t){var e=new this;return e.initWhenCreate(t),e},Object.defineProperty(r.prototype,"sourceRegionMethod",{get:function(){return t.Log.assert(this.p_sourceRegionMethod===t.TextureSourceRegionMethod.DRAW_IN_CANVAS,"compressed texture not support TextureSourceRegionMethod.DRAW_IN_CANVAS, will use TextureSourceRegionMethod.CHANGE_TEXCOORDS_IN_GLSL instead"),t.TextureSourceRegionMethod.CHANGE_TEXCOORDS_IN_GLSL},enumerable:!0,configurable:!0}),r.prototype.allocateSourceToTexture=function(e){var r=t.DeviceManager.getInstance().gl,n=t.DrawCompressedTextureCommand.create();n.glTarget=r.TEXTURE_2D,n.type=this.type,n.format=this.format,n.mipmaps=this.mipmaps,n.sourceRegion=this.sourceRegion,n.sourceRegionMethod=this.sourceRegionMethod,n.execute(),this.mipmaps.getCount()>1&&(this.generateMipmaps=!1)},r.prototype.needClampMaxSize=function(){return!1},r}(t.TwoDTexture);t.CompressedTexture=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){this.format=null,this.type=null,this.sourceRegion=null,this.sourceRegionMethod=t.TextureSourceRegionMethod.CHANGE_TEXCOORDS_IN_GLSL,this.glTarget=null}return e.prototype.getDrawTarget=function(e,r){void 0===r&&(r=this.sourceRegion);var n=null;return n=t.BasicTextureUtils.isDrawPartOfTexture(r,this.sourceRegionMethod)?t.BasicTextureUtils.drawPartOfTextureByCanvas(e,r.width,r.height,r.x,r.y,r.width,r.height,0,0,r.width,r.height):e},e}();t.DrawTextureCommand=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.mipmaps=null}return __extends(r,e),r.create=function(){var t=new this;return t},r.prototype.execute=function(){var e=t.DeviceManager.getInstance().gl,r=this;t.Log.error(null===this.format,t.Log.info.FUNC_NOT_SUPPORT(this.format)),this.format!==t.TextureFormat.RGBA?this.mipmaps.forEach(function(t,n){e.compressedTexImage2D(r.glTarget,n,r.format,t.width,t.height,0,r.getDrawTarget(t.data))}):this.mipmaps.forEach(function(t,n){e.texImage2D(r.glTarget,n,e[r.format],t.width,t.height,0,e[r.format],e[r.type],r.getDrawTarget(t.data))})},r}(t.DrawTextureCommand);t.DrawCompressedTextureCommand=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this.source=null}return __extends(r,e),r.prototype.drawTexture=function(e,r){var n=t.DeviceManager.getInstance().gl;n.texImage2D(this.glTarget,e,n[this.format],n[this.format],n[this.type],this.getDrawTarget(r))},r}(t.DrawTextureCommand);t.DrawTwoDTextureCommand=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.mipmaps=null}return __extends(e,t),e.create=function(){var t=new this;return t},e.prototype.execute=function(){var t=this;this.mipmaps.forEach(function(e,r){t.drawTexture(r,e)})},e}(t.DrawTwoDTextureCommand);t.DrawMipmapTwoDTextureCommand=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.create=function(){var t=new this;return t},e.prototype.execute=function(){this.drawTexture(0,this.source)},e}(t.DrawTwoDTextureCommand);t.DrawNoMipmapTwoDTextureCommand=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(t){var e=t.urlArr,r=t.onLoad,n=void 0===r?function(t){}:r,o=t.onError,i=void 0===o?function(t){}:o;this.url=null,this.source=null,this.isStop=!1,this._urlArr=null,this._onLoad=null,this._onError=null,this._urlArr=wdCb.Collection.create(e),this._onLoad=n,this._onError=i}return e.create=function(t){var e=new this(t);return e.initWhenCreate(),e},e.prototype.initWhenCreate=function(){this.url=this._getCanPlayUrl(),this.source=document.createElement("video"),this.source.src=this.url,this._bindEvent()},e.prototype.play=function(){this.isStop=!1,this.source.play()},e.prototype._getCanPlayUrl=function(){var e=this,r=null,n=[];return this._urlArr.forEach(function(t){var o=wdCb.PathUtils.extname(t);return n.push(o),e._canplay(o)?(r=t,wdCb.$BREAK):void 0}),t.Log.error(null===r,t.Log.info.FUNC_NOT_SUPPORT("browser",n.join(","))),r},e.prototype._canplay=function(e){var r=document.createElement("video"),n=null;switch(e){case".mp4":n='video/mp4; codecs="avc1.42e01e, mp4a.40.2"';break;case".ogv":n='video/ogg; codecs="theora, vorbis"';break;case".webm":n='video/webm; codecs="vp8, vorbis"';break;default:t.Log.error(!0,t.Log.info.FUNC_UNEXPECT(e))}return!!r.canPlayType&&""!==r.canPlayType(n)},e.prototype._bindEvent=function(){var t=this;this.source.addEventListener("canplaythrough",function(){t._onLoad(t)},!1),this.source.addEventListener("error",function(){t._onError("errorCode "+t.source.error.code)},!1),this.source.addEventListener("ended",function(){t.isStop=!0},!1)},e}();t.Video=e}(wd||(wd={}));var wd;!function(t){var e=function(){function e(){}return e.getInstance=function(){return null===this._instance&&(this._instance=new this),this._instance},e.prototype.play=function(e){var r=t.VideoLoader.getInstance().get(e),n=null;t.Log.error(!r,t.Log.info.FUNC_NOT_EXIST("video asset which id is "+e)),n=r.video,n.play()},e._instance=null,e}();t.VideoManager=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.create=function(){var t=new this;return t},e}(t.Material);t.CustomMaterial=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,a=3>i?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(3>i?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},wd;!function(t){var e=function(e){function r(){e.apply(this,arguments),this._velocity=t.Vector3.create(0,0,0),this._angularVelocity=t.Vector3.create(0,0,0),this._mass=1}return __extends(r,e),r.create=function(){var t=new this;return t},Object.defineProperty(r.prototype,"velocity",{get:function(){return this._velocity},set:function(t){this._velocity=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"angularVelocity",{get:function(){return this._angularVelocity},set:function(t){this._angularVelocity=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"mass",{get:function(){return this._mass},set:function(t){this._mass=t},enumerable:!0,configurable:!0}),r.prototype.addBody=function(){this.addBodyToPhysicsEngine("addKinematicBody",{mass:this.mass,velocity:this.velocity,angularVelocity:this.angularVelocity})},__decorate([t.operateBodyDataGetterAndSetter("Velocity")],r.prototype,"velocity",null),__decorate([t.operateBodyDataGetterAndSetter("AngularVelocity")],r.prototype,"angularVelocity",null),__decorate([t.operateBodyDataGetterAndSetter("Mass")],r.prototype,"mass",null),r}(t.RigidBody);t.KinematicRigidBody=e}(wd||(wd={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},wd;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.create=function(){var t=new this;return t},e.prototype.addBody=function(){this.addBodyToPhysicsEngine("addStaticBody")},e}(t.RigidBody);t.StaticRigidBody=e}(wd||(wd={}));var wd;!function(t){function e(e){return function(r){t.Script.addScript(e,r)}}t.script=e}(wd||(wd={}));