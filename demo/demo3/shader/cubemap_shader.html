<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>cubemap shader</title>

    <script src="/DYEngine/dist/dy.innerLib.js" type="text/javascript"></script>
    <script src="/DYEngine/dist/dy.debug.js" type="text/javascript"></script>
    <script src="/DYEngine/bower_components/jquery/dist/jquery.js" type="text/javascript"></script>
</head>
<body>
<canvas id="canvas" width="600" height="400"></canvas>
<input id="inp"/>

<script>
    window.onload = function () {
        dy.Main.setConfig({
            canvasId: "canvas"
        });

        dy.LoaderManager.getInstance().load([
            {url: "../../res/1.jpg", id:"texture1"},
            {url: "../../res/2.jpg", id:"texture2"},
            {url: "../../res/3.jpg", id:"texture3"},
            {url: "../../res/4.jpg", id:"texture4"},
            {url: "../../res/5.jpg", id:"texture5"},
            {url: "../../res/6.jpg", id:"texture6"}
        ]).subscribe(null, function(e){
                    throw e;
                },
                function(){
                    init();
                });

        function init() {
            _initScene();
        }

        function _initScene() {
            var material = dy.SkyboxMaterial.create();


            var skyboxCubemapTexture = dy.CubeTexture.create(
                    [
                        {
                            asset:dy.TextureLoader.getInstance().get("texture1")
                        },
                        {
                            asset:dy.TextureLoader.getInstance().get("texture2")
                        },
                        {
                            asset:dy.TextureLoader.getInstance().get("texture3")
                        },
                        {
                            asset:dy.TextureLoader.getInstance().get("texture4")
                        },
                        {
                            asset:dy.TextureLoader.getInstance().get("texture5")
                        },
                        {
                            asset:dy.TextureLoader.getInstance().get("texture6")
                        }
                    ]
            );


//            material.textureManager.addChild(cubemap);
            material.setEnvMap(skyboxCubemapTexture);






            var geometry = dy.BoxGeometry.create();
            geometry.material = material;
            geometry.width = 5;
            geometry.height = 5;
            geometry.depth = 5;



            var box = dy.Skybox.create();

            box.addComponent(geometry);








            var material2 = dy.CubemapMaterial.create();
//            material2.reflect = true;

            var reflectCubemapTexture = dy.CubeTexture.create(skyboxCubemapTexture.assets);


            reflectCubemapTexture.mode = dy.CubemapMode.REFLECTION;

            material2.setEnvMap(reflectCubemapTexture);
//            material2.textureManager.addChild(cubemap);



            var geometry2 = dy.BoxGeometry.create();
            geometry2.material = material2;
            geometry2.width = 2;
            geometry2.height = 2;
            geometry2.depth = 2;



            var box2 = dy.GameObject.create();

            box2.addComponent(dy.MeshRenderer.create());
            box2.addComponent(geometry2);

            box2.transform.translate(dy.Vector3.create(-10, 0, 0));






            var material3 = dy.CubemapMaterial.create();

            var refractCubemapTexture = dy.CubeTexture.create(skyboxCubemapTexture.assets);


            refractCubemapTexture.mode = dy.CubemapMode.REFRACTION;

            material3.refractionRatio = 1.52;
            material3.setEnvMap(refractCubemapTexture);



//            material3.textureManager.addChild(cubemap);



            var geometry3 = dy.BoxGeometry.create();
            geometry3.material = material3;
            geometry3.width = 2;
            geometry3.height = 2;
            geometry3.depth = 2;



            var box3 = dy.GameObject.create();

            box3.addComponent(dy.MeshRenderer.create());
            box3.addComponent(geometry3);

            box3.transform.translate(dy.Vector3.create(0, 0, 0));
















            var material4 = dy.CubemapMaterial.create();


            var fresnelCubemapTexture = dy.CubeTexture.create(skyboxCubemapTexture.assets);


            fresnelCubemapTexture.mode = dy.CubemapMode.FRESNEL;

            material4.refractionRatio = 1.52;
            material4.reflectivity = 0;
            material4.setEnvMap(fresnelCubemapTexture);




            var geometry4 = dy.BoxGeometry.create();
            geometry4.material = material4;
            geometry4.width = 2;
            geometry4.height = 2;
            geometry4.depth = 2;



            var box4 = dy.GameObject.create();

            box4.addComponent(dy.MeshRenderer.create());
            box4.addComponent(geometry4);

            box4.transform.translate(dy.Vector3.create(10, 0, 0));








            var material5 = dy.CubemapMaterial.create();


            var cubemapTexture = dy.CubeTexture.create(skyboxCubemapTexture.assets);



            material5.setEnvMap(cubemapTexture);




            var geometry5 = dy.BoxGeometry.create();
            geometry5.material = material5;
            geometry5.width = 2;
            geometry5.height = 2;
            geometry5.depth = 2;



            var box5 = dy.GameObject.create();

            box5.addComponent(dy.MeshRenderer.create());
            box5.addComponent(geometry5);

            box5.transform.translate(dy.Vector3.create(0, 10, 0));











            var director = dy.Director.getInstance();


            director.stage.addChild(box);
            director.stage.addChild(box2);
            director.stage.addChild(box3);
            director.stage.addChild(box4);
            director.stage.addChild(box5);

            director.stage.addChild(_createCamera());




            director.stage.addComponent(dy.Script.create("../stage.js"));



            director.start();
        }

        function _createCamera() {
            var camera = dy.GameObject.create();

            var cameraComponent = dy.Camera.create();


            cameraComponent.fovy = 60;
            cameraComponent.aspect = canvas.width / canvas.height;
            cameraComponent.near = 0.1;
            cameraComponent.far = 100;


            camera.addComponent(cameraComponent);

            camera.transform.translate(dy.Vector3.create(0, 0, 20));

            var script = dy.Script.create();

            script.url = "../camera.js";

            camera.addComponent(script);

            return camera
        }

    };
</script>
</body>
</html>
